{
    "version": "https://jsonfeed.org/version/1",
    "title": "LinuxSre云原生 • All posts by \"ansible\" tag",
    "description": "专注于 Linux 运维、云计算、云原⽣等技术",
    "home_page_url": "http://ixuyong.cn",
    "items": [
        {
            "id": "http://ixuyong.cn/posts/2794181051.html",
            "url": "http://ixuyong.cn/posts/2794181051.html",
            "title": "Ansible快速入门",
            "date_published": "2025-10-25T12:13:11.000Z",
            "content_html": "<h4 id=\"1ansible快速入门\"><a class=\"anchor\" href=\"#1ansible快速入门\">#</a> <strong>1.Ansible</strong> 快速入门</h4>\n<h5 id=\"11-什么是ansible\"><a class=\"anchor\" href=\"#11-什么是ansible\">#</a> <strong>1.1</strong> <strong>什么是</strong> Ansible</h5>\n<p>Ansible 是一个 IT 自动化的配置管理工具，自动化主要体现在 Ansible 集成了丰富模块，以及强大的功能组件，可以通过一个命令行完成一系列的操作。进而能减少我们重复性的工作，以提高工作的效率。</p>\n<p><img loading=\"lazy\" data-src=\"https://wp-cdn.4ce.cn/v2/nc8kngg.png\" alt=\"\" /></p>\n<h5 id=\"12-ansible主要功能\"><a class=\"anchor\" href=\"#12-ansible主要功能\">#</a> <strong>1.2 Ansible</strong> 主要功能</h5>\n<ul>\n<li>批量执行远程命令，可以对 N 多台主机同时进行命令的执行。</li>\n<li>批量配置软件服务，可以进行自动化的方式配置和管理服务。</li>\n<li>实现软件开发功能， jumpserver 底层使用 ansible 来实现的自动化管理。</li>\n<li>编排高级的 IT 任务， Ansible 的 Playbook 是一门编程语言，可以用来描绘一套 IT 架构。</li>\n</ul>\n<h5 id=\"13-ansible的特点\"><a class=\"anchor\" href=\"#13-ansible的特点\">#</a> <strong>1.3 Ansible</strong> 的特点</h5>\n<ul>\n<li>容易学习：无代理，不像 salt 既要学客户端与服务端，还需要学习客户端与服务端中间通讯协议；</li>\n<li>操作灵活： Ansible 有较多的模块，提供了丰富的功能、playbook 则提供类似于编程语言的复杂功能；</li>\n<li>简单易用：体现在 Ansible 一个命令可以完成很多事情；</li>\n<li>安全可靠：因为 Ansible 使用了 SSH 协议进行通讯，既稳定也安全；</li>\n<li>移植性高：可以将写好的 playbook 拷贝至任意机器进行执行；</li>\n<li>幂等性：一个任务执行 1 遍和执行 n 遍效果一样，不会因为重复执行带来意外情况；</li>\n</ul>\n<h5 id=\"14-ansible基础架构\"><a class=\"anchor\" href=\"#14-ansible基础架构\">#</a> <strong>1.4 Ansible</strong> 基础架构</h5>\n<p>Ansible 架构中的控制节点、被控制节点、 inventroy、ad-hoc、playbook、Connection Protocol 是什么？</p>\n<p><img loading=\"lazy\" data-src=\"https://wp-cdn.4ce.cn/v2/P3IN0Ko.png\" alt=\"\" /></p>\n<h4 id=\"2ansible安装与配置\"><a class=\"anchor\" href=\"#2ansible安装与配置\">#</a> <strong>2.Ansible</strong> 安装与配置</h4>\n<h5 id=\"21-rpm安装\"><a class=\"anchor\" href=\"#21-rpm安装\">#</a> <strong>2.1 rpm</strong> 安装</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#1. 下载 epel 源</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum install ansible -y</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#2. 查看版本</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ansible --version</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#3. 测试是否可用</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ansible localhost -m ping</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>localhost <span class=\"token operator\">|</span> SUCCESS <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token string\">\"changed\"</span><span class=\"token builtin class-name\">:</span> false, </pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token string\">\"ping\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"pong\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h5 id=\"22-pip安装\"><a class=\"anchor\" href=\"#22-pip安装\">#</a> <strong>2.2 pip</strong> 安装</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#1.pip 安装</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum install python3 python3-devel python3-pip -y</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># pip3 install --upgrade pip -i https://pypi.douban.com/simple/</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># pip3 install ansible -i https://pypi.douban.com/simple/</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># /usr/local/bin/ansible --version</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#2. 查看版本</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ansible --version</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">#3. 测试是否可用</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ansible localhost -m ping</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>localhost <span class=\"token operator\">|</span> SUCCESS <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token string\">\"changed\"</span><span class=\"token builtin class-name\">:</span> false, </pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token string\">\"ping\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"pong\"</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h4 id=\"3ansible配置\"><a class=\"anchor\" href=\"#3ansible配置\">#</a> <strong>3.Ansible</strong> 配置</h4>\n<h5 id=\"31-ansible配置路径\"><a class=\"anchor\" href=\"#31-ansible配置路径\">#</a> <strong>3.1 Ansible</strong> 配置路径</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@web01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># rpm -qc ansible</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>/etc/ansible/ansible.cfg   <span class=\"token comment\">#主配置文件，配置 ansible 工作特性</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>/etc/ansible/hosts         <span class=\"token comment\">#配置主机清单文件</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>/etc/ansible/roles/        <span class=\"token comment\">#存放 ansible 角色的目录</span></pre></td></tr></table></figure><h5 id=\"32-ansible主配置文件\"><a class=\"anchor\" href=\"#32-ansible主配置文件\">#</a> <strong>3.2 Ansible</strong> 主配置文件</h5>\n<p>ansible 的主配置文件存在 /etc/anible/ansible.cfg ，其中大部分的配置内容无需进行修改；</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#inventory      = /etc/ansible/hosts\t\t\t\t\t\t\t# 主机列表配置文件</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#inventory      = ./hosts\t\t\t\t\t\t\t\t\t\t# 路径重新定义</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#library        = /usr/share/my_modules/                        #库文件存放目录</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">#module_utils   = /usr/share/my_module_utils/                   #模块件存放目录</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#remote_tmp     = ~/.ansible/tmp                                #临时 py 文件存放在远程主机目录</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">#local_tmp      = ~/.ansible/tmp                                #本机的临时执行目录</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">#plugin_filters_cfg = /etc/ansible/plugin_filters.yml</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#forks          = 5\t\t\t\t\t\t\t\t\t\t\t\t# 默认并发数\t\t\t\t</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">#roles_path    = /etc/ansible/roles                             #角色存储路径</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">#sudo_user      = root                                          #默认 sudo 用户</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">#ask_sudo_pass = True                                           #每次执行是否询问 sudo 的 ssh 密码</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">#ask_pass      = True                                           #每次执行是否询问 ssh 密码</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">#remote_port    = 22                                            #远程主机端口</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">#host_key_checking = False                                      #检查对应服务器的 host_key，建议取消</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">#log_path = /var/log/ansible.log                                #ansible 日志，建议启用</span></pre></td></tr></table></figure><h5 id=\"33-ansible配置优先级\"><a class=\"anchor\" href=\"#33-ansible配置优先级\">#</a> <strong>3.3 Ansible</strong> 配置优先级</h5>\n<p>Ansible 的配置文件可以存放在任何位置，但配置文件有读取顺序，查找顺序如下：</p>\n<ul>\n<li>1、最先查找 $ANSIBLE_CONFIG 变量</li>\n<li>2、其次查找当前目录下 ansible.cfg</li>\n<li>3、然后查找用户家目录下的 .ansible.cfg</li>\n<li>4、最后查找 /etc/ansible/ansible.cfg</li>\n</ul>\n<p>通过命令行操作演示，验证结论:</p>\n<p>第一步读取：ANSIBLE_CONFIG</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># export ANSIBLE_CONFIG=/tmp/ansible.cfg</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># touch /tmp/ansible.cfg</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ansible --version</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@web01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ansible --version</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>ansible <span class=\"token number\">2.9</span>.27</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  config <span class=\"token function\">file</span> <span class=\"token operator\">=</span> /tmp/ansible.cfg</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># unset ANSIBLE_CONFIG\t\t\t# 取消</span></pre></td></tr></table></figure><p>第二步读取：当前项目目录下的 ansible.cfg</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir project1</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cd project1/</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager project1<span class=\"token punctuation\">]</span><span class=\"token comment\"># touch ansible.cfg</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager project1<span class=\"token punctuation\">]</span><span class=\"token comment\"># ansible --version</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>ansible <span class=\"token number\">2.9</span>.27</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  config <span class=\"token function\">file</span> <span class=\"token operator\">=</span> /root/project1/ansible.cfg</pre></td></tr></table></figure><p>第三步读取：当前用户家目录下的 .ansible.cfg</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># touch ~/.ansible.cfg</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ansible --version</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>ansible <span class=\"token number\">2.9</span>.27</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  config <span class=\"token function\">file</span> <span class=\"token operator\">=</span> /root/.ansible.cfg</pre></td></tr></table></figure><p>第四步读取: /etc/ansible/ansible.cfg</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager project1<span class=\"token punctuation\">]</span><span class=\"token comment\"># rm -f ~/.ansible.cfg</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ansible --version</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>ansible <span class=\"token number\">2.9</span>.27</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  config <span class=\"token function\">file</span> <span class=\"token operator\">=</span> /etc/ansible/ansible.cfg</pre></td></tr></table></figure><h4 id=\"4ansible-inventory\"><a class=\"anchor\" href=\"#4ansible-inventory\">#</a> <strong>4.Ansible Inventory</strong></h4>\n<h5 id=\"41-inventory是什么\"><a class=\"anchor\" href=\"#41-inventory是什么\">#</a> <strong>4.1 Inventory</strong> 是什么</h5>\n<ul>\n<li>Inventory 文件主要用来填写被管理主机以及主机组信息；</li>\n<li>默认 Inventory 文件为 /etc/ansible/hosts ；</li>\n<li>当然也可以自定义一个文件，当执行 ansible 命令时使用 -i 选项指定 Inventory 文件位置；</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/ansible/hosts </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>webservers<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">172.16</span>.1.7</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">172.16</span>.1.8</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">172.16</span>.1.9</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">[</span>dbservers<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">172.16</span>.1.51\t</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">172.16</span>.1.41\t</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>db<span class=\"token punctuation\">[</span>01:08<span class=\"token punctuation\">]</span>.ixuyong.cn</pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">[</span>testservers<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>test<span class=\"token punctuation\">[</span>01:99<span class=\"token punctuation\">]</span>-node.ixuyong.cn</pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ansible dbservers --list-hosts </span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  hosts <span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span>:</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token number\">172.16</span>.1.51</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token number\">172.16</span>.1.41</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    db01.ixuyong.cn</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    db02.ixuyong.cn</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    db03.ixuyong.cn</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    db04.ixuyong.cn</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    db05.ixuyong.cn</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    db06.ixuyong.cn</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    db07.ixuyong.cn</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    db08.ixuyong.cn</pre></td></tr></table></figure><h5 id=\"42-inventory密码连接方式\"><a class=\"anchor\" href=\"#42-inventory密码连接方式\">#</a> <strong>4.2 Inventory</strong> 密码连接方式</h5>\n<p>1. 指定主机 IP，指定主机端口，指定主机用户名、密码；</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/ansible/hosts </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>webservers<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">172.16</span>.1.7 <span class=\"token assign-left variable\">ansible_ssh_port</span><span class=\"token operator\">=</span><span class=\"token number\">22</span> <span class=\"token assign-left variable\">ansible_ssh_user</span><span class=\"token operator\">=</span>root <span class=\"token assign-left variable\">ansible_ssh_pass</span><span class=\"token operator\">=</span><span class=\"token string\">'talent'</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">172.16</span>.1.8 <span class=\"token assign-left variable\">ansible_ssh_port</span><span class=\"token operator\">=</span><span class=\"token number\">22</span> <span class=\"token assign-left variable\">ansible_ssh_user</span><span class=\"token operator\">=</span>root <span class=\"token assign-left variable\">ansible_ssh_pass</span><span class=\"token operator\">=</span><span class=\"token string\">'talent'</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>dbservers<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">172.16</span>.1.51 <span class=\"token assign-left variable\">ansible_ssh_port</span><span class=\"token operator\">=</span><span class=\"token number\">22</span> <span class=\"token assign-left variable\">ansible_ssh_user</span><span class=\"token operator\">=</span>root <span class=\"token assign-left variable\">ansible_ssh_pass</span><span class=\"token operator\">=</span><span class=\"token string\">'talent'</span>\t</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">172.16</span>.1.41 <span class=\"token assign-left variable\">ansible_ssh_port</span><span class=\"token operator\">=</span><span class=\"token number\">22</span> <span class=\"token assign-left variable\">ansible_ssh_user</span><span class=\"token operator\">=</span>root <span class=\"token assign-left variable\">ansible_ssh_pass</span><span class=\"token operator\">=</span><span class=\"token string\">'talent'</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ansible webservers -m ping</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">172.16</span>.1.7 <span class=\"token operator\">|</span> SUCCESS <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token string\">\"ansible_facts\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token string\">\"discovered_interpreter_python\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"/usr/bin/python\"</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span>, </pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token string\">\"changed\"</span><span class=\"token builtin class-name\">:</span> false, </pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token string\">\"ping\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"pong\"</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token number\">172.16</span>.1.8 <span class=\"token operator\">|</span> SUCCESS <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token string\">\"ansible_facts\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token string\">\"discovered_interpreter_python\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"/usr/bin/python\"</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span>, </pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token string\">\"changed\"</span><span class=\"token builtin class-name\">:</span> false, </pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token string\">\"ping\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"pong\"</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>2. 通过变量方式定义密码；</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/ansible/hosts </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>webservers<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">172.16</span>.1.7 <span class=\"token assign-left variable\">ansible_ssh_port</span><span class=\"token operator\">=</span><span class=\"token number\">22</span> <span class=\"token assign-left variable\">ansible_ssh_user</span><span class=\"token operator\">=</span>root <span class=\"token assign-left variable\">ansible_ssh_pass</span><span class=\"token operator\">=</span><span class=\"token string\">'talent'</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">172.16</span>.1.8 <span class=\"token assign-left variable\">ansible_ssh_port</span><span class=\"token operator\">=</span><span class=\"token number\">22</span> <span class=\"token assign-left variable\">ansible_ssh_user</span><span class=\"token operator\">=</span>root <span class=\"token assign-left variable\">ansible_ssh_pass</span><span class=\"token operator\">=</span><span class=\"token string\">'talent'</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>dbservers<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">172.16</span>.1.51</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">172.16</span>.1.41</pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">[</span>dbservers:vars<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token assign-left variable\">ansible_ssh_port</span><span class=\"token operator\">=</span><span class=\"token number\">22</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token assign-left variable\">ansible_ssh_user</span><span class=\"token operator\">=</span>root</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token assign-left variable\">ansible_ssh_pass</span><span class=\"token operator\">=</span><span class=\"token string\">'talent'</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ansible dbservers -m ping</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token number\">172.16</span>.1.41 <span class=\"token operator\">|</span> SUCCESS <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token string\">\"ansible_facts\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token string\">\"discovered_interpreter_python\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"/usr/bin/python\"</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span>, </pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token string\">\"changed\"</span><span class=\"token builtin class-name\">:</span> false, </pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token string\">\"ping\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"pong\"</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token number\">172.16</span>.1.51 <span class=\"token operator\">|</span> SUCCESS <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token string\">\"ansible_facts\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token string\">\"discovered_interpreter_python\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"/usr/bin/python\"</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span>, </pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token string\">\"changed\"</span><span class=\"token builtin class-name\">:</span> false, </pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token string\">\"ping\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"pong\"</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h5 id=\"43-inventory秘钥连接方式\"><a class=\"anchor\" href=\"#43-inventory秘钥连接方式\">#</a> 4.3 Inventory 秘钥连接方式</h5>\n<p>1. 创建秘钥对，然后下发秘钥；</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ssh-keygen </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ssh-copy-id -i ~/.ssh/id_rsa.pub root@172.16.1.7</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ssh-copy-id -i ~/.ssh/id_rsa.pub root@172.16.1.8</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ssh-copy-id -i ~/.ssh/id_rsa.pub root@172.16.1.41</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ssh-copy-id -i ~/.ssh/id_rsa.pub root@172.16.1.51</span></pre></td></tr></table></figure><p>2. 测试连通性</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/ansible/hosts </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>webservers<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">172.16</span>.1.7</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">172.16</span>.1.8</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>dbservers<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">172.16</span>.1.51</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">172.16</span>.1.41</pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ansible all -m ping</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">172.16</span>.1.41 <span class=\"token operator\">|</span> SUCCESS <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token string\">\"ansible_facts\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token string\">\"discovered_interpreter_python\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"/usr/bin/python\"</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span>, </pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token string\">\"changed\"</span><span class=\"token builtin class-name\">:</span> false, </pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token string\">\"ping\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"pong\"</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token number\">172.16</span>.1.7 <span class=\"token operator\">|</span> SUCCESS <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token string\">\"ansible_facts\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token string\">\"discovered_interpreter_python\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"/usr/bin/python\"</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span>, </pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token string\">\"changed\"</span><span class=\"token builtin class-name\">:</span> false, </pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token string\">\"ping\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"pong\"</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token number\">172.16</span>.1.51 <span class=\"token operator\">|</span> SUCCESS <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token string\">\"ansible_facts\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token string\">\"discovered_interpreter_python\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"/usr/bin/python\"</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span>, </pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token string\">\"changed\"</span><span class=\"token builtin class-name\">:</span> false, </pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token string\">\"ping\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"pong\"</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token number\">172.16</span>.1.8 <span class=\"token operator\">|</span> SUCCESS <span class=\"token operator\">=</span><span class=\"token operator\">></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token string\">\"ansible_facts\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token string\">\"discovered_interpreter_python\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"/usr/bin/python\"</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span>, </pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token string\">\"changed\"</span><span class=\"token builtin class-name\">:</span> false, </pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token string\">\"ping\"</span><span class=\"token builtin class-name\">:</span> <span class=\"token string\">\"pong\"</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h5 id=\"44-inventory主机匹配方式\"><a class=\"anchor\" href=\"#44-inventory主机匹配方式\">#</a> 4.4 Inventory 主机匹配方式</h5>\n<p>ansible 的 host-pattern 主机匹配使用说明；</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#1. 指定操作所有的组</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>ansible all <span class=\"token parameter variable\">-m</span> <span class=\"token function\">ping</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">#2. 通配符</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>ansible <span class=\"token string\">\"*\"</span> <span class=\"token parameter variable\">-m</span> <span class=\"token function\">ping</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>ansible web* <span class=\"token parameter variable\">-m</span> <span class=\"token function\">ping</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#3. 与：在 webservers 组；并且在 dbsservers 中的主机；</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>ansible <span class=\"token string\">\"webservers:&amp;dbservers\"</span> <span class=\"token parameter variable\">-m</span> <span class=\"token function\">ping</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">#4. 或：在 webservers 组，或者在 appservers 中的主机；</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>ansible <span class=\"token string\">\"webservers:appservers\"</span> <span class=\"token parameter variable\">-m</span> <span class=\"token function\">ping</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">#5. 非：在 webservers 组，但不在 apps 组中的主机</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>ansible <span class=\"token string\">'webservers:!apps'</span> <span class=\"token parameter variable\">-m</span> <span class=\"token function\">ping</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">#6. 正则表达式；</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>ansible <span class=\"token string\">\"~(web|db).*\\.oldxu\\.com\"</span> <span class=\"token parameter variable\">-m</span> <span class=\"token function\">ping</span></pre></td></tr></table></figure><h5 id=\"45-普通用户管理被控端\"><a class=\"anchor\" href=\"#45-普通用户管理被控端\">#</a> 4.5 普通用户管理被控端</h5>\n<p>场景说明： ansible 使用 xuyong 普通用户统一管理所有的被控端节点</p>\n<p>1. 首先控制端，被控端，都需要有 olxu 用户</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># useradd xuyong</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># echo \"talent\" | passwd --stdin xuyong</span></pre></td></tr></table></figure><p>2. 将控制端 xuyong 用户的公钥推送到被控端 xuyong 用户下，使普通用户能进行免密码登录</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># su xuyong</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>xuyong@manager root<span class=\"token punctuation\">]</span>$ ssh-keygen </pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>xuyong@manager root<span class=\"token punctuation\">]</span>$ ssh-copy-id <span class=\"token parameter variable\">-i</span> ~/.ssh/id_rsa.pub xuyong@172.16.1.7</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>xuyong@manager root<span class=\"token punctuation\">]</span>$ ssh-copy-id <span class=\"token parameter variable\">-i</span> ~/.ssh/id_rsa.pub xuyong@172.16.1.8</pre></td></tr></table></figure><p>3. 所有主机的 xuyong 用户都必须添加 sudo 权限。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@web01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim /etc/sudoers</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>xuyong  <span class=\"token assign-left variable\">ALL</span><span class=\"token operator\">=</span><span class=\"token punctuation\">(</span>ALL<span class=\"token punctuation\">)</span>       NOPASSWD: ALL</pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># 检查语法</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@web01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># visudo -csf /etc/sudoers</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>/etc/sudoers: parsed OK</pre></td></tr></table></figure><p>4. 修改控制端 /etc/ansible/ansible.cfg 主配置文件，配置普通用户提权</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim /etc/ansible/ansible.cfg</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>privilege_escalation<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token assign-left variable\">become</span><span class=\"token operator\">=</span>True</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">become_method</span><span class=\"token operator\">=</span>sudo</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token assign-left variable\">become_user</span><span class=\"token operator\">=</span>root</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token assign-left variable\">become_ask_pass</span><span class=\"token operator\">=</span>False</pre></td></tr></table></figure><p>5. 使用 xuyong 用户测试是否能执行任务</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>xuyong@manager root<span class=\"token punctuation\">]</span>$ ansible webservers <span class=\"token parameter variable\">-m</span> shell <span class=\"token parameter variable\">-a</span> <span class=\"token string\">\"mkdir /opt/test\"</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>WARNING<span class=\"token punctuation\">]</span>: Consider using the <span class=\"token function\">file</span> module with <span class=\"token assign-left variable\">state</span><span class=\"token operator\">=</span>directory rather than running <span class=\"token string\">'mkdir'</span><span class=\"token builtin class-name\">.</span>  If you need to use <span class=\"token builtin class-name\">command</span> because</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">file</span> is insufficient you can <span class=\"token function\">add</span> <span class=\"token string\">'warn: false'</span> to this <span class=\"token builtin class-name\">command</span> task or <span class=\"token builtin class-name\">set</span> <span class=\"token string\">'command_warnings=False'</span> <span class=\"token keyword\">in</span> ansible.cfg to get rid of</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>this message.</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">172.16</span>.1.7 <span class=\"token operator\">|</span> CHANGED <span class=\"token operator\">|</span> <span class=\"token assign-left variable\">rc</span><span class=\"token operator\">=</span><span class=\"token number\">0</span> <span class=\"token operator\">>></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">172.16</span>.1.8 <span class=\"token operator\">|</span> CHANGED <span class=\"token operator\">|</span> <span class=\"token assign-left variable\">rc</span><span class=\"token operator\">=</span><span class=\"token number\">0</span> <span class=\"token operator\">>></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span>root@web01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll /opt/</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>drwxr-xr-x <span class=\"token number\">2</span> root root <span class=\"token number\">6</span> Oct <span class=\"token number\">22</span> <span class=\"token number\">20</span>:56 <span class=\"token builtin class-name\">test</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">[</span>root@web02 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll /opt/</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>drwxr-xr-x <span class=\"token number\">2</span> root root <span class=\"token number\">6</span> Oct <span class=\"token number\">22</span> <span class=\"token number\">20</span>:56 <span class=\"token builtin class-name\">test</span></pre></td></tr></table></figure><h4 id=\"5ansible-ad-hoc\"><a class=\"anchor\" href=\"#5ansible-ad-hoc\">#</a> 5.Ansible ad-hoc</h4>\n<h5 id=\"51-ad-hoc是什么\"><a class=\"anchor\" href=\"#51-ad-hoc是什么\">#</a> <strong>5.1 ad-hoc</strong> 是什么</h5>\n<p>ad-hoc 简而言之就是 “临时命令”，执行完即结束，并不会保存；</p>\n<ul>\n<li>应用场景 1：查看多台节点的进程是否存在；</li>\n<li>应用场景 2：拷贝指定的文件至本地；</li>\n</ul>\n<h5 id=\"52-ad-hoc命令使用\"><a class=\"anchor\" href=\"#52-ad-hoc命令使用\">#</a> <strong>5.2 ad-hoc</strong> 命令使用</h5>\n<p>命令示例： ansible 'groups' -m command -a 'df -h' ，含义如下图所示；</p>\n<p><img loading=\"lazy\" data-src=\"https://wp-cdn.4ce.cn/v2/lkvDn50.jpeg\" alt=\"\" /></p>\n<h5 id=\"53-ad-hoc执行过程\"><a class=\"anchor\" href=\"#53-ad-hoc执行过程\">#</a> <strong>5.3 ad-hoc</strong> 执行过程</h5>\n<ul>\n<li>1. 加载自己的配置文件，默认 /etc/ansible/ansible.cfg ；</li>\n<li>2. 查找对应的主机配置文件，找到要执行的主机或者组；</li>\n<li>3. 加载自己对应的模块文件，如 command ；</li>\n<li>4. 通过 ansible 将模块或命令生成对应的临时 py 文件，并将该文件传输至远程服务器对应执行用户 $HOME/.ansible/tmp/ansible-tmp-number/xxx.py；</li>\n<li>5. 执行用户家目录的 py 文件；</li>\n<li>6. 给文件 +x 执行；</li>\n<li>7. 执行并返回结果；</li>\n<li>8. 删除临时 py 文件， sleep 0 退出</li>\n</ul>\n<h5 id=\"54-ad-hoc执行状态\"><a class=\"anchor\" href=\"#54-ad-hoc执行状态\">#</a> <strong>5.4 ad-hoc</strong> 执行状态</h5>\n<p>使用 ad-hoc 执行一次远程命令，注意观察返回结果的颜色；</p>\n<ul>\n<li>绿色：代表被管理端主机没有被修改</li>\n<li>黄色：代表被管理端主机发现变更</li>\n<li>红色：代表出现了故障，注意查看提示</li>\n</ul>\n<h4 id=\"6ansible常用模块\"><a class=\"anchor\" href=\"#6ansible常用模块\">#</a> <strong>6.Ansible</strong> 常用模块</h4>\n<p>ansible 有着诸多的模块，虽然模块众多，但最为常用的模块也就 20-30 个左右；</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ansible-doc yum</span></pre></td></tr></table></figure><h5 id=\"61-command模块\"><a class=\"anchor\" href=\"#61-command模块\">#</a> <strong>6.1 command</strong> 模块</h5>\n<p>功能：在远程主机执行 Shell 命令；此为默认模块，可忽略 -m 选项；</p>\n<p><em>注意：shell 支持  | 管道符号，command 不支持管道命令 |</em></p>\n<table>\n<thead>\n<tr>\n<th><strong>参数</strong></th>\n<th><strong>选项</strong></th>\n<th><strong>含义</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>chdir</td>\n<td>chdir /opt</td>\n<td>执行 ansible 时，切换到指定的目录</td>\n</tr>\n<tr>\n<td>creates</td>\n<td>creates /data/file</td>\n<td>如果文件存在，则跳过执行</td>\n</tr>\n<tr>\n<td>removes</td>\n<td>removes /data/file</td>\n<td>如果文件存在，则执行</td>\n</tr>\n</tbody>\n</table>\n<p>1.chdir 切换目录执行 Shell 命令；</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager project<span class=\"token punctuation\">]</span><span class=\"token comment\"># ansible webservers -m command -a \"creates=/tmp/log ifconfig ens192\"</span></pre></td></tr></table></figure><p>2.creates 如果 /data/file 文件存在，则不执行，如果不存在，就不执行；</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ansible webservers -m command -a 'creates=/data/file ifconfig ens192'</span></pre></td></tr></table></figure><ol start=\"3\">\n<li>removes 如果 /data/file 文件存在，则执行；</li>\n</ol>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ansible webservers -m command -a 'removes=/data/file ifconfig ens192'</span></pre></td></tr></table></figure><h5 id=\"62-shell模块\"><a class=\"anchor\" href=\"#62-shell模块\">#</a> <strong>6.2 shell</strong> 模块</h5>\n<p>功能：在远程主机执行 Shell 命令，执行管道等特殊符号的操作；</p>\n<table>\n<thead>\n<tr>\n<th><strong>参数</strong></th>\n<th><strong>选项</strong></th>\n<th><strong>含义</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>chdir</td>\n<td>chdir /opt</td>\n<td>执行 ansible 时，切换到指定的目录</td>\n</tr>\n<tr>\n<td>creates</td>\n<td>creates /data/file</td>\n<td>如果文件存在，则跳过执行</td>\n</tr>\n<tr>\n<td>removes</td>\n<td>removes /data/file</td>\n<td>如果文件存在，则执行</td>\n</tr>\n</tbody>\n</table>\n<p>1. 使用 Shell 命令过滤被控端主机的 IP 地址；</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ansible webservers -m shell -a \"ifconfig ens192 | awk 'NR==2'\"</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">192.168</span>.1.8 <span class=\"token operator\">|</span> CHANGED <span class=\"token operator\">|</span> <span class=\"token assign-left variable\">rc</span><span class=\"token operator\">=</span><span class=\"token number\">0</span> <span class=\"token operator\">>></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        inet <span class=\"token number\">192.168</span>.1.8  netmask <span class=\"token number\">255.255</span>.255.0  broadcast <span class=\"token number\">192.168</span>.1.255</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">192.168</span>.1.7 <span class=\"token operator\">|</span> CHANGED <span class=\"token operator\">|</span> <span class=\"token assign-left variable\">rc</span><span class=\"token operator\">=</span><span class=\"token number\">0</span> <span class=\"token operator\">>></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        inet <span class=\"token number\">192.168</span>.1.7  netmask <span class=\"token number\">255.255</span>.255.0  broadcast <span class=\"token number\">192.168</span>.1.255</pre></td></tr></table></figure><h5 id=\"63-yum模块\"><a class=\"anchor\" href=\"#63-yum模块\">#</a> <strong>6.3 yum</strong> 模块</h5>\n<p>功能：管理各个操作系统的软件包；</p>\n<table>\n<thead>\n<tr>\n<th><strong>参数</strong></th>\n<th><strong>选项</strong></th>\n<th><strong>含义</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>name</td>\n<td>httpd、nginx、 ...</td>\n<td>指定安装软件包名或软件包 URL</td>\n</tr>\n<tr>\n<td>state</td>\n<td>present (安装)-(default)、absent (删除)、latest (最新版)</td>\n<td>指定 yum 对应的方法</td>\n</tr>\n<tr>\n<td>enablerepo</td>\n<td>epel、base、...</td>\n<td>允许从哪些仓库获取软件</td>\n</tr>\n<tr>\n<td>disablerepo</td>\n<td>epel、base、...</td>\n<td>禁止从哪些仓库获取软件</td>\n</tr>\n<tr>\n<td>exclude</td>\n<td>kernel、...</td>\n<td>排除某些软件包</td>\n</tr>\n<tr>\n<td>download_only</td>\n<td>yes、no</td>\n<td>仅下载软件包，不安装</td>\n</tr>\n</tbody>\n</table>\n<p>1. 安装当前最新的 Apache 软件，如果存在则不安装</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@manger ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ansible webservers -m yum -a \"name=httpd state=present\"</span></pre></td></tr></table></figure><p>2. 安装当前最新的 Apache 软件，通过 epel 仓库安装</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@manger ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ansible webservers -m yum -a \"name=httpd state=present enablerepo=epel\"</span></pre></td></tr></table></figure><p>3. 通过公网 URL 安装 rpm 软件</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@manger ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ansible webservers -m yum -a \"name=https://xx.rpm state=present\"</span></pre></td></tr></table></figure><p>4. 安装最新版本的 Apache 软件，如果存在则更新 Apache</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@manger ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ansible webservers -m yum -a \"name=httpd state=latest\"</span></pre></td></tr></table></figure><p>5. 更新所有的软件包，但排除和 kernel 相关的</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@manger ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ansible webservers -m yum -a \"name=* state=latest exclude=kernel\"</span></pre></td></tr></table></figure><p>6. 删除 Apache 软件</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@manger ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ansible webservers -m yum -a \"name=httpd state=absent\"</span></pre></td></tr></table></figure><h5 id=\"64-copy模块\"><a class=\"anchor\" href=\"#64-copy模块\">#</a> <strong>6.4 copy</strong> 模块</h5>\n<p>功能：从 ansible 服务端主控端复制文件到远程主机；</p>\n<table>\n<thead>\n<tr>\n<th><strong>参数</strong></th>\n<th><strong>选项</strong></th>\n<th><strong>含义</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>src</td>\n<td></td>\n<td>复制本地目录下的文件至远程服务器</td>\n</tr>\n<tr>\n<td>dest</td>\n<td></td>\n<td>文件复制到远程的绝对路径</td>\n</tr>\n<tr>\n<td>owner</td>\n<td>root(Defaults)</td>\n<td>文件复制到远程并设定属主</td>\n</tr>\n<tr>\n<td>group</td>\n<td>root(Defaults)</td>\n<td>文件复制到远程并设定属组</td>\n</tr>\n<tr>\n<td>mode</td>\n<td>file=644，directory=755</td>\n<td>文件复制到远程并设定权限</td>\n</tr>\n<tr>\n<td>backup</td>\n<td>yes</td>\n<td>备份被修改前的配置文件</td>\n</tr>\n<tr>\n<td>content</td>\n<td></td>\n<td>新建文件并给文件添加内容</td>\n</tr>\n</tbody>\n</table>\n<p>1. 将本地的 httpd.conf 文件 Listen 端口修改为 8080 ，推送至远程服务器</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@manger ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ansible webservers -m copy -a \"src=./httpd.conf dest=/etc/httpd/conf/httpd.conf</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token assign-left variable\">owner</span><span class=\"token operator\">=</span>root <span class=\"token assign-left variable\">group</span><span class=\"token operator\">=</span>root <span class=\"token assign-left variable\">mode</span><span class=\"token operator\">=</span><span class=\"token number\">644</span>\"</pre></td></tr></table></figure><p>2. 将本地的 httpd.conf 文件 Listen 端口修改为 9090 ，推送至远程服务器，然后检查远端是否存在上一次的备份文件</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@manger ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ansible webservers -m copy -a \"src=./httpd.conf dest=/etc/httpd/conf/httpd.conf</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token assign-left variable\">owner</span><span class=\"token operator\">=</span>root <span class=\"token assign-left variable\">group</span><span class=\"token operator\">=</span>root <span class=\"token assign-left variable\">mode</span><span class=\"token operator\">=</span><span class=\"token number\">644</span> <span class=\"token assign-left variable\">backup</span><span class=\"token operator\">=</span>yes\"</pre></td></tr></table></figure><p>3. 往远程的主机文件中写入内容，如果文件不存在则创建</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@manger ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ansible webservers -m copy -a 'content=\"oldxu.net123\" dest=/etc/rsync.pass owner=root group=root mode=\"0600\" backup=yes</span></pre></td></tr></table></figure><p>4. 验证 sudo 配置是否正确（adhoc 测试失败）</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager project<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat sudoers.yaml </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>- hosts: webservers</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  tasks:</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  - name: Copy a <span class=\"token string\">\"sudoers\"</span> <span class=\"token function\">file</span> on the remote machine <span class=\"token keyword\">for</span> editing</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    copy:</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      src: ./sudoers</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      dest: /etc/sudoers</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      validate: /usr/sbin/visudo <span class=\"token parameter variable\">-csf</span> %s</pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager project<span class=\"token punctuation\">]</span><span class=\"token comment\"># ansible-playbook sudoers.yaml</span></pre></td></tr></table></figure><h5 id=\"65-systemd模块\"><a class=\"anchor\" href=\"#65-systemd模块\">#</a> <strong>6.5 systemd</strong> 模块</h5>\n<p>功能：管理服务启动与停止，与 service 模块用法一致；</p>\n<table>\n<thead>\n<tr>\n<th><strong>参数</strong></th>\n<th><strong>选项</strong></th>\n<th><strong>含义</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>name</td>\n<td>httpd、nginx、...</td>\n<td>定义要启动服务的名称</td>\n</tr>\n<tr>\n<td>state</td>\n<td>started、stopped、restarted、reloaded</td>\n<td>指定服务状态</td>\n</tr>\n<tr>\n<td>enabled</td>\n<td>yes、no</td>\n<td>允许服务开机自启或禁止服务开机自启</td>\n</tr>\n</tbody>\n</table>\n<p>1. 启动 Httpd 服务</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@manger ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ansible webservers -m systemd -a \"name=httpd state=started\"</span></pre></td></tr></table></figure><p>2. 重载 Httpd 服务</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@manger ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ansible webservers -m systemd -a \"name=httpd state=reloaded\"</span></pre></td></tr></table></figure><p>3. 重启 Httpd 服务</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@manger ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ansible webservers -m systemd -a \"name=httpd state=restarted\"</span></pre></td></tr></table></figure><p>4. 停止 Httpd 服务</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@manger ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ansible webservers -m systemd -a \"name=httpd state==stopped\"</span></pre></td></tr></table></figure><p>5. 启动 Httpd 服务，并加入开机自启</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@manger ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ansible webservers -m systemd -a \"name=httpd state=started enabled=yes\"</span></pre></td></tr></table></figure><h5 id=\"66-file模块\"><a class=\"anchor\" href=\"#66-file模块\">#</a> <strong>6.6 file</strong> 模块</h5>\n",
            "tags": [
                "Ansible"
            ]
        }
    ]
}