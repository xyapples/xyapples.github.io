{
    "version": "https://jsonfeed.org/version/1",
    "title": "LinuxSre云原生 • All posts by \"redis\" tag",
    "description": "专注于 Linux 运维、云计算、云原⽣等技术",
    "home_page_url": "http://ixuyong.cn",
    "items": [
        {
            "id": "http://ixuyong.cn/posts/1490514396.html",
            "url": "http://ixuyong.cn/posts/1490514396.html",
            "title": "Redis Cluster集群部署",
            "date_published": "2025-05-12T13:21:44.000Z",
            "content_html": "<h3 id=\"redis-cluster集群部署\"><a class=\"anchor\" href=\"#redis-cluster集群部署\">#</a> Redis Cluster 集群部署</h3>\n<h4 id=\"1-环境配置\"><a class=\"anchor\" href=\"#1-环境配置\">#</a> 1、环境配置</h4>\n<h5 id=\"11-关闭防火墙-selinux\"><a class=\"anchor\" href=\"#11-关闭防火墙-selinux\">#</a> 1.1 关闭防火墙、Selinux</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>systemctl disable <span class=\"token parameter variable\">--now</span> firewalld </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>setenforce <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">sed</span> <span class=\"token parameter variable\">-i</span> <span class=\"token string\">'s#SELINUX=enforcing#SELINUX=disabled#g'</span> /etc/sysconfig/selinux</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">sed</span> <span class=\"token parameter variable\">-i</span> <span class=\"token string\">'s#SELINUX=enforcing#SELINUX=disabled#g'</span> /etc/selinux/config</pre></td></tr></table></figure><h5 id=\"11-配置yum源\"><a class=\"anchor\" href=\"#11-配置yum源\">#</a> 1.1 配置 yum 源</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#rocky linux 配置</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">sed</span> <span class=\"token parameter variable\">-e</span> <span class=\"token string\">'s|^mirrorlist=|#mirrorlist=|g'</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token parameter variable\">-e</span> <span class=\"token string\">'s|^#baseurl=http://dl.rockylinux.org/$contentdir|baseurl=https://mirrors.aliyun.com/rockylinux|g'</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token parameter variable\">-i.bak</span> <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    /etc/yum.repos.d/rocky-*.repo</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>yum clean all <span class=\"token operator\">&amp;&amp;</span> yum makecache</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token function\">mkdir</span> /soft /data /scripts /backup</pre></td></tr></table></figure><h5 id=\"13-配置文件描述符\"><a class=\"anchor\" href=\"#13-配置文件描述符\">#</a> 1.3 配置文件描述符</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">ulimit</span> <span class=\"token parameter variable\">-SHn</span> <span class=\"token number\">65535</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">vim</span> /etc/security/limits.conf</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 末尾添加如下内容</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>* soft nofile <span class=\"token number\">65536</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>* hard nofile <span class=\"token number\">131072</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>* soft nproc <span class=\"token number\">65535</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>* hard nproc <span class=\"token number\">655350</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>* soft memlock unlimited</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>* hard memlock unlimited</pre></td></tr></table></figure><h5 id=\"14-系统内核参数调优\"><a class=\"anchor\" href=\"#14-系统内核参数调优\">#</a> 1.4 系统内核参数调优</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 修改 /etc/sysctl.conf 文件</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">cat</span> <span class=\"token operator\">>></span> /etc/sysctl.conf <span class=\"token operator\">&lt;&lt;</span><span class=\"token string\">EOF</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>vm.max_map_count = 262144</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>vm.swappiness=1</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>net.ipv4.tcp_fin_timeout=2</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>net.ipv4.tcp_tw_reuse=1</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>#net.ipv4.tcp_tw_recycle=1</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>net.ipv4.tcp_syncookies=1</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>net.ipv4.tcp_keepalive_time=600</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>net.ipv4.ip_local_port_range=4000 65000</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>net.ipv4.tcp_max_syn_backlog=16384</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>net.ipv4.route.gc_timeout=100</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>net.ipv4.tcp_max_tw_buckets= 5000</pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>net.ipv4.tcp_syn_retries=1</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>net.ipv4.tcp_synack_retries=1</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>net.core.somaxconn=16384</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>net.core.netdev_max_backlog=16384</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>net.ipv4.tcp_max_orphans=16384</pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre># 设置最大内存共享段大小bytes</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>kernel.shmmax=15461882265</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>kernel.shmall=3774873</pre></td></tr><tr><td data-num=\"25\"></td><td><pre># 修改消息队列长度</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>kernel.msgmax=65535</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>kernel.msgmnb=65535</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>EOF</span></pre></td></tr></table></figure><h5 id=\"15-修改默认限制内存\"><a class=\"anchor\" href=\"#15-修改默认限制内存\">#</a> 1.5 修改默认限制内存</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">cat</span> <span class=\"token operator\">>></span>/etc/systemd/system.conf<span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">EOF</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>DefaultLimitNOFILE=65536</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>DefaultLimitNPROC=32000</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>DefaultLimitMEMLOCK=infinity</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>EOF</span></pre></td></tr></table></figure><h5 id=\"16-执行命令生效状态\"><a class=\"anchor\" href=\"#16-执行命令生效状态\">#</a> 1.6 执行命令生效状态</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sysctl</span> <span class=\"token parameter variable\">-p</span></pre></td></tr></table></figure><h5 id=\"17-安装基础软件包\"><a class=\"anchor\" href=\"#17-安装基础软件包\">#</a> 1.7 安装基础软件包</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>yum <span class=\"token function\">install</span> <span class=\"token function\">wget</span> jq psmisc <span class=\"token function\">vim</span> <span class=\"token function\">unzip</span> net-tools telnet tree yum-utils device-mapper-persistent-data <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>lvm2 <span class=\"token function\">git</span> ntpdate nfs-utils iotop httpd-tools dos2unix lrzsz <span class=\"token parameter variable\">-y</span></pre></td></tr></table></figure><h5 id=\"18-升级系统\"><a class=\"anchor\" href=\"#18-升级系统\">#</a> 1.8 升级系统</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>yum update <span class=\"token parameter variable\">-y</span> <span class=\"token parameter variable\">--exclude</span><span class=\"token operator\">=</span>kernel* <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">reboot</span></pre></td></tr></table></figure><h4 id=\"2-redis-cluster部署\"><a class=\"anchor\" href=\"#2-redis-cluster部署\">#</a> 2、Redis cluster 部署</h4>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">192.168.1.135</th>\n<th style=\"text-align:center\">192.168.1.136</th>\n<th style=\"text-align:center\">192.168.1.137</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">node1：7001</td>\n<td style=\"text-align:center\">node1：7001</td>\n<td style=\"text-align:center\">node1：7001</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">node2：7002</td>\n<td style=\"text-align:center\">node2：7002</td>\n<td style=\"text-align:center\">node2：7002</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">node3：7003</td>\n<td style=\"text-align:center\">node3：7003</td>\n<td style=\"text-align:center\">node3：7003</td>\n</tr>\n</tbody>\n</table>\n<h5 id=\"21-安装包下载\"><a class=\"anchor\" href=\"#21-安装包下载\">#</a> 2.1 安装包下载</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">wget</span> https://download.redis.io/releases/redis-7.2.1.tar.gz</pre></td></tr></table></figure><h5 id=\"22-安装-redis\"><a class=\"anchor\" href=\"#22-安装-redis\">#</a> 2.2 安装 redis</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>yum <span class=\"token function\">install</span> gcc-c++ <span class=\"token parameter variable\">-y</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">mkdir</span> /soft</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">tar</span> <span class=\"token parameter variable\">-xzvf</span> redis-7.2.1.tar.gz <span class=\"token parameter variable\">-C</span> /soft</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">ln</span> <span class=\"token parameter variable\">-s</span> /soft/redis-7.2.1 /soft/redis</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token builtin class-name\">cd</span> /soft/redis</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token function\">make</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token function\">make</span> <span class=\"token function\">install</span> <span class=\"token assign-left variable\">prefix</span><span class=\"token operator\">=</span>/soft/redis</pre></td></tr></table></figure><h5 id=\"23-生成集群配置文件\"><a class=\"anchor\" href=\"#23-生成集群配置文件\">#</a> 2.3 生成集群配置文件</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /soft/redis/data/7001</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /soft/redis/data/7002</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /soft/redis/data/7003</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /soft/redis/log</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token builtin class-name\">cd</span> /soft/redis</pre></td></tr></table></figure><p><strong>redis_7001.conf 配置文件</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">cat</span> <span class=\"token operator\">></span> /soft/redis/redis_7001.conf <span class=\"token operator\">&lt;&lt;</span><span class=\"token string\">EOF</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>protected-mode yes</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>port 7001</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>requirepass admin123</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>masterauth admin123</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>cluster-enabled yes</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>cluster-config-file nodes-7001.conf</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>cluster-node-timeout 5000</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>maxmemory 2GB</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>maxmemory-policy volatile-lru</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>tcp-backlog 511</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>timeout 0</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>tcp-keepalive 300</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>daemonize yes</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>pidfile /soft/redis/data/redis7001.pid</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>loglevel notice</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>logfile \"/soft/redis/log/redis7001.log\"</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>#databases 16</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>always-show-logo no</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>set-proc-title yes</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>proc-title-template \"&#123;title&#125; &#123;listen-addr&#125; &#123;server-mode&#125;\"</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>locale-collate \"\"</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>stop-writes-on-bgsave-error yes</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>rdbcompression yes</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>rdbchecksum yes</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>dbfilename dump.rdb</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>rdb-del-sync-files no</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>dir /soft/redis/data/7001</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>replica-serve-stale-data yes</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>replica-read-only yes</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>repl-diskless-sync yes</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>repl-diskless-sync-delay 5</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>repl-diskless-sync-max-replicas 0</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>repl-diskless-load disabled</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>repl-disable-tcp-nodelay no</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>replica-priority 100</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>acllog-max-len 128</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>lazyfree-lazy-eviction no</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>lazyfree-lazy-expire no</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>lazyfree-lazy-server-del no</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>replica-lazy-flush no</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>lazyfree-lazy-user-del no</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>lazyfree-lazy-user-flush no</pre></td></tr><tr><td data-num=\"44\"></td><td><pre>oom-score-adj no</pre></td></tr><tr><td data-num=\"45\"></td><td><pre>oom-score-adj-values 0 200 800</pre></td></tr><tr><td data-num=\"46\"></td><td><pre>disable-thp yes</pre></td></tr><tr><td data-num=\"47\"></td><td><pre>appendonly no</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>appendfilename \"appendonly.aof\"</pre></td></tr><tr><td data-num=\"49\"></td><td><pre>appenddirname \"appendonlydir\"</pre></td></tr><tr><td data-num=\"50\"></td><td><pre>appendfsync everysec</pre></td></tr><tr><td data-num=\"51\"></td><td><pre>no-appendfsync-on-rewrite no</pre></td></tr><tr><td data-num=\"52\"></td><td><pre>auto-aof-rewrite-percentage 100</pre></td></tr><tr><td data-num=\"53\"></td><td><pre>auto-aof-rewrite-min-size 64mb</pre></td></tr><tr><td data-num=\"54\"></td><td><pre>aof-load-truncated yes</pre></td></tr><tr><td data-num=\"55\"></td><td><pre>aof-use-rdb-preamble yes</pre></td></tr><tr><td data-num=\"56\"></td><td><pre>aof-timestamp-enabled no</pre></td></tr><tr><td data-num=\"57\"></td><td><pre>slowlog-log-slower-than 10000</pre></td></tr><tr><td data-num=\"58\"></td><td><pre>slowlog-max-len 128</pre></td></tr><tr><td data-num=\"59\"></td><td><pre>latency-monitor-threshold 0</pre></td></tr><tr><td data-num=\"60\"></td><td><pre>notify-keyspace-events \"\"</pre></td></tr><tr><td data-num=\"61\"></td><td><pre>hash-max-listpack-entries 512</pre></td></tr><tr><td data-num=\"62\"></td><td><pre>hash-max-listpack-value 64</pre></td></tr><tr><td data-num=\"63\"></td><td><pre>list-max-listpack-size -2</pre></td></tr><tr><td data-num=\"64\"></td><td><pre>list-compress-depth 0</pre></td></tr><tr><td data-num=\"65\"></td><td><pre>set-max-intset-entries 512</pre></td></tr><tr><td data-num=\"66\"></td><td><pre>set-max-listpack-entries 128</pre></td></tr><tr><td data-num=\"67\"></td><td><pre>set-max-listpack-value 64</pre></td></tr><tr><td data-num=\"68\"></td><td><pre>zset-max-listpack-entries 128</pre></td></tr><tr><td data-num=\"69\"></td><td><pre>zset-max-listpack-value 64</pre></td></tr><tr><td data-num=\"70\"></td><td><pre>hll-sparse-max-bytes 3000</pre></td></tr><tr><td data-num=\"71\"></td><td><pre>stream-node-max-bytes 4096</pre></td></tr><tr><td data-num=\"72\"></td><td><pre>stream-node-max-entries 100</pre></td></tr><tr><td data-num=\"73\"></td><td><pre>activerehashing yes</pre></td></tr><tr><td data-num=\"74\"></td><td><pre>client-output-buffer-limit normal 0 0 0</pre></td></tr><tr><td data-num=\"75\"></td><td><pre>client-output-buffer-limit replica 256mb 64mb 60</pre></td></tr><tr><td data-num=\"76\"></td><td><pre>client-output-buffer-limit pubsub 32mb 8mb 60</pre></td></tr><tr><td data-num=\"77\"></td><td><pre>hz 10</pre></td></tr><tr><td data-num=\"78\"></td><td><pre>dynamic-hz yes</pre></td></tr><tr><td data-num=\"79\"></td><td><pre>aof-rewrite-incremental-fsync yes</pre></td></tr><tr><td data-num=\"80\"></td><td><pre>rdb-save-incremental-fsync yes</pre></td></tr><tr><td data-num=\"81\"></td><td><pre>jemalloc-bg-thread yes</pre></td></tr><tr><td data-num=\"82\"></td><td><pre>EOF</span></pre></td></tr></table></figure><p><strong>redis_7002.conf 配置文件</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">cat</span> <span class=\"token operator\">></span> /soft/redis/redis_7002.conf <span class=\"token operator\">&lt;&lt;</span><span class=\"token string\">EOF</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>protected-mode yes</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>port 7002</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>requirepass admin123</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>masterauth admin123</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>cluster-enabled yes</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>cluster-config-file nodes-7002.conf</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>cluster-node-timeout 5000</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>maxmemory 2GB</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>maxmemory-policy  volatile-lru</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>tcp-backlog 511</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>timeout 0</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>tcp-keepalive 300</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>daemonize yes</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>pidfile /soft/redis/data/redis7002.pid</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>loglevel notice</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>logfile \"/soft/redis/log/redis7002.log\"</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>#databases 16</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>always-show-logo no</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>set-proc-title yes</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>proc-title-template \"&#123;title&#125; &#123;listen-addr&#125; &#123;server-mode&#125;\"</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>locale-collate \"\"</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>stop-writes-on-bgsave-error yes</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>rdbcompression yes</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>rdbchecksum yes</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>dbfilename dump.rdb</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>rdb-del-sync-files no</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>dir /soft/redis/data/7002</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>replica-serve-stale-data yes</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>replica-read-only yes</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>repl-diskless-sync yes</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>repl-diskless-sync-delay 5</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>repl-diskless-sync-max-replicas 0</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>repl-diskless-load disabled</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>repl-disable-tcp-nodelay no</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>replica-priority 100</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>acllog-max-len 128</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>lazyfree-lazy-eviction no</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>lazyfree-lazy-expire no</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>lazyfree-lazy-server-del no</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>replica-lazy-flush no</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>lazyfree-lazy-user-del no</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>lazyfree-lazy-user-flush no</pre></td></tr><tr><td data-num=\"44\"></td><td><pre>oom-score-adj no</pre></td></tr><tr><td data-num=\"45\"></td><td><pre>oom-score-adj-values 0 200 800</pre></td></tr><tr><td data-num=\"46\"></td><td><pre>disable-thp yes</pre></td></tr><tr><td data-num=\"47\"></td><td><pre>appendonly no</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>appendfilename \"appendonly.aof\"</pre></td></tr><tr><td data-num=\"49\"></td><td><pre>appenddirname \"appendonlydir\"</pre></td></tr><tr><td data-num=\"50\"></td><td><pre>appendfsync everysec</pre></td></tr><tr><td data-num=\"51\"></td><td><pre>no-appendfsync-on-rewrite no</pre></td></tr><tr><td data-num=\"52\"></td><td><pre>auto-aof-rewrite-percentage 100</pre></td></tr><tr><td data-num=\"53\"></td><td><pre>auto-aof-rewrite-min-size 64mb</pre></td></tr><tr><td data-num=\"54\"></td><td><pre>aof-load-truncated yes</pre></td></tr><tr><td data-num=\"55\"></td><td><pre>aof-use-rdb-preamble yes</pre></td></tr><tr><td data-num=\"56\"></td><td><pre>aof-timestamp-enabled no</pre></td></tr><tr><td data-num=\"57\"></td><td><pre>slowlog-log-slower-than 10000</pre></td></tr><tr><td data-num=\"58\"></td><td><pre>slowlog-max-len 128</pre></td></tr><tr><td data-num=\"59\"></td><td><pre>latency-monitor-threshold 0</pre></td></tr><tr><td data-num=\"60\"></td><td><pre>notify-keyspace-events \"\"</pre></td></tr><tr><td data-num=\"61\"></td><td><pre>hash-max-listpack-entries 512</pre></td></tr><tr><td data-num=\"62\"></td><td><pre>hash-max-listpack-value 64</pre></td></tr><tr><td data-num=\"63\"></td><td><pre>list-max-listpack-size -2</pre></td></tr><tr><td data-num=\"64\"></td><td><pre>list-compress-depth 0</pre></td></tr><tr><td data-num=\"65\"></td><td><pre>set-max-intset-entries 512</pre></td></tr><tr><td data-num=\"66\"></td><td><pre>set-max-listpack-entries 128</pre></td></tr><tr><td data-num=\"67\"></td><td><pre>set-max-listpack-value 64</pre></td></tr><tr><td data-num=\"68\"></td><td><pre>zset-max-listpack-entries 128</pre></td></tr><tr><td data-num=\"69\"></td><td><pre>zset-max-listpack-value 64</pre></td></tr><tr><td data-num=\"70\"></td><td><pre>hll-sparse-max-bytes 3000</pre></td></tr><tr><td data-num=\"71\"></td><td><pre>stream-node-max-bytes 4096</pre></td></tr><tr><td data-num=\"72\"></td><td><pre>stream-node-max-entries 100</pre></td></tr><tr><td data-num=\"73\"></td><td><pre>activerehashing yes</pre></td></tr><tr><td data-num=\"74\"></td><td><pre>client-output-buffer-limit normal 0 0 0</pre></td></tr><tr><td data-num=\"75\"></td><td><pre>client-output-buffer-limit replica 256mb 64mb 60</pre></td></tr><tr><td data-num=\"76\"></td><td><pre>client-output-buffer-limit pubsub 32mb 8mb 60</pre></td></tr><tr><td data-num=\"77\"></td><td><pre>hz 10</pre></td></tr><tr><td data-num=\"78\"></td><td><pre>dynamic-hz yes</pre></td></tr><tr><td data-num=\"79\"></td><td><pre>aof-rewrite-incremental-fsync yes</pre></td></tr><tr><td data-num=\"80\"></td><td><pre>rdb-save-incremental-fsync yes</pre></td></tr><tr><td data-num=\"81\"></td><td><pre>jemalloc-bg-thread yes</pre></td></tr><tr><td data-num=\"82\"></td><td><pre>EOF</span></pre></td></tr></table></figure><p><strong>redis_7003.conf 配置文件</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">cat</span> <span class=\"token operator\">></span> /soft/redis/redis_7003.conf <span class=\"token operator\">&lt;&lt;</span><span class=\"token string\">EOF</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>protected-mode yes</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>port 7003</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>requirepass admin123</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>masterauth admin123</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>cluster-enabled yes</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>cluster-config-file nodes-7003.conf</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>cluster-node-timeout 5000</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>maxmemory 2GB</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>maxmemory-policy  volatile-lru</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>tcp-backlog 511</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>timeout 0</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>tcp-keepalive 300</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>daemonize yes</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>pidfile /soft/redis/data/redis7003.pid</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>loglevel notice</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>logfile \"/soft/redis/log/redis7003.log\"</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>#databases 16</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>always-show-logo no</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>set-proc-title yes</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>proc-title-template \"&#123;title&#125; &#123;listen-addr&#125; &#123;server-mode&#125;\"</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>locale-collate \"\"</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>stop-writes-on-bgsave-error yes</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>rdbcompression yes</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>rdbchecksum yes</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>dbfilename dump.rdb</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>rdb-del-sync-files no</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>dir /soft/redis/data/7003</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>replica-serve-stale-data yes</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>replica-read-only yes</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>repl-diskless-sync yes</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>repl-diskless-sync-delay 5</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>repl-diskless-sync-max-replicas 0</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>repl-diskless-load disabled</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>repl-disable-tcp-nodelay no</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>replica-priority 100</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>acllog-max-len 128</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>lazyfree-lazy-eviction no</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>lazyfree-lazy-expire no</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>lazyfree-lazy-server-del no</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>replica-lazy-flush no</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>lazyfree-lazy-user-del no</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>lazyfree-lazy-user-flush no</pre></td></tr><tr><td data-num=\"44\"></td><td><pre>oom-score-adj no</pre></td></tr><tr><td data-num=\"45\"></td><td><pre>oom-score-adj-values 0 200 800</pre></td></tr><tr><td data-num=\"46\"></td><td><pre>disable-thp yes</pre></td></tr><tr><td data-num=\"47\"></td><td><pre>appendonly no</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>appendfilename \"appendonly.aof\"</pre></td></tr><tr><td data-num=\"49\"></td><td><pre>appenddirname \"appendonlydir\"</pre></td></tr><tr><td data-num=\"50\"></td><td><pre>appendfsync everysec</pre></td></tr><tr><td data-num=\"51\"></td><td><pre>no-appendfsync-on-rewrite no</pre></td></tr><tr><td data-num=\"52\"></td><td><pre>auto-aof-rewrite-percentage 100</pre></td></tr><tr><td data-num=\"53\"></td><td><pre>auto-aof-rewrite-min-size 64mb</pre></td></tr><tr><td data-num=\"54\"></td><td><pre>aof-load-truncated yes</pre></td></tr><tr><td data-num=\"55\"></td><td><pre>aof-use-rdb-preamble yes</pre></td></tr><tr><td data-num=\"56\"></td><td><pre>aof-timestamp-enabled no</pre></td></tr><tr><td data-num=\"57\"></td><td><pre>slowlog-log-slower-than 10000</pre></td></tr><tr><td data-num=\"58\"></td><td><pre>slowlog-max-len 128</pre></td></tr><tr><td data-num=\"59\"></td><td><pre>latency-monitor-threshold 0</pre></td></tr><tr><td data-num=\"60\"></td><td><pre>notify-keyspace-events \"\"</pre></td></tr><tr><td data-num=\"61\"></td><td><pre>hash-max-listpack-entries 512</pre></td></tr><tr><td data-num=\"62\"></td><td><pre>hash-max-listpack-value 64</pre></td></tr><tr><td data-num=\"63\"></td><td><pre>list-max-listpack-size -2</pre></td></tr><tr><td data-num=\"64\"></td><td><pre>list-compress-depth 0</pre></td></tr><tr><td data-num=\"65\"></td><td><pre>set-max-intset-entries 512</pre></td></tr><tr><td data-num=\"66\"></td><td><pre>set-max-listpack-entries 128</pre></td></tr><tr><td data-num=\"67\"></td><td><pre>set-max-listpack-value 64</pre></td></tr><tr><td data-num=\"68\"></td><td><pre>zset-max-listpack-entries 128</pre></td></tr><tr><td data-num=\"69\"></td><td><pre>zset-max-listpack-value 64</pre></td></tr><tr><td data-num=\"70\"></td><td><pre>hll-sparse-max-bytes 3000</pre></td></tr><tr><td data-num=\"71\"></td><td><pre>stream-node-max-bytes 4096</pre></td></tr><tr><td data-num=\"72\"></td><td><pre>stream-node-max-entries 100</pre></td></tr><tr><td data-num=\"73\"></td><td><pre>activerehashing yes</pre></td></tr><tr><td data-num=\"74\"></td><td><pre>client-output-buffer-limit normal 0 0 0</pre></td></tr><tr><td data-num=\"75\"></td><td><pre>client-output-buffer-limit replica 256mb 64mb 60</pre></td></tr><tr><td data-num=\"76\"></td><td><pre>client-output-buffer-limit pubsub 32mb 8mb 60</pre></td></tr><tr><td data-num=\"77\"></td><td><pre>hz 10</pre></td></tr><tr><td data-num=\"78\"></td><td><pre>dynamic-hz yes</pre></td></tr><tr><td data-num=\"79\"></td><td><pre>aof-rewrite-incremental-fsync yes</pre></td></tr><tr><td data-num=\"80\"></td><td><pre>rdb-save-incremental-fsync yes</pre></td></tr><tr><td data-num=\"81\"></td><td><pre>jemalloc-bg-thread yes</pre></td></tr><tr><td data-num=\"82\"></td><td><pre>EOF</span></pre></td></tr></table></figure><h5 id=\"24-redis开机自启\"><a class=\"anchor\" href=\"#24-redis开机自启\">#</a> 2.4 Redis 开机自启</h5>\n<p><strong>redis_7001.service</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">cat</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">\"EOF\"<span class=\"token bash punctuation\"> <span class=\"token operator\">></span> /usr/lib/systemd/system/redis_7001.service</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>[Unit]</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Description=Redis 7001 service</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>Documentation=https://redis.io/documentation</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>Wants=network-online.target</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>After=network-online.target</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>[Service]</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>Type=forking</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>LimitNOFILE=10032</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>User=root</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>Group=root</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>ExecStart=/soft/redis/src/redis-server /soft/redis/redis_7001.conf</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>PrivateTmp=true</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>[Install]</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>WantedBy=multi-user.target</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>EOF</span></pre></td></tr></table></figure><p><strong>redis_7002.service</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">cat</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">\"EOF\"<span class=\"token bash punctuation\"> <span class=\"token operator\">></span> /usr/lib/systemd/system/redis_7002.service</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>[Unit]</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Description=Redis 7002 service</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>Documentation=https://redis.io/documentation</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>Wants=network-online.target</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>After=network-online.target</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>[Service]</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>Type=forking</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>LimitNOFILE=10032</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>User=root</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>Group=root</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>ExecStart=/soft/redis/src/redis-server /soft/redis/redis_7002.conf</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>PrivateTmp=true</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>[Install]</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>WantedBy=multi-user.target</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>EOF</span></pre></td></tr></table></figure><p><strong>redis_7003.service</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">cat</span> <span class=\"token operator\">&lt;&lt;</span> <span class=\"token string\">\"EOF\"<span class=\"token bash punctuation\"> <span class=\"token operator\">></span> /usr/lib/systemd/system/redis_7003.service</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>[Unit]</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Description=Redis 7003 service</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>Documentation=https://redis.io/documentation</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>Wants=network-online.target</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>After=network-online.target</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>[Service]</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>Type=forking</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>LimitNOFILE=10032</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>User=root</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>Group=root</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>ExecStart=/soft/redis/src/redis-server /soft/redis/redis_7003.conf</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>PrivateTmp=true</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>[Install]</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>WantedBy=multi-user.target</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>EOF</span></pre></td></tr></table></figure><p><strong>设置开机自启</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">chown</span> <span class=\"token parameter variable\">-R</span> root.root /soft/redis</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>systemctl daemon-reload</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>systemctl <span class=\"token builtin class-name\">enable</span> redis_7001.service</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>systemctl <span class=\"token builtin class-name\">enable</span> redis_7002.service</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>systemctl <span class=\"token builtin class-name\">enable</span> redis_7003.service</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>systemctl start redis_7001.service</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>systemctl start redis_7002.service</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>systemctl start redis_7003.service</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>systemctl status redis_7001.service</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>systemctl status redis_7002.service</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>systemctl status redis_7003.service</pre></td></tr></table></figure><h5 id=\"25-启动redis集群服务\"><a class=\"anchor\" href=\"#25-启动redis集群服务\">#</a> 2.5 启动 redis 集群服务</h5>\n<p>--cluster-replicas 2 表示为集群中的每个主节点创建 2 个从节点</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">cd</span> /soft/redis/src</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>./redis-cli <span class=\"token parameter variable\">--cluster</span> create <span class=\"token punctuation\">\\</span>  </pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">192.168</span>.1.135:7001 <span class=\"token number\">192.168</span>.1.135:7002 <span class=\"token number\">192.168</span>.1.135:7003 <span class=\"token punctuation\">\\</span>  </pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">192.168</span>.1.136:7001 <span class=\"token number\">192.168</span>.1.136:7002 <span class=\"token number\">192.168</span>.1.136:7003 <span class=\"token punctuation\">\\</span> </pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">192.168</span>.1.137:7001 <span class=\"token number\">192.168</span>.1.137:7002 <span class=\"token number\">192.168</span>.1.137:7003 <span class=\"token punctuation\">\\</span> </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>--cluster-replicas <span class=\"token number\">2</span> <span class=\"token parameter variable\">-a</span> admin123</pre></td></tr></table></figure><p>输入创建集群的命令后会出现以下提示，注意 Can I set the above configuration? (type 'yes' to accept): yes，该处请输入 yes</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@qnyp_node01 src<span class=\"token punctuation\">]</span><span class=\"token comment\"># ./redis-cli --cluster create \\</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token operator\">></span> <span class=\"token number\">192.168</span>.1.135:7001 <span class=\"token number\">192.168</span>.1.135:7002 <span class=\"token number\">192.168</span>.1.135:7003 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">></span> <span class=\"token number\">192.168</span>.1.136:7001 <span class=\"token number\">192.168</span>.1.136:7002 <span class=\"token number\">192.168</span>.1.136:7003 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token operator\">></span> <span class=\"token number\">192.168</span>.1.137:7001 <span class=\"token number\">192.168</span>.1.137:7002 <span class=\"token number\">192.168</span>.1.137:7003 <span class=\"token punctuation\">\\</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token operator\">></span> --cluster-replicas <span class=\"token number\">2</span> <span class=\"token parameter variable\">-a</span> admin123</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>Warning: Using a password with <span class=\"token string\">'-a'</span> or <span class=\"token string\">'-u'</span> option on the <span class=\"token builtin class-name\">command</span> line interface may not be safe.</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token operator\">>></span><span class=\"token operator\">></span> Performing <span class=\"token builtin class-name\">hash</span> slots allocation on <span class=\"token number\">9</span> nodes<span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>Master<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span> -<span class=\"token operator\">></span> Slots <span class=\"token number\">0</span> - <span class=\"token number\">5460</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>Master<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span> -<span class=\"token operator\">></span> Slots <span class=\"token number\">5461</span> - <span class=\"token number\">10922</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>Master<span class=\"token punctuation\">[</span><span class=\"token number\">2</span><span class=\"token punctuation\">]</span> -<span class=\"token operator\">></span> Slots <span class=\"token number\">10923</span> - <span class=\"token number\">16383</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>Adding replica <span class=\"token number\">192.168</span>.1.136:7002 to <span class=\"token number\">192.168</span>.1.135:7001</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>Adding replica <span class=\"token number\">192.168</span>.1.137:7002 to <span class=\"token number\">192.168</span>.1.135:7001</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>Adding replica <span class=\"token number\">192.168</span>.1.135:7003 to <span class=\"token number\">192.168</span>.1.136:7001</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>Adding replica <span class=\"token number\">192.168</span>.1.137:7003 to <span class=\"token number\">192.168</span>.1.136:7001</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>Adding replica <span class=\"token number\">192.168</span>.1.136:7003 to <span class=\"token number\">192.168</span>.1.137:7001</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>Adding replica <span class=\"token number\">192.168</span>.1.135:7002 to <span class=\"token number\">192.168</span>.1.137:7001</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>M: 928637d72deb6a2e7935f8a7bb5ebd9455cf64a7 <span class=\"token number\">192.168</span>.1.135:7001</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>   slots:<span class=\"token punctuation\">[</span><span class=\"token number\">0</span>-5460<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">(</span><span class=\"token number\">5461</span> slots<span class=\"token punctuation\">)</span> master</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>S: 4508bee0c33784e0d5be25b64e4c7e677cd9d396 <span class=\"token number\">192.168</span>.1.135:7002</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>   replicates f9133541e2175958117753ef4e206ea43a21f07c</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>S: a0e13083fcc1d6e96398f3bb2ea5581b7a64e05e <span class=\"token number\">192.168</span>.1.135:7003</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>   replicates 06ea827f8d328d9d776c9643109317b0100727a6</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>M: 06ea827f8d328d9d776c9643109317b0100727a6 <span class=\"token number\">192.168</span>.1.136:7001</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>   slots:<span class=\"token punctuation\">[</span><span class=\"token number\">5461</span>-10922<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">(</span><span class=\"token number\">5462</span> slots<span class=\"token punctuation\">)</span> master</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>S: 1d1b9817e39ee8987a3518f62a9b91c3ab666eff <span class=\"token number\">192.168</span>.1.136:7002</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>   replicates 928637d72deb6a2e7935f8a7bb5ebd9455cf64a7</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>S: a73c099dcc63f5d46a11d0f61c91270ef61290ff <span class=\"token number\">192.168</span>.1.136:7003</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>   replicates f9133541e2175958117753ef4e206ea43a21f07c</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>M: f9133541e2175958117753ef4e206ea43a21f07c <span class=\"token number\">192.168</span>.1.137:7001</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>   slots:<span class=\"token punctuation\">[</span><span class=\"token number\">10923</span>-16383<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">(</span><span class=\"token number\">5461</span> slots<span class=\"token punctuation\">)</span> master</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>S: 626dc659bb1059ec40039869241f7de88a49cd87 <span class=\"token number\">192.168</span>.1.137:7002</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>   replicates 928637d72deb6a2e7935f8a7bb5ebd9455cf64a7</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>S: 622f73cd06c5658f8d02056925ac708750f12c1a <span class=\"token number\">192.168</span>.1.137:7003</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>   replicates 06ea827f8d328d9d776c9643109317b0100727a6</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>Can I <span class=\"token builtin class-name\">set</span> the above configuration? <span class=\"token punctuation\">(</span>type <span class=\"token string\">'yes'</span> to accept<span class=\"token punctuation\">)</span>:</pre></td></tr></table></figure><p>输完 yes 后，会出现如下提示，[OK] All 16384 slots covered. 说明成功啦</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>Can I <span class=\"token builtin class-name\">set</span> the above configuration? <span class=\"token punctuation\">(</span>type <span class=\"token string\">'yes'</span> to accept<span class=\"token punctuation\">)</span>: <span class=\"token function\">yes</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token operator\">>></span><span class=\"token operator\">></span> Nodes configuration updated</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">>></span><span class=\"token operator\">></span> Assign a different config epoch to each <span class=\"token function\">node</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token operator\">>></span><span class=\"token operator\">></span> Sending CLUSTER MEET messages to <span class=\"token function\">join</span> the cluster</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>Waiting <span class=\"token keyword\">for</span> the cluster to <span class=\"token function\">join</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">..</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token operator\">>></span><span class=\"token operator\">></span> Performing Cluster Check <span class=\"token punctuation\">(</span>using <span class=\"token function\">node</span> <span class=\"token number\">192.168</span>.1.135:7001<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>M: 928637d72deb6a2e7935f8a7bb5ebd9455cf64a7 <span class=\"token number\">192.168</span>.1.135:7001</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   slots:<span class=\"token punctuation\">[</span><span class=\"token number\">0</span>-5460<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">(</span><span class=\"token number\">5461</span> slots<span class=\"token punctuation\">)</span> master</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   <span class=\"token number\">2</span> additional replica<span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>M: 06ea827f8d328d9d776c9643109317b0100727a6 <span class=\"token number\">192.168</span>.1.136:7001</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   slots:<span class=\"token punctuation\">[</span><span class=\"token number\">5461</span>-10922<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">(</span><span class=\"token number\">5462</span> slots<span class=\"token punctuation\">)</span> master</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   <span class=\"token number\">2</span> additional replica<span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>S: 622f73cd06c5658f8d02056925ac708750f12c1a <span class=\"token number\">192.168</span>.1.137:7003</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   slots: <span class=\"token punctuation\">(</span><span class=\"token number\">0</span> slots<span class=\"token punctuation\">)</span> slave</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   replicates 06ea827f8d328d9d776c9643109317b0100727a6</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>S: 1d1b9817e39ee8987a3518f62a9b91c3ab666eff <span class=\"token number\">192.168</span>.1.136:7002</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>   slots: <span class=\"token punctuation\">(</span><span class=\"token number\">0</span> slots<span class=\"token punctuation\">)</span> slave</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>   replicates 928637d72deb6a2e7935f8a7bb5ebd9455cf64a7</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>S: a73c099dcc63f5d46a11d0f61c91270ef61290ff <span class=\"token number\">192.168</span>.1.136:7003</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>   slots: <span class=\"token punctuation\">(</span><span class=\"token number\">0</span> slots<span class=\"token punctuation\">)</span> slave</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>   replicates f9133541e2175958117753ef4e206ea43a21f07c</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>S: a0e13083fcc1d6e96398f3bb2ea5581b7a64e05e <span class=\"token number\">192.168</span>.1.135:7003</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>   slots: <span class=\"token punctuation\">(</span><span class=\"token number\">0</span> slots<span class=\"token punctuation\">)</span> slave</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>   replicates 06ea827f8d328d9d776c9643109317b0100727a6</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>M: f9133541e2175958117753ef4e206ea43a21f07c <span class=\"token number\">192.168</span>.1.137:7001</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>   slots:<span class=\"token punctuation\">[</span><span class=\"token number\">10923</span>-16383<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">(</span><span class=\"token number\">5461</span> slots<span class=\"token punctuation\">)</span> master</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>   <span class=\"token number\">2</span> additional replica<span class=\"token punctuation\">(</span>s<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>S: 626dc659bb1059ec40039869241f7de88a49cd87 <span class=\"token number\">192.168</span>.1.137:7002</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>   slots: <span class=\"token punctuation\">(</span><span class=\"token number\">0</span> slots<span class=\"token punctuation\">)</span> slave</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>   replicates 928637d72deb6a2e7935f8a7bb5ebd9455cf64a7</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>S: 4508bee0c33784e0d5be25b64e4c7e677cd9d396 <span class=\"token number\">192.168</span>.1.135:7002</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>   slots: <span class=\"token punctuation\">(</span><span class=\"token number\">0</span> slots<span class=\"token punctuation\">)</span> slave</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>   replicates f9133541e2175958117753ef4e206ea43a21f07c</pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token punctuation\">[</span>OK<span class=\"token punctuation\">]</span> All nodes agree about slots configuration.</pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token operator\">>></span><span class=\"token operator\">></span> Check <span class=\"token keyword\">for</span> <span class=\"token function\">open</span> slots<span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token operator\">>></span><span class=\"token operator\">></span> Check slots coverage<span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token punctuation\">[</span>OK<span class=\"token punctuation\">]</span> All <span class=\"token number\">16384</span> slots covered.</pre></td></tr></table></figure><h5 id=\"26-访问reids集群并验证\"><a class=\"anchor\" href=\"#26-访问reids集群并验证\">#</a> 2.6 访问 reids 集群并验证</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">cd</span> /data/redis/src</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>./redis-cli <span class=\"token parameter variable\">-h</span> <span class=\"token number\">192.168</span>.1.135 <span class=\"token parameter variable\">-p</span> <span class=\"token number\">7001</span> <span class=\"token parameter variable\">-c</span> <span class=\"token parameter variable\">-a</span> admin123</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#列出当前节点的信息：cluster info</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>Warning: Using a password with <span class=\"token string\">'-a'</span> or <span class=\"token string\">'-u'</span> option on the <span class=\"token builtin class-name\">command</span> line interface may not be safe.</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">192.168</span>.1.135:700<span class=\"token operator\"><span class=\"token file-descriptor important\">1</span>></span> cluster info</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>cluster_state:ok</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>cluster_slots_assigned:16384</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>cluster_slots_ok:16384</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>cluster_slots_pfail:0</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>cluster_slots_fail:0</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>cluster_known_nodes:9</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>cluster_size:3</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>cluster_current_epoch:9</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>cluster_my_epoch:1</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>cluster_stats_messages_ping_sent:344</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>cluster_stats_messages_pong_sent:354</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>cluster_stats_messages_sent:698</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>cluster_stats_messages_ping_received:346</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>cluster_stats_messages_pong_received:344</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>cluster_stats_messages_meet_received:8</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>cluster_stats_messages_received:698</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>total_cluster_links_buffer_limit_exceeded:0</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>列出集群的节点的信息：cluster nodes</pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token number\">192.168</span>.1.135:700<span class=\"token operator\"><span class=\"token file-descriptor important\">1</span>></span> cluster nodes</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>06ea827f8d328d9d776c9643109317b0100727a6 <span class=\"token number\">192.168</span>.1.136:7001@17001 master - <span class=\"token number\">0</span> <span class=\"token number\">1747034145581</span> <span class=\"token number\">4</span> connected <span class=\"token number\">5461</span>-10922</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>622f73cd06c5658f8d02056925ac708750f12c1a <span class=\"token number\">192.168</span>.1.137:7003@17003 slave 06ea827f8d328d9d776c9643109317b0100727a6 <span class=\"token number\">0</span> <span class=\"token number\">1747034145581</span> <span class=\"token number\">4</span> connected</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>1d1b9817e39ee8987a3518f62a9b91c3ab666eff <span class=\"token number\">192.168</span>.1.136:7002@17002 slave 928637d72deb6a2e7935f8a7bb5ebd9455cf64a7 <span class=\"token number\">0</span> <span class=\"token number\">1747034145581</span> <span class=\"token number\">1</span> connected</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>a73c099dcc63f5d46a11d0f61c91270ef61290ff <span class=\"token number\">192.168</span>.1.136:7003@17003 slave f9133541e2175958117753ef4e206ea43a21f07c <span class=\"token number\">0</span> <span class=\"token number\">1747034145581</span> <span class=\"token number\">7</span> connected</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>a0e13083fcc1d6e96398f3bb2ea5581b7a64e05e <span class=\"token number\">192.168</span>.1.135:7003@17003 slave 06ea827f8d328d9d776c9643109317b0100727a6 <span class=\"token number\">0</span> <span class=\"token number\">1747034144077</span> <span class=\"token number\">4</span> connected</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>f9133541e2175958117753ef4e206ea43a21f07c <span class=\"token number\">192.168</span>.1.137:7001@17001 master - <span class=\"token number\">0</span> <span class=\"token number\">1747034145079</span> <span class=\"token number\">7</span> connected <span class=\"token number\">10923</span>-16383</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>626dc659bb1059ec40039869241f7de88a49cd87 <span class=\"token number\">192.168</span>.1.137:7002@17002 slave 928637d72deb6a2e7935f8a7bb5ebd9455cf64a7 <span class=\"token number\">0</span> <span class=\"token number\">1747034144000</span> <span class=\"token number\">1</span> connected</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>928637d72deb6a2e7935f8a7bb5ebd9455cf64a7 <span class=\"token number\">192.168</span>.1.135:7001@17001 myself,master - <span class=\"token number\">0</span> <span class=\"token number\">1747034144000</span> <span class=\"token number\">1</span> connected <span class=\"token number\">0</span>-5460</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>4508bee0c33784e0d5be25b64e4c7e677cd9d396 <span class=\"token number\">192.168</span>.1.135:7002@17002 slave f9133541e2175958117753ef4e206ea43a21f07c <span class=\"token number\">0</span> <span class=\"token number\">1747034144578</span> <span class=\"token number\">7</span> connected</pre></td></tr></table></figure>",
            "tags": [
                "Redis"
            ]
        },
        {
            "id": "http://ixuyong.cn/posts/1414180692.html",
            "url": "http://ixuyong.cn/posts/1414180692.html",
            "title": "Redis集群（主从+哨兵）模式",
            "date_published": "2025-04-09T11:50:06.000Z",
            "content_html": "<h3 id=\"redis集群主从哨兵模式\"><a class=\"anchor\" href=\"#redis集群主从哨兵模式\">#</a> Redis 集群（主从 + 哨兵）模式</h3>\n<h3 id=\"一-什么是redis主从复制\"><a class=\"anchor\" href=\"#一-什么是redis主从复制\">#</a> 一、什么是 redis 主从复制？</h3>\n<p>主从复制，是指将一台 Redis 服务器的数据，复制到其他的 Redis 服务器。前者称为主节点 (master)，后者称为从节点 (slave), 数据的复制是单向的，只能由主节点到从节点。master 以写为主，slave 以读为主。</p>\n<p><a href=\"https://imgse.com/i/pEgTlKx\"><img loading=\"lazy\" data-src=\"https://s21.ax1x.com/2025/04/09/pEgTlKx.png\" alt=\"pEgTlKx.png\" /></a></p>\n<h3 id=\"二-主从复制的作用\"><a class=\"anchor\" href=\"#二-主从复制的作用\">#</a> 二、主从复制的作用</h3>\n<p>数据冗余：主从复制实现了数据的热备份，是持久化之外的一种数据冗余方式。<br />\n故障恢复：当主节点出现问题时，可以由从节点提供服务，实现快速的故障恢复；实际上是一种服务的冗余。<br />\n负载均衡：在主从复制的基础上，配合读写分离，可以由主节点提供写服务，由从节点提供读服务（即写 Redis 数据时应用连接主节点，读 Redis 数据时应用连接从节点），分担服务器负载；尤其是在写少读多的场景下，通过多个从节点分担读负载，可以大大提高 Redis 服务器的并发量。<br />\n读写分离：用于实现读写分离，主库写、从库读，读写分离不仅可以提高服务器的负载能力，同时可根据需求的变化，改变从库的数量；<br />\n高可用基石：除了上述作用以外，主从复制还是哨兵和集群能够实施的基础，因此说主从复制是 Redis 高可用的基础。</p>\n<h3 id=\"三-实现主从复制\"><a class=\"anchor\" href=\"#三-实现主从复制\">#</a> 三、实现主从复制</h3>\n<table>\n<thead>\n<tr>\n<th>主机名</th>\n<th>IP</th>\n<th>角色</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>redis01</td>\n<td>192.168.40.101</td>\n<td>master</td>\n</tr>\n<tr>\n<td>redis02</td>\n<td>192.168.40.102</td>\n<td>slave</td>\n</tr>\n<tr>\n<td>redis03</td>\n<td>192.168.40.103</td>\n<td>slave</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"31-关闭防火墙-selinux\"><a class=\"anchor\" href=\"#31-关闭防火墙-selinux\">#</a> 3.1 关闭防火墙、selinux</h4>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@master01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># hostnamectl set-hostname redis01</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@redis01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl stop firewalld</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@redis01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl disable firewalld</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@redis01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># sed -i 's/^SELINUX=enforcing/SELINUX=disabled/g' /etc/sysconfig/selinux</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@redis01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># sed -i 's/^SELINUX=enforcing/SELINUX=disabled/g' /etc/selinux/config</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@redis01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum install net-tools vim tree lrzsz wget unzip dos2unix bash-completion  lsof ntp ntpdate git -y</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">[</span>root@redis01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum update -y --exclude=kernel* &amp;&amp; reboot</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">[</span>root@redis01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># echo 'Asia/Shanghai' >/etc/timezone</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span>root@redis01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ntpdate time2.aliyun.com</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">[</span>root@redis01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># crontab -e</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>*/5 * * * * /usr/sbin/ntpdate time2.aliyun.com <span class=\"token operator\">&amp;></span> /dev/null</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">[</span>root@redis01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir /soft /data /scripts /backup</span></pre></td></tr></table></figure><h4 id=\"32-安装redis\"><a class=\"anchor\" href=\"#32-安装redis\">#</a> 3.2 安装 redis</h4>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@redis01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum install gcc-c++ -y</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@redis01 soft<span class=\"token punctuation\">]</span><span class=\"token comment\"># wget https://download.redis.io/releases/redis-6.2.11.tar.gz</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@redis01 soft<span class=\"token punctuation\">]</span><span class=\"token comment\"># tar xf redis-6.2.11.tar.gz </span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@redis01 soft<span class=\"token punctuation\">]</span><span class=\"token comment\"># ln -s /soft/redis-6.2.11 /soft/redis</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@redis01 soft<span class=\"token punctuation\">]</span><span class=\"token comment\"># cd /soft/redis</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@redis01 redis<span class=\"token punctuation\">]</span><span class=\"token comment\"># make            #执行 make 编译</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">[</span>root@redis01 redis<span class=\"token punctuation\">]</span><span class=\"token comment\"># make install    #将 src 下的许多可执行文件复制到 /usr/local/bin 目录下</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">[</span>root@redis01 redis<span class=\"token punctuation\">]</span><span class=\"token comment\"># redis-server /soft/redis/redis.conf &amp;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span>root@redis01 redis<span class=\"token punctuation\">]</span><span class=\"token comment\"># netstat -lntp|grep redis</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>tcp        <span class=\"token number\">0</span>      <span class=\"token number\">0</span> <span class=\"token number\">127.0</span>.0.1:6379          <span class=\"token number\">0.0</span>.0.0:*               LISTEN      <span class=\"token number\">69686</span>/redis-server  </pre></td></tr><tr><td data-num=\"11\"></td><td><pre>tcp6       <span class=\"token number\">0</span>      <span class=\"token number\">0</span> ::1:6379                :::*                    LISTEN      <span class=\"token number\">69686</span>/redis-server     </pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">[</span>root@redis01 redis<span class=\"token punctuation\">]</span><span class=\"token comment\"># redis-cli shutdown      #关闭 Redis 服务</span></pre></td></tr></table></figure><h4 id=\"33-redis配置文件说明\"><a class=\"anchor\" href=\"#33-redis配置文件说明\">#</a> 3.3 redis 配置文件说明</h4>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@db01 redis<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim redis.conf </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token builtin class-name\">bind</span> <span class=\"token number\">127.0</span>.0.1      \t\t<span class=\"token comment\"># 绑定的 ip</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>protected-mode <span class=\"token function\">yes</span>  \t\t<span class=\"token comment\"># 保护模式</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>port <span class=\"token number\">6379</span>           \t\t<span class=\"token comment\"># 端口设置</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>daemonize <span class=\"token function\">yes</span>               <span class=\"token comment\"># 后台启动</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token builtin class-name\">bind</span> <span class=\"token number\">127.0</span>.0.1      \t\t<span class=\"token comment\"># 绑定的 ip</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>protected-mode <span class=\"token function\">yes</span>  \t\t<span class=\"token comment\"># 保护模式</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>port <span class=\"token number\">6379</span>           \t\t<span class=\"token comment\"># 端口设置</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>loglevel notice     \t\t<span class=\"token comment\"># 记录日志级别</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>logfile <span class=\"token string\">\"redis.log\"</span>         <span class=\"token comment\"># 日志的文件位置名</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token function\">dir</span> ./               \t\t<span class=\"token comment\"># 日志存储目录</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>databases <span class=\"token number\">16</span>        \t\t<span class=\"token comment\"># 数据库的数量，默认是 16 个数据库</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>always-show-logo <span class=\"token function\">yes</span> \t\t<span class=\"token comment\"># 是否总是显示 LOGO</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\"># 如果 900s 内，如果至少有一个 1 key 进行了修改，我们及进行持久化操作</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>save <span class=\"token number\">900</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\"># 如果 300s 内，如果至少 10 key 进行了修改，我们及进行持久化操作</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>save <span class=\"token number\">300</span> <span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\"># 如果 60s 内，如果至少 10000 key 进行了修改，我们及进行持久化操作</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>save <span class=\"token number\">60</span> <span class=\"token number\">10000</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\"># 我们之后学习持久化，会自己定义这个测试！</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>stop-writes-on-bgsave-error <span class=\"token function\">yes</span>   <span class=\"token comment\"># 持久化如果出错，是否还需要继续工作！</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>rdbcompression <span class=\"token function\">yes</span>                <span class=\"token comment\"># 是否压缩 rdb 文件，需要消耗一些 cpu 资源！</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>rdbchecksum <span class=\"token function\">yes</span>                   <span class=\"token comment\"># 保存 rdb 文件的时候，进行错误的检查校验！</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>dbfilename dump.rdb               <span class=\"token comment\"># rdb 文件保存的名称！</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token function\">dir</span> ./                            <span class=\"token comment\"># rdb 文件保存的目录！</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>slaveof <span class=\"token number\">192.168</span>.1.154 <span class=\"token number\">6379</span>        <span class=\"token comment\"># 配置主从复制</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>requirepass foobared              <span class=\"token comment\"># 配置 redis 登录密码</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>appendonly no    <span class=\"token comment\"># 默认是不开启 aof 模式的，默认是使用 rdb 方式持久化的，在大部分所有的情况下，rdb 完全够用！</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>appendfilename <span class=\"token string\">\"appendonly.aof\"</span>   <span class=\"token comment\"># 持久化的文件的名字</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token comment\"># appendfsync always        # 每次修改都会 sync。消耗性能</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>appendfsync everysec        <span class=\"token comment\"># 每秒执行一次 sync，可能会丢失这 1s 的数据！</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token comment\"># appendfsync no            # 不执行 sync，这个时候操作系统自己同步数据，速度最快！</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>no-appendfsync-on-rewrite   <span class=\"token comment\">#重写时是否可以运用 appendsync，默认 no，可以保证数据的安全性</span></pre></td></tr></table></figure><h4 id=\"34-redis环境配置\"><a class=\"anchor\" href=\"#34-redis环境配置\">#</a> 3.4 redis 环境配置</h4>\n<p>#修改 maser 配置文件</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">vim</span> redis.conf</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token builtin class-name\">bind</span> <span class=\"token number\">192.168</span>.40.101 <span class=\"token comment\">#绑定本机 ip 地址</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>port <span class=\"token number\">6739</span>          <span class=\"token comment\">#绑定端口号</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>daemonize <span class=\"token function\">yes</span>      <span class=\"token comment\">#用来指定 redis 是否要用守护进程的方式启动，默认为 no</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>pidfile /var/run/redis_6379.pid</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>logfile <span class=\"token string\">\"redis.log\"</span>   <span class=\"token comment\">#redis 日志文件</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>requirepass Superman*2023  <span class=\"token comment\">#本地 redis 密码</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>masterauth Superman*2023   <span class=\"token comment\">#主节点 redis 密码 注意：从节点也要配置，后边哨兵容灾切换用到</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>protected-mode <span class=\"token function\">yes</span>    <span class=\"token comment\">#保护模式</span></pre></td></tr></table></figure><p>#修改 slave01 配置文件</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">vim</span> redis.conf</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token builtin class-name\">bind</span> <span class=\"token number\">192.168</span>.40.102 <span class=\"token comment\">#绑定本机 ip 地址</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>port <span class=\"token number\">6739</span>          <span class=\"token comment\">#绑定端口号</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>daemonize <span class=\"token function\">yes</span>      <span class=\"token comment\">#用来指定 redis 是否要用守护进程的方式启动，默认为 no</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>pidfile /var/run/redis_6379.pid</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>logfile <span class=\"token string\">\"redis.log\"</span>   <span class=\"token comment\">#redis 日志文件</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>replicaof  <span class=\"token number\">192.168</span>.40.101 <span class=\"token number\">6379</span> <span class=\"token comment\">#配置文件中设置主节点，redis 主从复制这个地方只配置从库，注意：主库不需要这个配置</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>requirepass Superman*2023  <span class=\"token comment\">#本地 redis 密码</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>masterauth Superman*2023   <span class=\"token comment\">#主节点 redis 密码 注意：从节点也要配置，后边哨兵容灾切换用到</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>protected-mode <span class=\"token function\">yes</span>    <span class=\"token comment\">#保护模式</span></pre></td></tr></table></figure><p>#修改 slave02 配置文件</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">vim</span> redis.conf</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token builtin class-name\">bind</span> <span class=\"token number\">192.168</span>.40.103 <span class=\"token comment\">#绑定本机 ip 地址</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>port <span class=\"token number\">6739</span>          <span class=\"token comment\">#绑定端口号</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>daemonize <span class=\"token function\">yes</span>      <span class=\"token comment\">#用来指定 redis 是否要用守护进程的方式启动，默认为 no</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>pidfile /var/run/redis_6379.pid</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>logfile <span class=\"token string\">\"redis.log\"</span>   <span class=\"token comment\">#redis 日志文件</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>replicaof  <span class=\"token number\">192.168</span>.40.101 <span class=\"token number\">6379</span> <span class=\"token comment\">#配置文件中设置主节点，redis 主从复制这个地方只配置从库，注意：主库不需要这个配置</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>requirepass Superman*2023  <span class=\"token comment\">#本地 redis 密码</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>masterauth Superman*2023   <span class=\"token comment\">#主节点 redis 密码 注意：从节点也要配置，后边哨兵容灾切换用到</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>protected-mode <span class=\"token function\">yes</span>    <span class=\"token comment\">#保护模式</span></pre></td></tr></table></figure><h4 id=\"35-启动3台redis服务\"><a class=\"anchor\" href=\"#35-启动3台redis服务\">#</a> 3.5 启动 3 台 redis 服务</h4>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#启动 redis01</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@redis01 redis<span class=\"token punctuation\">]</span><span class=\"token comment\"># redis-server /soft/redis/redis.conf</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@redis0<span class=\"token punctuation\">[</span>root@redis01 redis<span class=\"token punctuation\">]</span><span class=\"token comment\"># redis-server /soft/redis/redis.conf redis]# netstat -lntp|grep redis</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>tcp        <span class=\"token number\">0</span>      <span class=\"token number\">0</span> <span class=\"token number\">192.168</span>.40.101:6379     <span class=\"token number\">0.0</span>.0.0:*               LISTEN      <span class=\"token number\">117358</span>/redis-server </pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">#启动 redis02</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">[</span>root@redis02 redis<span class=\"token punctuation\">]</span><span class=\"token comment\"># redis-server /soft/redis/redis.conf</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">[</span>root@redis02 redis<span class=\"token punctuation\">]</span><span class=\"token comment\"># netstat -lntp|grep redis</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>tcp        <span class=\"token number\">0</span>      <span class=\"token number\">0</span> <span class=\"token number\">192.168</span>.40.102:6379     <span class=\"token number\">0.0</span>.0.0:*               LISTEN      <span class=\"token number\">18210</span>/redis-server</pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>启动redis03</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">[</span>root@redis03 redis<span class=\"token punctuation\">]</span><span class=\"token comment\"># redis-server /soft/redis/redis.conf</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">[</span>root@redis03 redis<span class=\"token punctuation\">]</span><span class=\"token comment\"># netstat -lntp|grep redis</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>tcp        <span class=\"token number\">0</span>      <span class=\"token number\">0</span> <span class=\"token number\">192.168</span>.40.103:6379     <span class=\"token number\">0.0</span>.0.0:*               LISTEN      <span class=\"token number\">19186</span>/redis-server</pre></td></tr></table></figure><h4 id=\"36-查看主从状态\"><a class=\"anchor\" href=\"#36-查看主从状态\">#</a> 3.6 查看主从状态</h4>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#主节点</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@redis01 redis<span class=\"token punctuation\">]</span><span class=\"token comment\"># redis-cli -p 6379 -h 192.168.40.101 -a Superman*2023</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">192.168</span>.40.101:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> info replication</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># Replication</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>role:master</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>connected_slaves:2</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>slave0:ip<span class=\"token operator\">=</span><span class=\"token number\">192.168</span>.40.102,port<span class=\"token operator\">=</span><span class=\"token number\">6379</span>,state<span class=\"token operator\">=</span>online,offset<span class=\"token operator\">=</span><span class=\"token number\">616</span>,lag<span class=\"token operator\">=</span><span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>slave1:ip<span class=\"token operator\">=</span><span class=\"token number\">192.168</span>.40.103,port<span class=\"token operator\">=</span><span class=\"token number\">6379</span>,state<span class=\"token operator\">=</span>online,offset<span class=\"token operator\">=</span><span class=\"token number\">616</span>,lag<span class=\"token operator\">=</span><span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>master_failover_state:no-failover</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>master_replid:93df7cd5095dcccdbf8266787031b17cf638a2ad</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>master_replid2:0000000000000000000000000000000000000000</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>master_repl_offset:616</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>second_repl_offset:-1</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>repl_backlog_active:1</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>repl_backlog_size:1048576</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>repl_backlog_first_byte_offset:1</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>repl_backlog_histlen:616</pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\">#从节点</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">[</span>root@redis01 redis<span class=\"token punctuation\">]</span><span class=\"token comment\"># redis-cli -p 6379 -h 192.168.40.103 -a Superman*2023</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>Warning: Using a password with <span class=\"token string\">'-a'</span> or <span class=\"token string\">'-u'</span> option on the <span class=\"token builtin class-name\">command</span> line interface may not be safe.</pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token number\">192.168</span>.40.103:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> info replication</pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\"># Replication</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>role:slave</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>master_host:192.168.40.101</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>master_port:6379</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>master_link_status:up</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>master_last_io_seconds_ago:1</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>master_sync_in_progress:0</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>slave_read_repl_offset:812</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>slave_repl_offset:812</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>slave_priority:100</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>slave_read_only:1</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>replica_announced:1</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>connected_slaves:0</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>master_failover_state:no-failover</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>master_replid:93df7cd5095dcccdbf8266787031b17cf638a2ad</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>master_replid2:0000000000000000000000000000000000000000</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>master_repl_offset:812</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>second_repl_offset:-1</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>repl_backlog_active:1</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>repl_backlog_size:1048576</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>repl_backlog_first_byte_offset:295</pre></td></tr><tr><td data-num=\"44\"></td><td><pre>repl_backlog_histlen:518</pre></td></tr></table></figure><h4 id=\"37-测试主从\"><a class=\"anchor\" href=\"#37-测试主从\">#</a> 3.7 测试主从</h4>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@redis01 redis<span class=\"token punctuation\">]</span><span class=\"token comment\"># redis-cli -p 6379 -h 192.168.40.101 -a Superman*2023</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Warning: Using a password with <span class=\"token string\">'-a'</span> or <span class=\"token string\">'-u'</span> option on the <span class=\"token builtin class-name\">command</span> line interface may not be safe.</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">192.168</span>.40.101:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token builtin class-name\">set</span> k1 v1</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">192.168</span>.40.101:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token builtin class-name\">set</span> k2 v2</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">[</span>root@redis03 redis<span class=\"token punctuation\">]</span><span class=\"token comment\"># redis-cli -p 6379 -h 192.168.40.103 -a Superman*2023</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>Warning: Using a password with <span class=\"token string\">'-a'</span> or <span class=\"token string\">'-u'</span> option on the <span class=\"token builtin class-name\">command</span> line interface may not be safe.</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">192.168</span>.40.103:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get k1</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token string\">\"v1\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token number\">192.168</span>.40.103:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> get k2</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token string\">\"v2\"</span></pre></td></tr></table></figure><p><strong>注意:</strong><br />\n1、主机可以写，从机不能写，只能读。主机中的所有数据都会保存到从机中去。<br />\n2、主机断开连接，从机依旧连接到主机的，但是没有写操作，这个时候，主机如果回来了，从机依旧可以直接获取到主机写的信息！<br />\n3、如果是使用命令行，来配置的主从，这个时候如果重启了，就会变回主机！只要变为从机，立马就会从主机中获取值！<br />\n4、主从复制原理<br />\n Slave 启动成功连接到 master 后会发送一个 sync 同步命令<br />\n Master 接到命令，启动后台的存盘进程，同时收集所有接收到的用于修改数据集命令，在后台进程执行完毕之后，master 将传送整个数据文件到 slave，并完成一次完全同步。<br />\n全量复制：slave 服务在接收到数据库文件数据后，将其存盘并加载到内存中。<br />\n增量复制：Master 继续将新的所有收集到的修改命令依次传给 slave，完成同步，但是只要是重新连接 master，一次完全同步（全量复制）将被自动执行！ 主机的数据一定可以在从机中看到。</p>\n<h3 id=\"四-哨兵模式搭建\"><a class=\"anchor\" href=\"#四-哨兵模式搭建\">#</a> 四、哨兵模式搭建</h3>\n<p>1、什么是 redis 哨兵？<br />\nRedisSentinel 是 Redis 的高可用性解决方案，由一个或多个 Sentinel（哨兵）实例组成。它可以监视任意多个主服务器，以及这些主服务器属下的所有从服务器，并在被监视的主服务器进入下线状态时，自动将下线主服务器属下的某个从服务器升级为新的主服务器，它的主要功能如下：<br />\n监控 (Monitoring)：Sentinel 会不断地检查你的主服务器和从服务器是否运作正常。<br />\n通知 (Notification)：当被监控的某个 Redis 服务器出现问题时，Sentinel 可以通过 API 向管理员或者其他应用程序发送通知。<br />\n故障迁移：当主服务器不能正常工作时，Sentinel 会自动进行故障迁移，也就是主从切换。<br />\n统一的配置：管理连接者询问 sentinel 取得主从的地址。</p>\n<p>2、哨兵原理是什么？<br />\nSentinel 使用的算法核心是 Raft 算法，主要用途就是用于分布式系统，系统容错，以及 Leader 选举，每个 Sentinel 都需要定期的执行以下任务：<br />\n每个 Sentinel 会自动发现其他 Sentinel 和从服务器，它以每秒钟一次的频率向它所知的主服务器、从服务器以及其他 Sentinel 实例发送一个 PING 命令。<br />\n如果一个实例（instance）距离最后一次有效回复 PING 命令的时间超过 down-after-milliseconds 选项所指定的值， 那么这个实例会被 Sentinel 标记为主观下线。 有效回复可以是： +PONG 、 -LOADING 或者 -MASTERDOWN 。<br />\n如果一个主服务器被标记为主观下线， 那么正在监视这个主服务器的所有 Sentinel 要以每秒一次的频率确认主服务器的确进入了主观下线状态。<br />\n如果一个主服务器被标记为主观下线， 并且有足够数量的 Sentinel（至少要达到配置文件指定的数量）在指定的时间范围内同意这一判断，那么这个主服务器被标记为客观下线。<br />\n在一般情况下， 每个 Sentinel 会以每 10 秒一次的频率向它已知的所有主服务器和从服务器发送 INFO 命令。当一个主服务器 Sentinel 标记为客观下线时，Sentinel 向下线主服务器的所有从服务器发送 INFO 命令的频率会从 10 秒一次改为每秒一次。<br />\n当没有足够数量的 Sentinel 同意主服务器已经下线， 主服务器的客观下线状态就会被移除。 当主服务器重新向 Sentinel 的 PING 命令返回有效回复时， 主服务器的主管下线状态就会被移除。</p>\n<p><a href=\"https://imgse.com/i/pEgT1r6\"><img loading=\"lazy\" data-src=\"https://s21.ax1x.com/2025/04/09/pEgT1r6.png\" alt=\"pEgT1r6.png\" /></a></p>\n<h4 id=\"41-搭建哨兵\"><a class=\"anchor\" href=\"#41-搭建哨兵\">#</a> 4.1 搭建哨兵</h4>\n<p><em>在每台服务器上部署一个哨兵，配置方式如下:</em></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@redis01 redis<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim sentinel.conf</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#端口默认为 26379。</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>port <span class=\"token number\">26379</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">#关闭保护模式，可以外部访问。</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>protected-mode no</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">#设置为后台启动。</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>daemonize <span class=\"token function\">yes</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#日志文件。</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>logfile <span class=\"token string\">\"/soft/redis/sentinel.log\"</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">#指定服务器 IP 地址和端口，并且指定当有 2 台哨兵认为主机挂了，则对主机进行容灾切换。注意：三台哨兵这里的 ip 配置均为主节点 ip 和端口</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>sentinel monitor mymaster <span class=\"token number\">192.168</span>.40.101 <span class=\"token number\">6379</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">#当在 Redis 实例中开启了 requirepass，这里就需要提供密码。</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>sentinel auth-pass mymaster psw66</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">#这里设置了主机多少秒无响应，则认为挂了。</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>sentinel down-after-milliseconds mymaster <span class=\"token number\">3000</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\">#主备切换时，最多有多少个 slave 同时对新的 master 进行同步，这里设置为默认的</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>snetinel parallel-syncs mymaster <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">#故障转移的超时时间，这里设置为三分钟。</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>sentinel failover-timeout mymaster <span class=\"token number\">180000</span></pre></td></tr></table></figure><h4 id=\"42-启动三台服务器上的哨兵\"><a class=\"anchor\" href=\"#42-启动三台服务器上的哨兵\">#</a> 4.2 启动三台服务器上的哨兵</h4>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#启动 redis01 的 sentine</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@redis01 redis<span class=\"token punctuation\">]</span><span class=\"token comment\"># redis-sentinel /soft/redis/sentinel.conf</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@redis01 redis<span class=\"token punctuation\">]</span><span class=\"token comment\">#  netstat -lntp|grep redis</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>tcp        <span class=\"token number\">0</span>      <span class=\"token number\">0</span> <span class=\"token number\">0.0</span>.0.0:26379           <span class=\"token number\">0.0</span>.0.0:*               LISTEN      <span class=\"token number\">33536</span>/redis-sentine </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>tcp        <span class=\"token number\">0</span>      <span class=\"token number\">0</span> <span class=\"token number\">192.168</span>.40.101:6379     <span class=\"token number\">0.0</span>.0.0:*               LISTEN      <span class=\"token number\">117358</span>/redis-server </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>tcp6       <span class=\"token number\">0</span>      <span class=\"token number\">0</span> :::26379                :::*                    LISTEN      <span class=\"token number\">33536</span>/redis-sentine</pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#启动 redis02 的 sentine</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span>root@redis02 redis<span class=\"token punctuation\">]</span><span class=\"token comment\"># redis-sentinel /soft/redis/sentinel.conf</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">[</span>root@redis02 redis<span class=\"token punctuation\">]</span><span class=\"token comment\">#  netstat -lntp|grep redis</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>tcp        <span class=\"token number\">0</span>      <span class=\"token number\">0</span> <span class=\"token number\">0.0</span>.0.0:26379           <span class=\"token number\">0.0</span>.0.0:*               LISTEN      <span class=\"token number\">18757</span>/redis-sentine </pre></td></tr><tr><td data-num=\"12\"></td><td><pre>tcp        <span class=\"token number\">0</span>      <span class=\"token number\">0</span> <span class=\"token number\">192.168</span>.40.102:6379     <span class=\"token number\">0.0</span>.0.0:*               LISTEN      <span class=\"token number\">18210</span>/redis-server  </pre></td></tr><tr><td data-num=\"13\"></td><td><pre>tcp6       <span class=\"token number\">0</span>      <span class=\"token number\">0</span> :::26379                :::*                    LISTEN      <span class=\"token number\">18757</span>/redis-sentine</pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">#启动 redis03 的 sentine</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">[</span>root@redis03 redis<span class=\"token punctuation\">]</span><span class=\"token comment\"># redis-sentinel /soft/redis/sentinel.conf                     </span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">[</span>root@redis03 redis<span class=\"token punctuation\">]</span><span class=\"token comment\"># netstat -lntp|grep redis</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>tcp        <span class=\"token number\">0</span>      <span class=\"token number\">0</span> <span class=\"token number\">0.0</span>.0.0:26379           <span class=\"token number\">0.0</span>.0.0:*               LISTEN      <span class=\"token number\">19745</span>/redis-sentine </pre></td></tr><tr><td data-num=\"19\"></td><td><pre>tcp        <span class=\"token number\">0</span>      <span class=\"token number\">0</span> <span class=\"token number\">192.168</span>.40.103:6379     <span class=\"token number\">0.0</span>.0.0:*               LISTEN      <span class=\"token number\">19186</span>/redis-server  </pre></td></tr><tr><td data-num=\"20\"></td><td><pre>tcp6       <span class=\"token number\">0</span>      <span class=\"token number\">0</span> :::26379                :::*                    LISTEN      <span class=\"token number\">19745</span>/redis-sentine</pre></td></tr></table></figure><h4 id=\"43-连接客户端\"><a class=\"anchor\" href=\"#43-连接客户端\">#</a> 4.3 连接客户端</h4>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@redis01 redis<span class=\"token punctuation\">]</span><span class=\"token comment\"># redis-cli -p 26379</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">127.0</span>.0.1:2637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span>  info sentinel</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># Sentinel</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>sentinel_masters:1</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>sentinel_tilt:0</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>sentinel_running_scripts:0</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>sentinel_scripts_queue_length:0</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>sentinel_simulate_failure_flags:0</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>master0:name<span class=\"token operator\">=</span>mymaster,status<span class=\"token operator\">=</span>ok,address<span class=\"token operator\">=</span><span class=\"token number\">192.168</span>.40.101:6379,slaves<span class=\"token operator\">=</span><span class=\"token number\">2</span>,sentinels<span class=\"token operator\">=</span><span class=\"token number\">3</span></pre></td></tr></table></figure><h4 id=\"44-redis容灾切换\"><a class=\"anchor\" href=\"#44-redis容灾切换\">#</a> 4.4 redis 容灾切换</h4>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#连接 redis 客户端</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@redis01 redis<span class=\"token punctuation\">]</span><span class=\"token comment\"># redis-cli -p 6379 -h 192.168.40.101 </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#验证密码</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">192.168</span>.40.101:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> auth Superman*2023</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">#关闭 redis 服务</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">192.168</span>.40.101:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> <span class=\"token function\">shutdown</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>not connected<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">#退出客户端</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>not connected<span class=\"token operator\">></span> <span class=\"token builtin class-name\">exit</span></pre></td></tr></table></figure><p>关闭主节点之后，我们去查看哨兵日志:</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@redis01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># tail -f /soft/redis/sentinel.log </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">91936</span>:X <span class=\"token number\">14</span> Apr <span class=\"token number\">2023</span> <span class=\"token number\">23</span>:26:23.838 <span class=\"token comment\"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">91936</span>:X <span class=\"token number\">14</span> Apr <span class=\"token number\">2023</span> <span class=\"token number\">23</span>:26:23.838 <span class=\"token comment\"># Redis version=6.2.11, bits=64, commit=00000000, modified=0, pid=91936, just started</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">91936</span>:X <span class=\"token number\">14</span> Apr <span class=\"token number\">2023</span> <span class=\"token number\">23</span>:26:23.838 <span class=\"token comment\"># Configuration loaded</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">91936</span>:X <span class=\"token number\">14</span> Apr <span class=\"token number\">2023</span> <span class=\"token number\">23</span>:26:23.838 * monotonic clock: POSIX clock_gettime</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">91936</span>:X <span class=\"token number\">14</span> Apr <span class=\"token number\">2023</span> <span class=\"token number\">23</span>:26:23.839 * Running <span class=\"token assign-left variable\">mode</span><span class=\"token operator\">=</span>sentinel, <span class=\"token assign-left variable\">port</span><span class=\"token operator\">=</span><span class=\"token number\">26379</span>.</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">91936</span>:X <span class=\"token number\">14</span> Apr <span class=\"token number\">2023</span> <span class=\"token number\">23</span>:26:23.839 <span class=\"token comment\"># Sentinel ID is 835b4c8544fb250af5fd479f834ee369cc4f388e</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">91936</span>:X <span class=\"token number\">14</span> Apr <span class=\"token number\">2023</span> <span class=\"token number\">23</span>:26:23.839 <span class=\"token comment\"># +monitor master mymaster 192.168.40.101 6379 quorum 2</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token number\">91936</span>:X <span class=\"token number\">14</span> Apr <span class=\"token number\">2023</span> <span class=\"token number\">23</span>:31:25.329 <span class=\"token comment\"># +sdown master mymaster 192.168.40.101 6379   #这里应该是发现主节点宕机</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token number\">91936</span>:X <span class=\"token number\">14</span> Apr <span class=\"token number\">2023</span> <span class=\"token number\">23</span>:31:25.359 <span class=\"token comment\"># +new-epoch 5</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token number\">91936</span>:X <span class=\"token number\">14</span> Apr <span class=\"token number\">2023</span> <span class=\"token number\">23</span>:31:25.360 <span class=\"token comment\"># +vote-for-leader ab43979285cb47b1b459aeb0ab91b63fa9d1a989 5</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token number\">91936</span>:X <span class=\"token number\">14</span> Apr <span class=\"token number\">2023</span> <span class=\"token number\">23</span>:31:25.401 <span class=\"token comment\"># +odown master mymaster 192.168.40.101 6379 #quorum 3/2 两个哨兵都觉得主节点宕机了</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token number\">91936</span>:X <span class=\"token number\">14</span> Apr <span class=\"token number\">2023</span> <span class=\"token number\">23</span>:31:25.401 <span class=\"token comment\"># Next failover delay: I will not start a failover before Fri Apr 14 23:37:25 2023</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token number\">91936</span>:X <span class=\"token number\">14</span> Apr <span class=\"token number\">2023</span> <span class=\"token number\">23</span>:31:26.468 <span class=\"token comment\"># +config-update-from sentinel ab43979285cb47b1b459aeb0ab91b63fa9d1a989 192.168.40.102 26379 @ mymaster 192.168.40.101 6379</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token number\">91936</span>:X <span class=\"token number\">14</span> Apr <span class=\"token number\">2023</span> <span class=\"token number\">23</span>:31:26.468 <span class=\"token comment\"># +switch-master mymaster 192.168.40.101 6379 192.168.40.103 6379 #通过投票选举 40.103 为新的主节点</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token number\">91936</span>:X <span class=\"token number\">14</span> Apr <span class=\"token number\">2023</span> <span class=\"token number\">23</span>:31:26.468 * +slave slave <span class=\"token number\">192.168</span>.40.102:6379 <span class=\"token number\">192.168</span>.40.102 <span class=\"token number\">6379</span> @ mymaster <span class=\"token number\">192.168</span>.40.103 <span class=\"token number\">6379</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token number\">91936</span>:X <span class=\"token number\">14</span> Apr <span class=\"token number\">2023</span> <span class=\"token number\">23</span>:31:26.469 * +slave slave <span class=\"token number\">192.168</span>.40.101:6379 <span class=\"token number\">192.168</span>.40.101 <span class=\"token number\">6379</span> @ mymaster <span class=\"token number\">192.168</span>.40.103 <span class=\"token number\">6379</span></pre></td></tr></table></figure><p>下面我们去 40.103 下查看哨兵主从切换是否成功</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@redis03 redis<span class=\"token punctuation\">]</span><span class=\"token comment\"># redis-cli -p 6379 -h 192.168.40.103</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">192.168</span>.40.103:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> auth Superman*2023</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">192.168</span>.40.103:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> info replication</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># Replication</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>role:master   <span class=\"token comment\"># 40.103 变成主节点了</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>connected_slaves:1   <span class=\"token comment\"># 下面的从机个数为 1</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>slave0:ip<span class=\"token operator\">=</span><span class=\"token number\">192.168</span>.40.102,port<span class=\"token operator\">=</span><span class=\"token number\">6379</span>,state<span class=\"token operator\">=</span>online,offset<span class=\"token operator\">=</span><span class=\"token number\">108708</span>,lag<span class=\"token operator\">=</span><span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>master_failover_state:no-failover</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>master_replid:cf36f762dcae0c07b54f7287dc19d7ecc0d50dd3</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>master_replid2:a7de32d10b2d31f8886c84ca91dc7f055439c935</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>master_repl_offset:108851</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>second_repl_offset:59887</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>repl_backlog_active:1</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>repl_backlog_size:1048576</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>repl_backlog_first_byte_offset:1</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>repl_backlog_histlen:108851</pre></td></tr></table></figure><p>重新连接挂掉的主节点</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@redis01 redis<span class=\"token punctuation\">]</span><span class=\"token comment\"># redis-server redis.conf </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@redis01 redis<span class=\"token punctuation\">]</span><span class=\"token comment\">#  redis-cli -p 6379 -h 192.168.40.101</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">192.168</span>.40.101:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> auth Superman*2023</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>OK</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">192.168</span>.40.101:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> info replication</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># Replication</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>role:slave          <span class=\"token comment\">#主节点连接回来之后自动变成了从节点，并且成功连上了主机</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>master_host:192.168.40.103</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>master_port:6379</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>master_link_status:up</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>master_last_io_seconds_ago:1</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>master_sync_in_progress:0</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>slave_read_repl_offset:130607</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>slave_repl_offset:130607</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>slave_priority:100</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>slave_read_only:1</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>replica_announced:1</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>connected_slaves:0</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>master_failover_state:no-failover</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>master_replid:cf36f762dcae0c07b54f7287dc19d7ecc0d50dd3</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>master_replid2:0000000000000000000000000000000000000000</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>master_repl_offset:130607</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>second_repl_offset:-1</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>repl_backlog_active:1</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>repl_backlog_size:1048576</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>repl_backlog_first_byte_offset:126982</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>repl_backlog_histlen:3626</pre></td></tr></table></figure><p>再去主节点确认一下</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">192.168</span>.40.103:637<span class=\"token operator\"><span class=\"token file-descriptor important\">9</span>></span> info replication</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># Replication</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>role:master</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>connected_slaves:2   <span class=\"token comment\">#两个从节点</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>slave0:ip<span class=\"token operator\">=</span><span class=\"token number\">192.168</span>.40.102,port<span class=\"token operator\">=</span><span class=\"token number\">6379</span>,state<span class=\"token operator\">=</span>online,offset<span class=\"token operator\">=</span><span class=\"token number\">147879</span>,lag<span class=\"token operator\">=</span><span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>slave1:ip<span class=\"token operator\">=</span><span class=\"token number\">192.168</span>.40.101,port<span class=\"token operator\">=</span><span class=\"token number\">6379</span>,state<span class=\"token operator\">=</span>online,offset<span class=\"token operator\">=</span><span class=\"token number\">147879</span>,lag<span class=\"token operator\">=</span><span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>master_failover_state:no-failover</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>master_replid:cf36f762dcae0c07b54f7287dc19d7ecc0d50dd3</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>master_replid2:a7de32d10b2d31f8886c84ca91dc7f055439c935</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>master_repl_offset:148165</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>second_repl_offset:59887</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>repl_backlog_active:1</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>repl_backlog_size:1048576</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>repl_backlog_first_byte_offset:1</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>repl_backlog_histlen:148165</pre></td></tr></table></figure><p>五、哨兵模式的优缺点<br />\n 1. 优点</p>\n<p>哨兵集群，基于主从复制模式，所有的主从配置优点，它全有</p>\n<p>主从可以切换，故障可以转移，系统的可用性就会更好</p>\n<p>哨兵模式就是主从模式的升级，手动到自动，更加健壮！</p>\n<p>2. 缺点</p>\n<p>Redis 不好在线扩容，集群容量一旦到达上限，在线扩容就十分麻烦</p>\n<p>哨兵模式的配置繁琐</p>\n<p>3. 哨兵模式的配置文件详解</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># Example sentinel.conf</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># 哨兵 sentinel 实例运行的端口 默认 26379</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>port <span class=\"token number\">26379</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre> </pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># 哨兵 sentinel 的工作目录</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token function\">dir</span> /tmp</pre></td></tr><tr><td data-num=\"7\"></td><td><pre> </pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\"># 哨兵 sentinel 监控的 redis 主节点的 ip port</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\"># master-name 可以自己命名的主节点名字 只能由字母 A-z、数字 0-9 、这三个字符 \".-_\" 组成。</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\"># quorum 配置多少个 sentinel 哨兵统一认为 master 主节点失联 那么这时客观上认为主节点失联了</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\"># sentinel monitor &lt;master-name> &lt;ip> &lt;redis-port> &lt;quorum></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>sentinel monitor mymaster <span class=\"token number\">127.0</span>.0.1 <span class=\"token number\">6379</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\"># 当在 Redis 实例中开启了 requirepass foobared 授权密码这样所有连接 Redis 实例的客户端都要提供 密码</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\"># 设置哨兵 sentinel 连接主从的密码 注意必须为主从设置一样的验证密码</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\"># sentinel auth-pass &lt;master-name> &lt;password></span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>sentinel auth-pass mymaster MySUPER--secret-0123passw0rd</pre></td></tr><tr><td data-num=\"18\"></td><td><pre> </pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\"># 指定多少毫秒之后 主节点没有应答哨兵 sentinel 此时哨兵主观上认为主节点下线 默认 30 秒</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\"># sentinel down-after-milliseconds &lt;master-name> &lt;milliseconds></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>sentinel down-after-milliseconds mymaster <span class=\"token number\">30000</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre> </pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\"># 这个配置项指定了在发生 failover 主备切换时最多可以有多少个 slave 同时对新的 master 进行同步，这个数字越小，完成 failover 所需的时间就越长， 但是如果这个数字越大，就意味着越 多的 slave 因为 replication 而不可用。 可以通过将这个值设为 1 来保证每次只有一个 slave 处于不能处理命令请求的状态。</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\"># sentinel parallel-syncs &lt;master-name> &lt;numslaves></span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>sentinel parallel-syncs mymaster <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre> </pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token comment\"># 故障转移的超时时间 failover-timeout 可以用在以下这些方面：</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token comment\">#1. 同一个 sentinel 对同一个 master 两次 failover 之间的间隔时间。</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token comment\">#2. 当一个 slave 从一个错误的 master 那里同步数据开始计算时间。直到 slave 被纠正为向正确的 master 那 里同步数据时。</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token comment\">#3. 当想要取消一个正在进行的 failover 所需要的时间。</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token comment\">#4. 当进行 failover 时，配置所有 slaves 指向新的 master 所需的最大时间。不过，即使过了这个超时， slaves 依然会被正确配置为指向 master，但是就不按 parallel-syncs 所配置的规则来了 # 默认三分钟</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token comment\"># sentinel failover-timeout &lt;master-name> &lt;milliseconds> bilibili：</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>sentinel failover-timeout mymaster <span class=\"token number\">180000</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre> </pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token comment\"># SCRIPTS EXECUTION</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token comment\">#配置当某一事件发生时所需要执行的脚本，可以通过脚本来通知管理员，例如当系统运行不正常时发邮件通知 相关人员。</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token comment\">#对于脚本的运行结果有以下规则：</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token comment\">#若脚本执行后返回 1，那么该脚本稍后将会被再次执行，重复次数目前默认为 10</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token comment\">#若脚本执行后返回 2，或者比 2 更高的一个返回值，脚本将不会重复执行。</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token comment\">#如果脚本在执行过程中由于收到系统中断信号被终止了，则同返回值为 1 时的行为相同。</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token comment\">#一个脚本的最大执行时间为 60s，如果超过这个时间，脚本将会被一个 SIGKILL 信号终止，之后重新执行。</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token comment\">#通知型脚本：当 sentinel 有任何警告级别的事件发生时（比如说 redis 实例的主观失效和客观失效等等）， 将会去调用这个脚本，这时这个脚本应该通过邮件，SMS 等方式去通知系统管理员关于系统不正常运行的信 息。调用该脚本时，将传给脚本两个参数，一个是事件的类型，一个是事件的描述。如果 sentinel.conf 配 置文件中配置了这个脚本路径，那么必须保证这个脚本存在于这个路径，并且是可执行的，否则 sentinel 无 法正常启动成功。</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token comment\">#通知脚本</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token comment\"># shell 编程</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token comment\"># sentinel notification-script &lt;master-name> &lt;script-path> sentinel</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>notification-script mymaster /var/redis/notify.sh</pre></td></tr><tr><td data-num=\"47\"></td><td><pre> </pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token comment\"># 客户端重新配置主节点参数脚本</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token comment\"># 当一个 master 由于 failover 而发生改变时，这个脚本将会被调用，通知相关的客户端关于 master 地址已 经发生改变的信息。</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token comment\"># 以下参数将会在调用脚本时传给脚本:</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token comment\"># &lt;master-name> &lt;role> &lt;state> &lt;from-ip> &lt;from-port> &lt;to-ip> &lt;to-port> # 目前 & lt;state > 总是 “failover”,</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token comment\"># &lt;role > 是 “leader” 或者 “observer” 中的一个。</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre><span class=\"token comment\"># 参数 from-ip, from-port, to-ip, to-port 是用来和旧的 master 和新的 master (即旧的 slave) 通 信的# 这个脚本应该是通用的，能被多次调用，不是针对性的。</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token comment\"># sentinel client-reconfig-script &lt;master-name> &lt;script-path> sentinel client-reconfig-</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>script mymaster /var/redis/reconfig.shb</pre></td></tr></table></figure><p><em>再去看一下 redis 的配置文件和哨兵的配置文件，你会惊讶的发现，里边的配置文件已经被改过来了。</em></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">cat</span> redis.con</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>replicaof <span class=\"token number\">192.168</span>.40.103 <span class=\"token number\">6379</span></pre></td></tr></table></figure>",
            "tags": [
                "Redis"
            ]
        }
    ]
}