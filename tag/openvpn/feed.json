{
    "version": "https://jsonfeed.org/version/1",
    "title": "LinuxSre云原生 • All posts by \"openvpn\" tag",
    "description": "专注于 Linux 运维、云计算、云原⽣等技术",
    "home_page_url": "http://ixuyong.cn",
    "items": [
        {
            "id": "http://ixuyong.cn/posts/2126514413.html",
            "url": "http://ixuyong.cn/posts/2126514413.html",
            "title": "虚拟隧道网络Openvpn",
            "date_published": "2025-06-05T13:50:22.000Z",
            "content_html": "<h3 id=\"虚拟隧道网络openvpn\"><a class=\"anchor\" href=\"#虚拟隧道网络openvpn\">#</a> 虚拟隧道网络 Openvpn</h3>\n<h4 id=\"一-什么是vpn\"><a class=\"anchor\" href=\"#一-什么是vpn\">#</a> 一、什么是 VPN</h4>\n<p>VPN（Virtual Private Network） 翻译过来就是虚拟专⽤⽹络，那虚拟专⽤⽹提供什么功能</p>\n<ol>\n<li>将两个或多个 “不同地域 “的⽹络通过⼀条虚拟隧道的⽅式连接起来，实现互通；</li>\n<li>在不安全的线路上提供安全的数据传输；</li>\n</ol>\n<h4 id=\"二-vpn应用场景\"><a class=\"anchor\" href=\"#二-vpn应用场景\">#</a> 二、VPN 应⽤场景</h4>\n<h5 id=\"21-点对点连接\"><a class=\"anchor\" href=\"#21-点对点连接\">#</a> 2.1 点对点连接</h5>\n<p>Peer-to-Peer VPN (点对点连接)，将 Internet 两台机器（公⽹地址）使⽤ VPN 连接起来，⽐如上海服务器和北京服务器的之间的数据需要相互调⽤，但是数据⼜⽐较敏感，直接通过 http 公共⽹络传输，容易被窃取。如果拉⼀条专线成本⼜太⾼。所以我们可以通过 VPN 将两台主机逻辑上捆绑在⼀个虚拟⽹络中，这样既保证了数据传输安全，同时⼜节省了成本。</p>\n<p><img loading=\"lazy\" data-src=\"https://wp-cdn.4ce.cn/v2/ZjDn2SI.png\" alt=\"1.png\" /></p>\n<h5 id=\"22-站点对站点\"><a class=\"anchor\" href=\"#22-站点对站点\">#</a> 2.2 站点对站点</h5>\n<p>SIte-to-Site VPN (站点对站点连接) ，⽤于连接两个或者多个地域上不同的局域⽹ LAN，每个 LAN 有⼀台 OpenVPN 服务器作为接⼊点，组成虚拟专⽤⽹络，使得不同 LAN ⾥⾯的主机和服务器都能够相互通讯。（⽐如国内公司与海外公司分公司的连接）</p>\n<p><img loading=\"lazy\" data-src=\"https://wp-cdn.4ce.cn/v2/W5Yg3v0.png\" alt=\"2.png\" /></p>\n<h5 id=\"23-远程访问\"><a class=\"anchor\" href=\"#23-远程访问\">#</a> 2.3 远程访问</h5>\n<p>Remote AccessVPN（远程访问），应⽤于外⽹⽤户访问内部资源。在这个场景中远程访问者⼀般通过公⽹ IP 连接 VPN 服务，然后通过分配后的内⽹地址与其内⽹⽹段进⾏通信。</p>\n<p><img loading=\"lazy\" data-src=\"https://wp-cdn.4ce.cn/v2/6f3PYIK.png\" alt=\"3.png\" /></p>\n<h4 id=\"三-openvpn基本介绍\"><a class=\"anchor\" href=\"#三-openvpn基本介绍\">#</a> 三、OpenVPN 基本介绍</h4>\n<h5 id=\"31-什么是openvpn\"><a class=\"anchor\" href=\"#31-什么是openvpn\">#</a> 3.1 什么是 OpenVPN</h5>\n<p>OpenVPN 就像它的名字⼀样，是⼀个开源的软件，且提供</p>\n<p>VPN 虚拟专⽤⽹络功能；</p>\n<ul>\n<li>⽀持 SSL/TLS 协议，使得数据传输更安全；</li>\n<li>⽀持 TCP、UDP 隧道；</li>\n<li>⽀持动态分配虚拟 IP 地址；</li>\n<li>⽀持数百甚⾄数千⽤户同时使⽤；</li>\n<li>⽀持⼤多数主流操作系统平台；</li>\n</ul>\n<p>OpenVPN 官⽹：<a href=\"https://openvpn.net\">https://openvpn.net</a></p>\n<p>GitHub 地址：<a href=\"https://github.com/OpenVPN/openvpn\">https://github.com/OpenVPN/openvpn</a></p>\n<h5 id=\"32-openvpn应用场景\"><a class=\"anchor\" href=\"#32-openvpn应用场景\">#</a> 3.2 OpenVPN 应⽤场景</h5>\n<p>场景 1：拨⼊ OpenVPN，然后连接内部服务器；</p>\n<p>场景 2：实现两个不同地域主机、且两个地域主机 IP 不固定，互连互通；</p>\n<h5 id=\"33-openvpn实现场景\"><a class=\"anchor\" href=\"#33-openvpn实现场景\">#</a> 3.3 OpenVPN 实现场景</h5>\n<p><img loading=\"lazy\" data-src=\"https://wp-cdn.4ce.cn/v2/3GCg7Qd.png\" alt=\"1.png\" /></p>\n<h4 id=\"四-openvpn证书配置\"><a class=\"anchor\" href=\"#四-openvpn证书配置\">#</a> 四、OpenVPN 证书配置</h4>\n<h5 id=\"41-安装easy-rsa\"><a class=\"anchor\" href=\"#41-安装easy-rsa\">#</a> 4.1 安装 easy-rsa</h5>\n<p>1. 为了保证 OpenVPN 数据传输安全，所以需要证书，可以通过 easy-rsa ⼯具创建相关证书</p>\n<pre><code>[root@openvpn ~]# yum install easy-rsa -y\n</code></pre>\n<p>2. 创建证书前，需要拷⻉配置⽂件，以及 vars ⽂件，定义证书相关的属性</p>\n<pre><code>[root@open ~]# mkdir /opt/easy-rsa\n[root@open ~]# cd /opt/easy-rsa/\n[root@openvpn easy-rsa]# cp -a /usr/share/easy-rsa/3/* ./\n[root@openvpn easy-rsa]# cp -a /usr/share/doc/easy-rsa-*/vars.example ./vars\n</code></pre>\n<p>3. 修改 vars ⽂件</p>\n<pre><code>[root@openvpn easy-rsa]# cat vars \nif [ -z &quot;$EASYRSA_CALLER&quot; ]; then\n\techo &quot;You appear to be sourcing an Easy-RSA 'vars' file.&quot; &gt;&amp;2\n\techo &quot;This is no longer necessary and is disallowed. See the section called&quot; &gt;&amp;2\n\techo &quot;'How to use this file' near the top comments for more details.&quot; &gt;&amp;2\n\treturn 1\nfi\nset_var EASYRSA_CA_EXPIRE 3650            #证书有效期\nset_var EASYRSA_CERT_EXPIRE 3650          #服务端证书有效期，默为825天\nset_var EASYRSA_DN &quot;cn_only&quot;\nset_var EASYRSA_REQ_COUNTRY &quot;CN&quot;          #所在的国家\nset_var EASYRSA_REQ_PROVINCE &quot;Guangdong&quot;    #所在的省份\nset_var EASYRSA_REQ_CITY &quot;Shenzhen&quot;        #所在的城市\nset_var EASYRSA_REQ_ORG &quot;nfzl&quot;           #所在的组织\nset_var EASYRSA_REQ_EMAIL &quot;xuy@nf-leasing.com&quot; #邮箱的地址\nset_var EASYRSA_NS_SUPPORT &quot;yes&quot;\n</code></pre>\n<h5 id=\"42-创建证书文件\"><a class=\"anchor\" href=\"#42-创建证书文件\">#</a> 4.2 创建证书⽂件</h5>\n<h6 id=\"421初始化pki\"><a class=\"anchor\" href=\"#421初始化pki\">#</a> 4.2.1 初始化 PKI</h6>\n<pre><code># 初始化，在当前⽬录创建PKI⽬录，⽤于存储证书\n[root@openvpn easy-rsa]# ./easyrsa init-pki\n\nNote: using Easy-RSA configuration from: /opt/easy-rsa/vars\n\ninit-pki complete; you may now create a CA or requests.\nYour newly created PKI dir is: /opt/easy-rsa/pki\n</code></pre>\n<h6 id=\"422-创建ca机构\"><a class=\"anchor\" href=\"#422-创建ca机构\">#</a> 4.2.2 创建 CA 机构</h6>\n<pre><code># 创建ca证书，主要对后续创建的server、client证书进⾏签名；会提示设置密码，其他可默认\n[root@openvpn easy-rsa]# ./easyrsa build-ca\n\nNote: using Easy-RSA configuration from: /opt/easy-rsa/vars\nUsing SSL: openssl OpenSSL 1.0.2k-fips  26 Jan 2017\n\nEnter New CA Key Passphrase:        #设置密码\nRe-Enter New CA Key Passphrase:     #确认密码\nGenerating RSA private key, 2048 bit long modulus\n.................................+++\n..............+++\ne is 65537 (0x10001)\nYou are about to be asked to enter information that will be incorporated\ninto your certificate request.\nWhat you are about to enter is what is called a Distinguished Name or a DN.\nThere are quite a few fields but you can leave some blank\nFor some fields there will be a default value,\nIf you enter '.', the field will be left blank.\n-----\nCommon Name (eg: your user, host, or server name) [Easy-RSA CA]:nfzl     #输入nfzl\n\nCA creation complete and you may now import and sign cert requests.\nYour new CA certificate file for publishing is at:\n/opt/easy-rsa/pki/ca.crt\n</code></pre>\n<h6 id=\"423-签发服务端证书\"><a class=\"anchor\" href=\"#423-签发服务端证书\">#</a> 4.2.3 签发服务端证书</h6>\n<p>1. 创建 server 端证书，nopass 表示不加密私钥⽂件，其他可默认</p>\n<pre><code>[root@openvpn easy-rsa]# ./easyrsa gen-req server nopass\n\nNote: using Easy-RSA configuration from: /opt/easy-rsa/vars\nUsing SSL: openssl OpenSSL 1.0.2k-fips  26 Jan 2017\nGenerating a 2048 bit RSA private key\n..............................+++\n......................................................................+++\nwriting new private key to '/opt/easy-rsa/pki/easy-rsa-1983.z07ECs/tmp.PBZXuy'\n-----\nYou are about to be asked to enter information that will be incorporated\ninto your certificate request.\nWhat you are about to enter is what is called a Distinguished Name or a DN.\nThere are quite a few fields but you can leave some blank\nFor some fields there will be a default value,\nIf you enter '.', the field will be left blank.\n-----\nCommon Name (eg: your user, host, or server name) [server]:     #回车即可\n\nKeypair and certificate request completed. Your files are:\nreq: /opt/easy-rsa/pki/reqs/server.req            #请求⽂件\nkey: /opt/easy-rsa/pki/private/server.key         #私钥\n</code></pre>\n<p>2. 给 server 端证书签名，⾸先是对信息的确认，可以输⼊ yes，然后输⼊创建 ca 根证书时设置的密码</p>\n<pre><code># 第⼀个server是类型\n# 第⼆个server是req请求⽂件名称\n[root@openvpn easy-rsa]# ./easyrsa sign server server\n\nNote: using Easy-RSA configuration from: /opt/easy-rsa/vars\nUsing SSL: openssl OpenSSL 1.0.2k-fips  26 Jan 2017\n\nYou are about to sign the following certificate.\nPlease check over the details shown below for accuracy. Note that this request\nhas not been cryptographically verified. Please be sure it came from a trusted\nsource or that you have verified the request checksum with the sender.\n\nRequest subject, to be signed as a server certificate for 3650 days:\n\nsubject=\n    commonName                = server\n\nType the word 'yes' to continue, or any other input to abort.\n  Confirm request details: yes             #输入yes\nUsing configuration from /opt/easy-rsa/pki/easy-rsa-2098.GEv4iZ/tmp.oyIjPH\nEnter pass phrase for /opt/easy-rsa/pki/private/ca.key:    #输入密码\nCheck that the request matches the signature\nSignature ok\nThe Subject's Distinguished Name is as follows\ncommonName            :ASN.1 12:'server'\nCertificate is to be certified until Jun  8 13:22:49 2033 GMT (3650 days)\n\nWrite out database with 1 new entries\nData Base Updated\n\nCertificate created at: /opt/easy-rsa/pki/issued/server.crt   # 公钥\n</code></pre>\n<h6 id=\"424-创建dh密钥\"><a class=\"anchor\" href=\"#424-创建dh密钥\">#</a> 4.2.4 创建 DH 密钥</h6>\n<p>Diffie-Hellman 是⼀种安全协议；让双⽅在完全没有对⽅任何信息情况下通过不安全信道建⽴⼀个密钥； 这个密钥⼀般作为 “对称加密” 的密钥⽽被双⽅在后续数据传输中使⽤；</p>\n<pre><code>[root@openvpn easy-rsa]# ./easyrsa gen-dh DH parameters of size 2048 created at /opt/easy-rsa/pki/dh.pem\n</code></pre>\n<h6 id=\"425-签发客户端证书\"><a class=\"anchor\" href=\"#425-签发客户端证书\">#</a> 4.2.5 签发客户端证书</h6>\n<p>1. 创建 client 端私钥⽂件，nopass 表示不加密私钥⽂件，其他可默认</p>\n<pre><code>[root@openvpn easy-rsa]# ./easyrsa gen-req client nopass\n\nNote: using Easy-RSA configuration from: /opt/easy-rsa/vars\nUsing SSL: openssl OpenSSL 1.0.2k-fips  26 Jan 2017\nGenerating a 2048 bit RSA private key\n............................................................+++\n.................+++\nwriting new private key to '/opt/easy-rsa/pki/easy-rsa-2191.qCdaPl/tmp.mqfX2L'\n-----\nYou are about to be asked to enter information that will be incorporated\ninto your certificate request.\nWhat you are about to enter is what is called a Distinguished Name or a DN.\nThere are quite a few fields but you can leave some blank\nFor some fields there will be a default value,\nIf you enter '.', the field will be left blank.\n-----\nCommon Name (eg: your user, host, or server name) [client]:    #回车即可\n\nKeypair and certificate request completed. Your files are:\nreq: /opt/easy-rsa/pki/reqs/client.req        #请求⽂件\nkey: /opt/easy-rsa/pki/private/client.key     #私钥⽂件\n</code></pre>\n<p>2. 给 client 端证书签名，⾸先是对信息的确认，可以输⼊ yes，然后创建 ca 根证书时设置的密码</p>\n<pre><code># 第⼀个client是类型\n# 第⼆个client是req请求⽂件名称\n[root@openvpn easy-rsa]# ./easyrsa sign client client\nNote: using Easy-RSA configuration from: /opt/easy-rsa/vars\nUsing SSL: openssl OpenSSL 1.0.2k-fips  26 Jan 2017\n\nYou are about to sign the following certificate.\nPlease check over the details shown below for accuracy. Note that this request\nhas not been cryptographically verified. Please be sure it came from a trusted\nsource or that you have verified the request checksum with the sender.\n\nRequest subject, to be signed as a client certificate for 3650 days:\n\nsubject=\n    commonName                = yes\n\nType the word 'yes' to continue, or any other input to abort.\n  Confirm request details: yes                      #输入yes\nUsing configuration from /opt/easy-rsa/pki/easy-rsa-2218.aCZcDB/tmp.Z2nHgS\nEnter pass phrase for /opt/easy-rsa/pki/private/ca.key:            #输入密码\nCheck that the request matches the signature\nSignature ok\nThe Subject's Distinguished Name is as follows\ncommonName            :ASN.1 12:'yes'\nCertificate is to be certified until Jun  8 13:29:01 2033 GMT (3650 days)\n\nWrite out database with 1 new entries\nData Base Updated\n\nCertificate created at: /opt/easy-rsa/pki/issued/client.crt     # 客户端公钥\n</code></pre>\n<h4 id=\"五-openvpn服务安装\"><a class=\"anchor\" href=\"#五-openvpn服务安装\">#</a> 五、OpenVPN 服务安装</h4>\n<h5 id=\"51-安装openvpn服务\"><a class=\"anchor\" href=\"#51-安装openvpn服务\">#</a> 5.1 安装 Openvpn 服务</h5>\n<pre><code>[root@openvpn ~]# ntpdate time2.aliyun.com         #⼀定要同步时间\n[root@openvpn ~]# crontab -l\n*/5 * * * * /usr/sbin/ntpdate time2.aliyun.com &amp;&gt; /dev/null\n\n[root@openvpn ~]# yum install openvpn -y\n</code></pre>\n<h5 id=\"52-配置openvpn服务\"><a class=\"anchor\" href=\"#52-配置openvpn服务\">#</a> 5.2 配置 openvpn 服务</h5>\n<pre><code>[root@openvpn easy-rsa]# cat /etc/openvpn/server.conf \nport 1194                              #端口\nproto tcp                              #协议\ndev tun                                #采用路由隧道模式tun\nca ca.crt                              #ca证书文件位置\ncert server.crt                        #服务端公钥名称\nkey server.key                         #服务端私钥名称\ndh dh.pem                              #交换证书\nserver 10.8.0.0 255.255.255.0          #给客户端分配地址池，注意：不能和VPN服务器内网网段有相同\npush &quot;route 172.16.1.0 255.255.255.0&quot;  #允许客户端访问内网172.16.1.0网段，根据实际情况修改\n\n# push &quot;redirect-gateway def1&quot;\n# push &quot;dhcp-option DNS 8.8.8.8&quot;\n\nifconfig-pool-persist ipp.txt       #地址池记录文件位置\nkeepalive 10 120                    #存活时间，10秒ping⼀次,120如未收到响应则视为断线\nmax-clients 100                     #最多允许100个客户端连接\nstatus openvpn-status.log           #日志记录位置\nverb 3                              #openvpn版本\nclient-to-client                    #客户端与客户端之间通信\nlog /var/log/openvpn.log            #openvpn日志记录位置\npersist-key                         #通过keepalive检测超时后，重新启动VPN，不重新读取keys，保留第一次使的keys\npersist-tun                         #检测超时后，重新启动VPN，一直保持tun是linkup的。否则网络会先linkdown然后再linkup\nduplicate-cn\n</code></pre>\n<h5 id=\"53-拷服务端证书文件\"><a class=\"anchor\" href=\"#53-拷服务端证书文件\">#</a> 5.3 拷⻉服务端证书⽂件</h5>\n<pre><code># 将服务端证书拷⻉⾄/etc/openvpn⽬录下\ncp /opt/easy-rsa/pki/ca.crt /etc/openvpn/\ncp /opt/easy-rsa/pki/dh.pem /etc/openvpn/\ncp /opt/easy-rsa/pki/issued/server.crt /etc/openvpn/\ncp /opt/easy-rsa/pki/private/server.key /etc/openvpn/\n</code></pre>\n<h5 id=\"54-开启内核转发参数\"><a class=\"anchor\" href=\"#54-开启内核转发参数\">#</a> 5.4 开启内核转发参数</h5>\n<pre><code># 必须开启内核转发功能\n[root@openvpn ~]# echo &quot;net.ipv4.ip_forward = 1&quot; &gt;&gt; /etc/sysctl.conf\n[root@openvpn ~]# sysctl -p\n</code></pre>\n<h5 id=\"55-启动openvpn服务\"><a class=\"anchor\" href=\"#55-启动openvpn服务\">#</a> 5.5 启动 openvpn 服务</h5>\n<pre><code>[root@openvpn ~]# systemctl enable openvpn@server &amp;&amp; systemctl start openvpn@server\n[root@openvpn ~]# netstat -lntp|grep 1194\ntcp        0      0 0.0.0.0:1194            0.0.0.0:*               LISTEN      2522/openvpn\n\n#检测1194端口是否通，阿里云服务器需安全组规则放行1194\n[root@jumpserver ~]# telnet 192.168.40.70 1194\nTrying 192.168.40.70...\nConnected to 192.168.40.70.\nEscape character is '^]'.\n\n[root@openvpn easy-rsa]# ifconfig\neth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500\n        inet 192.168.40.70  netmask 255.255.255.0  broadcast 192.168.40.255\n        inet6 fe80::1856:7b0:9d1e:7208  prefixlen 64  scopeid 0x20&lt;link&gt;\n        ether 00:0c:29:75:9b:a9  txqueuelen 1000  (Ethernet)\n        RX packets 2542  bytes 836133 (816.5 KiB)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 3150  bytes 327134 (319.4 KiB)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n\neth1: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500\n        inet 172.16.1.70  netmask 255.255.255.0  broadcast 172.16.1.255\n        inet6 fe80::1607:3fa8:6c0d:8f7f  prefixlen 64  scopeid 0x20&lt;link&gt;\n        ether 00:0c:29:75:9b:b3  txqueuelen 1000  (Ethernet)\n        RX packets 0  bytes 0 (0.0 B)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 18  bytes 1382 (1.3 KiB)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n\nlo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536\n        inet 127.0.0.1  netmask 255.0.0.0\n        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;\n        loop  txqueuelen 1000  (Local Loopback)\n        RX packets 0  bytes 0 (0.0 B)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 0  bytes 0 (0.0 B)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n\ntun0: flags=4305&lt;UP,POINTOPOINT,RUNNING,NOARP,MULTICAST&gt;  mtu 1500\n        inet 10.8.0.1  netmask 255.255.255.255  destination 10.8.0.2\n        inet6 fe80::d334:578d:2988:1996  prefixlen 64  scopeid 0x20&lt;link&gt;\n        unspec 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00  txqueuelen 100  (UNSPEC)\n        RX packets 0  bytes 0 (0.0 B)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 3  bytes 144 (144.0 B)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n</code></pre>\n<h4 id=\"六-openvpn客户端\"><a class=\"anchor\" href=\"#六-openvpn客户端\">#</a> 六、OpenVPN 客户端</h4>\n<h5 id=\"61-客户端连接linux\"><a class=\"anchor\" href=\"#61-客户端连接linux\">#</a> 6.1 客户端连接 Linux</h5>\n<p>1. 端安装 openvpn</p>\n<pre><code>[root@openvpn-client ~]# yum install openvpn -y\n</code></pre>\n<p>2. 下载客户端公钥与私钥以及 Ca 证书⾄客户端</p>\n<pre><code>[root@openvpn-client ~]# cd /etc/openvpn/\n[root@openvpn-client openvpn]# scp root@192.168.40.70:/opt/easy-rsa/pki/ca.crt ./\n[root@openvpn-client openvpn]# scp root@192.168.40.70:/opt/easy-rsa/pki/issued/client.crt ./\n[root@openvpn-client openvpn]# scp root@192.168.40.70:/opt/easy-rsa/pki/private/client.key ./\n</code></pre>\n<p>3. 客户端有了公钥和私钥后，还需要准备对应的客户端配置⽂件</p>\n<pre><code>[root@db01 openvpn]# cat client.ovpn\nclient                        #指定当前VPN是客户端\ndev tun                       #使用tun隧道传输协议\nproto tcp                     #使用udp协议传输数据\nremote 192.168.40.70 1194     #openvpn服务器IP地址端口号\nresolv-retry infinite         #断线后动重新连接，在网络不稳定的情况下非常有用\nnobind                        #不绑定本地特定的端口号\nca ca.crt                     #指定CA证书的文件路径\ncert client.crt               #指定当前客户端的证书文件路径\nkey client.key                #指定当前客户端的私钥文件路径\nverb 3                        #指定日志文件的记录详细级别，可选0-9，等级越高日志内容越详细\npersist-key                   #通过keepalive检测超时后，重新启动VPN，不重新读取keys，保留第几次使用的keys\npersist-tun                   #检测超时后，重新启动VPN，一直保持tun是linkup的。否则网络会先linkdown然后再linkup\n</code></pre>\n<p>4. 启动 openvpn 客户端</p>\n<pre><code>[root@db01 openvpn]# openvpn --daemon --cd /etc/openvpn --config client.ovpn --log-append /var/log/openvpn.log\n# --daemon：openvpn以daemon⽅式启动。\n# --cd dir：配置⽂件的⽬录，openvpn初始化前，先切换到此⽬录。\n# --config file：客户端配置⽂件的路径。\n# --log-append file：⽇志⽂件路径，如果⽂件不存在会⾃动创建。\n\n[root@db01 openvpn]# ps aux|grep openvpn\nroot       2675  0.0  0.1  75164  3448 ?        Ss   16:20   0:00 openvpn --daemon --cd /etc/openvpn --config client.ovpn --log-append /var/log/openvpn.log\nroot       2705  0.0  0.0 112812   980 pts/0    S+   16:21   0:00 grep --color=auto openvpn\n      \n[root@db01 openvpn]# ifconfig\neth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500\n        inet 192.168.40.51  netmask 255.255.255.0  broadcast 192.168.40.255\n        inet6 fe80::63d4:467f:9b76:e34f  prefixlen 64  scopeid 0x20&lt;link&gt;\n        inet6 fe80::1856:7b0:9d1e:7208  prefixlen 64  scopeid 0x20&lt;link&gt;\n        ether 00:0c:29:e0:f8:86  txqueuelen 1000  (Ethernet)\n        RX packets 2911  bytes 880086 (859.4 KiB)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 1943  bytes 249205 (243.3 KiB)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n\neth1: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500\n        inet 172.16.1.51  netmask 255.255.255.0  broadcast 172.16.1.255\n        inet6 fe80::1607:3fa8:6c0d:8f7f  prefixlen 64  scopeid 0x20&lt;link&gt;\n        inet6 fe80::b64e:4e5e:1653:e542  prefixlen 64  scopeid 0x20&lt;link&gt;\n        ether 00:0c:29:e0:f8:90  txqueuelen 1000  (Ethernet)\n        RX packets 6  bytes 516 (516.0 B)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 66  bytes 5642 (5.5 KiB)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n\nlo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536\n        inet 127.0.0.1  netmask 255.0.0.0\n        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;\n        loop  txqueuelen 1000  (Local Loopback)\n        RX packets 97  bytes 15400 (15.0 KiB)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 97  bytes 15400 (15.0 KiB)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n\ntun0: flags=4305&lt;UP,POINTOPOINT,RUNNING,NOARP,MULTICAST&gt;  mtu 1500\n        inet 10.8.0.6  netmask 255.255.255.255  destination 10.8.0.5\n        inet6 fe80::7cc6:553f:e98d:9633  prefixlen 64  scopeid 0x20&lt;link&gt;\n        unspec 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00  txqueuelen 100  (UNSPEC)\n        RX packets 0  bytes 0 (0.0 B)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 3  bytes 144 (144.0 B)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n</code></pre>\n<h5 id=\"62-客户端连接windows\"><a class=\"anchor\" href=\"#62-客户端连接windows\">#</a> 6.2 客户端连接 Windows</h5>\n<p>openvpn for windows 客户端下载地址、openvpn-2.4.11-Win7.exe、openvpn-2.4.11-Win10.exe</p>\n<p>1. 下载服务端准备的客户端密钥⽂件和 ca ⽂件⾄ C:\\Program Files\\OpenVPN\\config ⽬录中</p>\n<pre><code>[root@openvpn ~]# sz /opt/easy-rsa/pki/ca.crt\n[root@openvpn ~]# sz /opt/easy-rsa/pki/issued/client.crt\n[root@openvpn ~]# sz /opt/easy-rsa/pki/private/client.key\n</code></pre>\n<p>2. 在 C:\\Program Files\\OpenVPN\\config 创建⼀个客户端配置⽂件，名称叫 client.ovpn</p>\n<pre><code>client                       #指定当前VPN是客户端\ndev tun                      #使用tun隧道传输协议\nproto tcp                    #使用udp协议传输数据\nremote 192.168.40.70 1194   #openvpn服务器IP地址端口号\nresolv-retry infinite        #断线自动重新连接，在网络不稳定的情况下非常有用\nnobind                       #不绑定本地特定的端口号\nca ca.crt                    #指定CA证书的文件路径\ncert client.crt              #指定当前客户端的证书文件路径\nkey client.key               #指定当前客户端的私钥文件路径\nverb 3                       #指定日志文件的记录详细级别，可选0-9，等级越越高志内容越详细\npersist-key                  #通过keepalive检测超时后，重新启动VPN，不重新读取keys，保留第一次使用的keys\npersist-tun                  #检测超时后，重新启动VPN，一直保持tun是linkup的。否则网络会先linkdown然后再linkup\n</code></pre>\n<p>3. 最终 windows 的⽬录中配置⽂件如下</p>\n<pre><code>C:\\Program Files\\OpenVPN\\config\nca.crt\nclient.crt\nclient.key\nclient.ovpn\nREADME.txt\n</code></pre>\n<p>4. 登陆成功后，通过 windows 查看 openvpn 服务推送过来的路由信息；</p>\n<pre><code># 查看连接状态10.8.0.6连接172.16.1.60\n[root@openvpn ~]# netstat -nt\nActive Internet connections (w/o servers)\nProto Recv-Q Send-Q Local Address           Foreign Address         State      \ntcp        0     36 172.16.1.70:22          10.8.0.6:52391          ESTABLISHED\ntcp        0      0 192.168.40.70:1194      192.168.40.1:52319      ESTABLISHED\ntcp        0      0 192.168.40.70:22        192.168.40.1:51544      ESTABLISHED\n\n\n# windows查看推送过来的路由信息\n[C:\\~]$ route print -4\n===========================================================================\n接口列表\n 14...94 c6 91 22 3a e8 ......Realtek PCIe GBE Family Controller\n 13...00 ff 9c 82 0c c4 ......TAP-Windows Adapter V9\n  5...52 2b 73 e8 4f b4 ......Microsoft Wi-Fi Direct Virtual Adapter\n 18...50 2b 73 e8 4f b4 ......Microsoft Wi-Fi Direct Virtual Adapter #2\n 20...00 50 56 c0 00 01 ......VMware Virtual Ethernet Adapter for VMnet1\n 11...00 50 56 c0 00 08 ......VMware Virtual Ethernet Adapter for VMnet8\n 10...00 50 56 c0 00 0f ......VMware Virtual Ethernet Adapter for VMnet15\n 17...50 2b 73 e8 4f b4 ......Realtek 8188GU Wireless LAN 802.11n USB NIC\n  1...........................Software Loopback Interface 1\n===========================================================================\n\nIPv4 路由表\n===========================================================================\n活动路由:\n网络目标        网络掩码          网关       接口   跃点数\n          0.0.0.0          0.0.0.0      192.168.1.1    192.168.1.102     50\n         10.8.0.0    255.255.255.0         10.8.0.5         10.8.0.6    281\n         10.8.0.4  255.255.255.252            在链路上          10.8.0.6    281\n         10.8.0.6  255.255.255.255            在链路上          10.8.0.6    281\n         10.8.0.7  255.255.255.255            在链路上          10.8.0.6    281\n        127.0.0.0        255.0.0.0            在链路上         127.0.0.1    331\n        127.0.0.1  255.255.255.255            在链路上         127.0.0.1    331\n  127.255.255.255  255.255.255.255            在链路上         127.0.0.1    331\n       172.16.1.0    255.255.255.0         10.8.0.5         10.8.0.6    281         #路由条目\n      192.168.1.0    255.255.255.0            在链路上     192.168.1.102    306\n    192.168.1.102  255.255.255.255            在链路上     192.168.1.102    306\n    192.168.1.255  255.255.255.255            在链路上     192.168.1.102    306\n     192.168.40.0    255.255.255.0            在链路上      192.168.40.1    291\n     192.168.40.1  255.255.255.255            在链路上      192.168.40.1    291\n   192.168.40.255  255.255.255.255            在链路上      192.168.40.1    291\n    192.168.137.0    255.255.255.0            在链路上     192.168.137.1    291\n    192.168.137.1  255.255.255.255            在链路上     192.168.137.1    291\n  192.168.137.255  255.255.255.255            在链路上     192.168.137.1    291\n    192.168.195.0    255.255.255.0            在链路上     192.168.195.1    291\n    192.168.195.1  255.255.255.255            在链路上     192.168.195.1    291\n  192.168.195.255  255.255.255.255            在链路上     192.168.195.1    291\n        224.0.0.0        240.0.0.0            在链路上         127.0.0.1    331\n        224.0.0.0        240.0.0.0            在链路上     192.168.195.1    291\n        224.0.0.0        240.0.0.0            在链路上      192.168.40.1    291\n        224.0.0.0        240.0.0.0            在链路上     192.168.137.1    291\n        224.0.0.0        240.0.0.0            在链路上          10.8.0.6    281\n        224.0.0.0        240.0.0.0            在链路上     192.168.1.102    306\n  255.255.255.255  255.255.255.255            在链路上         127.0.0.1    331\n  255.255.255.255  255.255.255.255            在链路上     192.168.195.1    291\n  255.255.255.255  255.255.255.255            在链路上      192.168.40.1    291\n  255.255.255.255  255.255.255.255            在链路上     192.168.137.1    291\n  255.255.255.255  255.255.255.255            在链路上          10.8.0.6    281\n  255.255.255.255  255.255.255.255            在链路上     192.168.1.102    306\n===========================================================================\n永久路由:\n  无\n</code></pre>\n<h4 id=\"七-openvpn用户密码认证\"><a class=\"anchor\" href=\"#七-openvpn用户密码认证\">#</a> 七、OpenVPN ⽤户密码认证</h4>\n<p>我们⽬前使⽤密钥进⾏加密传输，可以说已经很安全了，为什么还要需要⽤户名秘密呢。</p>\n<p>1、首先管理这些秘钥和证书⽐较麻烦，如果⽤户⽐较多，单独为每个⽤户都创建⼀套秘钥⽐较麻烦；<br />\n2、其次多⼈使⽤同⼀秘钥⼜不具有唯⼀性，⽐如说有⽤户不在需要 VPN 的时候，我们就需要吊销证书，如果多⼈使⽤⼀个秘钥的情况下，吊销证书会造成其他⽤户也⽆法正常登录。</p>\n<p>所以就需要秘钥加⽤户名密码，这样就可以实现多个⽤户使⽤同⼀个证书，使⽤不同的⽤户名和密码； 当有新⽤户加⼊时，只需要添加⼀个⽤户名和密码即可，如果不需要使⽤，则删除⽤户名和密码即可；</p>\n<h5 id=\"71-openvpn服务端配置\"><a class=\"anchor\" href=\"#71-openvpn服务端配置\">#</a> 7.1 OpenVPN 服务端配置</h5>\n<p>1、修改服务端配置</p>\n<pre><code># 添加如下三⾏代码，使其服务端⽀持密码认证⽅式\n[root@openvpn ~]# vim /etc/openvpn/server.conf\nscript-security 3                                         #允许使用自定义脚本\nauth-user-pass-verify /etc/openvpn/check.sh via-env       #自定义脚本路径\nusername-as-common-name                                   #用户密码登陆方式验证\n\n# 表示只使用用户名密码方式验证，不加该参数，则代表需要证书、用户名、密码多重验证登录\n# client-cert-not-required\n</code></pre>\n<p>2、创建⾃定义脚本</p>\n<pre><code>[root@openvpn ~]# vim /etc/openvpn/check.sh\n#!/bin/sh\n###########################################################\n\nPASSFILE=&quot;/etc/openvpn/openvpnfile&quot;\nLOG_FILE=&quot;/var/log/openvpn-password.log&quot;\nTIME_STAMP=`date &quot;+%Y-%m-%d %T&quot;`\n\nif [ ! -r &quot;$&#123;PASSFILE&#125;&quot; ]; then\n  echo &quot;$&#123;TIME_STAMP&#125;: Could not open password file \\&quot;$&#123;PASSFILE&#125;\\&quot; for reading.&quot; &gt;&gt; $&#123;LOG_FILE&#125;\n  exit 1\nfi\n\nCORRECT_PASSWORD=`awk '!/^;/&amp;&amp;!/^#/&amp;&amp;$1==&quot;'$&#123;username&#125;'&quot;&#123;print $2;exit&#125;' $&#123;PASSFILE&#125;`\n\nif [ &quot;$&#123;CORRECT_PASSWORD&#125;&quot; = &quot;&quot; ]; then \n  echo &quot;$&#123;TIME_STAMP&#125;: User does not exist: username=\\&quot;$&#123;username&#125;\\&quot;, password=\\&quot;$&#123;password&#125;\\&quot;.&quot; &gt;&gt; $&#123;LOG_FILE&#125;\n  exit 1\nfi\n\nif [ &quot;$&#123;password&#125;&quot; = &quot;$&#123;CORRECT_PASSWORD&#125;&quot; ]; then \n  echo &quot;$&#123;TIME_STAMP&#125;: Successful authentication: username=\\&quot;$&#123;username&#125;\\&quot;.&quot; &gt;&gt; $&#123;LOG_FILE&#125;\n  exit 0\nfi\n\necho &quot;$&#123;TIME_STAMP&#125;: Incorrect password: username=\\&quot;$&#123;username&#125;\\&quot;, password=\\&quot;$&#123;password&#125;\\&quot;.&quot; &gt;&gt; $&#123;LOG_FILE&#125;\nexit 1\n\n# 为脚本增加执⾏权限\n[root@openvpn ~]# chmod +x /etc/openvpn/check.sh\n</code></pre>\n<p>3、创建⽤户密码⽂件</p>\n<pre><code># 创建`check.sh`脚本中定义`openvpn`使⽤的⽤户和密码认证⽂件\ncat &gt; /etc/openvpn/openvpnfile &lt;&lt;EOF\nxuyong 123456\nEOF\n</code></pre>\n<p>4、重启 OpenVPN 服务</p>\n<pre><code>[root@openvpn ~]# systemctl restart openvpn@server\n</code></pre>\n<h5 id=\"72-openvpn客户端配置\"><a class=\"anchor\" href=\"#72-openvpn客户端配置\">#</a> 7.2 OpenVPN 客户端配置</h5>\n<p>1、修改客户端配置 C:\\Program Files\\OpenVPN\\config</p>\n<pre><code># 修改客户端配置文件，增加如下代码，使其支持用户名/密码与服务器进行身份验证；\nauth-user-pass                #用户密码认证\n</code></pre>\n<p>2、客户端重新登陆</p>\n<p><img loading=\"lazy\" data-src=\"https://wp-cdn.4ce.cn/v2/HwnEpBm.jpeg\" alt=\"Snipaste_2025-06-07_23-10-45.jpg\" /></p>\n<h4 id=\"八-openvpn访问内部网段\"><a class=\"anchor\" href=\"#八-openvpn访问内部网段\">#</a> 八、OpenVPN 访问内部⽹段</h4>\n<h5 id=\"81-内部节点无法正常访问\"><a class=\"anchor\" href=\"#81-内部节点无法正常访问\">#</a> <strong>8.1</strong> 内部节点无法正常访问</h5>\n<p>抓包分析数据包能抵达 openvpn 的内⽹地址，但⽆法与 OpenVPN 服务同内⽹⽹段主机进⾏通信；</p>\n<p>因为后端主机没有去往 10.8.0.0 ⽹段的路由，所以数据包⽆法原路返回，最终造成⽆法 ping 通</p>\n<pre><code>[root@windows ~]# ping 172.16.1.51 -t\n\n正在 Ping 172.16.1.51 具有 32 字节的数据:\n请求超时。\n\n#在后端的主机上抓包分析，发现能接收到数据包，但没有回去的路由所以⽆法通信\n[root@openvpn-client ~] tcpdump  -i eth1 -nn -p icmp\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on eth1, link-type EN10MB (Ethernet), capture size 262144 bytes\n16:44:54.957022 IP 10.8.0.10 &gt; 172.16.1.51: ICMP echo request, id 1, seq 137, length 40\n16:44:59.956197 IP 10.8.0.10 &gt; 172.16.1.51: ICMP echo request, id 1, seq 138, length 40\n</code></pre>\n<p>解决此问题有如下⼏种⽅式：</p>\n<p>⽅式 1：在每台节点添加⼀条路由，下⼀跳为 Openvpn 节点；</p>\n<p>⽅式 2：在所有内⽹主机的默认路由器上添加⼀条路由，下⼀跳为 Openvpn 节点；</p>\n<p>⽅式 3：配置 iptables、firewalld 的 NAT 规则</p>\n<h5 id=\"82-在节点上添加主机路由\"><a class=\"anchor\" href=\"#82-在节点上添加主机路由\">#</a> 8.2 在节点上添加主机路由</h5>\n<p>1、在后端主机添加抵达去往 10.8.0.0/24 ⽹段的⾛ openvpn 的内⽹地址进⾏路由（原理如下图）</p>\n<p><img loading=\"lazy\" data-src=\"https://wp-cdn.4ce.cn/v2/HKR4TLX.jpeg\" alt=\"1.jpg\" /></p>\n<pre><code>[root@openvpn-client ~] route add -net 10.8.0.0/24 gw 172.16.1.70\n[root@db01 ~]# route -n\nKernel IP routing table\nDestination     Gateway         Genmask         Flags Metric Ref    Use Iface\n0.0.0.0         192.168.40.2    0.0.0.0         UG    100    0        0 eth0\n10.8.0.0        172.16.1.70     255.255.255.0   UG    0      0        0 eth1\n172.16.1.0      0.0.0.0         255.255.255.0   U     101    0        0 eth1\n192.168.40.0    0.0.0.0         255.255.255.0   U     100    0        0 eth0\n</code></pre>\n<p>2、添加完路由后，继续 ping 该节点，在抓包查看</p>\n<pre><code>[root@openvpn-client ~] tcpdump  -i eth1 -nn -p icmp\ntcpdump: verbose output suppressed, use -v or -vv for full protocol decode\nlistening on eth1, link-type EN10MB (Ethernet), capture size 262144 bytes\n16:48:14.054654 IP 10.8.0.10 &gt; 172.16.1.51: ICMP echo request, id 1, seq 240, length 40\n16:48:14.054673 IP 172.16.1.51 &gt; 10.8.0.10: ICMP echo reply, id 1, seq 240, length 40\n16:48:15.055662 IP 10.8.0.10 &gt; 172.16.1.51: ICMP echo request, id 1, seq 241, length 40\n16:48:15.055683 IP 172.16.1.51 &gt; 10.8.0.10: ICMP echo reply, id 1, seq 241, length 40\n16:48:16.056026 IP 10.8.0.10 &gt; 172.16.1.51: ICMP echo request, id 1, seq 242, length 40\n16:48:16.056046 IP 172.16.1.51 &gt; 10.8.0.10: ICMP echo reply, id 1, seq 242, length 40\n</code></pre>\n<p>3、通过 vpn 连接内⽹服务器，检查内⽹服务器与哪个 IP 建⽴连接（会发现是真实的 VPN 客户端节点）；</p>\n<pre><code>[root@openvpn-client ~] netstat -nt\nActive Internet connections (w/o servers)\nProto Recv-Q Send-Q Local Address           Foreign Address         State      \ntcp        0     36 172.16.1.51:22          10.8.0.10:53947         ESTABLISHED\ntcp        0      0 192.168.40.51:22        192.168.40.1:53130      ESTABLISHED\n</code></pre>\n<h5 id=\"83-配置nat地址替换\"><a class=\"anchor\" href=\"#83-配置nat地址替换\">#</a> 8.3 配置 NAT 地址替换</h5>\n<p>如上的配置需要在所有后端主机添加，如果机器量过多，那么添加起来⾮常的麻烦，可以在 VPN 节点上增加防⽕墙规则配置，实现地址替换（原理如下图）</p>\n<p><img loading=\"lazy\" data-src=\"https://wp-cdn.4ce.cn/v2/bhcIl0l.jpeg\" alt=\"2.jpg\" /></p>\n<pre><code># Iptables\n[root@openvpn ~]# iptables -t nat -A POSTROUTING -s 10.8.0.0/24 -o eth1 -j MASQUERADE    # ⾃动\n[root@openvpn ~]# iptables -t nat -A POSTROUTING -s 10.8.0.0/24 -o eth1 -j SNAT --to 172.16.1.70\n\n# Firewalld\n[root@openvpn ~]# systemctl start firewalld\n[root@openvpn ~]# firewall-cmd --add\u0002service=openvpn --permanent\n[root@openvpn ~]# firewall-cmd --add-masquerade --permanent\n[root@openvpn ~]# firewall-cmd --reload\n</code></pre>\n<p>2. 通过 vpn 连接内⽹服务器，检查内⽹服务器与哪个 IP 建⽴连接（会发现是 SNAT 后的内⽹ IP）；</p>\n<pre><code>[root@windows ~]# ssh root@172.16.1.51\n[root@db01 ~]# netstat -nt|grep 22\ntcp        0      0 192.168.40.51:22        192.168.40.1:60083      ESTABLISHED\ntcp        0     36 172.16.1.51:22          172.16.1.70:60439       ESTABLISHED\n</code></pre>\n<h5 id=\"84-配置路由器路由条目公有云\"><a class=\"anchor\" href=\"#84-配置路由器路由条目公有云\">#</a> 8.4 配置路由器路由条⽬（公有云）</h5>\n<p><strong>实验环境准备</strong>：</p>\n<p><img loading=\"lazy\" data-src=\"https://wp-cdn.4ce.cn/v2/JvZgcbw.jpeg\" alt=\"2.jpg\" /></p>\n<p>1. 华南 3 买三台，公网 IP，安全组放行 1194 端口；</p>\n<p>2. 西南购买 1 台，公网 IP；</p>\n<p><img loading=\"lazy\" data-src=\"https://wp-cdn.4ce.cn/v2/k6asgYc.jpeg\" alt=\"1.jpg\" /></p>\n<p><strong>实现场景 1：</strong><br />\n1.Windows 主机通过远程访问 vpn，能够直接链接阿里云内网主机；</p>\n<p>方法一：给路由器添加路由条目，指向 VPN 主机；</p>\n<p><img loading=\"lazy\" data-src=\"https://wp-cdn.4ce.cn/v2/dHe7eNU.jpeg\" alt=\"5.jpg\" /></p>\n<p>方法二： 在 VPN 主机上使用 iptables 或 firewalld 规则；</p>\n<pre><code>iptables -t nat -A POSTROUTING -s 10.8.0.0/24 -o eth0 -j SNAT --to 172.16.1.70\n</code></pre>\n<p><strong>实现场景 2：</strong>\t<br />\n1. 西南 Linux 主机拨入 vpn 后，可以直接访问华南地域的内网；</p>\n<p><strong>实现场景 3：</strong><br />\n1.windows 和西南地区的 Linux 主机都拨入了 VPN，它们之间通过虚拟地址是可以互通；</p>\n<h4 id=\"九-openvp结合jumpserver\"><a class=\"anchor\" href=\"#九-openvp结合jumpserver\">#</a> 九、OpenVP 结合 Jumpserver</h4>\n<p>实现拨通 OpenVPN 后，仅能够访问 Jumpserver172.16.1.61.</p>\n<pre><code>[root@openvpn easy-rsa]# cat /etc/openvpn/server.conf \nport 1194                              #端口\nproto tcp                              #协议\ndev tun                                #采用路由隧道模式tun\nca ca.crt                              #ca证书文件位置\ncert server.crt                        #服务端公钥名称\nkey server.key                         #服务端私钥名称\ndh dh.pem                              #交换证书\nserver 10.8.0.0 255.255.255.0          #给客户端分配地址池，注意：不能和VPN服务器内网网段有相同\npush &quot;route 172.16.1.61 255.255.255.255&quot;  #允许客户端访问内网172.16.1.61主机，根据实际情况修改\n\n# push &quot;redirect-gateway def1&quot;\n# push &quot;dhcp-option DNS 8.8.8.8&quot;\n\nifconfig-pool-persist ipp.txt       #地址池记录文件位置\nkeepalive 10 120                    #存活时间，10秒ping⼀次,120如未收到响应则视为断线\nmax-clients 100                     #最多允许100个客户端连接\nstatus openvpn-status.log           #日志记录位置\nverb 3                              #openvpn版本\nclient-to-client                    #客户端与客户端之间通信\nlog /var/log/openvpn.log            #openvpn日志记录位置\npersist-key                         #通过keepalive检测超时后，重新启动VPN，不重新读取keys，保留第一次使的keys\npersist-tun                         #检测超时后，重新启动VPN，一直保持tun是linkup的。否则网络会先linkdown然后再linkup\nduplicate-cn\n</code></pre>\n",
            "tags": [
                "Openvpn"
            ]
        }
    ]
}