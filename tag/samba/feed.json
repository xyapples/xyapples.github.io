{
    "version": "https://jsonfeed.org/version/1",
    "title": "LinuxSre云原生 • All posts by \"samba\" tag",
    "description": "专注于 Linux 运维、云计算、云原⽣等技术",
    "home_page_url": "http://ixuyong.cn",
    "items": [
        {
            "id": "http://ixuyong.cn/posts/269104229.html",
            "url": "http://ixuyong.cn/posts/269104229.html",
            "title": "Samba服务实践",
            "date_published": "2025-06-20T14:12:07.000Z",
            "content_html": "<h3 id=\"samba服务实践\"><a class=\"anchor\" href=\"#samba服务实践\">#</a> Samba 服务实践</h3>\n<h4 id=\"一-samba-概述\"><a class=\"anchor\" href=\"#一-samba-概述\">#</a> 一、Samba 概述</h4>\n<p>SMB（Server Messages Block，信息服务块）是一种在局域网上共享文件和打印机的一种通信协议，它为局域网内的不同操作系统的计算机之间提供文件及打印机等资源的共享服务。SMB 协议是客户机 / 服务器型协议，客户机通过该协议可以访问服务器上的共享文件系统、打印机及其他资源。如图：</p>\n<p><img loading=\"lazy\" data-src=\"https://wp-cdn.4ce.cn/v2/jBVTDjA.jpeg\" alt=\"1.jpg\" /></p>\n<p><strong>1. ftp 的优缺点：</strong></p>\n<p>优点：文件传输、应用层协议、可跨平台</p>\n<p>缺点：只能实现文件传输，无法实现文件系统挂载；无法直接修改服务器端文件</p>\n<p><strong>2. Samba 的特性：</strong></p>\n<p>使用 smb/cifs 协议、可跨平台、可实现文件系统挂载、可实现服务器端修改文件</p>\n<p><strong>3. smb</strong> <strong>协议和</strong> <strong>cifs</strong> <strong>之间的关系</strong></p>\n<p>随着 Internet 的流行，Microsoft 希望将这个协议扩展到 Internet 上去，成为 Internet 上计算机之间相互共享数据的一种标准。因此它<strong>将原有的几乎没有多少技术文档的 SMB 协议进行整理，重新命名为 CIFS（Common Internet File</strong> <strong>System），它使程序可以访问远程 Internet 计算机上的文件并要求此计算机提供服务</strong>。客户程序请求远在服务器上的服务器程序为它提供服务。服务器获得请求并返回响应。CIFS 是公共的或开放的 SMB 协议版本，并由 Microsoft 使用。SMB 协议在局域网上用于服务器文件访问和打印的协议。</p>\n<p><strong>4. 常见文件服务器对比</strong></p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">服务名称</th>\n<th style=\"text-align:left\">使用范围</th>\n<th style=\"text-align:left\">服务端</th>\n<th style=\"text-align:left\">客服端</th>\n<th style=\"text-align:left\">局限性</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">FTP</td>\n<td style=\"text-align:left\">内网和公网</td>\n<td style=\"text-align:left\">Windows、Linux</td>\n<td style=\"text-align:left\">Windows、Linux</td>\n<td style=\"text-align:left\">无法直接在服务器端修改数据</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Samba</td>\n<td style=\"text-align:left\">内网</td>\n<td style=\"text-align:left\">Windows、Linux</td>\n<td style=\"text-align:left\">Windows、Linux</td>\n<td style=\"text-align:left\">只能在内网使用</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">NFS</td>\n<td style=\"text-align:left\">内网和公网</td>\n<td style=\"text-align:left\">Linux</td>\n<td style=\"text-align:left\">Linux</td>\n<td style=\"text-align:left\">只能 Linux 之间使用</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"二-samba部署\"><a class=\"anchor\" href=\"#二-samba部署\">#</a> 二、Samba 部署</h4>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum install samba -y</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl start smb &amp;&amp; systemctl enable smb</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># netstat -lntp|grep smb</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>tcp        <span class=\"token number\">0</span>      <span class=\"token number\">0</span> <span class=\"token number\">0.0</span>.0.0:139             <span class=\"token number\">0.0</span>.0.0:*               LISTEN      <span class=\"token number\">1739</span>/smbd           </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>tcp        <span class=\"token number\">0</span>      <span class=\"token number\">0</span> <span class=\"token number\">0.0</span>.0.0:445             <span class=\"token number\">0.0</span>.0.0:*               LISTEN      <span class=\"token number\">1739</span>/smbd           </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>tcp6       <span class=\"token number\">0</span>      <span class=\"token number\">0</span> :::139                  :::*                    LISTEN      <span class=\"token number\">1739</span>/smbd           </pre></td></tr><tr><td data-num=\"7\"></td><td><pre>tcp6       <span class=\"token number\">0</span>      <span class=\"token number\">0</span> :::445                  :::*                    LISTEN      <span class=\"token number\">1739</span>/smbd </pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># testparm   #检测配置文件语法</span></pre></td></tr></table></figure><h4 id=\"三-samba配置文件详解\"><a class=\"anchor\" href=\"#三-samba配置文件详解\">#</a> 三、Samba 配置文件详解</h4>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># egrep -v '^#|^$' /etc/samba/smb.conf</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>global<span class=\"token punctuation\">]</span>           <span class=\"token comment\">#全局设置</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tworkgroup <span class=\"token operator\">=</span> SAMBA</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tsecurity <span class=\"token operator\">=</span> user</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\tpassdb backend <span class=\"token operator\">=</span> tdbsam</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\tprinting <span class=\"token operator\">=</span> cups</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token function\">printcap</span> name <span class=\"token operator\">=</span> cups</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\tload printers <span class=\"token operator\">=</span> <span class=\"token function\">yes</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\tcups options <span class=\"token operator\">=</span> raw</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">[</span>homes<span class=\"token punctuation\">]</span>            <span class=\"token comment\">#用户目录共享设置</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> Home Directories</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\tvalid <span class=\"token function\">users</span> <span class=\"token operator\">=</span> %S, %D%w%S</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\tbrowseable <span class=\"token operator\">=</span> No</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t<span class=\"token builtin class-name\">read</span> only <span class=\"token operator\">=</span> No</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\tinherit acls <span class=\"token operator\">=</span> Yes</pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">[</span>printers<span class=\"token punctuation\">]</span>         <span class=\"token comment\">#打印机共享设置</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> All Printers</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\tpath <span class=\"token operator\">=</span> /var/tmp</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\tprintable <span class=\"token operator\">=</span> Yes</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\tcreate mask <span class=\"token operator\">=</span> 0600</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\tbrowseable <span class=\"token operator\">=</span> No</pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">[</span>print$<span class=\"token punctuation\">]</span>           <span class=\"token comment\">#自定义名称的共享目录设置</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> Printer Drivers</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\tpath <span class=\"token operator\">=</span> /var/lib/samba/drivers</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t<span class=\"token function\">write</span> list <span class=\"token operator\">=</span> @printadmin root</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\tforce group <span class=\"token operator\">=</span> @printadmin</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\tcreate mask <span class=\"token operator\">=</span> 0664</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\tdirectory mask <span class=\"token operator\">=</span> 0775</pre></td></tr></table></figure><h5 id=\"31-全局参数详解\"><a class=\"anchor\" href=\"#31-全局参数详解\">#</a> 3.1 全局参数详解</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>workgroup <span class=\"token operator\">=</span> WORKGROUP</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#设定 Samba Server 所要加入的工作组或者域</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>server string <span class=\"token operator\">=</span> Samba Server Version %v</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#设定 Samba Server 的注释，可以是任何字符串，也可以不填。宏 % v 表示显示 Samba 的版本号</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>hosts allow <span class=\"token operator\">=</span> <span class=\"token number\">127</span>. <span class=\"token number\">192.168</span>.1. <span class=\"token number\">192.168</span>.10.1</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#表示允许连接到 Samba Server 的客户端，多个参数以空格隔开。可以用一个 IP 表示，也可以用一个网段表示。hosts deny 与 hosts allow 刚好相反。</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">#例如：hosts allow=172.17.2.EXCEPT172.17.2.50</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">#表示容许来自 172.17.2.* 的主机连接，但排除 172.17.2.50</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">#hosts allow=172.17.2.0/255.255.0.0</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">#表示容许来自 172.17.2.0/255.255.0.0 子网中的所有主机连接</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>log <span class=\"token function\">file</span> <span class=\"token operator\">=</span> /var/log/samba/log.%m</pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">#设置 Samba Server 日志文件的存储位置以及日志文件名称。在文件名后加个宏 % m（主机名），表示对每台访问 Samba Server 的机器都单独记录一个日志文件。如果 pc1、pc2 访问过 Samba Server，就会在 /var/log/samba 目录下留下 log.pc1 和 log.pc2 两个日志文件。</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>passdb backend <span class=\"token operator\">=</span> tdbsam</pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">#passdb backend 就是用户后台的意思。目前有三种后台：smbpasswd、tdbsam 和 ldapsam。sam 应该是 security account manager（安全账户管理）的简写。</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>security <span class=\"token operator\">=</span> user</pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">#说明：设置用户访问 Samba Server 的验证方式，一共有四种验证方式。</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">#1.share：用户访问 Samba Server 不需要提供用户名和口令，安全性能较低。</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">#2.user：Samba Server 共享目录只能被授权的用户访问，由 Samba Server 负责检查账号和密码的正确性。账号和密码要在本 Samba Server 中建立。</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">#3.server：依靠其他 Windows NT/2000 或 Samba Server 来验证用户的账号和密码，是一种代理验证。此种安全模式下，系统管理员可以把所有的 Windows 用户和口令集中到一个 NT 系统上，使用 Windows NT 进行 Samba 认证，远程服务器可以自动认证全部用户和口令，如果认证失败，Samba 将使用用户级安全模式作为替代的方式。</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token comment\">#4.domain：域安全级别，使用主域控制器 (PDC) 来完成认证。</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>max connections <span class=\"token operator\">=</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token comment\">#max connections 用来指定连接 Samba Server 的最大连接数目。如果超出连接数目，则新的连接请求将被拒绝。0 表示不限制。</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>load printers <span class=\"token operator\">=</span> yes/no</pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token comment\">#设置是否在启动 Samba 时就共享打印机。</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token function\">printcap</span> name <span class=\"token operator\">=</span> cups</pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token comment\">#设置共享打印机的配置文件</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>printing <span class=\"token operator\">=</span> cups</pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token comment\">#设置 Samba 共享打印机的类型。现在支持的打印系统有：bsd, sysv, plp, lprng, aix, hpux, qnx</span></pre></td></tr></table></figure><h5 id=\"32-共享参数详解\"><a class=\"anchor\" href=\"#32-共享参数详解\">#</a> 3.2 共享参数详解</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>共享名<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>comment <span class=\"token operator\">=</span> 任意字符串</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#comment 是对该共享的描述，可以是任意字符串</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>path <span class=\"token operator\">=</span> 共享目录路径</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">#path 用来指定共享目录的路径</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>guest ok <span class=\"token operator\">=</span> yes/no</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">#允许任何人访问，等同于同 “public”</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token builtin class-name\">read</span> only <span class=\"token operator\">=</span> <span class=\"token function\">yes</span>\t</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">#所有人只读</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>writable <span class=\"token operator\">=</span> yes/no</pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">#writable 用来指定该共享路径是否可写</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token function\">write</span> list <span class=\"token operator\">=</span> 允许写入该共享的用户</pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">#write list 用来指定可以在该共享下写入文件的用户。</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\">#例如：write list = bobyuan，@bob</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>browseable <span class=\"token operator\">=</span> yes/no</pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">#browseable 用来指定该共享是否可以浏览</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>valid <span class=\"token function\">users</span> <span class=\"token operator\">=</span> 允许访问该共享的用户</pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token comment\">#valid users 用来指定允许访问该共享资源的用户</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token comment\">#例如：valid users = bobyuan，@bob，@tech（多个用户或者组中间用逗号隔开，如果要加入一个组就用 “@+ 组名” 表示。）</span></pre></td></tr></table></figure><h4 id=\"四-samba-share权限访问\"><a class=\"anchor\" href=\"#四-samba-share权限访问\">#</a> 四、Samba share 权限访问</h4>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#1. 修改配置文件</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># egrep -v '^#|^$' /etc/samba/smb.conf</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>global<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tworkgroup <span class=\"token operator\">=</span> workgroup</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\tsecurity <span class=\"token operator\">=</span> User</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    map to guest <span class=\"token operator\">=</span> Bad User  <span class=\"token comment\">#目前 \"security = share\" 参数已被弃用，取而代之的是 map to guest = Bad User</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\tpassdb backend <span class=\"token operator\">=</span> tdbsam</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\tprinting <span class=\"token operator\">=</span> cups</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token function\">printcap</span> name <span class=\"token operator\">=</span> cups</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\tload printers <span class=\"token operator\">=</span> <span class=\"token function\">yes</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\tcups options <span class=\"token operator\">=</span> raw</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">[</span>homes<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> Home Directories</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\tvalid <span class=\"token function\">users</span> <span class=\"token operator\">=</span> %S, %D%w%S</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\tbrowseable <span class=\"token operator\">=</span> No</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t<span class=\"token builtin class-name\">read</span> only <span class=\"token operator\">=</span> No</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\tinherit acls <span class=\"token operator\">=</span> Yes</pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">[</span>printers<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> All Printers</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\tpath <span class=\"token operator\">=</span> /var/tmp</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\tprintable <span class=\"token operator\">=</span> Yes</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\tcreate mask <span class=\"token operator\">=</span> 0600</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\tbrowseable <span class=\"token operator\">=</span> No</pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">[</span>print$<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> Printer Drivers</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\tpath <span class=\"token operator\">=</span> /var/lib/samba/drivers</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t<span class=\"token function\">write</span> list <span class=\"token operator\">=</span> @printadmin root</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\tforce group <span class=\"token operator\">=</span> @printadmin</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\tcreate mask <span class=\"token operator\">=</span> 0664</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\tdirectory mask <span class=\"token operator\">=</span> 0775</pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token punctuation\">[</span>Public Share<span class=\"token punctuation\">]</span>                      <span class=\"token comment\">#共享名称      </span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> This is public share  <span class=\"token comment\">#所有人可写</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\tpath <span class=\"token operator\">=</span> /data                    <span class=\"token comment\">#共享目录</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\tbrowseable <span class=\"token operator\">=</span> <span class=\"token function\">yes</span>                <span class=\"token comment\">#共享是否可以见</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\twritable <span class=\"token operator\">=</span> <span class=\"token function\">yes</span>                  <span class=\"token comment\">#所有人可写</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\tguest ok <span class=\"token operator\">=</span> <span class=\"token function\">yes</span>                  <span class=\"token comment\">#所有人可访问</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token comment\">#2. 重启 smbf 服务</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># testparm</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl restart smb</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token comment\">#3. 修改系统权限</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir /data</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll -d /data/</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>drwxr-xr-x. <span class=\"token number\">5</span> root root <span class=\"token number\">49</span> Jun <span class=\"token number\">23</span> <span class=\"token number\">14</span>:26 /data/</pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token comment\">#share 访问全部映射成 nobody 用户访问，nobody 没有权限访问 data 目录，需要添加系统权限</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chown nobody /data</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll -d /data</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>drwxr-xr-x. <span class=\"token number\">5</span> nobody root <span class=\"token number\">73</span> Jun <span class=\"token number\">25</span> <span class=\"token number\">14</span>:22 /data</pre></td></tr></table></figure><h4 id=\"五-linux客户端命令行工具\"><a class=\"anchor\" href=\"#五-linux客户端命令行工具\">#</a> 五、Linux 客户端命令行工具</h4>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@qnyp-client1 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum install samba-client -y</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba-client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># smbclient -L //192.168.1.50 -U 用户名          #查看共享资源</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba-client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># smbclient //192.168.1.50 / 共享名 -U 用户名       #访问共享资源</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba-client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ls           #查看</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba-client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># get          #下载</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba-client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># push         #上传</span></pre></td></tr></table></figure><h4 id=\"六-samba-user级别访问\"><a class=\"anchor\" href=\"#六-samba-user级别访问\">#</a> 六、Samba user 级别访问</h4>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#1. 修改配置文件</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># egrep -v '^#|^$' /etc/samba/smb.conf</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>global<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tworkgroup <span class=\"token operator\">=</span> SAMBA</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\tsecurity <span class=\"token operator\">=</span> user   <span class=\"token comment\">#user 级别访问 </span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\tpassdb backend <span class=\"token operator\">=</span> tdbsam</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\tprinting <span class=\"token operator\">=</span> cups</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token function\">printcap</span> name <span class=\"token operator\">=</span> cups</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\tload printers <span class=\"token operator\">=</span> <span class=\"token function\">yes</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\tcups options <span class=\"token operator\">=</span> raw</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">[</span>homes<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> Home Directories</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\tvalid <span class=\"token function\">users</span> <span class=\"token operator\">=</span> %S, %D%w%S</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\tbrowseable <span class=\"token operator\">=</span> No</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t<span class=\"token builtin class-name\">read</span> only <span class=\"token operator\">=</span> No</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\tinherit acls <span class=\"token operator\">=</span> Yes</pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">[</span>printers<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> All Printers</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\tpath <span class=\"token operator\">=</span> /var/tmp</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\tprintable <span class=\"token operator\">=</span> Yes</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\tcreate mask <span class=\"token operator\">=</span> 0600</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\tbrowseable <span class=\"token operator\">=</span> No</pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">[</span>print$<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> Printer Drivers</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\tpath <span class=\"token operator\">=</span> /var/lib/samba/drivers</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t<span class=\"token function\">write</span> list <span class=\"token operator\">=</span> @printadmin root</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\tforce group <span class=\"token operator\">=</span> @printadmin</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\tcreate mask <span class=\"token operator\">=</span> 0664</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\tdirectory mask <span class=\"token operator\">=</span> 0775</pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">[</span>cawu_share<span class=\"token punctuation\">]</span>                     </pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> This is caiwu share </pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\tpath <span class=\"token operator\">=</span> /public         <span class=\"token comment\">#共享目录           </span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\tbrowseable <span class=\"token operator\">=</span> <span class=\"token function\">yes</span>       <span class=\"token comment\">#共享是否可以见       </span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\twritable <span class=\"token operator\">=</span> <span class=\"token function\">yes</span>         <span class=\"token comment\">#所有人可写      </span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token function\">write</span> list <span class=\"token operator\">=</span> yangxiao    <span class=\"token comment\">#允许写入该共享的用户</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    valid <span class=\"token function\">users</span> <span class=\"token operator\">=</span> yangxiao   <span class=\"token comment\">#允许访问该共享的用户</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>     </pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl restart smb</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token comment\">#2. 添加 samba 密码，该用户必须已经是系统用户</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir /public</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># useradd -s /sbin/nologin yangxiao</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># smbpasswd -a yangxiao               </span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># testparm            #测试语法</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll -d /public/</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>drwxr-xr-x <span class=\"token number\">2</span> root root <span class=\"token number\">6</span> Jun <span class=\"token number\">25</span> <span class=\"token number\">20</span>:25 /public/</pre></td></tr><tr><td data-num=\"47\"></td><td><pre></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token comment\">#3. 添加 publi 目录系统用户权限\t</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chown yangxiao.yangxiao /public/         </span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll /public/ -d</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>drwxr-xr-x <span class=\"token number\">2</span> yangxiao yangxiao <span class=\"token number\">55</span> Jun <span class=\"token number\">25</span> <span class=\"token number\">20</span>:44 /public/</pre></td></tr></table></figure><ul>\n<li>注释 valid users = yangxiao 后发现用户 weiyixiao 可以访问共享目录，但是无法上传</li>\n<li>注释 valid users = yangxiao，write list = yangxiao 后发现用户 weiyixiao 可以访问共享目录，仍然无法上传，原因 public 目录没有系统的写入权限</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#1. 修改配置文件</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># egrep -v '^#|^$' /etc/samba/smb.conf</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>global<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tworkgroup <span class=\"token operator\">=</span> SAMBA</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\tsecurity <span class=\"token operator\">=</span> user</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\tpassdb backend <span class=\"token operator\">=</span> tdbsam</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\tprinting <span class=\"token operator\">=</span> cups</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token function\">printcap</span> name <span class=\"token operator\">=</span> cups</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\tload printers <span class=\"token operator\">=</span> <span class=\"token function\">yes</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\tcups options <span class=\"token operator\">=</span> raw</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">[</span>homes<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> Home Directories</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\tvalid <span class=\"token function\">users</span> <span class=\"token operator\">=</span> %S, %D%w%S</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\tbrowseable <span class=\"token operator\">=</span> No</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t<span class=\"token builtin class-name\">read</span> only <span class=\"token operator\">=</span> No</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\tinherit acls <span class=\"token operator\">=</span> Yes</pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">[</span>printers<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> All Printers</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\tpath <span class=\"token operator\">=</span> /var/tmp</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\tprintable <span class=\"token operator\">=</span> Yes</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\tcreate mask <span class=\"token operator\">=</span> 0600</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\tbrowseable <span class=\"token operator\">=</span> No</pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">[</span>print$<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> Printer Drivers</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\tpath <span class=\"token operator\">=</span> /var/lib/samba/drivers</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t<span class=\"token function\">write</span> list <span class=\"token operator\">=</span> @printadmin root</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\tforce group <span class=\"token operator\">=</span> @printadmin</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\tcreate mask <span class=\"token operator\">=</span> 0664</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\tdirectory mask <span class=\"token operator\">=</span> 0775</pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">[</span>cawu_share<span class=\"token punctuation\">]</span>                     </pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> This is caiwu share </pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\tpath <span class=\"token operator\">=</span> /public           <span class=\"token comment\">#共享目录  </span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\tbrowseable <span class=\"token operator\">=</span> <span class=\"token function\">yes</span>         <span class=\"token comment\">#共享是否可以见    </span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\twritable <span class=\"token operator\">=</span> <span class=\"token function\">yes</span>           <span class=\"token comment\">#所有人可写  </span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token punctuation\">;</span>   <span class=\"token function\">write</span> list <span class=\"token operator\">=</span> yangxiao  <span class=\"token comment\">#允许写入该共享的用户</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token punctuation\">;</span>   valid <span class=\"token function\">users</span> <span class=\"token operator\">=</span> yangxiao <span class=\"token comment\">#允许访问该共享的用户</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token comment\">#2. 添加用户并授予系统权限</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># useradd -s /sbin/nologin weiyixiao</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># smbpasswd -a weiyixiao            #要给用户添加 samba 密码，该用户必须已经是系统用户</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll /public/ -d</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>drwxr-xr-x <span class=\"token number\">2</span> yangxiao yangxiao <span class=\"token number\">55</span> Jun <span class=\"token number\">25</span> <span class=\"token number\">20</span>:44 /public/</pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chmod 775 /public</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># usermod -a -G yangxiao weiyixiao    #将 weiyixiao 用户添加到 yangxiao 组</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl start smb</span></pre></td></tr></table></figure><h4 id=\"七-添加删除samba用户\"><a class=\"anchor\" href=\"#七-添加删除samba用户\">#</a> 七、添加删除 Samba 用户</h4>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#1. 添加系统用户</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># useradd -s /sbin/nologin test </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">#2. 添加 samba 密码，该用户必须已经是系统用户</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># smbpasswd -a test     </span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">#3. 查看 smb 用户</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># pdbedit -L</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>yangxiao:1003:</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>test:1005:</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>weiyixiao:1004:</pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">#4. 删除 smb 用户</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># smbpasswd -x test</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>Deleted user test.</pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># pdbedit -L</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>yangxiao:1003:</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>weiyixiao:1004:</pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">#5.samba Linux 客户端访问</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># smbclient //192.168.40.188/public -U xuyong   #public 共享名</span></pre></td></tr></table></figure><h4 id=\"八-samba企业实战\"><a class=\"anchor\" href=\"#八-samba企业实战\">#</a> 八、Samba 企业实战</h4>\n<p><img loading=\"lazy\" data-src=\"https://wp-cdn.4ce.cn/v2/G1pGXaJ.png\" alt=\"1.png\" /></p>\n<h5 id=\"81-samba服务器需求\"><a class=\"anchor\" href=\"#81-samba服务器需求\">#</a> 8.1 Samba 服务器需求</h5>\n<ol>\n<li>每位员工有独立的目录，可上传、可读、可写、可删除权限，但目录本身员工不可删除</li>\n<li>每位员工可见公司共享目录 public_share（只读）</li>\n<li>部门内部员工可见部门共享目录_caiwu_share（读写）</li>\n</ol>\n<h5 id=\"82-samba服务安装\"><a class=\"anchor\" href=\"#82-samba服务安装\">#</a> 8.2 Samba 服务安装</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum install samba -y</span></pre></td></tr></table></figure><h5 id=\"83-samba服务配置\"><a class=\"anchor\" href=\"#83-samba服务配置\">#</a> 8.3 Samba 服务配置</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@Harbor public_share<span class=\"token punctuation\">]</span><span class=\"token comment\"># egrep -v '^#|^$' /etc/samba/smb.conf</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>global<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tworkgroup <span class=\"token operator\">=</span> SAMBA</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tsecurity <span class=\"token operator\">=</span> user</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\tpassdb backend <span class=\"token operator\">=</span> tdbsam</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\tprinting <span class=\"token operator\">=</span> cups</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token function\">printcap</span> name <span class=\"token operator\">=</span> cups</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\tload printers <span class=\"token operator\">=</span> <span class=\"token function\">yes</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\tcups options <span class=\"token operator\">=</span> raw</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">[</span>homes<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> Home Directories</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\tvalid <span class=\"token function\">users</span> <span class=\"token operator\">=</span> %S, %D%w%S</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\tbrowseable <span class=\"token operator\">=</span> No</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t<span class=\"token builtin class-name\">read</span> only <span class=\"token operator\">=</span> No</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\tinherit acls <span class=\"token operator\">=</span> Yes</pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">[</span>printers<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> All Printers</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\tpath <span class=\"token operator\">=</span> /var/tmp</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\tprintable <span class=\"token operator\">=</span> Yes</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\tcreate mask <span class=\"token operator\">=</span> 0600</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\tbrowseable <span class=\"token operator\">=</span> No</pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">[</span>print$<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> Printer Drivers</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\tpath <span class=\"token operator\">=</span> /var/lib/samba/drivers</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t<span class=\"token function\">write</span> list <span class=\"token operator\">=</span> @printadmin root</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\tforce group <span class=\"token operator\">=</span> @printadmin</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\tcreate mask <span class=\"token operator\">=</span> 0664</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\tdirectory mask <span class=\"token operator\">=</span> 0775</pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token punctuation\">[</span>public_share<span class=\"token punctuation\">]</span>                          </pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> This is public share  </pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\tpath <span class=\"token operator\">=</span> /samba_share/public_share</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\tbrowseable <span class=\"token operator\">=</span> <span class=\"token function\">yes</span>              </pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\twritable <span class=\"token operator\">=</span> <span class=\"token function\">yes</span>               </pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token punctuation\">[</span>yewu_share<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        comment <span class=\"token operator\">=</span> This is caiwu share</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        path <span class=\"token operator\">=</span> /samba_share/yewu_share</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        browseable <span class=\"token operator\">=</span> <span class=\"token function\">yes</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        writable <span class=\"token operator\">=</span> <span class=\"token function\">yes</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token punctuation\">[</span>caiwu_share<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        comment <span class=\"token operator\">=</span> This is yewu share</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        path <span class=\"token operator\">=</span> /samba_share/caiwu_share</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        browseable <span class=\"token operator\">=</span> <span class=\"token function\">yes</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        writable <span class=\"token operator\">=</span> <span class=\"token function\">yes</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl restart smb</span></pre></td></tr></table></figure><h5 id=\"84-创建共享目录\"><a class=\"anchor\" href=\"#84-创建共享目录\">#</a> 8.4 创建共享目录</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir /samba_share/</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cd /samba_share/</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba samba_share<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir caiwu_share</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba samba_share<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir yewu_share</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba samba_share<span class=\"token punctuation\">]</span><span class=\"token comment\"># public_share</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll -d /samba_share/yewu_share</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>drwxr-xr-x <span class=\"token number\">2</span> root root <span class=\"token number\">6</span> Jun <span class=\"token number\">26</span> <span class=\"token number\">11</span>:27 /samba_share/yewu_share</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll -d /samba_share/caiwu_share/</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>drwxr-xr-x <span class=\"token number\">2</span> root root <span class=\"token number\">6</span> Jun <span class=\"token number\">26</span> <span class=\"token number\">11</span>:26 /samba_share/caiwu_share</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll -d /samba_share/public_share/</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>drwxr-xr-x <span class=\"token number\">2</span> root root <span class=\"token number\">6</span> Jun <span class=\"token number\">26</span> <span class=\"token number\">11</span>:27 /samba_share/public_share</pre></td></tr></table></figure><h5 id=\"85-添加用户并设置smb密码\"><a class=\"anchor\" href=\"#85-添加用户并设置smb密码\">#</a> 8.5 添加用户并设置 smb 密码</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#1. 添加系统用户</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># useradd -s /sbin/nologin wangyuyan</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># useradd -s /sbin/nologin azhu</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># useradd -s /sbin/nologin duanyu</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># useradd -s /sbin/nologin xuzhu</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># useradd -s /sbin/nologin qiaofeng</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#2. 添加 smb 密码</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># smbpasswd -a wangyuyan</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># smbpasswd -a azhu</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># smbpasswd -a duanyu</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># smbpasswd -a xuzhu</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># smbpasswd -a qiaofeng</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">#3. 查看 smb 用户</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># pdbedit -L</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>wangyuyan:1002:</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>duanyu:1004:</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>qiaofeng:1006:</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>azhu:1003:</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>xuzhu:1005:</pre></td></tr></table></figure><h5 id=\"86-为用户添加acl权限\"><a class=\"anchor\" href=\"#86-为用户添加acl权限\">#</a> 8.6 为用户添加 ACL 权限</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#1. 修改目录权限</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chmod 700 /samba_share/public_share</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">#2. 为用户添加 ACL 权限</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#添加 ACL 权限</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># setfacl -m u:qiaofeng:rx /samba_share/public_share</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#3. 查看 ACL 权限</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># getfacl /samba_share/public_share</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>getfacl: Removing leading <span class=\"token string\">'/'</span> from absolute path names</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\"># file: samba_share/public_share</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\"># owner: root</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\"># group: root</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>user::rwx</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>user:qiaofeng:r-x</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>group::---</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>mask::r-x</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>other::---</pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">#4. 删除 ACL 权限</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># setfacl -x u:qiaofeng /samba_share/public_share</span></pre></td></tr></table></figure><h5 id=\"87-为组添加acl权限\"><a class=\"anchor\" href=\"#87-为组添加acl权限\">#</a> 8.7 为组添加 ACL 权限</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#1. 新建组并加入用户</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># groupadd caiwu</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># groupadd yewu</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># usermod -a -G caiwu wangyuyan</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># usermod -a -G caiwu azhu</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># usermod -a -G yewu duanyu</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># usermod -a -G yewu xuzhu</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">#从组中移除用户</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># gpasswd -d duanyu caiwu</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># gpasswd -d xuzhu caiwu</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">#2. 修改目录权限</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chmod 700 /samba_share/yewu_share</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chmod 700 /samba_share/caiwu_share</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">#3. 为组设定 ACL 权限</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># setfacl -m g:caiwu:rwx /samba_share/caiwu_share</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># setfacl -m g:caiwu:rx /samba_share/public_share</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># setfacl -m g:yewu:rwx /samba_share/yewu_share</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># setfacl -m g:yewu:rx /samba_share/public_share</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">#4. 查看 ACL 权限</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># getfacl /samba_share/yewu_share</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>getfacl: Removing leading <span class=\"token string\">'/'</span> from absolute path names</pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token comment\"># file: samba_share/yewu_share</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token comment\"># owner: root</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token comment\"># group: root</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>user::rwx</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>group::---</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>group:yewu:rwx</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>mask::rwx</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>other::---</pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># getfacl /samba_share/caiwu_share</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>getfacl: Removing leading <span class=\"token string\">'/'</span> from absolute path names</pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token comment\"># file: samba_share/caiwu_share</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token comment\"># owner: root</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token comment\"># group: root</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>user::rwx</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>group::---</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>group:caiwu:rwx</pre></td></tr><tr><td data-num=\"44\"></td><td><pre>mask::rwx</pre></td></tr><tr><td data-num=\"45\"></td><td><pre>other::---</pre></td></tr><tr><td data-num=\"46\"></td><td><pre></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># getfacl /samba_share/public_share</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>getfacl: Removing leading <span class=\"token string\">'/'</span> from absolute path names</pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token comment\"># file: samba_share/public_share</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token comment\"># owner: root</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token comment\"># group: root</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>user::rwx</pre></td></tr><tr><td data-num=\"53\"></td><td><pre>user:qiaofeng:r-x</pre></td></tr><tr><td data-num=\"54\"></td><td><pre>group::---</pre></td></tr><tr><td data-num=\"55\"></td><td><pre>group:caiwu:r-x</pre></td></tr><tr><td data-num=\"56\"></td><td><pre>group:yewu:r-x</pre></td></tr><tr><td data-num=\"57\"></td><td><pre>mask::r-x</pre></td></tr><tr><td data-num=\"58\"></td><td><pre>other::---</pre></td></tr><tr><td data-num=\"59\"></td><td><pre></pre></td></tr><tr><td data-num=\"60\"></td><td><pre><span class=\"token comment\">#5. 删除 ACL 权限</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># setfacl -x g:caiwu /samba_share/caiwu_share</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># setfacl -x g:yewu /samba_share/yewu_share</span></pre></td></tr></table></figure><h4 id=\"九-samba挂载及别名\"><a class=\"anchor\" href=\"#九-samba挂载及别名\">#</a> 九、Samba 挂载及别名</h4>\n<h5 id=\"91-samba挂载\"><a class=\"anchor\" href=\"#91-samba挂载\">#</a> 9.1 Samba 挂载</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#public_share 为共享名非共享目录</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mount -t cifs -o username=wangyuyan //192.168.1.50/public_share /mnt   </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">#配置自动挂载</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># echo \"//192.168.1.50/public_share /mnt cifs defaults,username=wangyuyan,passwd=123456 1 2\" >> /etc/fstab</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mount -a</span></pre></td></tr></table></figure><h5 id=\"92-samba别名\"><a class=\"anchor\" href=\"#92-samba别名\">#</a> 9.2 Samba 别名</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#1. 开启 smb 别名</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim /etc/samba/smb.conf</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>global<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        workgroup <span class=\"token operator\">=</span> workgroup</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        security <span class=\"token operator\">=</span> user</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        username map <span class=\"token operator\">=</span> /etc/samba/smbusers      <span class=\"token comment\">#添加此行配置</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">#2. 配置 smb 别名</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim /etc/samba/smbusers</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>wangyuyan <span class=\"token operator\">=</span>  zhangsan lisi <span class=\"token comment\">#别名用户 zhangsan、lisi 登录后用于 wangyuyan 权限，权限及密码均一样</span></pre></td></tr></table></figure>",
            "tags": [
                "Samba"
            ]
        }
    ]
}