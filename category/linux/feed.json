{
    "version": "https://jsonfeed.org/version/1",
    "title": "LinuxSre云原生 • All posts by \"linux\" category",
    "description": "专注于 Linux 运维、云计算、云原⽣等技术",
    "home_page_url": "http://ixuyong.cn",
    "items": [
        {
            "id": "http://ixuyong.cn/posts/2508697220.html",
            "url": "http://ixuyong.cn/posts/2508697220.html",
            "title": "Chrony时间同步服务",
            "date_published": "2025-06-23T11:40:03.000Z",
            "content_html": "<h3 id=\"chrony时间同步服务\"><a class=\"anchor\" href=\"#chrony时间同步服务\">#</a> Chrony 时间同步服务</h3>\n<h4 id=\"一-时间同步基本概念\"><a class=\"anchor\" href=\"#一-时间同步基本概念\">#</a> 一、时间同步基本概念</h4>\n<p>时间同步就是将本地时间与互联网时间进行校对，为系统提供一个统一时间的过程。由于本地时间的计时速率、运行环境不一致性。所有本地时钟纵使在某一刻被校准了 ，一段时间后，这些本地时钟也会出现不一致。为了本地时钟再次达到相同的时间值，所以需要进行时间同步的操作。</p>\n<h4 id=\"二-chrony时间服务\"><a class=\"anchor\" href=\"#二-chrony时间服务\">#</a> 二、Chrony 时间服务</h4>\n<h5 id=\"21-chrony介绍\"><a class=\"anchor\" href=\"#21-chrony介绍\">#</a> 2.1 Chrony 介绍</h5>\n<p>chrony 是基于 ntp 协议的实现时间同步服务，它既可以当做服务端，也可以充当客户端；</p>\n<ul>\n<li>1、chrony 是 NTP 的替代品，能更精确的时间和更快的速度同步时钟；</li>\n<li>2、chrony 占用系统资源少，只有被唤起时才占用少部分 CPU，chrony 兼容 ntpdate；</li>\n<li>3、chrony 允许本地网络其他主机像本地进行时间同步；</li>\n</ul>\n<p><img loading=\"lazy\" data-src=\"https://wp-cdn.4ce.cn/v2/21Dre4A.png\" alt=\"1.png\" /></p>\n<h5 id=\"22-chrony安装\"><a class=\"anchor\" href=\"#22-chrony安装\">#</a> 2.2 Chrony 安装</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@chrony ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum install chrony -y</span></pre></td></tr></table></figure><ul>\n<li>主配置文件：/etc/chrony.conf</li>\n<li>客户端程序：/usr/bin/chronyc</li>\n<li>服务端程序：/usr/sbin/chronyd</li>\n</ul>\n<h5 id=\"23-chrony服务端\"><a class=\"anchor\" href=\"#23-chrony服务端\">#</a> 2.3 Chrony 服务端</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@chrony ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/chrony.conf</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#使用同步的远程时钟源，理论上可以同步无限个</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>server <span class=\"token number\">0</span>.centos.pool.ntp.org iburst</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>server <span class=\"token number\">1</span>.centos.pool.ntp.org iburst</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>server <span class=\"token number\">2</span>.centos.pool.ntp.org iburst</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>server <span class=\"token number\">3</span>.centos.pool.ntp.org iburst</pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#根据实际时间计算出服务器增减时间的比率，然后记录到一个文件中，在系统重启后为系统做出最佳时间补偿调整</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>driftfile /var/lib/chrony/drift</pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">#如果系统时钟的偏移量大于 1 秒，则允许系统时钟在前三次更新中步进</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>makestep <span class=\"token number\">1.0</span> <span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">#启用实时时钟（RTC）的内核同步</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>rtcsync</pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">#通过使用 hwtimestamp 指令启用硬件时间戳</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">#hwtimestamp *</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">#增加调整所需的可选择源的最小数量</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">#minsources 2</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\"># 允许指定网络的主机同步时间，不指定就是允许所有，默认不开启。</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>allow <span class=\"token number\">192.168</span>.0.0/16</pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token comment\"># 默认情况下本地服务器无法同步互联网时间时，可能会出现不精确，所以会拒绝提供授时服务；</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token comment\"># 开启此选项，则表示允许接受不精确时间，继续为客户端提供授时服务；</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token builtin class-name\">local</span> stratum <span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token comment\">#指定包含 NTP 身份验证密钥的文件</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token comment\">#keyfile /etc/chrony.keys</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token comment\">#指定日志文件</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>logdir /var/log/chrony</pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token comment\">#选择日志文件要记录的信息</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>log measurements statistics tracking</pre></td></tr></table></figure><p>1.Chrony 服务端配置，修改 /etc/chrony.conf 文件三处，设定外部时间服务器、允许内网同步此服务端、设置断网继续同步</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@Harbor ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/chrony.conf</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># Use public servers from the pool.ntp.org project.</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># Please consider joining the pool (https://www.pool.ntp.org/join.html).</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>server ntp.aliyun.com iburst</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># Allow NTP client access from local network.</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>allow <span class=\"token number\">192.168</span>.1.0/24</pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\"># Serve time even if not synchronized to a time source.</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token builtin class-name\">local</span> stratum <span class=\"token number\">10</span></pre></td></tr></table></figure><p>2. 重启 Chrony 服务</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@chrony ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl restart chronyd</span></pre></td></tr></table></figure><h5 id=\"24-chrony客户端\"><a class=\"anchor\" href=\"#24-chrony客户端\">#</a> 2.4 Chrony 客户端</h5>\n<p>1. 客户端使用 ntpdate 或 chronyc 命令的方式进行手动同步</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># ntpdate</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@chrony ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum install ntpdate -y</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@chrony ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ntpdate 192.168.1.68</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># chronyc</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@chrony ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chronyc -a makestep</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">200</span> OK</pre></td></tr></table></figure><p>2. 客户端使用 chrony 守护进程方式进行时间自动化同步</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@chrony ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum install chrony -y</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@chrony ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim /etc/chrony.conf</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 指向至服务端</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>server <span class=\"token number\">192.168</span>.1.68 iburst</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@chrony ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl restart chronyd</span></pre></td></tr></table></figure><p>3. 查看时间同步是否正常</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@chrony ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chronyc sources</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">210</span> Number of sources <span class=\"token operator\">=</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>MS Name/IP address         Stratum Poll Reach LastRx Last sample               </pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">=</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>^* <span class=\"token number\">192.168</span>.1.68                  <span class=\"token number\">3</span>   <span class=\"token number\">6</span>    <span class=\"token number\">17</span>     <span class=\"token number\">1</span>  +1652ns<span class=\"token punctuation\">[</span>  +17us<span class=\"token punctuation\">]</span> +/-   32ms</pre></td></tr></table></figure>",
            "tags": [
                "Linux"
            ]
        },
        {
            "id": "http://ixuyong.cn/posts/269104229.html",
            "url": "http://ixuyong.cn/posts/269104229.html",
            "title": "Samba服务实践",
            "date_published": "2025-06-20T14:12:07.000Z",
            "content_html": "<h3 id=\"samba服务实践\"><a class=\"anchor\" href=\"#samba服务实践\">#</a> Samba 服务实践</h3>\n<h4 id=\"一-samba-概述\"><a class=\"anchor\" href=\"#一-samba-概述\">#</a> 一、Samba 概述</h4>\n<p>SMB（Server Messages Block，信息服务块）是一种在局域网上共享文件和打印机的一种通信协议，它为局域网内的不同操作系统的计算机之间提供文件及打印机等资源的共享服务。SMB 协议是客户机 / 服务器型协议，客户机通过该协议可以访问服务器上的共享文件系统、打印机及其他资源。如图：</p>\n<p><img loading=\"lazy\" data-src=\"https://wp-cdn.4ce.cn/v2/jBVTDjA.jpeg\" alt=\"1.jpg\" /></p>\n<p><strong>1. ftp 的优缺点：</strong></p>\n<p>优点：文件传输、应用层协议、可跨平台</p>\n<p>缺点：只能实现文件传输，无法实现文件系统挂载；无法直接修改服务器端文件</p>\n<p><strong>2. Samba 的特性：</strong></p>\n<p>使用 smb/cifs 协议、可跨平台、可实现文件系统挂载、可实现服务器端修改文件</p>\n<p><strong>3. smb</strong> <strong>协议和</strong> <strong>cifs</strong> <strong>之间的关系</strong></p>\n<p>随着 Internet 的流行，Microsoft 希望将这个协议扩展到 Internet 上去，成为 Internet 上计算机之间相互共享数据的一种标准。因此它<strong>将原有的几乎没有多少技术文档的 SMB 协议进行整理，重新命名为 CIFS（Common Internet File</strong> <strong>System），它使程序可以访问远程 Internet 计算机上的文件并要求此计算机提供服务</strong>。客户程序请求远在服务器上的服务器程序为它提供服务。服务器获得请求并返回响应。CIFS 是公共的或开放的 SMB 协议版本，并由 Microsoft 使用。SMB 协议在局域网上用于服务器文件访问和打印的协议。</p>\n<p><strong>4. 常见文件服务器对比</strong></p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">服务名称</th>\n<th style=\"text-align:left\">使用范围</th>\n<th style=\"text-align:left\">服务端</th>\n<th style=\"text-align:left\">客服端</th>\n<th style=\"text-align:left\">局限性</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">FTP</td>\n<td style=\"text-align:left\">内网和公网</td>\n<td style=\"text-align:left\">Windows、Linux</td>\n<td style=\"text-align:left\">Windows、Linux</td>\n<td style=\"text-align:left\">无法直接在服务器端修改数据</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Samba</td>\n<td style=\"text-align:left\">内网</td>\n<td style=\"text-align:left\">Windows、Linux</td>\n<td style=\"text-align:left\">Windows、Linux</td>\n<td style=\"text-align:left\">只能在内网使用</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">NFS</td>\n<td style=\"text-align:left\">内网和公网</td>\n<td style=\"text-align:left\">Linux</td>\n<td style=\"text-align:left\">Linux</td>\n<td style=\"text-align:left\">只能 Linux 之间使用</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"二-samba部署\"><a class=\"anchor\" href=\"#二-samba部署\">#</a> 二、Samba 部署</h4>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum install samba -y</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl start smb &amp;&amp; systemctl enable smb</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># netstat -lntp|grep smb</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>tcp        <span class=\"token number\">0</span>      <span class=\"token number\">0</span> <span class=\"token number\">0.0</span>.0.0:139             <span class=\"token number\">0.0</span>.0.0:*               LISTEN      <span class=\"token number\">1739</span>/smbd           </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>tcp        <span class=\"token number\">0</span>      <span class=\"token number\">0</span> <span class=\"token number\">0.0</span>.0.0:445             <span class=\"token number\">0.0</span>.0.0:*               LISTEN      <span class=\"token number\">1739</span>/smbd           </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>tcp6       <span class=\"token number\">0</span>      <span class=\"token number\">0</span> :::139                  :::*                    LISTEN      <span class=\"token number\">1739</span>/smbd           </pre></td></tr><tr><td data-num=\"7\"></td><td><pre>tcp6       <span class=\"token number\">0</span>      <span class=\"token number\">0</span> :::445                  :::*                    LISTEN      <span class=\"token number\">1739</span>/smbd </pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># testparm   #检测配置文件语法</span></pre></td></tr></table></figure><h4 id=\"三-samba配置文件详解\"><a class=\"anchor\" href=\"#三-samba配置文件详解\">#</a> 三、Samba 配置文件详解</h4>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># egrep -v '^#|^$' /etc/samba/smb.conf</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>global<span class=\"token punctuation\">]</span>           <span class=\"token comment\">#全局设置</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tworkgroup <span class=\"token operator\">=</span> SAMBA</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tsecurity <span class=\"token operator\">=</span> user</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\tpassdb backend <span class=\"token operator\">=</span> tdbsam</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\tprinting <span class=\"token operator\">=</span> cups</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token function\">printcap</span> name <span class=\"token operator\">=</span> cups</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\tload printers <span class=\"token operator\">=</span> <span class=\"token function\">yes</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\tcups options <span class=\"token operator\">=</span> raw</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">[</span>homes<span class=\"token punctuation\">]</span>            <span class=\"token comment\">#用户目录共享设置</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> Home Directories</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\tvalid <span class=\"token function\">users</span> <span class=\"token operator\">=</span> %S, %D%w%S</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\tbrowseable <span class=\"token operator\">=</span> No</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t<span class=\"token builtin class-name\">read</span> only <span class=\"token operator\">=</span> No</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\tinherit acls <span class=\"token operator\">=</span> Yes</pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">[</span>printers<span class=\"token punctuation\">]</span>         <span class=\"token comment\">#打印机共享设置</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> All Printers</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\tpath <span class=\"token operator\">=</span> /var/tmp</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\tprintable <span class=\"token operator\">=</span> Yes</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\tcreate mask <span class=\"token operator\">=</span> 0600</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\tbrowseable <span class=\"token operator\">=</span> No</pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">[</span>print$<span class=\"token punctuation\">]</span>           <span class=\"token comment\">#自定义名称的共享目录设置</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> Printer Drivers</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\tpath <span class=\"token operator\">=</span> /var/lib/samba/drivers</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t<span class=\"token function\">write</span> list <span class=\"token operator\">=</span> @printadmin root</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\tforce group <span class=\"token operator\">=</span> @printadmin</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\tcreate mask <span class=\"token operator\">=</span> 0664</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\tdirectory mask <span class=\"token operator\">=</span> 0775</pre></td></tr></table></figure><h5 id=\"31-全局参数详解\"><a class=\"anchor\" href=\"#31-全局参数详解\">#</a> 3.1 全局参数详解</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>workgroup <span class=\"token operator\">=</span> WORKGROUP</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#设定 Samba Server 所要加入的工作组或者域</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>server string <span class=\"token operator\">=</span> Samba Server Version %v</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#设定 Samba Server 的注释，可以是任何字符串，也可以不填。宏 % v 表示显示 Samba 的版本号</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>hosts allow <span class=\"token operator\">=</span> <span class=\"token number\">127</span>. <span class=\"token number\">192.168</span>.1. <span class=\"token number\">192.168</span>.10.1</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#表示允许连接到 Samba Server 的客户端，多个参数以空格隔开。可以用一个 IP 表示，也可以用一个网段表示。hosts deny 与 hosts allow 刚好相反。</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">#例如：hosts allow=172.17.2.EXCEPT172.17.2.50</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">#表示容许来自 172.17.2.* 的主机连接，但排除 172.17.2.50</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">#hosts allow=172.17.2.0/255.255.0.0</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">#表示容许来自 172.17.2.0/255.255.0.0 子网中的所有主机连接</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>log <span class=\"token function\">file</span> <span class=\"token operator\">=</span> /var/log/samba/log.%m</pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">#设置 Samba Server 日志文件的存储位置以及日志文件名称。在文件名后加个宏 % m（主机名），表示对每台访问 Samba Server 的机器都单独记录一个日志文件。如果 pc1、pc2 访问过 Samba Server，就会在 /var/log/samba 目录下留下 log.pc1 和 log.pc2 两个日志文件。</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>passdb backend <span class=\"token operator\">=</span> tdbsam</pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">#passdb backend 就是用户后台的意思。目前有三种后台：smbpasswd、tdbsam 和 ldapsam。sam 应该是 security account manager（安全账户管理）的简写。</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>security <span class=\"token operator\">=</span> user</pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">#说明：设置用户访问 Samba Server 的验证方式，一共有四种验证方式。</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">#1.share：用户访问 Samba Server 不需要提供用户名和口令，安全性能较低。</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">#2.user：Samba Server 共享目录只能被授权的用户访问，由 Samba Server 负责检查账号和密码的正确性。账号和密码要在本 Samba Server 中建立。</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">#3.server：依靠其他 Windows NT/2000 或 Samba Server 来验证用户的账号和密码，是一种代理验证。此种安全模式下，系统管理员可以把所有的 Windows 用户和口令集中到一个 NT 系统上，使用 Windows NT 进行 Samba 认证，远程服务器可以自动认证全部用户和口令，如果认证失败，Samba 将使用用户级安全模式作为替代的方式。</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token comment\">#4.domain：域安全级别，使用主域控制器 (PDC) 来完成认证。</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>max connections <span class=\"token operator\">=</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token comment\">#max connections 用来指定连接 Samba Server 的最大连接数目。如果超出连接数目，则新的连接请求将被拒绝。0 表示不限制。</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>load printers <span class=\"token operator\">=</span> yes/no</pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token comment\">#设置是否在启动 Samba 时就共享打印机。</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token function\">printcap</span> name <span class=\"token operator\">=</span> cups</pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token comment\">#设置共享打印机的配置文件</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>printing <span class=\"token operator\">=</span> cups</pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token comment\">#设置 Samba 共享打印机的类型。现在支持的打印系统有：bsd, sysv, plp, lprng, aix, hpux, qnx</span></pre></td></tr></table></figure><h5 id=\"32-共享参数详解\"><a class=\"anchor\" href=\"#32-共享参数详解\">#</a> 3.2 共享参数详解</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>共享名<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>comment <span class=\"token operator\">=</span> 任意字符串</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#comment 是对该共享的描述，可以是任意字符串</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>path <span class=\"token operator\">=</span> 共享目录路径</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">#path 用来指定共享目录的路径</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>guest ok <span class=\"token operator\">=</span> yes/no</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">#允许任何人访问，等同于同 “public”</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token builtin class-name\">read</span> only <span class=\"token operator\">=</span> <span class=\"token function\">yes</span>\t</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">#所有人只读</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>writable <span class=\"token operator\">=</span> yes/no</pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">#writable 用来指定该共享路径是否可写</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token function\">write</span> list <span class=\"token operator\">=</span> 允许写入该共享的用户</pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">#write list 用来指定可以在该共享下写入文件的用户。</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\">#例如：write list = bobyuan，@bob</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>browseable <span class=\"token operator\">=</span> yes/no</pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">#browseable 用来指定该共享是否可以浏览</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>valid <span class=\"token function\">users</span> <span class=\"token operator\">=</span> 允许访问该共享的用户</pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token comment\">#valid users 用来指定允许访问该共享资源的用户</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token comment\">#例如：valid users = bobyuan，@bob，@tech（多个用户或者组中间用逗号隔开，如果要加入一个组就用 “@+ 组名” 表示。）</span></pre></td></tr></table></figure><h4 id=\"四-samba-share权限访问\"><a class=\"anchor\" href=\"#四-samba-share权限访问\">#</a> 四、Samba share 权限访问</h4>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#1. 修改配置文件</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># egrep -v '^#|^$' /etc/samba/smb.conf</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>global<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tworkgroup <span class=\"token operator\">=</span> workgroup</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\tsecurity <span class=\"token operator\">=</span> User</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    map to guest <span class=\"token operator\">=</span> Bad User  <span class=\"token comment\">#目前 \"security = share\" 参数已被弃用，取而代之的是 map to guest = Bad User</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\tpassdb backend <span class=\"token operator\">=</span> tdbsam</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\tprinting <span class=\"token operator\">=</span> cups</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token function\">printcap</span> name <span class=\"token operator\">=</span> cups</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\tload printers <span class=\"token operator\">=</span> <span class=\"token function\">yes</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\tcups options <span class=\"token operator\">=</span> raw</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">[</span>homes<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> Home Directories</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\tvalid <span class=\"token function\">users</span> <span class=\"token operator\">=</span> %S, %D%w%S</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\tbrowseable <span class=\"token operator\">=</span> No</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t<span class=\"token builtin class-name\">read</span> only <span class=\"token operator\">=</span> No</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\tinherit acls <span class=\"token operator\">=</span> Yes</pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">[</span>printers<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> All Printers</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\tpath <span class=\"token operator\">=</span> /var/tmp</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\tprintable <span class=\"token operator\">=</span> Yes</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\tcreate mask <span class=\"token operator\">=</span> 0600</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\tbrowseable <span class=\"token operator\">=</span> No</pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">[</span>print$<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> Printer Drivers</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\tpath <span class=\"token operator\">=</span> /var/lib/samba/drivers</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t<span class=\"token function\">write</span> list <span class=\"token operator\">=</span> @printadmin root</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\tforce group <span class=\"token operator\">=</span> @printadmin</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\tcreate mask <span class=\"token operator\">=</span> 0664</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\tdirectory mask <span class=\"token operator\">=</span> 0775</pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token punctuation\">[</span>Public Share<span class=\"token punctuation\">]</span>                      <span class=\"token comment\">#共享名称      </span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> This is public share  <span class=\"token comment\">#所有人可写</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\tpath <span class=\"token operator\">=</span> /data                    <span class=\"token comment\">#共享目录</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\tbrowseable <span class=\"token operator\">=</span> <span class=\"token function\">yes</span>                <span class=\"token comment\">#共享是否可以见</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\twritable <span class=\"token operator\">=</span> <span class=\"token function\">yes</span>                  <span class=\"token comment\">#所有人可写</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\tguest ok <span class=\"token operator\">=</span> <span class=\"token function\">yes</span>                  <span class=\"token comment\">#所有人可访问</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token comment\">#2. 重启 smbf 服务</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># testparm</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl restart smb</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token comment\">#3. 修改系统权限</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir /data</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll -d /data/</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>drwxr-xr-x. <span class=\"token number\">5</span> root root <span class=\"token number\">49</span> Jun <span class=\"token number\">23</span> <span class=\"token number\">14</span>:26 /data/</pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token comment\">#share 访问全部映射成 nobody 用户访问，nobody 没有权限访问 data 目录，需要添加系统权限</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chown nobody /data</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll -d /data</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>drwxr-xr-x. <span class=\"token number\">5</span> nobody root <span class=\"token number\">73</span> Jun <span class=\"token number\">25</span> <span class=\"token number\">14</span>:22 /data</pre></td></tr></table></figure><h4 id=\"五-linux客户端命令行工具\"><a class=\"anchor\" href=\"#五-linux客户端命令行工具\">#</a> 五、Linux 客户端命令行工具</h4>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@qnyp-client1 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum install samba-client -y</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba-client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># smbclient -L //192.168.1.50 -U 用户名          #查看共享资源</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba-client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># smbclient //192.168.1.50 / 共享名 -U 用户名       #访问共享资源</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba-client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ls           #查看</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba-client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># get          #下载</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba-client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># push         #上传</span></pre></td></tr></table></figure><h4 id=\"六-samba-user级别访问\"><a class=\"anchor\" href=\"#六-samba-user级别访问\">#</a> 六、Samba user 级别访问</h4>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#1. 修改配置文件</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># egrep -v '^#|^$' /etc/samba/smb.conf</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>global<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tworkgroup <span class=\"token operator\">=</span> SAMBA</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\tsecurity <span class=\"token operator\">=</span> user   <span class=\"token comment\">#user 级别访问 </span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\tpassdb backend <span class=\"token operator\">=</span> tdbsam</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\tprinting <span class=\"token operator\">=</span> cups</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token function\">printcap</span> name <span class=\"token operator\">=</span> cups</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\tload printers <span class=\"token operator\">=</span> <span class=\"token function\">yes</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\tcups options <span class=\"token operator\">=</span> raw</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">[</span>homes<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> Home Directories</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\tvalid <span class=\"token function\">users</span> <span class=\"token operator\">=</span> %S, %D%w%S</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\tbrowseable <span class=\"token operator\">=</span> No</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t<span class=\"token builtin class-name\">read</span> only <span class=\"token operator\">=</span> No</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\tinherit acls <span class=\"token operator\">=</span> Yes</pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">[</span>printers<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> All Printers</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\tpath <span class=\"token operator\">=</span> /var/tmp</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\tprintable <span class=\"token operator\">=</span> Yes</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\tcreate mask <span class=\"token operator\">=</span> 0600</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\tbrowseable <span class=\"token operator\">=</span> No</pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">[</span>print$<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> Printer Drivers</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\tpath <span class=\"token operator\">=</span> /var/lib/samba/drivers</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t<span class=\"token function\">write</span> list <span class=\"token operator\">=</span> @printadmin root</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\tforce group <span class=\"token operator\">=</span> @printadmin</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\tcreate mask <span class=\"token operator\">=</span> 0664</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\tdirectory mask <span class=\"token operator\">=</span> 0775</pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">[</span>cawu_share<span class=\"token punctuation\">]</span>                     </pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> This is caiwu share </pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\tpath <span class=\"token operator\">=</span> /public         <span class=\"token comment\">#共享目录           </span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\tbrowseable <span class=\"token operator\">=</span> <span class=\"token function\">yes</span>       <span class=\"token comment\">#共享是否可以见       </span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\twritable <span class=\"token operator\">=</span> <span class=\"token function\">yes</span>         <span class=\"token comment\">#所有人可写      </span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token function\">write</span> list <span class=\"token operator\">=</span> yangxiao    <span class=\"token comment\">#允许写入该共享的用户</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    valid <span class=\"token function\">users</span> <span class=\"token operator\">=</span> yangxiao   <span class=\"token comment\">#允许访问该共享的用户</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>     </pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl restart smb</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token comment\">#2. 添加 samba 密码，该用户必须已经是系统用户</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir /public</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># useradd -s /sbin/nologin yangxiao</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># smbpasswd -a yangxiao               </span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># testparm            #测试语法</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll -d /public/</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>drwxr-xr-x <span class=\"token number\">2</span> root root <span class=\"token number\">6</span> Jun <span class=\"token number\">25</span> <span class=\"token number\">20</span>:25 /public/</pre></td></tr><tr><td data-num=\"47\"></td><td><pre></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token comment\">#3. 添加 publi 目录系统用户权限\t</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chown yangxiao.yangxiao /public/         </span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll /public/ -d</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>drwxr-xr-x <span class=\"token number\">2</span> yangxiao yangxiao <span class=\"token number\">55</span> Jun <span class=\"token number\">25</span> <span class=\"token number\">20</span>:44 /public/</pre></td></tr></table></figure><ul>\n<li>注释 valid users = yangxiao 后发现用户 weiyixiao 可以访问共享目录，但是无法上传</li>\n<li>注释 valid users = yangxiao，write list = yangxiao 后发现用户 weiyixiao 可以访问共享目录，仍然无法上传，原因 public 目录没有系统的写入权限</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#1. 修改配置文件</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># egrep -v '^#|^$' /etc/samba/smb.conf</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>global<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tworkgroup <span class=\"token operator\">=</span> SAMBA</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\tsecurity <span class=\"token operator\">=</span> user</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\tpassdb backend <span class=\"token operator\">=</span> tdbsam</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\tprinting <span class=\"token operator\">=</span> cups</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token function\">printcap</span> name <span class=\"token operator\">=</span> cups</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\tload printers <span class=\"token operator\">=</span> <span class=\"token function\">yes</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\tcups options <span class=\"token operator\">=</span> raw</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">[</span>homes<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> Home Directories</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\tvalid <span class=\"token function\">users</span> <span class=\"token operator\">=</span> %S, %D%w%S</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\tbrowseable <span class=\"token operator\">=</span> No</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t<span class=\"token builtin class-name\">read</span> only <span class=\"token operator\">=</span> No</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\tinherit acls <span class=\"token operator\">=</span> Yes</pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">[</span>printers<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> All Printers</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\tpath <span class=\"token operator\">=</span> /var/tmp</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\tprintable <span class=\"token operator\">=</span> Yes</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\tcreate mask <span class=\"token operator\">=</span> 0600</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\tbrowseable <span class=\"token operator\">=</span> No</pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">[</span>print$<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> Printer Drivers</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\tpath <span class=\"token operator\">=</span> /var/lib/samba/drivers</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t<span class=\"token function\">write</span> list <span class=\"token operator\">=</span> @printadmin root</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\tforce group <span class=\"token operator\">=</span> @printadmin</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\tcreate mask <span class=\"token operator\">=</span> 0664</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\tdirectory mask <span class=\"token operator\">=</span> 0775</pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">[</span>cawu_share<span class=\"token punctuation\">]</span>                     </pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> This is caiwu share </pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\tpath <span class=\"token operator\">=</span> /public           <span class=\"token comment\">#共享目录  </span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\tbrowseable <span class=\"token operator\">=</span> <span class=\"token function\">yes</span>         <span class=\"token comment\">#共享是否可以见    </span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\twritable <span class=\"token operator\">=</span> <span class=\"token function\">yes</span>           <span class=\"token comment\">#所有人可写  </span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token punctuation\">;</span>   <span class=\"token function\">write</span> list <span class=\"token operator\">=</span> yangxiao  <span class=\"token comment\">#允许写入该共享的用户</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token punctuation\">;</span>   valid <span class=\"token function\">users</span> <span class=\"token operator\">=</span> yangxiao <span class=\"token comment\">#允许访问该共享的用户</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token comment\">#2. 添加用户并授予系统权限</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># useradd -s /sbin/nologin weiyixiao</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># smbpasswd -a weiyixiao            #要给用户添加 samba 密码，该用户必须已经是系统用户</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll /public/ -d</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>drwxr-xr-x <span class=\"token number\">2</span> yangxiao yangxiao <span class=\"token number\">55</span> Jun <span class=\"token number\">25</span> <span class=\"token number\">20</span>:44 /public/</pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chmod 775 /public</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># usermod -a -G yangxiao weiyixiao    #将 weiyixiao 用户添加到 yangxiao 组</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl start smb</span></pre></td></tr></table></figure><h4 id=\"七-添加删除samba用户\"><a class=\"anchor\" href=\"#七-添加删除samba用户\">#</a> 七、添加删除 Samba 用户</h4>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#1. 添加系统用户</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># useradd -s /sbin/nologin test </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">#2. 添加 samba 密码，该用户必须已经是系统用户</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># smbpasswd -a test     </span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">#3. 查看 smb 用户</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># pdbedit -L</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>yangxiao:1003:</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>test:1005:</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>weiyixiao:1004:</pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">#4. 删除 smb 用户</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># smbpasswd -x test</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>Deleted user test.</pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># pdbedit -L</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>yangxiao:1003:</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>weiyixiao:1004:</pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">#5.samba Linux 客户端访问</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># smbclient //192.168.40.188/public -U xuyong   #public 共享名</span></pre></td></tr></table></figure><h4 id=\"八-samba企业实战\"><a class=\"anchor\" href=\"#八-samba企业实战\">#</a> 八、Samba 企业实战</h4>\n<p><img loading=\"lazy\" data-src=\"https://wp-cdn.4ce.cn/v2/G1pGXaJ.png\" alt=\"1.png\" /></p>\n<h5 id=\"81-samba服务器需求\"><a class=\"anchor\" href=\"#81-samba服务器需求\">#</a> 8.1 Samba 服务器需求</h5>\n<ol>\n<li>每位员工有独立的目录，可上传、可读、可写、可删除权限，但目录本身员工不可删除</li>\n<li>每位员工可见公司共享目录 public_share（只读）</li>\n<li>部门内部员工可见部门共享目录_caiwu_share（读写）</li>\n</ol>\n<h5 id=\"82-samba服务安装\"><a class=\"anchor\" href=\"#82-samba服务安装\">#</a> 8.2 Samba 服务安装</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum install samba -y</span></pre></td></tr></table></figure><h5 id=\"83-samba服务配置\"><a class=\"anchor\" href=\"#83-samba服务配置\">#</a> 8.3 Samba 服务配置</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@Harbor public_share<span class=\"token punctuation\">]</span><span class=\"token comment\"># egrep -v '^#|^$' /etc/samba/smb.conf</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>global<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tworkgroup <span class=\"token operator\">=</span> SAMBA</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tsecurity <span class=\"token operator\">=</span> user</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\tpassdb backend <span class=\"token operator\">=</span> tdbsam</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\tprinting <span class=\"token operator\">=</span> cups</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token function\">printcap</span> name <span class=\"token operator\">=</span> cups</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\tload printers <span class=\"token operator\">=</span> <span class=\"token function\">yes</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\tcups options <span class=\"token operator\">=</span> raw</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">[</span>homes<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> Home Directories</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\tvalid <span class=\"token function\">users</span> <span class=\"token operator\">=</span> %S, %D%w%S</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\tbrowseable <span class=\"token operator\">=</span> No</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t<span class=\"token builtin class-name\">read</span> only <span class=\"token operator\">=</span> No</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\tinherit acls <span class=\"token operator\">=</span> Yes</pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">[</span>printers<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> All Printers</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\tpath <span class=\"token operator\">=</span> /var/tmp</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\tprintable <span class=\"token operator\">=</span> Yes</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\tcreate mask <span class=\"token operator\">=</span> 0600</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\tbrowseable <span class=\"token operator\">=</span> No</pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">[</span>print$<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> Printer Drivers</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\tpath <span class=\"token operator\">=</span> /var/lib/samba/drivers</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t<span class=\"token function\">write</span> list <span class=\"token operator\">=</span> @printadmin root</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\tforce group <span class=\"token operator\">=</span> @printadmin</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\tcreate mask <span class=\"token operator\">=</span> 0664</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\tdirectory mask <span class=\"token operator\">=</span> 0775</pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token punctuation\">[</span>public_share<span class=\"token punctuation\">]</span>                          </pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> This is public share  </pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\tpath <span class=\"token operator\">=</span> /samba_share/public_share</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\tbrowseable <span class=\"token operator\">=</span> <span class=\"token function\">yes</span>              </pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\twritable <span class=\"token operator\">=</span> <span class=\"token function\">yes</span>               </pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token punctuation\">[</span>yewu_share<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        comment <span class=\"token operator\">=</span> This is caiwu share</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        path <span class=\"token operator\">=</span> /samba_share/yewu_share</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        browseable <span class=\"token operator\">=</span> <span class=\"token function\">yes</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        writable <span class=\"token operator\">=</span> <span class=\"token function\">yes</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token punctuation\">[</span>caiwu_share<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        comment <span class=\"token operator\">=</span> This is yewu share</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        path <span class=\"token operator\">=</span> /samba_share/caiwu_share</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        browseable <span class=\"token operator\">=</span> <span class=\"token function\">yes</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        writable <span class=\"token operator\">=</span> <span class=\"token function\">yes</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl restart smb</span></pre></td></tr></table></figure><h5 id=\"84-创建共享目录\"><a class=\"anchor\" href=\"#84-创建共享目录\">#</a> 8.4 创建共享目录</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir /samba_share/</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cd /samba_share/</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba samba_share<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir caiwu_share</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba samba_share<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir yewu_share</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba samba_share<span class=\"token punctuation\">]</span><span class=\"token comment\"># public_share</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll -d /samba_share/yewu_share</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>drwxr-xr-x <span class=\"token number\">2</span> root root <span class=\"token number\">6</span> Jun <span class=\"token number\">26</span> <span class=\"token number\">11</span>:27 /samba_share/yewu_share</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll -d /samba_share/caiwu_share/</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>drwxr-xr-x <span class=\"token number\">2</span> root root <span class=\"token number\">6</span> Jun <span class=\"token number\">26</span> <span class=\"token number\">11</span>:26 /samba_share/caiwu_share</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll -d /samba_share/public_share/</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>drwxr-xr-x <span class=\"token number\">2</span> root root <span class=\"token number\">6</span> Jun <span class=\"token number\">26</span> <span class=\"token number\">11</span>:27 /samba_share/public_share</pre></td></tr></table></figure><h5 id=\"85-添加用户并设置smb密码\"><a class=\"anchor\" href=\"#85-添加用户并设置smb密码\">#</a> 8.5 添加用户并设置 smb 密码</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#1. 添加系统用户</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># useradd -s /sbin/nologin wangyuyan</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># useradd -s /sbin/nologin azhu</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># useradd -s /sbin/nologin duanyu</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># useradd -s /sbin/nologin xuzhu</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># useradd -s /sbin/nologin qiaofeng</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#2. 添加 smb 密码</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># smbpasswd -a wangyuyan</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># smbpasswd -a azhu</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># smbpasswd -a duanyu</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># smbpasswd -a xuzhu</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># smbpasswd -a qiaofeng</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">#3. 查看 smb 用户</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># pdbedit -L</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>wangyuyan:1002:</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>duanyu:1004:</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>qiaofeng:1006:</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>azhu:1003:</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>xuzhu:1005:</pre></td></tr></table></figure><h5 id=\"86-为用户添加acl权限\"><a class=\"anchor\" href=\"#86-为用户添加acl权限\">#</a> 8.6 为用户添加 ACL 权限</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#1. 修改目录权限</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chmod 700 /samba_share/public_share</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">#2. 为用户添加 ACL 权限</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#添加 ACL 权限</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># setfacl -m u:qiaofeng:rx /samba_share/public_share</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#3. 查看 ACL 权限</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># getfacl /samba_share/public_share</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>getfacl: Removing leading <span class=\"token string\">'/'</span> from absolute path names</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\"># file: samba_share/public_share</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\"># owner: root</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\"># group: root</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>user::rwx</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>user:qiaofeng:r-x</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>group::---</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>mask::r-x</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>other::---</pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">#4. 删除 ACL 权限</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># setfacl -x u:qiaofeng /samba_share/public_share</span></pre></td></tr></table></figure><h5 id=\"87-为组添加acl权限\"><a class=\"anchor\" href=\"#87-为组添加acl权限\">#</a> 8.7 为组添加 ACL 权限</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#1. 新建组并加入用户</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># groupadd caiwu</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># groupadd yewu</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># usermod -a -G caiwu wangyuyan</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># usermod -a -G caiwu azhu</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># usermod -a -G yewu duanyu</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># usermod -a -G yewu xuzhu</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">#从组中移除用户</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># gpasswd -d duanyu caiwu</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># gpasswd -d xuzhu caiwu</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">#2. 修改目录权限</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chmod 700 /samba_share/yewu_share</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chmod 700 /samba_share/caiwu_share</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">#3. 为组设定 ACL 权限</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># setfacl -m g:caiwu:rwx /samba_share/caiwu_share</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># setfacl -m g:caiwu:rx /samba_share/public_share</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># setfacl -m g:yewu:rwx /samba_share/yewu_share</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># setfacl -m g:yewu:rx /samba_share/public_share</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">#4. 查看 ACL 权限</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># getfacl /samba_share/yewu_share</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>getfacl: Removing leading <span class=\"token string\">'/'</span> from absolute path names</pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token comment\"># file: samba_share/yewu_share</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token comment\"># owner: root</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token comment\"># group: root</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>user::rwx</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>group::---</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>group:yewu:rwx</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>mask::rwx</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>other::---</pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># getfacl /samba_share/caiwu_share</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>getfacl: Removing leading <span class=\"token string\">'/'</span> from absolute path names</pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token comment\"># file: samba_share/caiwu_share</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token comment\"># owner: root</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token comment\"># group: root</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>user::rwx</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>group::---</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>group:caiwu:rwx</pre></td></tr><tr><td data-num=\"44\"></td><td><pre>mask::rwx</pre></td></tr><tr><td data-num=\"45\"></td><td><pre>other::---</pre></td></tr><tr><td data-num=\"46\"></td><td><pre></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># getfacl /samba_share/public_share</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>getfacl: Removing leading <span class=\"token string\">'/'</span> from absolute path names</pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token comment\"># file: samba_share/public_share</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token comment\"># owner: root</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token comment\"># group: root</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>user::rwx</pre></td></tr><tr><td data-num=\"53\"></td><td><pre>user:qiaofeng:r-x</pre></td></tr><tr><td data-num=\"54\"></td><td><pre>group::---</pre></td></tr><tr><td data-num=\"55\"></td><td><pre>group:caiwu:r-x</pre></td></tr><tr><td data-num=\"56\"></td><td><pre>group:yewu:r-x</pre></td></tr><tr><td data-num=\"57\"></td><td><pre>mask::r-x</pre></td></tr><tr><td data-num=\"58\"></td><td><pre>other::---</pre></td></tr><tr><td data-num=\"59\"></td><td><pre></pre></td></tr><tr><td data-num=\"60\"></td><td><pre><span class=\"token comment\">#5. 删除 ACL 权限</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># setfacl -x g:caiwu /samba_share/caiwu_share</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># setfacl -x g:yewu /samba_share/yewu_share</span></pre></td></tr></table></figure><h4 id=\"九-samba挂载及别名\"><a class=\"anchor\" href=\"#九-samba挂载及别名\">#</a> 九、Samba 挂载及别名</h4>\n<h5 id=\"91-samba挂载\"><a class=\"anchor\" href=\"#91-samba挂载\">#</a> 9.1 Samba 挂载</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#public_share 为共享名非共享目录</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mount -t cifs -o username=wangyuyan //192.168.1.50/public_share /mnt   </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">#配置自动挂载</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># echo \"//192.168.1.50/public_share /mnt cifs defaults,username=wangyuyan,passwd=123456 1 2\" >> /etc/fstab</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mount -a</span></pre></td></tr></table></figure><h5 id=\"92-samba别名\"><a class=\"anchor\" href=\"#92-samba别名\">#</a> 9.2 Samba 别名</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#1. 开启 smb 别名</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim /etc/samba/smb.conf</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>global<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        workgroup <span class=\"token operator\">=</span> workgroup</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        security <span class=\"token operator\">=</span> user</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        username map <span class=\"token operator\">=</span> /etc/samba/smbusers      <span class=\"token comment\">#添加此行配置</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">#2. 配置 smb 别名</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim /etc/samba/smbusers</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>wangyuyan <span class=\"token operator\">=</span>  zhangsan lisi <span class=\"token comment\">#别名用户 zhangsan、lisi 登录后用于 wangyuyan 权限，权限及密码均一样</span></pre></td></tr></table></figure>",
            "tags": [
                "Samba"
            ]
        },
        {
            "id": "http://ixuyong.cn/posts/2889248111.html",
            "url": "http://ixuyong.cn/posts/2889248111.html",
            "title": "Vsftp服务实践",
            "date_published": "2025-06-20T14:12:00.000Z",
            "content_html": "<h3 id=\"vsftp服务实践\"><a class=\"anchor\" href=\"#vsftp服务实践\">#</a> Vsftp 服务实践</h3>\n<h4 id=\"一-vsftp-概述\"><a class=\"anchor\" href=\"#一-vsftp-概述\">#</a> 一、VSFTP 概述</h4>\n<p>FTP 是 File Transfer Protocol（文件传输协议）的英文简称，用于 Internet 上的文件的双向传输。使用 FTP 来传输时，是具有一定程度的危险性， 因为数据在因特网上面是完全没有受到保护的明文传输方式。</p>\n<p>VSFTP 是一个基于 GPL 发布的类 Unix 系统上使用的 FTP 服务器软件，它的全称是 Very Secure FTP，从名称定义上基本可以看出，这是为了解决 ftp 传输安全性问题的。</p>\n<h4 id=\"二-vsftp-工作模式\"><a class=\"anchor\" href=\"#二-vsftp-工作模式\">#</a> 二、VSFTP 工作模式</h4>\n<h5 id=\"21-port模式\"><a class=\"anchor\" href=\"#21-port模式\">#</a> 2.1 Port 模式</h5>\n<p>FTP 客户端首先和服务器的 TCP 21 端口建立连接，用来发送命令，客户端需要接收数据的时候在这个通道上发送 PORT 命令。PORT 命令包含了客户端用什么端口接收数据。在传送数据的时候，服务器端通过自己的 TCP 20 端口连接至客户端的指定端口发送数据。FTP server 必须和客户端建立一个新的连接用来传送数据。</p>\n<p><img loading=\"lazy\" data-src=\"https://wp-cdn.4ce.cn/v2/YAl4LqQ.jpeg\" alt=\"1.jpg\" /></p>\n<h5 id=\"22-passive模式\"><a class=\"anchor\" href=\"#22-passive模式\">#</a> 2.2 Passive 模式</h5>\n<p>FTP 客户端首先和服务器的 TCP 21 端口建立连接，用来建立控制通道发送命令，但建立连接后客户端发送 Pasv 命令。服务器收到 Pasv 命令后，打开一个临时端口（端口大于 1023 小于 65535）并且通知客户端在这个端口上传送数据的请求，客户端连接 FTP 服务器的临时端口，然后 FTP 服务器将通过这个端口传输数据。</p>\n<p><img loading=\"lazy\" data-src=\"https://wp-cdn.4ce.cn/v2/7mKqSbg.jpeg\" alt=\"2.jpg\" /></p>\n<h4 id=\"三-vsftp部署\"><a class=\"anchor\" href=\"#三-vsftp部署\">#</a> 三、VSFTP 部署</h4>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#1. 安装 vsftp</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum install vsftpd -y</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl start vsftpd &amp;&amp; systemctl enable vsftpd</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#2.vsftp 相关文件</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll /etc/vsftpd/</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>-rw------- <span class=\"token number\">1</span> root root  <span class=\"token number\">125</span> Jun <span class=\"token number\">10</span>  <span class=\"token number\">2021</span> ftpusers       <span class=\"token comment\">#黑名单</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>-rw------- <span class=\"token number\">1</span> root root  <span class=\"token number\">361</span> Jun <span class=\"token number\">10</span>  <span class=\"token number\">2021</span> user_list      <span class=\"token comment\">#默认为黑名单，如将 userlist_deny=NO 则为白名单</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>-rw------- <span class=\"token number\">1</span> root root <span class=\"token number\">5116</span> Jun <span class=\"token number\">10</span>  <span class=\"token number\">2021</span> vsftpd.conf    <span class=\"token comment\">#主配置文件</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>-rwxr--r-- <span class=\"token number\">1</span> root root  <span class=\"token number\">338</span> Jun <span class=\"token number\">10</span>  <span class=\"token number\">2021</span> vsftpd_conf_migrate.sh</pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">#3. 验证 vsftp 明文传输，tcpdump 抓包可以看到密码</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># useradd xuyong</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># echo \"123456\" | passwd --stdin xuyong</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># tcpdump -i eth0 -nnX port 21</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token number\">15</span>:05:40.187871 IP <span class=\"token number\">192.168</span>.40.1.54319 <span class=\"token operator\">></span> <span class=\"token number\">192.168</span>.40.50.21: Flags <span class=\"token punctuation\">[</span>P.<span class=\"token punctuation\">]</span>, <span class=\"token function\">seq</span> <span class=\"token number\">1</span>:14, ack <span class=\"token number\">21</span>, win <span class=\"token number\">1023</span>, length <span class=\"token number\">13</span>: FTP: <span class=\"token environment constant\">USER</span> xuyong  <span class=\"token comment\">#用户名</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t0x0000:  <span class=\"token number\">4500</span> 0035 36d8 <span class=\"token number\">4000</span> <span class=\"token number\">8006</span> f266 c0a8 <span class=\"token number\">2801</span>  E<span class=\"token punctuation\">..</span><span class=\"token number\">56</span>.@<span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span>f<span class=\"token punctuation\">..</span><span class=\"token punctuation\">(</span>.</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t0x0010:  c0a8 <span class=\"token number\">2832</span> d42f 0015 b46e 2af8 bd8d d6ef  <span class=\"token punctuation\">..</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span>./<span class=\"token punctuation\">..</span>.n*<span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t0x0020:  <span class=\"token number\">5018</span> 03ff <span class=\"token number\">8100</span> 0000 <span class=\"token number\">5553</span> <span class=\"token number\">4552</span> <span class=\"token number\">2078</span> <span class=\"token number\">7579</span>  P<span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span>.<span class=\"token environment constant\">USER</span>.xuy</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t0x0030:  6f6e 670d 0a                             ong<span class=\"token punctuation\">..</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token number\">15</span>:05:40.188149 IP <span class=\"token number\">192.168</span>.40.1.54319 <span class=\"token operator\">></span> <span class=\"token number\">192.168</span>.40.50.21: Flags <span class=\"token punctuation\">[</span>P.<span class=\"token punctuation\">]</span>, <span class=\"token function\">seq</span> <span class=\"token number\">14</span>:27, ack <span class=\"token number\">55</span>, win <span class=\"token number\">1023</span>, length <span class=\"token number\">13</span>: FTP: PASS <span class=\"token number\">123456</span>  <span class=\"token comment\">#密码</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t0x0000:  <span class=\"token number\">4500</span> 0035 36db <span class=\"token number\">4000</span> <span class=\"token number\">8006</span> f263 c0a8 <span class=\"token number\">2801</span>  E<span class=\"token punctuation\">..</span><span class=\"token number\">56</span>.@<span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span>c<span class=\"token punctuation\">..</span><span class=\"token punctuation\">(</span>.</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t0x0010:  c0a8 <span class=\"token number\">2832</span> d42f 0015 b46e 2b05 bd8d d711  <span class=\"token punctuation\">..</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span>./<span class=\"token punctuation\">..</span>.n+<span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t0x0020:  <span class=\"token number\">5018</span> 03ff 27a9 0000 <span class=\"token number\">5041</span> <span class=\"token number\">5353</span> <span class=\"token number\">2031</span> <span class=\"token number\">3233</span>  P<span class=\"token punctuation\">..</span>.'<span class=\"token punctuation\">..</span>.PASS.123</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t0x0030:  <span class=\"token number\">3435</span> 360d 0a                             <span class=\"token number\">456</span><span class=\"token punctuation\">..</span></pre></td></tr></table></figure><h4 id=\"四-登录验证方式\"><a class=\"anchor\" href=\"#四-登录验证方式\">#</a> 四、登录验证方式</h4>\n<p><strong>1. 匿名用户验证：</strong></p>\n<ul>\n<li>用户账号名称：ftp 或 anonymous</li>\n<li>用户账号密码：无密码</li>\n<li>工作目录：/var/ftp</li>\n<li>默认权限：默认可下载不可上传，上传权限由两部分组成（主配置文件和文件系统）</li>\n</ul>\n<p><strong>2. 本地用户验证：</strong></p>\n<ul>\n<li>用户账号名称：本地用户（/etc/passwd）</li>\n<li>用户账号密码：用户密码（/etc/shadow）</li>\n<li>工作目录：登录用户的家目录</li>\n<li>权限：最大权限（drwx------）</li>\n</ul>\n<p><strong>3. 虚拟（virtual）用户验证：</strong></p>\n<ul>\n<li>创建虚拟用户用来代替本地用户，减少本地用户曝光率</li>\n<li>使用本地用户作为虚拟用户的映射用户，为虚拟用户提供工作目录和权限控制</li>\n<li>能够设置严格的权限（为每一个用户生成单独的配置文件）</li>\n</ul>\n<h4 id=\"五-vsftp配置文件详解\"><a class=\"anchor\" href=\"#五-vsftp配置文件详解\">#</a> 五、VSFTP 配置文件详解</h4>\n<h5 id=\"51-vsftp默认配置文件\"><a class=\"anchor\" href=\"#51-vsftp默认配置文件\">#</a> 5.1 VSFTP 默认配置文件</h5>\n<ul>\n<li>允许匿名用户和本地用户登陆。anonymous_enable=YES 、local_enable=YES</li>\n<li>匿名用户使用的登陆名为 ftp 或 anonymous，口令为空；匿名用户不能离开匿名用户家目录 /var/ftp，且只能下载不能上传。</li>\n<li>本地用户的登录名为本地用户名，口令为此本地用户的口令；本地用户可以在自 己家目录中进行读写操作；本地用户可以离开自家目录切换至有权限访问的其他目录，并在权限允许的情况下进行上传 / 下载。write_enable=YES</li>\n<li>写在文件 /etc/vsftpd.ftpusers 中的本地用户禁止登陆。</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#  egrep -v \"^#|^$\" /etc/vsftpd/vsftpd.conf </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token assign-left variable\">anonymous_enable</span><span class=\"token operator\">=</span>YES         <span class=\"token comment\">#允许匿名用户登录</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token assign-left variable\">local_enable</span><span class=\"token operator\">=</span>YES             <span class=\"token comment\">#允许本地用户登录</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">write_enable</span><span class=\"token operator\">=</span>YES             <span class=\"token comment\">#允许本地用户上传</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token assign-left variable\">local_umask</span><span class=\"token operator\">=</span>022              <span class=\"token comment\">#umask 权限，上传默认文件权限 644，默认目录权限 755</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token assign-left variable\">dirmessage_enable</span><span class=\"token operator\">=</span>YES        <span class=\"token comment\">#用户进入目录时，显示 message 文件中信息</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token assign-left variable\">xferlog_enable</span><span class=\"token operator\">=</span>YES           <span class=\"token comment\">#激活记录日志</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token assign-left variable\">connect_from_port_20</span><span class=\"token operator\">=</span>YES     <span class=\"token comment\">#主动模式数据传输端口</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token assign-left variable\">xferlog_std_format</span><span class=\"token operator\">=</span>YES       <span class=\"token comment\">#使用标准的 ftp 日志格式</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token assign-left variable\">listen</span><span class=\"token operator\">=</span>NO\t\t\t\t\t <span class=\"token comment\">#允许被监听</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token assign-left variable\">listen_ipv6</span><span class=\"token operator\">=</span>YES              <span class=\"token comment\">#允许被监听</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token assign-left variable\">pam_service_name</span><span class=\"token operator\">=</span>vsftpd      <span class=\"token comment\">#开启 pam 认证</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token assign-left variable\">userlist_enable</span><span class=\"token operator\">=</span>YES          <span class=\"token comment\">#用户登入限制</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token assign-left variable\">tcp_wrappers</span><span class=\"token operator\">=</span>YES             <span class=\"token comment\">#主机访问控制模式</span></pre></td></tr></table></figure><h5 id=\"52-常用全局配置\"><a class=\"anchor\" href=\"#52-常用全局配置\">#</a> 5.2 常用全局配置</h5>\n<h6 id=\"521-匿名用户anonymous设置\"><a class=\"anchor\" href=\"#521-匿名用户anonymous设置\">#</a> 5.2.1 匿名用户（anonymous）设置</h6>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">anonymous_enable</span><span class=\"token operator\">=</span>YES         </pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#控制是否允许匿名用户登入，YES 为允许匿名登入，NO 为不允许。默认值为 YES。</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">write_enable</span><span class=\"token operator\">=</span>YES             </pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#是否允许登陆用户有写权限。属于全局设置，默认值为 YES。</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token assign-left variable\">no_anon_password</span><span class=\"token operator\">=</span>NO          </pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#若是启动这项功能，则使用匿名登入时，不会询问密码。默认值为 NO。</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token assign-left variable\">ftp_username</span><span class=\"token operator\">=</span>ftp             </pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">#定义匿名登入的使用者名称。默认值为 ftp。</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token assign-left variable\">anon_root</span><span class=\"token operator\">=</span>/var/ftp          </pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">#使用匿名登入时，所登入的目录。默认值为 /var/ftp。注意 ftp 目录不能是 777 的权限属性，即匿名用户的家目录不能有 777 的权限。</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token assign-left variable\">anon_upload_enable</span><span class=\"token operator\">=</span>NO        </pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">#如果设为 YES，则允许匿名登入者有上传文件（非目录）的权限，只有在 write_enable=YES 时，此项才有效。当然，匿名用户必须要有对上层目录的写入权。默认值为 NO。</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token assign-left variable\">anon_world_readable_only</span><span class=\"token operator\">=</span>YES </pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">#如果设为 YES，则允许匿名登入者下载可阅读的档案（可以下载到本机阅读，不能直接在 FTP 服务器中打开阅读）。默认值为 YES。</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token assign-left variable\">anon_mkdir_write_enable</span><span class=\"token operator\">=</span>NO   </pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">#如果设为 YES，则允许匿名登入者有新增目录的权限，只有在 write_enable=YES 时，此项才有效。当然，匿名用户必须要有对上层目录的写入权。默认值为 NO。</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token assign-left variable\">anon_other_write_enable</span><span class=\"token operator\">=</span>NO   </pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token comment\">#如果设为 YES，则允许匿名登入者更多于上传或者建立目录之外的权限，譬如删除或者重命名。（如果 anon_upload_enable=NO，则匿名用户不能上传文件，但可以删除或者重命名已经存在的文件；如果 anon_mkdir_write_enable=NO，则匿名用户不能上传或者新建文件夹，但可以删除或者重命名已经存在的文件夹。）默认值为 NO。</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token assign-left variable\">chown_uploads</span><span class=\"token operator\">=</span>NO            </pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token comment\">#设置是否改变匿名用户上传文件（非目录）的属主。默认值为 NO。</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token assign-left variable\">chown_username</span><span class=\"token operator\">=</span>username     </pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token comment\">#设置匿名用户上传文件（非目录）的属主名。建议不要设置为 root。</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token assign-left variable\">anon_umask</span><span class=\"token operator\">=</span>077             </pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token comment\">#设置匿名登入者新增或上传档案时的 umask 值。默认值为 077，则新建档案的对应权限为 700。</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token assign-left variable\">deny_email_enable</span><span class=\"token operator\">=</span>NO        </pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token comment\">#若是启动这项功能，则必须提供一个档案 /etc/vsftpd/banner_emails，内容为 email address。若是使用匿名登入，则会要求输入 email address，若输入的 email address 在此档案内，则不允许进入。默认值为 NO。</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token assign-left variable\">banned_email_file</span><span class=\"token operator\">=</span>/etc/vsftpd/banner_emails</pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token comment\">#此文件用来输入 email address，只有在 deny_email_enable=YES 时，才会使用到此档案。若是使用匿名登入，则会要求输入 email address，若输入的 email address 在此档案内，则不允许进入。</span></pre></td></tr></table></figure><h6 id=\"522-本地用户设置\"><a class=\"anchor\" href=\"#522-本地用户设置\">#</a> 5.2.2 本地用户设置</h6>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">local_enable</span><span class=\"token operator\">=</span>YES/NO（YES）</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#控制是否允许本地用户登入，YES 为允许本地用户登入，NO 为不允许。默认值为 YES。</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">local_root</span><span class=\"token operator\">=</span>/home/username</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#当本地用户登入时，将被更换到定义的目录下。默认值为各用户的家目录。</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token assign-left variable\">write_enable</span><span class=\"token operator\">=</span>YES/NO（YES）</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#是否允许登陆用户有写权限。属于全局设置，默认值为 YES。</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token assign-left variable\">local_umask</span><span class=\"token operator\">=</span>022</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">#本地用户新增档案时的 umask 值。默认值为 077。</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token assign-left variable\">file_open_mode</span><span class=\"token operator\">=</span>0755</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">#本地用户上传档案后的档案权限，与 chmod 所使用的数值相同。默认值为 0666。</span></pre></td></tr></table></figure><h6 id=\"523-欢迎语设置\"><a class=\"anchor\" href=\"#523-欢迎语设置\">#</a> 5.2.3 欢迎语设置</h6>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">dirmessage_enable</span><span class=\"token operator\">=</span>YES/NO（YES）</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#如果启动这个选项，那么使用者第一次进入一个目录时，会检查该目录下是否有.message 这个档案，如果有，则会出现此档案的内容，通常这个档案会放置欢迎话语，或是对该目录的说明。默认值为开启。</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">message_file</span><span class=\"token operator\">=</span>.message</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#设置目录消息文件，可将要显示的信息写入该文件。默认值为.message。</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token assign-left variable\">banner_file</span><span class=\"token operator\">=</span>/etc/vsftpd/banner</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#当使用者登入时，会显示此设定所在的档案内容，通常为欢迎话语或是说明。默认值为无。如果欢迎信息较多，则使用该配置项。</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token assign-left variable\">ftpd_banner</span><span class=\"token operator\">=</span>Welcome to BOB's FTP server</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">#这里用来定义欢迎话语的字符串，banner_file 是档案的形式，而 ftpd_banner 则是字符串的形式。预设为无。</span></pre></td></tr></table></figure><h6 id=\"524-控制用户是否允许切换到上级目录\"><a class=\"anchor\" href=\"#524-控制用户是否允许切换到上级目录\">#</a> 5.2.4 控制用户是否允许切换到上级目录</h6>\n<p>在默认配置下，本地用户登入 FTP 后可以使用 cd 命令切换到其他目录，这样会对系统带来安全隐患。可以通过以下三条配置文件来控制用户切换目录。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">chroot_list_enable</span><span class=\"token operator\">=</span>NO                     <span class=\"token comment\">#设置是否启用 chroot_list_file 配置项指定的用户列表文件。默认值为 NO</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token assign-left variable\">chroot_list_file</span><span class=\"token operator\">=</span>/etc/vsftpd.chroot_list  <span class=\"token comment\">#用于指定用户列表文件，该文件用于控制哪些用户可以切换到用户家目录的上级目录</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token assign-left variable\">chroot_local_user</span><span class=\"token operator\">=</span>NO                      <span class=\"token comment\">#用于指定用户列表文件中的用户是否允许切换到上级目录。默认值为 NO</span></pre></td></tr></table></figure><p>通过搭配能实现以下几种效果：</p>\n<ul>\n<li>当 chroot_list_enable=YES，chroot_local_user=YES 时，在 /etc/vsftpd.chroot_list 文件中列出的用户，可以切换到其他目录；未在文件中列出的用户，不能切换到其他目录。</li>\n<li>当 chroot_list_enable=YES，chroot_local_user=NO 时，在 /etc/vsftpd.chroot_list 文件中列出的用户，不能切换到其他目录；未在文件中列出的用户，可以切换到其他目录。</li>\n<li>当 chroot_list_enable=NO，chroot_local_user=YES 时，所有的用户均不能切换到其他目录。</li>\n<li>当 chroot_list_enable=NO，chroot_local_user=NO 时，所有的用户均可以切换到其他目录。</li>\n</ul>\n<h6 id=\"525-数据传输模式设置\"><a class=\"anchor\" href=\"#525-数据传输模式设置\">#</a> 5.2.5 数据传输模式设置</h6>\n<p>FTP 在传输数据时，可以使用二进制方式，也可以使用 ASCII 模式来上传或下载数据。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">ascii_upload_enable</span><span class=\"token operator\">=</span>YES/NO（NO）</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#设置是否启用 ASCII 模式上传数据。默认值为 NO。</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">ascii_download_enable</span><span class=\"token operator\">=</span>YES/NO（NO）</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#设置是否启用 ASCII 模式下载数据。默认值为 NO。</span></pre></td></tr></table></figure><h6 id=\"526-访问控制设置\"><a class=\"anchor\" href=\"#526-访问控制设置\">#</a> 5.2.6 访问控制设置</h6>\n<p>两种控制方式：一种控制主机访问，另一种控制用户访问。</p>\n<p>1、控制主机访问：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">tcp_wrappers</span><span class=\"token operator\">=</span>YES/NO（YES）</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#设置 vsftpd 是否与 tcp wrapper 相结合来进行主机的访问控制。默认值为 YES。如果启用，则 vsftpd 服务器会检查 /etc/hosts.allow 和 /etc/hosts.deny 中的设置，来决定请求连接的主机，是否允许访问该 FTP 服务器。这两个文件可以起到简易的防火墙功能。比如：若要仅允许 192.168.0.1—192.168.0.254 的用户可以连接 FTP 服务器，则在 /etc/hosts.allow 文件中添加以下内容：</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>vsftpd:192.168.0. :allow</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>all:all :deny</pre></td></tr></table></figure><p>2、控制用户访问</p>\n<p>对于用户的访问控制可以通过 /etc 目录下的 vsftpd.user_list 和 ftpusers 文件来实现。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">userlist_file</span><span class=\"token operator\">=</span>/etc/vsftpd.user_list</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#控制用户访问 FTP 的文件，里面写着用户名称。一个用户名称一行。</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">userlist_enable</span><span class=\"token operator\">=</span>YES/NO（NO）</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#是否启用 vsftpd.user_list 文件。</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token assign-left variable\">userlist_deny</span><span class=\"token operator\">=</span>YES/NO（YES）</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#决定 vsftpd.user_list 文件中的用户是否能够访问 FTP 服务器。若设置为 YES，则 vsftpd.user_list 文件中的用户不允许访问 FTP，若设置为 NO，则只有 vsftpd.user_list 文件中的用户才能访问 FTP。/etc/vsftpd/ftpusers 文件专门用于定义不允许访问 FTP 服务器的用户列表（注意：如果 userlist_enable=YES,userlist_deny=NO, 此时如果在 vsftpd.user_list 和 ftpusers 中都有某个用户时，那么这个用户是不能够访问 FTP 的，即 ftpusers 的优先级要高）。默认情况下 vsftpd.user_list 和 ftpusers，这两个文件已经预设置了一些不允许访问 FTP 服务器的系统内部账户。如果系统没有这两个文件，那么新建这两个文件，将用户添加进去即可。</span></pre></td></tr></table></figure><h6 id=\"527-访问速率设置\"><a class=\"anchor\" href=\"#527-访问速率设置\">#</a> 5.2.7 访问速率设置</h6>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">anon_max_rate</span><span class=\"token operator\">=</span><span class=\"token number\">0</span>                   <span class=\"token comment\">#设置匿名登入者使用的最大传输速度，单位为 B/s，0 表示不限制速度。默认值为 0</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token assign-left variable\">local_max_rate</span><span class=\"token operator\">=</span><span class=\"token number\">0</span>                  <span class=\"token comment\">#本地用户使用的最大传输速度，单位为 B/s，0 表示不限制速度。预设值为 0。</span></pre></td></tr></table></figure><h6 id=\"528-超时时间设置\"><a class=\"anchor\" href=\"#528-超时时间设置\">#</a> 5.2.8 超时时间设置</h6>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">accept_timeout</span><span class=\"token operator\">=</span><span class=\"token number\">60</span>                 <span class=\"token comment\">#被动模式设置建立 FTP 连接的超时时间，单位为秒。默认值为 60</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token assign-left variable\">connect_timeout</span><span class=\"token operator\">=</span><span class=\"token number\">60</span>                <span class=\"token comment\">#PORT 主动模式下建立数据连接的超时时间，单位为秒。默认值为 60</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token assign-left variable\">data_connection_timeout</span><span class=\"token operator\">=</span><span class=\"token number\">120</span>       <span class=\"token comment\">#设置建立 FTP 数据连接的超时时间，单位为秒。默认值为 120</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">idle_session_timeout</span><span class=\"token operator\">=</span><span class=\"token number\">300</span>          <span class=\"token comment\">#设置多长时间不对 FTP 服务器进行任何操作，则断开该 FTP 连接，默认值为 300 秒</span></pre></td></tr></table></figure><h6 id=\"529-日志文件设置\"><a class=\"anchor\" href=\"#529-日志文件设置\">#</a> 5.2.9 日志文件设置</h6>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">xferlog_enable</span><span class=\"token operator\">=</span> YES/NO（YES）</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#是否启用上传 / 下载日志记录。如果启用，则上传与下载的信息将被完整纪录在 xferlog_file 所定义的档案中。预设为开启。</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">xferlog_file</span><span class=\"token operator\">=</span>/var/log/vsftpd.log</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#设置日志文件名和路径，默认值为 /var/log/vsftpd.log。</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token assign-left variable\">xferlog_std_format</span><span class=\"token operator\">=</span>YES/NO（NO）</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#如果启用，则日志文件将会写成 xferlog 的标准格式，如同 wu-ftpd 一般。默认值为关闭。</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token assign-left variable\">log_ftp_protocol</span><span class=\"token operator\">=</span>YES<span class=\"token operator\">|</span>NO（NO）</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">#如果启用此选项，所有的 FTP 请求和响应都会被记录到日志中，默认日志文件在 /var/log/vsftpd.log。启用此选项时，xferlog_std_format 不能被激活。这个选项有助于调试。默认值为 NO。</span></pre></td></tr></table></figure><h6 id=\"5210-ftp工作模式与端口设置\"><a class=\"anchor\" href=\"#5210-ftp工作模式与端口设置\">#</a> 5.2.10 FTP 工作模式与端口设置</h6>\n<p>FTP 有两种工作方式：PORT FTP（主动模式）和 PASV FTP（被动模式）</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">listen_port</span><span class=\"token operator\">=</span><span class=\"token number\">21</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#设置 FTP 服务器建立连接所监听的端口，默认值为 21。</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">connect_from_port_20</span><span class=\"token operator\">=</span>YES/NO</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#指定 FTP 使用 20 端口进行数据传输，默认值为 YES。</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token assign-left variable\">ftp_data_port</span><span class=\"token operator\">=</span><span class=\"token number\">20</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#设置在 PORT 方式下，FTP 数据连接使用的端口，默认值为 20。</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token assign-left variable\">pasv_enable</span><span class=\"token operator\">=</span>YES/NO（YES）</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">#若设置为 YES，则使用 PASV 被动模式；若设置为 NO，则使用 PORT 模式。默认值为 YES，即使用 PASV 被动模式。</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token assign-left variable\">pasv_max_port</span><span class=\"token operator\">=</span><span class=\"token number\">24800</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">#在 PASV 工作模式下，数据连接可以使用的端口范围的最大端口，0 表示任意端口。默认值为 0。</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token assign-left variable\">pasv_min_port</span><span class=\"token operator\">=</span><span class=\"token number\">24500</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">#在 PASV 工作模式下，数据连接可以使用的端口范围的最小端口，0 表示任意端口。默认值为 0。</span></pre></td></tr></table></figure><h6 id=\"5211-与连接相关的设置\"><a class=\"anchor\" href=\"#5211-与连接相关的设置\">#</a> 5.2.11 与连接相关的设置</h6>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">listen</span><span class=\"token operator\">=</span>YES/NO（YES）</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#设置 vsftpd 服务器是否以 standalone 模式运行。以 standalone 模式运行是一种较好的方式，此时 listen 必须设置为 YES，此为默认值。建议不要更改，有很多与服务器运行相关的配置命令，需要在此模式下才有效。若设置为 NO，则 vsftpd 不是以独立的服务运行，要受到 xinetd 服务的管控，功能上会受到限制。</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">max_clients</span><span class=\"token operator\">=</span><span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#设置 vsftpd 允许的最大连接数，默认值为 0，表示不受限制。若设置为 100 时，则同时允许有 100 连接，超出的将被拒绝。只有在 standalone 模式运行才有效。</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token assign-left variable\">max_per_ip</span><span class=\"token operator\">=</span><span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#设置每个 IP 允许与 FTP 服务器同时建立连接的数目。默认值为 0，表示不受限制。只有在 standalone 模式运行才有效。</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token assign-left variable\">listen_address</span><span class=\"token operator\">=</span>IP 地址</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">#设置 FTP 服务器在指定的 IP 地址上侦听用户的 FTP 请求。若不设置，则对服务器绑定的所有 IP 地址进行侦听。只有在 standalone 模式运行才有效。</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token assign-left variable\">setproctitle_enable</span><span class=\"token operator\">=</span>YES/NO（NO）</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">#设置每个与 FTP 服务器的连接，是否以不同的进程表现出来。默认值为 NO，此时使用 ps aux |grep ftp 只会有一个 vsftpd 的进程。若设置为 YES，则每个连接都会有一个 vsftpd 的进程。</span></pre></td></tr></table></figure><h6 id=\"5212-虚拟用户设置\"><a class=\"anchor\" href=\"#5212-虚拟用户设置\">#</a> 5.2.12 虚拟用户设置</h6>\n<p>虚拟用户使用 PAM 认证方式。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">pam_service_name</span><span class=\"token operator\">=</span>vsftpd</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#设置 PAM 使用的名称，默认值为 /etc/pam.d/vsftpd。</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">guest_enable</span><span class=\"token operator\">=</span> YES/NO（NO）</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#启用虚拟用户。默认值为 NO。</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token assign-left variable\">guest_username</span><span class=\"token operator\">=</span>ftp</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#这里用来映射虚拟用户。默认值为 ftp。</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token assign-left variable\">virtual_use_local_privs</span><span class=\"token operator\">=</span>YES/NO（NO）</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">#当该参数激活（YES）时，虚拟用户使用与本地用户相同的权限。当此参数关闭（NO）时，虚拟用户使用与匿名用户相同的权限。默认情况下此参数是关闭的（NO）。</span></pre></td></tr></table></figure><h6 id=\"5213-定义用户配置文件\"><a class=\"anchor\" href=\"#5213-定义用户配置文件\">#</a> 5.2.13 定义用户配置文件</h6>\n<p>在 vsftpd 中，可以通过定义用户配置文件来实现不同的用户使用不同的配置。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">user_config_dir</span><span class=\"token operator\">=</span>/etc/vsftpd/userconf</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#设置用户配置文件所在的目录。当设置了该配置项后，用户登陆服务器后，系统就会到 /etc/vsftpd/userconf 目录下，读取与当前用户名相同的文件，并根据文件中的配置命令，对当前用户进行更进一步的配置。</span></pre></td></tr></table></figure><p><em>例如：定义 user_config_dir=/etc/vsftpd/userconf，且主机上有使用者 test1,test2，那么我们就在 user_config_dir 的目录新增文件名为 test1 和 test2 两个文件。若是 test1 登入，则会读取 user_config_dir 下的 test1 这个档案内的设定。默认值为无。利用用户配置文件，可以实现对不同用户进行访问速度的控制，在各用户配置文件中定义 local_max_rate=XX，即可。</em></p>\n<h4 id=\"六-vsftp匿名用户访问\"><a class=\"anchor\" href=\"#六-vsftp匿名用户访问\">#</a> 六、VSFTP 匿名用户访问</h4>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#1. 注释中带 * 为修改项或增加项 </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># egrep -v \"^#|^$\" /etc/vsftpd/vsftpd.conf </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token assign-left variable\">anonymous_enable</span><span class=\"token operator\">=</span>YES         <span class=\"token comment\">#允许匿名用户登录       ***</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">local_enable</span><span class=\"token operator\">=</span>YES             <span class=\"token comment\">#允许本地用户登录</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token assign-left variable\">write_enable</span><span class=\"token operator\">=</span>YES             <span class=\"token comment\">#允许本地用户上传</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token assign-left variable\">local_umask</span><span class=\"token operator\">=</span>022              <span class=\"token comment\">#umask 权限，上传文件权限默认 644，目录 755</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token assign-left variable\">anon_upload_enable</span><span class=\"token operator\">=</span>YES       <span class=\"token comment\">#允许匿名用户上传       ***</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token assign-left variable\">anon_mkdir_write_enable</span><span class=\"token operator\">=</span>YES  <span class=\"token comment\">#允许匿名用户新建目录   ***</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token assign-left variable\">anon_other_write_enable</span><span class=\"token operator\">=</span>YES  <span class=\"token comment\">#允许匿名用户删除或上传 ***</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token assign-left variable\">dirmessage_enable</span><span class=\"token operator\">=</span>YES        <span class=\"token comment\">#用户进入目录时，显示 message 文件中信息</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token assign-left variable\">xferlog_enable</span><span class=\"token operator\">=</span>YES           <span class=\"token comment\">#激活记录日志</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token assign-left variable\">connect_from_port_20</span><span class=\"token operator\">=</span>YES     <span class=\"token comment\">#主动模式数据传输端口</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token assign-left variable\">xferlog_std_format</span><span class=\"token operator\">=</span>YES       <span class=\"token comment\">#使用标准的 ftp 日志格式</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token assign-left variable\">listen</span><span class=\"token operator\">=</span>NO\t\t\t\t\t <span class=\"token comment\">#允许被监听</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token assign-left variable\">listen_ipv6</span><span class=\"token operator\">=</span>YES              <span class=\"token comment\">#允许被监听</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token assign-left variable\">pam_service_name</span><span class=\"token operator\">=</span>vsftpd      <span class=\"token comment\">#开启 pam 认证</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token assign-left variable\">userlist_enable</span><span class=\"token operator\">=</span>YES          <span class=\"token comment\">#用户登入限制</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token assign-left variable\">tcp_wrappers</span><span class=\"token operator\">=</span>YES             <span class=\"token comment\">#主机访问控制模式</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">#2. 匿名用户访问路径</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl restat vsftpd</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cd /var/ftp/</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">#3. 此时 ftp 无法上传文件，因为匿名登录为系统用户 ftp，对 /var/ftp/pub 目录没有写入权限</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll /var/ftp/pub -d</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>drwxr-xr-x <span class=\"token number\">3</span> root root <span class=\"token number\">30</span> Nov  <span class=\"token number\">4</span> <span class=\"token number\">23</span>:05 /var/ftp/</pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chown ftp /var/ftp/pub</span></pre></td></tr></table></figure><h4 id=\"七-vsftp系统用户访问\"><a class=\"anchor\" href=\"#七-vsftp系统用户访问\">#</a> 七、VSFTP 系统用户访问</h4>\n<h5 id=\"71-vsftp配置文件\"><a class=\"anchor\" href=\"#71-vsftp配置文件\">#</a> 7.1 VSFTP 配置文件</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># egrep -v \"^#|^$\" /etc/vsftpd/vsftpd.conf </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token assign-left variable\">anonymous_enable</span><span class=\"token operator\">=</span>YES         <span class=\"token comment\">#允许匿名用户登录       </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token assign-left variable\">local_enable</span><span class=\"token operator\">=</span>YES             <span class=\"token comment\">#允许本地用户登录</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">write_enable</span><span class=\"token operator\">=</span>YES             <span class=\"token comment\">#允许本地用户上传</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token assign-left variable\">local_umask</span><span class=\"token operator\">=</span>022              <span class=\"token comment\">#umask 权限，上传文件权限默认 644，目录 755</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token assign-left variable\">dirmessage_enable</span><span class=\"token operator\">=</span>YES        <span class=\"token comment\">#用户进入目录时，显示 message 文件中信息</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token assign-left variable\">xferlog_enable</span><span class=\"token operator\">=</span>YES           <span class=\"token comment\">#激活记录日志</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token assign-left variable\">connect_from_port_20</span><span class=\"token operator\">=</span>YES     <span class=\"token comment\">#主动模式数据传输端口</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token assign-left variable\">xferlog_std_format</span><span class=\"token operator\">=</span>YES       <span class=\"token comment\">#使用标准的 ftp 日志格式</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token assign-left variable\">listen</span><span class=\"token operator\">=</span>NO\t\t\t\t\t <span class=\"token comment\">#允许被监听</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token assign-left variable\">listen_ipv6</span><span class=\"token operator\">=</span>YES              <span class=\"token comment\">#允许被监听</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token assign-left variable\">pam_service_name</span><span class=\"token operator\">=</span>vsftpd      <span class=\"token comment\">#开启 pam 认证</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token assign-left variable\">userlist_enable</span><span class=\"token operator\">=</span>YES          <span class=\"token comment\">#用户登入限制</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token assign-left variable\">tcp_wrappers</span><span class=\"token operator\">=</span>YES             <span class=\"token comment\">#主机访问控制模式</span></pre></td></tr></table></figure><h5 id=\"72-新建系统用户\"><a class=\"anchor\" href=\"#72-新建系统用户\">#</a> 7.2 新建系统用户</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># useradd xuyong</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># passwd zhangshan</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># useradd xuyong</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># echo \"123456\" | passwd --stdin zhangshan</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># userdel -d zhangsan</span></pre></td></tr></table></figure><h5 id=\"73-vsftp基本配置\"><a class=\"anchor\" href=\"#73-vsftp基本配置\">#</a> 7.3 VSFTP 基本配置</h5>\n<p>vsftp 登录路径默认为用户家目录，可以通过修改配置文件自定义主目录，修改后所有用户登录的工作目录都是该路径 /share_home。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">local_root</span><span class=\"token operator\">=</span>/share_home      <span class=\"token comment\">#当本地用户登入时，将被更换到定义的目录下。默认值为各用户的家目录。\t</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token assign-left variable\">local_max_rate</span><span class=\"token operator\">=</span><span class=\"token number\">0</span>            <span class=\"token comment\">#限制最大传输速率 (字节 / 秒)</span></pre></td></tr></table></figure><p>此时用户登录后没有写入权限，原因为虽然 VSFTP 服务开启了写权限，但是 /share_home 目录属主属组为 root，用户没有目录写权限。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># groupadd caiwu</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># id xuyong</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token assign-left variable\">uid</span><span class=\"token operator\">=</span><span class=\"token number\">1000</span><span class=\"token punctuation\">(</span>xuyong<span class=\"token punctuation\">)</span> <span class=\"token assign-left variable\">gid</span><span class=\"token operator\">=</span><span class=\"token number\">1000</span><span class=\"token punctuation\">(</span>xuyong<span class=\"token punctuation\">)</span> <span class=\"token assign-left variable\">groups</span><span class=\"token operator\">=</span><span class=\"token number\">1000</span><span class=\"token punctuation\">(</span>xuyong<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># gpasswd -a xuyong caiwu    #已存在用户加入到 caiwu 组</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># id xuyong</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token assign-left variable\">uid</span><span class=\"token operator\">=</span><span class=\"token number\">1000</span><span class=\"token punctuation\">(</span>xuyong<span class=\"token punctuation\">)</span> <span class=\"token assign-left variable\">gid</span><span class=\"token operator\">=</span><span class=\"token number\">1000</span><span class=\"token punctuation\">(</span>xuyong<span class=\"token punctuation\">)</span> <span class=\"token assign-left variable\">groups</span><span class=\"token operator\">=</span><span class=\"token number\">1000</span><span class=\"token punctuation\">(</span>xuyong<span class=\"token punctuation\">)</span>,1003<span class=\"token punctuation\">(</span>caiwu<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir /share_home</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll /share_home/ -d</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>drwxr-xr-x <span class=\"token number\">2</span> root root <span class=\"token number\">6</span> Nov  <span class=\"token number\">5</span> 09:59 /share_home/</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chown root.caiwu /share_home/</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chmod 775 /share_home</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll /share_home/ -d</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>drwxrwxr-x <span class=\"token number\">2</span> root caiwu <span class=\"token number\">6</span> Jun <span class=\"token number\">22</span> <span class=\"token number\">16</span>:39 /share_home/</pre></td></tr></table></figure><h5 id=\"74-限制登录用户切换家目录\"><a class=\"anchor\" href=\"#74-限制登录用户切换家目录\">#</a> 7.4 限制登录用户切换家目录</h5>\n<p>1、限制所有登录用户切换家目录</p>\n<p>从 2.3.5 之后，vsftpd 增强了安全检查，如果用户被限定在了其主目录下，则该用户的主目录不能再具有写权限了！如果检查发现还有写权限，就会报该错误。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">chroot_local_user</span><span class=\"token operator\">=</span>YES                </pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token assign-left variable\">allow_writeable_chroot</span><span class=\"token operator\">=</span>YES</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#开启用户限制在家目录 (只开启以上行，把所有用户都限制在用户家目录中)</span></pre></td></tr></table></figure><p>2、仅允许写入 /etc/vsftpd/chroot_list 文件中的用户可以切换目录，其他用户都限制在用户主目录</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">chroot_local_user</span><span class=\"token operator\">=</span>YES                </pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token assign-left variable\">allow_writeable_chroot</span><span class=\"token operator\">=</span>YES</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token assign-left variable\">chroot_list_enable</span><span class=\"token operator\">=</span>YES</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">chroot_list_file</span><span class=\"token operator\">=</span>/etc/vsftpd/chroot_list  </pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#开启以上 4 行，写入 /etc/vsftpd/chroot_list 文件中的用户可以切换目录，其他用户都限制在用户主目录</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim /etc/vsftpd/chroot_list</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>xuyong</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl restart vsftpd</span></pre></td></tr></table></figure><h5 id=\"75-vsftp用户访问控制\"><a class=\"anchor\" href=\"#75-vsftp用户访问控制\">#</a> 7.5 VSFTP 用户访问控制</h5>\n<p>1、配置文件</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll /etc/vsftpd/</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>total <span class=\"token number\">36</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>-rw------- <span class=\"token number\">1</span> root root   <span class=\"token number\">125</span> Jun <span class=\"token number\">10</span>  <span class=\"token number\">2021</span> ftpusers         <span class=\"token comment\">#黑名单</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>-rw------- <span class=\"token number\">1</span> root root   <span class=\"token number\">361</span> Jun <span class=\"token number\">10</span>  <span class=\"token number\">2021</span> user_list        <span class=\"token comment\">#默认为黑名单，如将 userlist_deny=NO 则为白名单，仅允许该配置文件中用户可以访问</span></pre></td></tr></table></figure><p>2、将用户 xuyong 加入 user_list 文件中后默认为黑名单，不能登入 vsftp 服务器</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/vsftpd/user_list </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># vsftpd userlist</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># If userlist_deny=NO, only allow users in this file</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># If userlist_deny=YES (default), never allow users in this file, and</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># do not even prompt for a password.</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># Note that the default vsftpd pam config also checks /etc/vsftpd/ftpusers</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># for users that are denied.</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>root</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>bin</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>daemon</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>adm</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>lp</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token function\">sync</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token function\">shutdown</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token function\">halt</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>mail</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>news</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>uucp</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>operator</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>games</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>nobody</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>xuyong              <span class=\"token comment\">#用户加入黑名单</span></pre></td></tr></table></figure><p>3、通过修改配置文件 /etc/vsftpd/vsftpd.conf，仅写入 /etc/vsftpd/user_list 中的用户可以访问 vsftp 服务器，其他用户不可以访问。此时该文件为白名单。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">userlist_enable</span><span class=\"token operator\">=</span>YES                 <span class=\"token comment\">#开启用户访问控制，默认开启状态</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token assign-left variable\">userlist_deny</span><span class=\"token operator\">=</span>NO                    <span class=\"token comment\">#开启白名单功能</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token assign-left variable\">Userlist_file</span><span class=\"token operator\">=</span>/etc/vsftpd/user_list</pre></td></tr></table></figure><h4 id=\"八-vsftp虚拟用户访问\"><a class=\"anchor\" href=\"#八-vsftp虚拟用户访问\">#</a> 八、VSFTP 虚拟用户访问</h4>\n<h5 id=\"81-创建虚拟用户口令文件\"><a class=\"anchor\" href=\"#81-创建虚拟用户口令文件\">#</a> 8.1 创建虚拟用户口令文件</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/vsftpd/vusers </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>xuyong    <span class=\"token comment\">#用户名</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">123456</span>    <span class=\"token comment\">#密码</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>zhaomin</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">123456</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>zhangwuji</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">123456</span></pre></td></tr></table></figure><h5 id=\"82-生成虚拟用户已口令认证文件\"><a class=\"anchor\" href=\"#82-生成虚拟用户已口令认证文件\">#</a> 8.2 生成虚拟用户已口令认证文件</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#1. 安装口令认证命令</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum install db4-utils -y</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre> </pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">#2. 生成 Vsftpd 虚拟用户数据库认证文件，</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># db_load -T -t hash -f /etc/vsftpd/vusers /etc/vsftpd/vusers.db</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chmod 700 /etc/vsftpd/vusers.db</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll /etc/vsftpd/vusers.db </span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>-rw-r--r-- <span class=\"token number\">1</span> root root <span class=\"token number\">12288</span> Jun <span class=\"token number\">22</span> <span class=\"token number\">20</span>:41 /etc/vsftpd/vusers.db</pre></td></tr></table></figure><h5 id=\"83-编辑vsftp的pam认证文件\"><a class=\"anchor\" href=\"#83-编辑vsftp的pam认证文件\">#</a> 8.3 编辑 VSFTP 的 PAM 认证文件</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#配置 PAM 认证文件，/etc/pam.d/vsftpd 行尾加入如下两行，其余行注释掉，此时系统本地用户无法登入</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/pam.d/vsftpd</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#%PAM-1.0</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">#session    optional     pam_keyinit.so    force revoke</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#auth       required\tpam_listfile.so item=user sense=deny file=/etc/vsftpd/ftpusers onerr=succeed</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">#auth       required\tpam_shells.so</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">#auth       include\tpassword-auth</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#account    include\tpassword-auth</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">#session    required     pam_loginuid.so</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">#session    include\tpassword-auth</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>auth       required     pam_userdb.so  <span class=\"token assign-left variable\">db</span><span class=\"token operator\">=</span>/etc/vsftpd/vusers</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>account    required     pam_userdb.so  <span class=\"token assign-left variable\">db</span><span class=\"token operator\">=</span>/etc/vsftpd/vusers</pre></td></tr></table></figure><h5 id=\"84-建立本地映射用户并设置宿主目录权限\"><a class=\"anchor\" href=\"#84-建立本地映射用户并设置宿主目录权限\">#</a> 8.4 建立本地映射用户并设置宿主目录权限</h5>\n<ul>\n<li>所有 Vsftpd 虚拟用户需要映射到一个系统用户，该系统用户不需要密码，也不需要登录，主要用于虚拟用户映射使用；</li>\n<li>用户名必须和下一步配置文件中一致；</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># useradd -d /home/vftproot -s /sbin/nologin vuser</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chmod 755 /home/vftproot</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll /home/vftproot -d</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>drwxr-xr-x <span class=\"token number\">2</span> vuser vuser <span class=\"token number\">62</span> Jun <span class=\"token number\">22</span> <span class=\"token number\">20</span>:58 /home/vftproot</pre></td></tr></table></figure><h5 id=\"85-修改配置文件\"><a class=\"anchor\" href=\"#85-修改配置文件\">#</a> 8.5 修改配置文件</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim /etc/vsftpd/vsftpd.conf </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token assign-left variable\">guest_enable</span><span class=\"token operator\">=</span>YES              <span class=\"token comment\">#开启虚拟用户</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">guest_username</span><span class=\"token operator\">=</span>vuser          <span class=\"token comment\">#FTP 虚拟用户对应的系统用户</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token assign-left variable\">pam_service_name</span><span class=\"token operator\">=</span>vsftpd       <span class=\"token comment\">#PAM 认证文件（默认存在）</span></pre></td></tr></table></figure><h5 id=\"86-重启vsftp服务并测试\"><a class=\"anchor\" href=\"#86-重启vsftp服务并测试\">#</a> 8.6 重启 VSFTP 服务并测试</h5>\n<ul>\n<li>此时虚拟用户可以登录、查看、下载，不能上传</li>\n<li>默认上传文件的位置是虚拟用户的家目录</li>\n<li><strong>权限使用的是匿名用户权限进行管理</strong></li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl restart vsftpd</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#验证并测试，此时虚拟用户可以登录、查看、下载，不能上传报错</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp vftproot<span class=\"token punctuation\">]</span><span class=\"token comment\"># pwd</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>/home/vftproot</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp vftproot<span class=\"token punctuation\">]</span><span class=\"token comment\"># ls</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>a.txt</pre></td></tr></table></figure><p><img loading=\"lazy\" data-src=\"https://wp-cdn.4ce.cn/v2/WPjrX3b.jpeg\" alt=\"1.jpg\" /></p>\n<h5 id=\"87-调整虚拟用户权限\"><a class=\"anchor\" href=\"#87-调整虚拟用户权限\">#</a> 8.7 调整虚拟用户权限</h5>\n<ul>\n<li>给虚拟用户设定权限，允许所有虚拟用上传</li>\n<li>关闭匿名用户登录，更加安全（不影响虚拟用户登录）</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim /etc/vsftpd/vsftpd.conf </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token assign-left variable\">anonymous_enable</span><span class=\"token operator\">=</span>NO          <span class=\"token comment\">#允许匿名用户登录       ***</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token assign-left variable\">anon_upload_enable</span><span class=\"token operator\">=</span>YES       <span class=\"token comment\">#允许匿名用户上传       ***</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">anon_mkdir_write_enable</span><span class=\"token operator\">=</span>YES  <span class=\"token comment\">#允许匿名用户新建目录    ***</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token assign-left variable\">anon_other_write_enable</span><span class=\"token operator\">=</span>YES  <span class=\"token comment\">#允许匿名用户删除或上传  ***</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp vftproot<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl restart vsftpd</span></pre></td></tr></table></figure><p><img loading=\"lazy\" data-src=\"https://wp-cdn.4ce.cn/v2/AH9dxIX.jpeg\" alt=\"2.jpg\" /></p>\n<h5 id=\"88-单独定义虚拟用户权限\"><a class=\"anchor\" href=\"#88-单独定义虚拟用户权限\">#</a> 8.8 单独定义虚拟用户权限</h5>\n<p>为每个虚拟用户建立自己的配置文件，每个虚拟用户都有自己的共享目录，并单独定义权限；</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#1. 修改配置文件，指定保存虚拟用户配置文件的目录</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim /etc/vsftpd/vsftpd.conf</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token assign-left variable\">user_config_dir</span><span class=\"token operator\">=</span>/etc/vsftpd/vusers_dir       <span class=\"token comment\">#指定保存虚拟用户配置文件的目录</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#2. 建立目录</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir /etc/vsftpd/vusers_dir</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#3. 为每个虚拟用户建立配置文件，配置文件名称与虚拟用户一致，系统会读取与当前用户名相同的配置文件</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim /etc/vsftpd/vusers_dir/xuyong</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token assign-left variable\">anon_upload_enable</span><span class=\"token operator\">=</span>YES       <span class=\"token comment\">#允许匿名用户上传       ***</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token assign-left variable\">anon_mkdir_write_enable</span><span class=\"token operator\">=</span>YES  <span class=\"token comment\">#允许匿名用户新建目录    ***</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token assign-left variable\">anon_other_write_enable</span><span class=\"token operator\">=</span>YES  <span class=\"token comment\">#允许匿名用户删除       ***</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token assign-left variable\">local_root</span><span class=\"token operator\">=</span>/data/xuyong      <span class=\"token comment\">#xuyong 指定独立的上传目录</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim /etc/vsftpd/vusers_dir/zhangwuji</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token assign-left variable\">anon_upload_enable</span><span class=\"token operator\">=</span>YES       <span class=\"token comment\">#允许匿名用户上传       ***</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token assign-left variable\">anon_mkdir_write_enable</span><span class=\"token operator\">=</span>YES  <span class=\"token comment\">#允许匿名用户新建目录    ***</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token assign-left variable\">anon_other_write_enable</span><span class=\"token operator\">=</span>NO   <span class=\"token comment\">#允许匿名用户删除       ***</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token assign-left variable\">local_root</span><span class=\"token operator\">=</span>/data/zhangwuji   <span class=\"token comment\">#zhangwuji 指定独立的上传目录</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim /etc/vsftpd/vusers_dir/zhaomin</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token assign-left variable\">anon_upload_enable</span><span class=\"token operator\">=</span>YES       <span class=\"token comment\">#允许匿名用户上传       ***</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token assign-left variable\">anon_mkdir_write_enable</span><span class=\"token operator\">=</span>NO   <span class=\"token comment\">#允许匿名用户新建目录    ***</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token assign-left variable\">anon_other_write_enable</span><span class=\"token operator\">=</span>NO   <span class=\"token comment\">#允许匿名用户删除       ***</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token assign-left variable\">local_root</span><span class=\"token operator\">=</span>/data/zhaomin     <span class=\"token comment\">#zhaomin 指定独立的上传目录</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token comment\">#4. 新建上传目录并配置虚拟用户系统权限</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir /data/xuyong</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir /data/zhangwuji</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir /data/zhaomin</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chown vuser:vuser /data/xuyong</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chown vuser:vuser /data/zhangwuji</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chown vuser:vuser /data/zhaomi</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token comment\">#5. 重启服务验证并测试</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp vftproot<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl restart vsftpd</span></pre></td></tr></table></figure><ul>\n<li>用户 xuyong 可以登录、查看、下载，删除、创建目录和文件、上传</li>\n<li>用户 zhangwuji 可以登录、查看、下载、创建目录和文件，上传，无法删除</li>\n<li>用户 zhangwuji 可以登录、查看、下载、上传，无法删除、创建目录和文件</li>\n</ul>\n<h4 id=\"九-项目实战\"><a class=\"anchor\" href=\"#九-项目实战\">#</a> 九、项目实战</h4>\n<h5 id=\"91-公司ftp服务器需求\"><a class=\"anchor\" href=\"#91-公司ftp服务器需求\">#</a> 9.1 公司 FTP 服务器需求</h5>\n<ol>\n<li>每位员工有独立的目录，可上传、可读、可写、可删除权限，但目录本身员工不可删除</li>\n<li>每位员工拥有独立根目录，在自己目录下可见公司共享目录 public_share（只读）</li>\n<li>部门内部员工可见部门共享目录_caiwu_share（读写）</li>\n<li>禁锢虚拟用户的主目录，同时禁止访问除主目录之外的目录</li>\n<li>开启日志记录登录、上传、下载、删除信息</li>\n</ol>\n<p><img loading=\"lazy\" data-src=\"https://wp-cdn.4ce.cn/v2/ucO32qb.png\" alt=\"1.png\" /></p>\n<h5 id=\"92-vsftp-部署\"><a class=\"anchor\" href=\"#92-vsftp-部署\">#</a> 9.2 VSFTP 部署</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum install vsftpd -y</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl start vsftpd &amp;&amp; systemctl enable vsftpd</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># netstat -lntp|grep vsftpd</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>tcp6       <span class=\"token number\">0</span>      <span class=\"token number\">0</span> :::21                   :::*                    LISTEN      <span class=\"token number\">973</span>/vsftpd</pre></td></tr></table></figure><h5 id=\"93-配置虚拟用户访问\"><a class=\"anchor\" href=\"#93-配置虚拟用户访问\">#</a> 9.3 配置虚拟用户访问</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#1. 创建虚拟用户口令文件</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/vsftpd/vusers </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>xuyong</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">123456</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>zhaomin</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">123456</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>zhangwuji</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">123456</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">#2. 生成虚拟用户已口令认证文件</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum install db4-utils -y</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># db_load -T -t hash -f /etc/vsftpd/vusers /etc/vsftpd/vusers.db</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll /etc/vsftpd/vusers.db</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>-rw-r--r-- <span class=\"token number\">1</span> root root <span class=\"token number\">12288</span> Jun <span class=\"token number\">23</span> <span class=\"token number\">13</span>:54 /etc/vsftpd/vusers.db</pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\">#3. 配置 PAM 认证文件，/etc/pam.d/vsftpd 行尾加入如下两行，其余行注释掉，此时系统本地用户无法登入</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/pam.d/vsftpd</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">#%PAM-1.0</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\">#session    optional     pam_keyinit.so    force revoke</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">#auth       required\tpam_listfile.so item=user sense=deny file=/etc/vsftpd/ftpusers onerr=succeed</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">#auth       required\tpam_shells.so</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">#auth       include\tpassword-auth</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">#account    include\tpassword-auth</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">#session    required     pam_loginuid.so</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token comment\">#session    include\tpassword-auth</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>auth       required     pam_userdb.so  <span class=\"token assign-left variable\">db</span><span class=\"token operator\">=</span>/etc/vsftpd/vusers</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>account    required     pam_userdb.so  <span class=\"token assign-left variable\">db</span><span class=\"token operator\">=</span>/etc/vsftpd/vusers</pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token comment\">#4. 建立本地映射用户并设置宿主目录权限</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># useradd -d /home/vftproot -s /sbin/nologin vuser</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chmod 755 /home/vftproot</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll /home/vftproot -d</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>drwxr-xr-x <span class=\"token number\">2</span> vuser vuser <span class=\"token number\">62</span> Jun <span class=\"token number\">23</span> <span class=\"token number\">13</span>:55 /home/vftproot</pre></td></tr><tr><td data-num=\"34\"></td><td><pre></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token comment\">#5. 修改配置文件</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim /etc/vsftpd/vsftpd.conf </span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token assign-left variable\">anonymous_enable</span><span class=\"token operator\">=</span>NO</pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token assign-left variable\">chroot_local_user</span><span class=\"token operator\">=</span>YES         <span class=\"token comment\">#开启用户限制在家目录</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token assign-left variable\">allow_writeable_chroot</span><span class=\"token operator\">=</span>YES</pre></td></tr><tr><td data-num=\"41\"></td><td><pre></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token assign-left variable\">guest_enable</span><span class=\"token operator\">=</span>YES              <span class=\"token comment\">#开启虚拟用户</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token assign-left variable\">guest_username</span><span class=\"token operator\">=</span>vuser          <span class=\"token comment\">#FTP 虚拟用户对应的系统用户</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token assign-left variable\">pam_service_name</span><span class=\"token operator\">=</span>vsftpd       <span class=\"token comment\">#PAM 认证文件（默认存在）</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token comment\">#6. 修改配置文件，指定保存虚拟用户配置文件的目录</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim /etc/vsftpd/vsftpd.conf</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token assign-left variable\">user_config_dir</span><span class=\"token operator\">=</span>/etc/vsftpd/vusers_dir       <span class=\"token comment\">#指定保存虚拟用户配置文件的目录</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre></pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token comment\">#7. 建立目录</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir /etc/vsftpd/vusers_dir</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre></pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token comment\">#8. 为每个虚拟用户建立配置文件，配置文件名称与虚拟用户一致，系统会读取与当前用户名相同的配置文件</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre><span class=\"token comment\">###anon_upload_enable=YES         #允许匿名用户上传       </span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token comment\">###anon_mkdir_write_enable=YES    #允许匿名用户新建目录    </span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre><span class=\"token comment\">###anon_other_write_enable=YES    #允许匿名用户删除      </span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre><span class=\"token comment\">###local_root=/data/IT/xuyong     #xuyong 指定独立的上传目录</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre></pre></td></tr><tr><td data-num=\"60\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp vusers_dir<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/vsftpd/vusers_dir/xuyong </span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre><span class=\"token assign-left variable\">anon_upload_enable</span><span class=\"token operator\">=</span>YES</pre></td></tr><tr><td data-num=\"62\"></td><td><pre><span class=\"token assign-left variable\">anon_mkdir_write_enable</span><span class=\"token operator\">=</span>YES</pre></td></tr><tr><td data-num=\"63\"></td><td><pre><span class=\"token assign-left variable\">anon_other_write_enable</span><span class=\"token operator\">=</span>YES</pre></td></tr><tr><td data-num=\"64\"></td><td><pre><span class=\"token assign-left variable\">local_root</span><span class=\"token operator\">=</span>/data/it/xuyong</pre></td></tr><tr><td data-num=\"65\"></td><td><pre></pre></td></tr><tr><td data-num=\"66\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp vusers_dir<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/vsftpd/vusers_dir/zhangwuji </span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre><span class=\"token assign-left variable\">anon_upload_enable</span><span class=\"token operator\">=</span>YES</pre></td></tr><tr><td data-num=\"68\"></td><td><pre><span class=\"token assign-left variable\">anon_mkdir_write_enable</span><span class=\"token operator\">=</span>YES</pre></td></tr><tr><td data-num=\"69\"></td><td><pre><span class=\"token assign-left variable\">anon_other_write_enable</span><span class=\"token operator\">=</span>YES</pre></td></tr><tr><td data-num=\"70\"></td><td><pre><span class=\"token assign-left variable\">local_root</span><span class=\"token operator\">=</span>/data/caiwu/zhangwuji</pre></td></tr><tr><td data-num=\"71\"></td><td><pre></pre></td></tr><tr><td data-num=\"72\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp vusers_dir<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/vsftpd/vusers_dir/zhaomin </span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre><span class=\"token assign-left variable\">anon_upload_enable</span><span class=\"token operator\">=</span>YES</pre></td></tr><tr><td data-num=\"74\"></td><td><pre><span class=\"token assign-left variable\">anon_mkdir_write_enable</span><span class=\"token operator\">=</span>YES</pre></td></tr><tr><td data-num=\"75\"></td><td><pre><span class=\"token assign-left variable\">anon_other_write_enable</span><span class=\"token operator\">=</span>YES</pre></td></tr><tr><td data-num=\"76\"></td><td><pre><span class=\"token assign-left variable\">local_root</span><span class=\"token operator\">=</span>/data/caiwu/zhaomin</pre></td></tr><tr><td data-num=\"77\"></td><td><pre></pre></td></tr><tr><td data-num=\"78\"></td><td><pre><span class=\"token comment\">#10. 新建上传目录并配置虚拟用户系统权限</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir -p /data/it/xuyong</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir -p /data/caiwu/zhangwuji</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir -p /data/caiwu/zhaomin</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chown vuser:vuser /data/it/xuyong</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chown vuser:vuser /data/caiwu/zhangwuji</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chown vuser:vuser /data/caiwu/zhaomin</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre></pre></td></tr><tr><td data-num=\"86\"></td><td><pre><span class=\"token comment\">#11. 重启服务验证并测试</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp vftproot<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl restart vsftpd</span></pre></td></tr></table></figure><h5 id=\"94-配置公共目录共享\"><a class=\"anchor\" href=\"#94-配置公共目录共享\">#</a> 9.4 配置公共目录共享</h5>\n<p>因为 1 个虚拟用户只可以配置 1 个目录，故需要通过 mount -B 来实现目录共享</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#1. 创建公共目录</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /data/public_share</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /data/caiwu/caiwu_share</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /data/it/it_share</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /data/caiwu/zhangwuji/caiwu_share</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /data/caiwu/zhangwuji/public_share</pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /data/caiwu/zhaomin/caiwu_share</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /data/caiwu/zhaomin/public_share</pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /data/it/xuyong/it_share</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /data/it/xuyong/public_share</pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\">#2. 使用 mount -B -o rw,ro 来将公共目录、日志目录挂载至个人根目录。</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token function\">mount</span> <span class=\"token parameter variable\">-B</span> <span class=\"token parameter variable\">-o</span> rw /data/caiwu/caiwu_share /data/caiwu/zhangwuji/caiwu_share</pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token function\">mount</span> <span class=\"token parameter variable\">-B</span> <span class=\"token parameter variable\">-o</span> ro /data/public_share /data/caiwu/zhangwuji/public_share </pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token function\">mount</span> <span class=\"token parameter variable\">-B</span> <span class=\"token parameter variable\">-o</span> rw /data/caiwu/caiwu_share /data/caiwu/zhaomin/caiwu_share</pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token function\">mount</span> <span class=\"token parameter variable\">-B</span> <span class=\"token parameter variable\">-o</span> ro /data/public_share /data/caiwu/zhaomin/public_share </pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token function\">mount</span> <span class=\"token parameter variable\">-B</span> <span class=\"token parameter variable\">-o</span> rw /data/it/it_share /data/it/xuyong/it_share</pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token function\">mount</span> <span class=\"token parameter variable\">-B</span> <span class=\"token parameter variable\">-o</span> ro /data/public_share /data/it/xuyong/public_share </pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token comment\">#3. 为部门共享配置虚拟用户系统权限</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token function\">chown</span> vuser:vuser /data/caiwu/caiwu_share</pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token function\">chown</span> vuser:vuser /data/it/it_share</pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token comment\">#4. 配置自动挂载</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim /etc/rc.local</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>追加内容如下：</pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token function\">mount</span> <span class=\"token parameter variable\">-B</span> <span class=\"token parameter variable\">-o</span> rw /data/caiwu/caiwu_share /data/caiwu/zhangwuji/caiwu_share</pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token function\">mount</span> <span class=\"token parameter variable\">-B</span> <span class=\"token parameter variable\">-o</span> ro /data/public_share /data/caiwu/zhangwuji/public_share </pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token function\">mount</span> <span class=\"token parameter variable\">-B</span> <span class=\"token parameter variable\">-o</span> rw /data/caiwu/caiwu_share /data/caiwu/zhaomin/caiwu_share</pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token function\">mount</span> <span class=\"token parameter variable\">-B</span> <span class=\"token parameter variable\">-o</span> ro /data/public_share /data/caiwu/zhaomin/public_share </pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token function\">mount</span> <span class=\"token parameter variable\">-B</span> <span class=\"token parameter variable\">-o</span> rw /data/it/it_share /data/it/xuyong/it_share</pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token function\">mount</span> <span class=\"token parameter variable\">-B</span> <span class=\"token parameter variable\">-o</span> ro /data/public_share /data/it/xuyong/public_share</pre></td></tr></table></figure>",
            "tags": [
                "Vsftp"
            ]
        },
        {
            "id": "http://ixuyong.cn/posts/581151773.html",
            "url": "http://ixuyong.cn/posts/581151773.html",
            "title": "100个运维相关技术官网汇总",
            "date_published": "2025-06-19T13:16:37.000Z",
            "content_html": "<h3 id=\"100个运维相关技术官网大汇总\"><a class=\"anchor\" href=\"#100个运维相关技术官网大汇总\">#</a> 100 个运维相关技术官网大汇总</h3>\n<h4 id=\"1-操作系统官网\"><a class=\"anchor\" href=\"#1-操作系统官网\">#</a> <strong>1. 操作系统官网</strong></h4>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">名称</th>\n<th style=\"text-align:left\">官网链接</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">Ubuntu</td>\n<td style=\"text-align:left\"><a href=\"https://ubuntu.com\">https://ubuntu.com</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Debian</td>\n<td style=\"text-align:left\"><a href=\"https://www.debian.org\">https://www.debian.org</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">RHEL</td>\n<td style=\"text-align:left\"><a href=\"https://www.redhat.com\">https://www.redhat.com</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Rocky Linux</td>\n<td style=\"text-align:left\"><a href=\"https://rockylinux.org\">https://rockylinux.org</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">AlmaLinux</td>\n<td style=\"text-align:left\"><a href=\"https://almalinux.org\">https://almalinux.org</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Arch Wiki</td>\n<td style=\"text-align:left\"><a href=\"https://wiki.archlinux.org\">https://wiki.archlinux.org</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">麒麟系统</td>\n<td style=\"text-align:left\"><a href=\"https://www.kylinos.cn/\">https://www.kylinos.cn/</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">统信系统</td>\n<td style=\"text-align:left\"><a href=\"https://uniontech.com/\">https://uniontech.com/</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">openEuler</td>\n<td style=\"text-align:left\"><a href=\"https://www.openeuler.org/zh/\">https://www.openeuler.org/zh/</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">正版操作系统</td>\n<td style=\"text-align:left\"><a href=\"https://msdn.itellyou.cn/\">https://msdn.itellyou.cn/</a></td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"2-开源镜像站\"><a class=\"anchor\" href=\"#2-开源镜像站\">#</a> <strong>2. 开源镜像站</strong></h4>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">镜像源名称</th>\n<th style=\"text-align:left\">官网链接</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">清华大学镜像站</td>\n<td style=\"text-align:left\"><a href=\"https://mirrors.tuna.tsinghua.edu.cn\">https://mirrors.tuna.tsinghua.edu.cn</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">中科大镜像站</td>\n<td style=\"text-align:left\"><a href=\"https://mirrors.ustc.edu.cn\">https://mirrors.ustc.edu.cn</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">阿里云镜像站</td>\n<td style=\"text-align:left\"><a href=\"https://developer.aliyun.com/mirror\">https://developer.aliyun.com/mirror</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">华为云镜像站</td>\n<td style=\"text-align:left\"><a href=\"https://mirrors.huaweicloud.com\">https://mirrors.huaweicloud.com</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">中国科技网镜像</td>\n<td style=\"text-align:left\"><a href=\"https://mirrors.cstcloud.cn\">https://mirrors.cstcloud.cn</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">网易开源镜像站</td>\n<td style=\"text-align:left\"><a href=\"http://mirrors.163.com\">http://mirrors.163.com</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">腾讯云镜像站</td>\n<td style=\"text-align:left\"><a href=\"https://mirrors.cloud.tencent.com\">https://mirrors.cloud.tencent.com</a></td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"3-容器与-kubernetes\"><a class=\"anchor\" href=\"#3-容器与-kubernetes\">#</a> <strong>3. 容器与 Kubernetes</strong></h4>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">名称</th>\n<th style=\"text-align:left\">官网链接</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">Docker</td>\n<td style=\"text-align:left\"><a href=\"https://www.docker.com\">https://www.docker.com</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Kubernetes</td>\n<td style=\"text-align:left\"><a href=\"https://kubernetes.io\">https://kubernetes.io</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Helm</td>\n<td style=\"text-align:left\"><a href=\"https://helm.sh\">https://helm.sh</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Podman</td>\n<td style=\"text-align:left\"><a href=\"https://podman.io\">https://podman.io</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">containerd</td>\n<td style=\"text-align:left\"><a href=\"https://containerd.io\">https://containerd.io</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">K3s</td>\n<td style=\"text-align:left\"><a href=\"https://k3s.io\">https://k3s.io</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Rancher</td>\n<td style=\"text-align:left\"><a href=\"https://www.rancher.com/\">https://www.rancher.com/</a></td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"4-云平台\"><a class=\"anchor\" href=\"#4-云平台\">#</a> <strong>4. 云平台</strong></h4>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">名称</th>\n<th style=\"text-align:left\">官网链接</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">AWS</td>\n<td style=\"text-align:left\"><a href=\"https://aws.amazon.com\">https://aws.amazon.com</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Azure</td>\n<td style=\"text-align:left\"><a href=\"https://azure.microsoft.com\">https://azure.microsoft.com</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">阿里云</td>\n<td style=\"text-align:left\"><a href=\"https://www.aliyun.com\">https://www.aliyun.com</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">腾讯云</td>\n<td style=\"text-align:left\"><a href=\"https://cloud.tencent.com\">https://cloud.tencent.com</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">华为云</td>\n<td style=\"text-align:left\"><a href=\"https://www.huaweicloud.com\">https://www.huaweicloud.com</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">天翼云</td>\n<td style=\"text-align:left\"><a href=\"https://www.ctyun.cn/\">https://www.ctyun.cn/</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">OpenStack</td>\n<td style=\"text-align:left\"><a href=\"https://www.openstack.org\">https://www.openstack.org</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">CNCF Landscape</td>\n<td style=\"text-align:left\"><a href=\"https://landscape.cncf.io\">https://landscape.cncf.io</a></td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"5-数据库\"><a class=\"anchor\" href=\"#5-数据库\">#</a> <strong>5. 数据库</strong></h4>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">名称</th>\n<th style=\"text-align:left\">官网链接</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">MySQL</td>\n<td style=\"text-align:left\"><a href=\"https://www.mysql.com\">https://www.mysql.com</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Oracle</td>\n<td style=\"text-align:left\"><a href=\"https://www.oracle.com/\">https://www.oracle.com/</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">PostgreSQL</td>\n<td style=\"text-align:left\"><a href=\"https://www.postgresql.org\">https://www.postgresql.org</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">MariaDB</td>\n<td style=\"text-align:left\"><a href=\"https://mariadb.org\">https://mariadb.org</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">MongoDB</td>\n<td style=\"text-align:left\"><a href=\"https://www.mongodb.com\">https://www.mongodb.com</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Redis</td>\n<td style=\"text-align:left\"><a href=\"https://redis.io\">https://redis.io</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Memcached</td>\n<td style=\"text-align:left\"><a href=\"https://memcached.org\">https://memcached.org</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">达梦数据库</td>\n<td style=\"text-align:left\"><a href=\"https://www.dameng.com/\">https://www.dameng.com/</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">OceanBase</td>\n<td style=\"text-align:left\"><a href=\"https://www.oceanbase.com/\">https://www.oceanbase.com/</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Elasticsearch</td>\n<td style=\"text-align:left\"><a href=\"https://www.elastic.co/elasticsearch/\">https://www.elastic.co/elasticsearch/</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">ClickHouse</td>\n<td style=\"text-align:left\"><a href=\"https://clickhouse.com\">https://clickhouse.com</a></td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"6-基础服务\"><a class=\"anchor\" href=\"#6-基础服务\">#</a> <strong>6. 基础服务</strong></h4>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">名称</th>\n<th style=\"text-align:left\">官网链接</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">Nginx</td>\n<td style=\"text-align:left\"><a href=\"https://nginx.org\">https://nginx.org</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Apache HTTPD</td>\n<td style=\"text-align:left\"><a href=\"https://httpd.apache.org\">https://httpd.apache.org</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Tomcat</td>\n<td style=\"text-align:left\"><a href=\"https://tomcat.apache.org/\">https://tomcat.apache.org/</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">HAProxy</td>\n<td style=\"text-align:left\"><a href=\"https://www.haproxy.org\">https://www.haproxy.org</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Dnsmasq</td>\n<td style=\"text-align:left\"><a href=\"https://thekelleys.org.uk/dnsmasq/doc.html\">https://thekelleys.org.uk/dnsmasq/doc.html</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">CoreDNS</td>\n<td style=\"text-align:left\"><a href=\"https://coredns.io\">https://coredns.io</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">RabbitMQ</td>\n<td style=\"text-align:left\"><a href=\"https://www.rabbitmq.com\">https://www.rabbitmq.com</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Kafka</td>\n<td style=\"text-align:left\"><a href=\"https://kafka.apache.org\">https://kafka.apache.org</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Etcd</td>\n<td style=\"text-align:left\"><a href=\"https://etcd.io\">https://etcd.io</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Consul</td>\n<td style=\"text-align:left\"><a href=\"https://www.consul.io\">https://www.consul.io</a></td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"7-cicd-与服务网格\"><a class=\"anchor\" href=\"#7-cicd-与服务网格\">#</a> <strong>7. CI/CD 与服务网格</strong></h4>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">名称</th>\n<th style=\"text-align:left\">官网链接</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">Jenkins</td>\n<td style=\"text-align:left\"><a href=\"https://www.jenkins.io\">https://www.jenkins.io</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">GitLab CI/CD</td>\n<td style=\"text-align:left\"><a href=\"https://about.gitlab.com\">https://about.gitlab.com</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">GitHub Actions</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/features/actions\">https://github.com/features/actions</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">ArgoCD</td>\n<td style=\"text-align:left\"><a href=\"https://argo-cd.readthedocs.io/\">https://argo-cd.readthedocs.io/</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Spinnaker</td>\n<td style=\"text-align:left\"><a href=\"https://spinnaker.io\">https://spinnaker.io</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Istio</td>\n<td style=\"text-align:left\"><a href=\"https://istio.io/\">https://istio.io/</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Envoy Proxy</td>\n<td style=\"text-align:left\"><a href=\"https://www.envoyproxy.io\">https://www.envoyproxy.io</a></td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"8-监控与日志系统\"><a class=\"anchor\" href=\"#8-监控与日志系统\">#</a> <strong>8. 监控与日志系统</strong></h4>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">名称</th>\n<th style=\"text-align:left\">官网链接</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">Prometheus</td>\n<td style=\"text-align:left\"><a href=\"https://prometheus.io\">https://prometheus.io</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Grafana</td>\n<td style=\"text-align:left\"><a href=\"https://grafana.com\">https://grafana.com</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Loki</td>\n<td style=\"text-align:left\"><a href=\"https://grafana.com/oss/loki/\">https://grafana.com/oss/loki/</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">ELK Stack</td>\n<td style=\"text-align:left\"><a href=\"https://www.elastic.co/what-is/elk-stack\">https://www.elastic.co/what-is/elk-stack</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Kibana</td>\n<td style=\"text-align:left\"><a href=\"https://www.elastic.co/kibana/\">https://www.elastic.co/kibana/</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Fluentd</td>\n<td style=\"text-align:left\"><a href=\"https://www.fluentd.org\">https://www.fluentd.org</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Zabbix</td>\n<td style=\"text-align:left\"><a href=\"https://www.zabbix.com\">https://www.zabbix.com</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Netdata</td>\n<td style=\"text-align:left\"><a href=\"https://www.netdata.cloud\">https://www.netdata.cloud</a></td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"9-自动化运维工具\"><a class=\"anchor\" href=\"#9-自动化运维工具\">#</a> <strong>9. 自动化运维工具</strong></h4>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">名称</th>\n<th style=\"text-align:left\">官网链接</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">Ansible</td>\n<td style=\"text-align:left\"><a href=\"https://docs.ansible.com/\">https://docs.ansible.com/</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Terraform</td>\n<td style=\"text-align:left\"><a href=\"https://developer.hashicorp.com/terraform/docs\">https://developer.hashicorp.com/terraform/docs</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">SaltStack</td>\n<td style=\"text-align:left\"><a href=\"https://docs.saltproject.io/\">https://docs.saltproject.io/</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Puppet</td>\n<td style=\"text-align:left\"><a href=\"https://puppet.com/docs/\">https://puppet.com/docs/</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Chef</td>\n<td style=\"text-align:left\"><a href=\"https://docs.chef.io/\">https://docs.chef.io/</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Packer</td>\n<td style=\"text-align:left\"><a href=\"https://developer.hashicorp.com/packer/docs\">https://developer.hashicorp.com/packer/docs</a></td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"10-运维常用工具\"><a class=\"anchor\" href=\"#10-运维常用工具\">#</a> <strong>10. 运维常用工具</strong></h4>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">工具名称</th>\n<th style=\"text-align:left\">官网链接</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">Xshell</td>\n<td style=\"text-align:left\"><a href=\"https://www.netsarang.com/zh/xshell/\">https://www.netsarang.com/zh/xshell/</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Xftp</td>\n<td style=\"text-align:left\"><a href=\"https://www.netsarang.com/en/xftp/\">https://www.netsarang.com/en/xftp/</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">MobaXterm</td>\n<td style=\"text-align:left\"><a href=\"https://mobaxterm.mobatek.net\">https://mobaxterm.mobatek.net</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">PuTTY</td>\n<td style=\"text-align:left\"><a href=\"https://www.putty.org\">https://www.putty.org</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">SecureCRT</td>\n<td style=\"text-align:left\"><a href=\"https://www.vandyke.com/products/securecrt/\">https://www.vandyke.com/products/securecrt/</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">WinSCP</td>\n<td style=\"text-align:left\"><a href=\"https://winscp.net\">https://winscp.net</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">FileZilla</td>\n<td style=\"text-align:left\"><a href=\"https://filezilla-project.org\">https://filezilla-project.org</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">FastCopy</td>\n<td style=\"text-align:left\"><a href=\"https://fastcopy.jp/en/\">https://fastcopy.jp/en/</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Everything</td>\n<td style=\"text-align:left\"><a href=\"https://www.voidtools.com\">https://www.voidtools.com</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Wireshark</td>\n<td style=\"text-align:left\"><a href=\"https://www.wireshark.org\">https://www.wireshark.org</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">VirtualBox</td>\n<td style=\"text-align:left\"><a href=\"https://www.virtualbox.org/\">https://www.virtualbox.org/</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">VMware Workstation</td>\n<td style=\"text-align:left\"><a href=\"https://www.vmware.com/products/workstation-pro.html\">https://www.vmware.com/products/workstation-pro.html</a></td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"11-数据库可视化连接工具\"><a class=\"anchor\" href=\"#11-数据库可视化连接工具\">#</a> <strong>11. 数据库可视化连接工具</strong></h4>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">工具名称</th>\n<th style=\"text-align:left\">官网链接</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">DBeaver</td>\n<td style=\"text-align:left\"><a href=\"https://dbeaver.io\">https://dbeaver.io</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Navicat</td>\n<td style=\"text-align:left\"><a href=\"https://www.navicat.com\">https://www.navicat.com</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">HeidiSQL</td>\n<td style=\"text-align:left\"><a href=\"https://www.heidisql.com\">https://www.heidisql.com</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">SSMS</td>\n<td style=\"text-align:left\"><a href=\"https://learn.microsoft.com/sql/ssms/\">https://learn.microsoft.com/sql/ssms/</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Toad for Oracle</td>\n<td style=\"text-align:left\"><a href=\"https://www.toadworld.com/products/toad-for-oracle\">https://www.toadworld.com/products/toad-for-oracle</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">SQL Developer</td>\n<td style=\"text-align:left\"><a href=\"https://www.oracle.com/database/sqldeveloper/\">https://www.oracle.com/database/sqldeveloper/</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">DbVisualizer</td>\n<td style=\"text-align:left\"><a href=\"https://www.dbvis.com\">https://www.dbvis.com</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">SQL Workbench</td>\n<td style=\"text-align:left\"><a href=\"https://www.sql-workbench.eu\">https://www.sql-workbench.eu</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">phpMyAdmin</td>\n<td style=\"text-align:left\"><a href=\"https://www.phpmyadmin.net\">https://www.phpmyadmin.net</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">pgAdmin</td>\n<td style=\"text-align:left\"><a href=\"https://www.pgadmin.org\">https://www.pgadmin.org</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">MongoDB Compass</td>\n<td style=\"text-align:left\"><a href=\"https://www.mongodb.com/products/compass\">https://www.mongodb.com/products/compass</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">RedisInsight</td>\n<td style=\"text-align:left\"><a href=\"https://redis.com/redis-enterprise/redis-insight/\">https://redis.com/redis-enterprise/redis-insight/</a></td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"12-实用工具\"><a class=\"anchor\" href=\"#12-实用工具\">#</a> 12. 实用工具</h4>\n<table>\n<thead>\n<tr>\n<th>工具名称</th>\n<th>官网链接</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>图床工具</td>\n<td><a href=\"https://wp-cdn.4ce.cn/\">https://wp-cdn.4ce.cn/</a></td>\n</tr>\n<tr>\n<td>科学上网</td>\n<td><a href=\"https://ikuuu.one/auth/register\">https://ikuuu.one/auth/register</a></td>\n</tr>\n<tr>\n<td>截图工具</td>\n<td><a href=\"https://pixpin.cn/\">https://pixpin.cn/</a></td>\n</tr>\n<tr>\n<td>FileZilla</td>\n<td><a href=\"https://www.filezilla.cn/download/client\">https://www.filezilla.cn/download/client</a></td>\n</tr>\n<tr>\n<td>在线工具</td>\n<td><a href=\"https://tool.lu/\">https://tool.lu/</a></td>\n</tr>\n<tr>\n<td>LOGO</td>\n<td><a href=\"https://favicon.io/\">https://favicon.io/</a></td>\n</tr>\n</tbody>\n</table>\n",
            "tags": [
                "Linux"
            ]
        },
        {
            "id": "http://ixuyong.cn/posts/2260957686.html",
            "url": "http://ixuyong.cn/posts/2260957686.html",
            "title": "Linux—Centos7修改网卡名称",
            "date_published": "2025-06-07T02:40:25.000Z",
            "content_html": "<h3 id=\"linuxcentos7修改网卡名称\"><a class=\"anchor\" href=\"#linuxcentos7修改网卡名称\">#</a> Linux—Centos7 修改网卡名称</h3>\n<p>首先我们先了解不同网卡名称对应的内核参数：</p>\n<ol>\n<li>biosdevname=0  net.ifnames=1：网卡名 “enp<em>s</em>” 此内核参数一般为默认</li>\n<li>biosdevname=1  net.ifnames=0：网卡名 “em*”</li>\n<li>biosdevname=0  net.ifnames=0：网卡名 “eth*”</li>\n</ol>\n<p>本次以将网卡名命名为 eth * 格式作示例</p>\n<h4 id=\"1-查看当前网卡的信息\"><a class=\"anchor\" href=\"#1-查看当前网卡的信息\">#</a> 1. 查看当前网卡的信息</h4>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ifconfig</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>ens33: <span class=\"token assign-left variable\">flags</span><span class=\"token operator\">=</span><span class=\"token number\">416</span><span class=\"token operator\"><span class=\"token file-descriptor important\">3</span>&lt;</span>UP,BROADCAST,RUNNING,MULTICAST<span class=\"token operator\">></span>  mtu <span class=\"token number\">1500</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        inet <span class=\"token number\">192.168</span>.40.88  netmask <span class=\"token number\">255.255</span>.255.0  broadcast <span class=\"token number\">192.168</span>.40.255</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        inet6 fe80::b92f:3dd3:19e7:1311  prefixlen <span class=\"token number\">64</span>  scopeid 0x2<span class=\"token operator\"><span class=\"token file-descriptor important\">0</span>&lt;</span>link<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        ether 00:0c:29:5e:a0:59  txqueuelen <span class=\"token number\">1000</span>  <span class=\"token punctuation\">(</span>Ethernet<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        RX packets <span class=\"token number\">75</span>  bytes <span class=\"token number\">8065</span> <span class=\"token punctuation\">(</span><span class=\"token number\">7.8</span> KiB<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        RX errors <span class=\"token number\">0</span>  dropped <span class=\"token number\">0</span>  overruns <span class=\"token number\">0</span>  frame <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        TX packets <span class=\"token number\">63</span>  bytes <span class=\"token number\">7754</span> <span class=\"token punctuation\">(</span><span class=\"token number\">7.5</span> KiB<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        TX errors <span class=\"token number\">0</span>  dropped <span class=\"token number\">0</span> overruns <span class=\"token number\">0</span>  carrier <span class=\"token number\">0</span>  collisions <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>lo: <span class=\"token assign-left variable\">flags</span><span class=\"token operator\">=</span><span class=\"token number\">7</span><span class=\"token operator\"><span class=\"token file-descriptor important\">3</span>&lt;</span>UP,LOOPBACK,RUNNING<span class=\"token operator\">></span>  mtu <span class=\"token number\">65536</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        inet <span class=\"token number\">127.0</span>.0.1  netmask <span class=\"token number\">255.0</span>.0.0</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        inet6 ::1  prefixlen <span class=\"token number\">128</span>  scopeid 0x1<span class=\"token operator\"><span class=\"token file-descriptor important\">0</span>&lt;</span>host<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        loop  txqueuelen <span class=\"token number\">1000</span>  <span class=\"token punctuation\">(</span>Local Loopback<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        RX packets <span class=\"token number\">0</span>  bytes <span class=\"token number\">0</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0.0</span> B<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        RX errors <span class=\"token number\">0</span>  dropped <span class=\"token number\">0</span>  overruns <span class=\"token number\">0</span>  frame <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        TX packets <span class=\"token number\">0</span>  bytes <span class=\"token number\">0</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0.0</span> B<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        TX errors <span class=\"token number\">0</span>  dropped <span class=\"token number\">0</span> overruns <span class=\"token number\">0</span>  carrier <span class=\"token number\">0</span>  collisions <span class=\"token number\">0</span></pre></td></tr></table></figure><h4 id=\"2-修改配置文件\"><a class=\"anchor\" href=\"#2-修改配置文件\">#</a> 2 . 修改配置文件</h4>\n<p>（1）在下列路径下找到 ifcgf-ens33</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cd /etc/sysconfig/network-scripts/</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager network-scripts<span class=\"token punctuation\">]</span><span class=\"token comment\"># ls</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>ifcfg-ens33  ifdown-ippp  ifdown-routes    <span class=\"token function\">ifup</span>          ifup-ipv6   ifup-ppp       ifup-tunnel</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>ifcfg-lo     ifdown-ipv6  ifdown-sit       ifup-aliases  ifup-isdn   ifup-routes    ifup-wireless</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">ifdown</span>       ifdown-isdn  ifdown-Team      ifup-bnep     ifup-plip   ifup-sit       init.ipv6-global</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>ifdown-bnep  ifdown-post  ifdown-TeamPort  ifup-eth      ifup-plusb  ifup-Team      network-functions</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>ifdown-eth   ifdown-ppp   ifdown-tunnel    ifup-ippp     ifup-post   ifup-TeamPort  network-functions-ipv6</pre></td></tr></table></figure><p>（2）使用 MV 命令，修改当前网卡的名称</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mv ifcfg-ens33 ifcfg-eth0</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager network-scripts<span class=\"token punctuation\">]</span><span class=\"token comment\"># ls</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>ifcfg-eth0   ifdown-ippp  ifdown-routes    <span class=\"token function\">ifup</span>          ifup-ipv6   ifup-ppp       ifup-tunnel</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>ifcfg-lo     ifdown-ipv6  ifdown-sit       ifup-aliases  ifup-isdn   ifup-routes    ifup-wireless</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">ifdown</span>       ifdown-isdn  ifdown-Team      ifup-bnep     ifup-plip   ifup-sit       init.ipv6-global</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>ifdown-bnep  ifdown-post  ifdown-TeamPort  ifup-eth      ifup-plusb  ifup-Team      network-functions</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>ifdown-eth   ifdown-ppp   ifdown-tunnel    ifup-ippp     ifup-post   ifup-TeamPort  network-functions-ipv6</pre></td></tr></table></figure><p>（3）同步修改网卡配置文件中的 name 和 device，修改为需要配置网卡的名字</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">NAME</span><span class=\"token operator\">=</span><span class=\"token string\">\"ens33\"</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token assign-left variable\">DEVICE</span><span class=\"token operator\">=</span><span class=\"token string\">\"ens33\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre> </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>将上列命令修改为</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> </pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token assign-left variable\">NAME</span><span class=\"token operator\">=</span><span class=\"token string\">\"eth0\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token assign-left variable\">DEVICE</span><span class=\"token operator\">=</span><span class=\"token string\">\"eth0\"</span></pre></td></tr></table></figure><p>（4）修改 grub</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cd /etc/default/</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#编辑内核信息，在 GRUB_CMDLINE_LINUX 行添加字段 net.ifnames=0 biosdevname=0</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager default<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat grub </span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token assign-left variable\">GRUB_TIMEOUT</span><span class=\"token operator\">=</span><span class=\"token number\">5</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token assign-left variable\">GRUB_DISTRIBUTOR</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">sed</span> <span class=\"token string\">'s, release .*$,,g'</span> /etc/system-release<span class=\"token variable\">)</span></span>\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token assign-left variable\">GRUB_DEFAULT</span><span class=\"token operator\">=</span>saved</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token assign-left variable\">GRUB_DISABLE_SUBMENU</span><span class=\"token operator\">=</span>true</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token assign-left variable\">GRUB_TERMINAL_OUTPUT</span><span class=\"token operator\">=</span><span class=\"token string\">\"console\"</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token assign-left variable\">GRUB_CMDLINE_LINUX</span><span class=\"token operator\">=</span><span class=\"token string\">\"crashkernel=auto rhgb net.ifnames=0 biosdevname=0 quiet\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token assign-left variable\">GRUB_DISABLE_RECOVERY</span><span class=\"token operator\">=</span><span class=\"token string\">\"true\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">#生成启动菜单</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager default<span class=\"token punctuation\">]</span><span class=\"token comment\"># grub2-mkconfig -o /boot/grub2/grub.cfg</span></pre></td></tr></table></figure><p>（5）完成之后 reboot 重启系统即可</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager default<span class=\"token punctuation\">]</span><span class=\"token comment\"># reboot</span></pre></td></tr></table></figure><p>（6）使用 ifconfig 即可查看</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ifconfig</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>eth0: <span class=\"token assign-left variable\">flags</span><span class=\"token operator\">=</span><span class=\"token number\">416</span><span class=\"token operator\"><span class=\"token file-descriptor important\">3</span>&lt;</span>UP,BROADCAST,RUNNING,MULTICAST<span class=\"token operator\">></span>  mtu <span class=\"token number\">1500</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        inet <span class=\"token number\">192.168</span>.40.88  netmask <span class=\"token number\">255.255</span>.255.0  broadcast <span class=\"token number\">192.168</span>.40.255</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        inet6 fe80::63d4:467f:9b76:e34f  prefixlen <span class=\"token number\">64</span>  scopeid 0x2<span class=\"token operator\"><span class=\"token file-descriptor important\">0</span>&lt;</span>link<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        inet6 fe80::1856:7b0:9d1e:7208  prefixlen <span class=\"token number\">64</span>  scopeid 0x2<span class=\"token operator\"><span class=\"token file-descriptor important\">0</span>&lt;</span>link<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        ether 00:0c:29:5e:a0:59  txqueuelen <span class=\"token number\">1000</span>  <span class=\"token punctuation\">(</span>Ethernet<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        RX packets <span class=\"token number\">77</span>  bytes <span class=\"token number\">8117</span> <span class=\"token punctuation\">(</span><span class=\"token number\">7.9</span> KiB<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        RX errors <span class=\"token number\">0</span>  dropped <span class=\"token number\">0</span>  overruns <span class=\"token number\">0</span>  frame <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        TX packets <span class=\"token number\">62</span>  bytes <span class=\"token number\">7842</span> <span class=\"token punctuation\">(</span><span class=\"token number\">7.6</span> KiB<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        TX errors <span class=\"token number\">0</span>  dropped <span class=\"token number\">0</span> overruns <span class=\"token number\">0</span>  carrier <span class=\"token number\">0</span>  collisions <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>lo: <span class=\"token assign-left variable\">flags</span><span class=\"token operator\">=</span><span class=\"token number\">7</span><span class=\"token operator\"><span class=\"token file-descriptor important\">3</span>&lt;</span>UP,LOOPBACK,RUNNING<span class=\"token operator\">></span>  mtu <span class=\"token number\">65536</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        inet <span class=\"token number\">127.0</span>.0.1  netmask <span class=\"token number\">255.0</span>.0.0</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        inet6 ::1  prefixlen <span class=\"token number\">128</span>  scopeid 0x1<span class=\"token operator\"><span class=\"token file-descriptor important\">0</span>&lt;</span>host<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        loop  txqueuelen <span class=\"token number\">1000</span>  <span class=\"token punctuation\">(</span>Local Loopback<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        RX packets <span class=\"token number\">0</span>  bytes <span class=\"token number\">0</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0.0</span> B<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        RX errors <span class=\"token number\">0</span>  dropped <span class=\"token number\">0</span>  overruns <span class=\"token number\">0</span>  frame <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        TX packets <span class=\"token number\">0</span>  bytes <span class=\"token number\">0</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0.0</span> B<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        TX errors <span class=\"token number\">0</span>  dropped <span class=\"token number\">0</span> overruns <span class=\"token number\">0</span>  carrier <span class=\"token number\">0</span>  collisions <span class=\"token number\">0</span></pre></td></tr></table></figure>",
            "tags": [
                "Linux"
            ]
        },
        {
            "id": "http://ixuyong.cn/posts/1922841233.html",
            "url": "http://ixuyong.cn/posts/1922841233.html",
            "title": "Rsync服务实践",
            "date_published": "2025-03-30T12:45:48.000Z",
            "content_html": "<h3 id=\"ursync服务实践u\"><a class=\"anchor\" href=\"#ursync服务实践u\">#</a> <u>Rsync 服务实践</u></h3>\n<p><strong>环境准备</strong></p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">主机名</th>\n<th style=\"text-align:center\"><strong>IP</strong></th>\n<th><strong>角色</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">server</td>\n<td style=\"text-align:center\">192.168.40.101</td>\n<td>rsync 服务端</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">client</td>\n<td style=\"text-align:center\">192.168.40.102</td>\n<td>rsync 客户</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"1rsync服务端\"><a class=\"anchor\" href=\"#1rsync服务端\">#</a> 1.rsync 服务端</h4>\n<h5 id=\"11-关闭防火墙-selinux\"><a class=\"anchor\" href=\"#11-关闭防火墙-selinux\">#</a> 1.1 关闭防火墙、selinux</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># hostnamectl set-hostname backup</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># bash</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># hostnamectl set-hostname aizj_lb01</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl stop firewalld</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl disable firewalld</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># sed -i 's/^SELINUX=enforcing/SELINUX=disabled/g' /etc/sysconfig/selinux</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># sed -i 's/^SELINUX=enforcing/SELINUX=disabled/g' /etc/selinux/config</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum install net-tools vim tree lrzsz wget unzip dos2unix bash-completion  lsof ntp ntpdate git -y</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum update -y --exclude=kernel* &amp;&amp; reboot</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># echo 'Asia/Shanghai' >/etc/timezone</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ntpdate time2.aliyun.com</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># crontab -e</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>*/5 * * * * /usr/sbin/ntpdate time2.aliyun.com <span class=\"token operator\">&amp;></span> /dev/nul</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir /soft /data /scripts /backup</span></pre></td></tr></table></figure><h5 id=\"12-安装rsync\"><a class=\"anchor\" href=\"#12-安装rsync\">#</a> 1.2 安装 rsync</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum install -y rsync</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@server ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl start rsyncd</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@server ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl enable rsyncd</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># useradd -M -s /sbin/nologin rsync</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir -p /backup/mysql  /backup/file</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chown -R rsync.rsync /backup/mysql /backup/file</span></pre></td></tr></table></figure><h5 id=\"13-修改配置文件\"><a class=\"anchor\" href=\"#13-修改配置文件\">#</a> 1.3 修改配置文件</h5>\n<p><em><mark>#生产环境中取消注释，导致备份数据报错</mark></em></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#带注释配置文件</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim /etc/rsyncd.conf</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>uid <span class=\"token operator\">=</span> <span class=\"token function\">rsync</span>             <span class=\"token comment\">#运行服务的用户</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>gid <span class=\"token operator\">=</span> <span class=\"token function\">rsync</span>             <span class=\"token comment\">#运行服务的组</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>port <span class=\"token operator\">=</span> <span class=\"token number\">873</span>              <span class=\"token comment\">#服务监听端口</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>fake super <span class=\"token operator\">=</span> <span class=\"token function\">yes</span>        <span class=\"token comment\">#服务无需使用 root 用户身份，即可接收文件的完整属性</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>use <span class=\"token function\">chroot</span> <span class=\"token operator\">=</span> no         <span class=\"token comment\">#禁锢目录，不允许获取 root 权限</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>max connections <span class=\"token operator\">=</span> <span class=\"token number\">200</span>   <span class=\"token comment\">#最大连接数，最多能有多少个客户端跟服务端的 873 端口建立连接</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token function\">timeout</span> <span class=\"token operator\">=</span> <span class=\"token number\">600</span>           <span class=\"token comment\">#超时时间</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>ignore errors          <span class=\"token comment\">#忽略错误</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token builtin class-name\">read</span> only <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>      <span class=\"token comment\">#客户是否只读</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>list <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>           <span class=\"token comment\">#不允许查看模块信息</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>auth <span class=\"token function\">users</span> <span class=\"token operator\">=</span> rsync_backup         <span class=\"token comment\">#定义虚拟用户，用户数据传输</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>secrets <span class=\"token function\">file</span> <span class=\"token operator\">=</span> /etc/rsync.passwd  <span class=\"token comment\">#定义虚拟用户密码认证文件</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>log <span class=\"token function\">file</span> <span class=\"token operator\">=</span> /var/log/rsyncd.log    <span class=\"token comment\">#日志文件存放的位置</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">[</span>backup_mysql<span class=\"token punctuation\">]</span>         <span class=\"token comment\">#模块名</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>comment <span class=\"token operator\">=</span> welcome to rsync_backup</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>path <span class=\"token operator\">=</span> /backup/mysql   <span class=\"token comment\">#数据存放目录</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">[</span>backup_file<span class=\"token punctuation\">]</span>          <span class=\"token comment\">#模块名</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>comment <span class=\"token operator\">=</span> welcome to rsync_backup</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>path <span class=\"token operator\">=</span> /backup/file    <span class=\"token comment\">#数据存放目录 </span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">#不带注释配置文件</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/rsyncd.conf</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>uid <span class=\"token operator\">=</span> <span class=\"token function\">rsync</span>        </pre></td></tr><tr><td data-num=\"26\"></td><td><pre>gid <span class=\"token operator\">=</span> <span class=\"token function\">rsync</span>         </pre></td></tr><tr><td data-num=\"27\"></td><td><pre>port <span class=\"token operator\">=</span> <span class=\"token number\">873</span>     </pre></td></tr><tr><td data-num=\"28\"></td><td><pre>fake super <span class=\"token operator\">=</span> <span class=\"token function\">yes</span>     </pre></td></tr><tr><td data-num=\"29\"></td><td><pre>use <span class=\"token function\">chroot</span> <span class=\"token operator\">=</span> no        </pre></td></tr><tr><td data-num=\"30\"></td><td><pre>max connections <span class=\"token operator\">=</span> <span class=\"token number\">200</span>  </pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token function\">timeout</span> <span class=\"token operator\">=</span> <span class=\"token number\">600</span>         </pre></td></tr><tr><td data-num=\"32\"></td><td><pre>ignore errors       </pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token builtin class-name\">read</span> only <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>    </pre></td></tr><tr><td data-num=\"34\"></td><td><pre>list <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>          </pre></td></tr><tr><td data-num=\"35\"></td><td><pre>auth <span class=\"token function\">users</span> <span class=\"token operator\">=</span> rsync_backup        </pre></td></tr><tr><td data-num=\"36\"></td><td><pre>secrets <span class=\"token function\">file</span> <span class=\"token operator\">=</span> /etc/rsync.passwd</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>log <span class=\"token function\">file</span> <span class=\"token operator\">=</span> /var/log/rsyncd.log    </pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token punctuation\">[</span>backup_mysql<span class=\"token punctuation\">]</span>       </pre></td></tr><tr><td data-num=\"39\"></td><td><pre>comment <span class=\"token operator\">=</span> welcome to rsync_backup</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>path <span class=\"token operator\">=</span> /backup/mysql  </pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token punctuation\">[</span>backup_file<span class=\"token punctuation\">]</span>         </pre></td></tr><tr><td data-num=\"42\"></td><td><pre>comment <span class=\"token operator\">=</span> welcome to rsync_backup</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>path <span class=\"token operator\">=</span> /backup/file</pre></td></tr></table></figure><h5 id=\"4-创建虚拟用户密码文件并设置权限\"><a class=\"anchor\" href=\"#4-创建虚拟用户密码文件并设置权限\">#</a> 4. 创建虚拟用户密码文件并设置权限</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/rsync.passwd</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>rsync_backup:your <span class=\"token function\">passwd</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chmod 600 /etc/rsync.passwd</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl restart rsyncd &amp;&amp; systemctl status rsyncd</span></pre></td></tr></table></figure><h5 id=\"5-检查服务端口是否开启\"><a class=\"anchor\" href=\"#5-检查服务端口是否开启\">#</a> 5. 检查服务端口是否开启</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># netstat -lntp | grep \"rsync\"</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>tcp        <span class=\"token number\">0</span>      <span class=\"token number\">0</span> <span class=\"token number\">0.0</span>.0.0:873             <span class=\"token number\">0.0</span>.0.0:*               LISTEN      <span class=\"token number\">20357</span>/rsync         </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>tcp6       <span class=\"token number\">0</span>      <span class=\"token number\">0</span> :::873                  :::*                    LISTEN      <span class=\"token number\">20357</span>/rsync</pre></td></tr></table></figure><h4 id=\"2-rsync客户端\"><a class=\"anchor\" href=\"#2-rsync客户端\">#</a> 2. rsync 客户端</h4>\n<h5 id=\"21-安装rsync\"><a class=\"anchor\" href=\"#21-安装rsync\">#</a> 2.1 安装 rsync</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@db01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum install nfs-utils -y</span></pre></td></tr></table></figure><h5 id=\"22-配置传输密码\"><a class=\"anchor\" href=\"#22-配置传输密码\">#</a> 2.2 配置传输密码</h5>\n<p>方法 1：将密码写入文件</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@db01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#  echo 'your passwd' > /etc/rsync.pass</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@db01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/rsync.pass </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>your <span class=\"token function\">passwd</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@db01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chmod 600 /etc/rsync.pass</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>--测试收发数据：</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@db01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># rsync -avz --password-file=/etc/rsync.pass /root/test rsync_backup@192.168.40.101::backup_file</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>sending incremental <span class=\"token function\">file</span> list</pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>sent <span class=\"token number\">47</span> bytes  received <span class=\"token number\">20</span> bytes  <span class=\"token number\">134.00</span> bytes/sec</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>total size is <span class=\"token number\">0</span>  speedup is <span class=\"token number\">0.00</span></pre></td></tr></table></figure><p>方法 2：使用密码环境变量 RSYNC_PASSWORD</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@db01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># export RSYNC_PASSWORD='your passwd'</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>--测试收发数据：</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@db01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># rsync -avz /root/test rsync_backup@192.168.40.101::backup_file</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>sending incremental <span class=\"token function\">file</span> list</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>sent <span class=\"token number\">47</span> bytes  received <span class=\"token number\">20</span> bytes  <span class=\"token number\">134.00</span> bytes/sec</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>total size is <span class=\"token number\">0</span>  speedup is <span class=\"token number\">0.00</span></pre></td></tr></table></figure><h3 id=\"ursync企业级备份案例u\"><a class=\"anchor\" href=\"#ursync企业级备份案例u\">#</a> <u>Rsync 企业级备份案例</u></h3>\n<p><strong>环境准备</strong></p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">主机名</th>\n<th style=\"text-align:center\"><strong>IP</strong></th>\n<th><strong>角色</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">server</td>\n<td style=\"text-align:center\">192.168.40.101</td>\n<td>rsync 服务端</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">client</td>\n<td style=\"text-align:center\">192.168.40.102</td>\n<td>rsync 客户</td>\n</tr>\n</tbody>\n</table>\n<p><strong>客户端需求</strong></p>\n<ul>\n<li>客户端每天凌晨 3 点备份 MySQL 至 /backup 下以 &quot;主机名_IP 地址_当前时间命名&quot; 的目录中</li>\n<li>客户端推送 /backup 目录下数据备份目录至 Rsync 备份服务器</li>\n<li>客户端只保留最近七天的备份数据，避免浪费磁盘空间</li>\n</ul>\n<p><strong>服务端需求</strong></p>\n<ul>\n<li>服务端部署 rsync 服务，用于接收用户的备份数据</li>\n<li>服务端每天校验客户端推送过来的数据是否完整，并将结果以邮件的方式发送给管理员</li>\n<li>服务端仅保留 6 个月的备份数据</li>\n</ul>\n<p><strong>注意</strong>：所有服务器的备份目录均为 /backup，所有脚本存放目录均为 /scripts。</p>\n<h4 id=\"1-服务端部署rsync服务\"><a class=\"anchor\" href=\"#1-服务端部署rsync服务\">#</a> <strong>1. 服务端部署 rsync 服务</strong></h4>\n<h5 id=\"11-关闭防火墙-selinux-2\"><a class=\"anchor\" href=\"#11-关闭防火墙-selinux-2\">#</a> 1.1 关闭防火墙、selinux</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># hostnamectl set-hostname backup</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># bash</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># hostnamectl set-hostname aizj_lb01</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl stop firewalld</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl disable firewalld</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># sed -i 's/^SELINUX=enforcing/SELINUX=disabled/g' /etc/sysconfig/selinux</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># sed -i 's/^SELINUX=enforcing/SELINUX=disabled/g' /etc/selinux/config</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum install net-tools vim tree lrzsz wget unzip dos2unix bash-completion  lsof ntp ntpdate git -y</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum update -y --exclude=kernel* &amp;&amp; reboot</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># echo 'Asia/Shanghai' >/etc/timezone</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ntpdate time2.aliyun.com</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># crontab -e</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>*/5 * * * * /usr/sbin/ntpdate time2.aliyun.com <span class=\"token operator\">&amp;></span> /dev/nul</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir /soft /data /scripts /backup</span></pre></td></tr></table></figure><h5 id=\"12-安装rsync-2\"><a class=\"anchor\" href=\"#12-安装rsync-2\">#</a> 1.2 安装 rsync</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum install -y rsync</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@server ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl start rsyncd</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@server ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl enable rsyncd</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># useradd -M -s /sbin/nologin rsync</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir -p /backup/mysql  /backup/file</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chown -R rsync.rsync /backup/mysql /backup/file</span></pre></td></tr></table></figure><h5 id=\"13-修改配置文件-2\"><a class=\"anchor\" href=\"#13-修改配置文件-2\">#</a> 1.3 修改配置文件</h5>\n<p><em><mark>#生产环境中取消注释，导致备份数据报错</mark></em></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#带注释配置文件</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim /etc/rsyncd.conf</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>uid <span class=\"token operator\">=</span> <span class=\"token function\">rsync</span>             <span class=\"token comment\">#运行服务的用户</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>gid <span class=\"token operator\">=</span> <span class=\"token function\">rsync</span>             <span class=\"token comment\">#运行服务的组</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>port <span class=\"token operator\">=</span> <span class=\"token number\">873</span>              <span class=\"token comment\">#服务监听端口</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>fake super <span class=\"token operator\">=</span> <span class=\"token function\">yes</span>        <span class=\"token comment\">#服务无需使用 root 用户身份，即可接收文件的完整属性</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>use <span class=\"token function\">chroot</span> <span class=\"token operator\">=</span> no         <span class=\"token comment\">#禁锢目录，不允许获取 root 权限</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>max connections <span class=\"token operator\">=</span> <span class=\"token number\">200</span>   <span class=\"token comment\">#最大连接数，最多能有多少个客户端跟服务端的 873 端口建立连接</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token function\">timeout</span> <span class=\"token operator\">=</span> <span class=\"token number\">600</span>           <span class=\"token comment\">#超时时间</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>ignore errors          <span class=\"token comment\">#忽略错误</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token builtin class-name\">read</span> only <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>      <span class=\"token comment\">#客户是否只读</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>list <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>           <span class=\"token comment\">#不允许查看模块信息</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>auth <span class=\"token function\">users</span> <span class=\"token operator\">=</span> rsync_backup         <span class=\"token comment\">#定义虚拟用户，用户数据传输</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>secrets <span class=\"token function\">file</span> <span class=\"token operator\">=</span> /etc/rsync.passwd  <span class=\"token comment\">#定义虚拟用户密码认证文件</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>log <span class=\"token function\">file</span> <span class=\"token operator\">=</span> /var/log/rsyncd.log    <span class=\"token comment\">#日志文件存放的位置</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">[</span>backup_mysql<span class=\"token punctuation\">]</span>         <span class=\"token comment\">#模块名</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>comment <span class=\"token operator\">=</span> welcome to rsync_backup</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>path <span class=\"token operator\">=</span> /backup/mysql   <span class=\"token comment\">#数据存放目录</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">[</span>backup_file<span class=\"token punctuation\">]</span>          <span class=\"token comment\">#模块名</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>comment <span class=\"token operator\">=</span> welcome to rsync_backup</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>path <span class=\"token operator\">=</span> /backup/file    <span class=\"token comment\">#数据存放目录 </span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">#不带注释配置文件</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/rsyncd.conf</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>uid <span class=\"token operator\">=</span> <span class=\"token function\">rsync</span>        </pre></td></tr><tr><td data-num=\"26\"></td><td><pre>gid <span class=\"token operator\">=</span> <span class=\"token function\">rsync</span>         </pre></td></tr><tr><td data-num=\"27\"></td><td><pre>port <span class=\"token operator\">=</span> <span class=\"token number\">873</span>     </pre></td></tr><tr><td data-num=\"28\"></td><td><pre>fake super <span class=\"token operator\">=</span> <span class=\"token function\">yes</span>     </pre></td></tr><tr><td data-num=\"29\"></td><td><pre>use <span class=\"token function\">chroot</span> <span class=\"token operator\">=</span> no        </pre></td></tr><tr><td data-num=\"30\"></td><td><pre>max connections <span class=\"token operator\">=</span> <span class=\"token number\">200</span>  </pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token function\">timeout</span> <span class=\"token operator\">=</span> <span class=\"token number\">600</span>         </pre></td></tr><tr><td data-num=\"32\"></td><td><pre>ignore errors       </pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token builtin class-name\">read</span> only <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>    </pre></td></tr><tr><td data-num=\"34\"></td><td><pre>list <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>          </pre></td></tr><tr><td data-num=\"35\"></td><td><pre>auth <span class=\"token function\">users</span> <span class=\"token operator\">=</span> rsync_backup        </pre></td></tr><tr><td data-num=\"36\"></td><td><pre>secrets <span class=\"token function\">file</span> <span class=\"token operator\">=</span> /etc/rsync.passwd</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>log <span class=\"token function\">file</span> <span class=\"token operator\">=</span> /var/log/rsyncd.log    </pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token punctuation\">[</span>backup_mysql<span class=\"token punctuation\">]</span>       </pre></td></tr><tr><td data-num=\"39\"></td><td><pre>comment <span class=\"token operator\">=</span> welcome to rsync_backup</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>path <span class=\"token operator\">=</span> /backup/mysql  </pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token punctuation\">[</span>backup_file<span class=\"token punctuation\">]</span>         </pre></td></tr><tr><td data-num=\"42\"></td><td><pre>comment <span class=\"token operator\">=</span> welcome to rsync_backup</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>path <span class=\"token operator\">=</span> /backup/file</pre></td></tr></table></figure><h5 id=\"4-创建虚拟用户密码文件并设置权限-2\"><a class=\"anchor\" href=\"#4-创建虚拟用户密码文件并设置权限-2\">#</a> 4. 创建虚拟用户密码文件并设置权限</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/rsync.passwd</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>rsync_backup:your <span class=\"token function\">passwd</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chmod 600 /etc/rsync.passwd</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl restart rsyncd &amp;&amp; systemctl status rsyncd</span></pre></td></tr></table></figure><h5 id=\"5-检查服务端口是否开启-2\"><a class=\"anchor\" href=\"#5-检查服务端口是否开启-2\">#</a> 5. 检查服务端口是否开启</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># netstat -lntp | grep \"rsync\"</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>tcp        <span class=\"token number\">0</span>      <span class=\"token number\">0</span> <span class=\"token number\">0.0</span>.0.0:873             <span class=\"token number\">0.0</span>.0.0:*               LISTEN      <span class=\"token number\">20357</span>/rsync         </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>tcp6       <span class=\"token number\">0</span>      <span class=\"token number\">0</span> :::873                  :::*                    LISTEN      <span class=\"token number\">20357</span>/rsync</pre></td></tr></table></figure><h4 id=\"2-rsync客户端-2\"><a class=\"anchor\" href=\"#2-rsync客户端-2\">#</a> 2. rsync 客户端</h4>\n<h5 id=\"21-安装rsync-2\"><a class=\"anchor\" href=\"#21-安装rsync-2\">#</a> 2.1 安装 rsync</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@db01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum install nfs-utils -y</span></pre></td></tr></table></figure><h5 id=\"22-测试客户端备份数据并推送至rsync服务器\"><a class=\"anchor\" href=\"#22-测试客户端备份数据并推送至rsync服务器\">#</a> 2.2 测试客户端备份数据并推送至 rsync 服务器</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@db01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># export RSYNC_PASSWORD='your passwd'</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@db01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># rsync -avz /root/test rsync_backup@192.168.40.101::backup_file</span></pre></td></tr></table></figure><h5 id=\"23-客户端备份数据并推送至rsync服务器\"><a class=\"anchor\" href=\"#23-客户端备份数据并推送至rsync服务器\">#</a> <strong>2.3 客户端备份数据并推送至 rsync 服务器</strong></h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@db01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir /scripts</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@db01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /scripts/mysql_backup.sh </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#!/bin/bash</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">PATH</span></span><span class=\"token operator\">=</span>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">#1、定义变量</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token assign-left variable\">Host</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">hostname</span><span class=\"token variable\">)</span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token assign-left variable\">Ip</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">ifconfig</span> ens192 <span class=\"token operator\">|</span> <span class=\"token function\">awk</span> <span class=\"token string\">'NR==2&#123;print $2&#125;'</span><span class=\"token variable\">)</span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token assign-left variable\">Date</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">date</span> +%F<span class=\"token variable\">)</span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token assign-left variable\">BackupDir</span><span class=\"token operator\">=</span>/backup/mysql</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token assign-left variable\">Dest</span><span class=\"token operator\">=</span><span class=\"token variable\">$&#123;BackupDir&#125;</span>/<span class=\"token variable\">$&#123;Host&#125;</span>_<span class=\"token variable\">$&#123;Ip&#125;</span>_<span class=\"token variable\">$&#123;Date&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token assign-left variable\">FILE_NAME</span><span class=\"token operator\">=</span>mysql_backup_<span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">date</span> <span class=\"token string\">'+%Y%m%d%H%M%S'</span><span class=\"token variable\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token assign-left variable\">OLDBINLOG</span><span class=\"token operator\">=</span>/var/lib/mysql/oldbinlog</pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">#2、创建备份目录</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token operator\">!</span> <span class=\"token parameter variable\">-d</span> <span class=\"token variable\">$Dest</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> <span class=\"token variable\">$Dest</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">fi</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">#3、备份目录</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>/usr/bin/mysqldump -u<span class=\"token string\">'root'</span> -p<span class=\"token string\">'your passwd'</span> nf_flms <span class=\"token operator\">></span> <span class=\"token variable\">$Dest</span>/nf-flms_<span class=\"token variable\">$&#123;FILE_NAME&#125;</span>.sql</pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token function\">tar</span> <span class=\"token parameter variable\">-czvf</span> <span class=\"token variable\">$Dest</span>/<span class=\"token variable\">$&#123;FILE_NAME&#125;</span>.tar.gz <span class=\"token variable\">$Dest</span>/nf-flms_<span class=\"token variable\">$&#123;FILE_NAME&#125;</span>.sql</pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token function\">rm</span> <span class=\"token parameter variable\">-rf</span> <span class=\"token variable\">$Dest</span>/*<span class=\"token variable\">$&#123;FILE_NAME&#125;</span>.sql</pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Your database backup successfully\"</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token comment\">#4、校验</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>md5sum <span class=\"token variable\">$Dest</span>/* <span class=\"token operator\">></span><span class=\"token variable\">$Dest</span>/backup_check_<span class=\"token variable\">$Date</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token comment\">#5、将备份目录推动到 rsync 服务端</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token assign-left variable\">Rsync_Ip</span><span class=\"token operator\">=</span><span class=\"token number\">192.168</span>.1.145</pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token assign-left variable\">Rsync_user</span><span class=\"token operator\">=</span>rsync_backup</pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token assign-left variable\">Rsync_Module</span><span class=\"token operator\">=</span>backup_mysql</pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">RSYNC_PASSWORD</span><span class=\"token operator\">=</span>your <span class=\"token function\">passwd</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token function\">rsync</span> <span class=\"token parameter variable\">-avz</span> <span class=\"token variable\">$Dest</span> <span class=\"token variable\">$Rsync_user</span>@<span class=\"token variable\">$Rsync_Ip</span>::<span class=\"token variable\">$Rsync_Module</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token comment\">#6、删除 15 天备份目录</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token function\">find</span> <span class=\"token variable\">$Dest</span> <span class=\"token parameter variable\">-type</span> d <span class=\"token parameter variable\">-mtime</span> +15 <span class=\"token operator\">|</span> <span class=\"token function\">xargs</span> <span class=\"token function\">rm</span> <span class=\"token parameter variable\">-rf</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"remove file  successfully\"</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token punctuation\">[</span>root@db01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chmod +x /scripts/etc_backup.sh</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token punctuation\">[</span>root@db01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># crontab -e</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>00 03 * * * /bin/bash /scripts/mysql_backup.sh <span class=\"token operator\">&amp;></span> /dev/null</pre></td></tr></table></figure><h5 id=\"24-服务端校验数据并将结果以邮件发送给管理员\"><a class=\"anchor\" href=\"#24-服务端校验数据并将结果以邮件发送给管理员\">#</a> <strong>2.4 服务端校验数据并将结果以邮件发送给管理员</strong></h5>\n<h6 id=\"241-配置邮件服务\"><a class=\"anchor\" href=\"#241-配置邮件服务\">#</a> 2.4.1 配置邮件服务</h6>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum -y install mailx</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/mail.rc      #最后一行插入</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token builtin class-name\">set</span> <span class=\"token assign-left variable\">from</span><span class=\"token operator\">=</span><span class=\"token number\">373370405</span>@qq.com</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token builtin class-name\">set</span> <span class=\"token assign-left variable\">smtp</span><span class=\"token operator\">=</span>smtps://smtp.qq.com:465</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token builtin class-name\">set</span> smtp-auth-user<span class=\"token operator\">=</span><span class=\"token number\">373370405</span>@qq.com</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token builtin class-name\">set</span> smtp-auth-password<span class=\"token operator\">=</span>**********   <span class=\"token comment\"># 发件邮箱的授权码</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token builtin class-name\">set</span> smtp-auth<span class=\"token operator\">=</span>login</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token builtin class-name\">set</span> ssl-verify<span class=\"token operator\">=</span>ignore</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token builtin class-name\">set</span> nss-config-dir<span class=\"token operator\">=</span>/etc/pki/nssdb</pre></td></tr></table></figure><h6 id=\"242-发送邮件测试\"><a class=\"anchor\" href=\"#242-发送邮件测试\">#</a> 2.4.2 发送邮件测试</h6>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#  echo Hello World | mail -s test 373370405@qq.com &amp;> /dev/null</span></pre></td></tr></table></figure><h6 id=\"243-配置脚本校验数据并将结果发送给管理员\"><a class=\"anchor\" href=\"#243-配置脚本校验数据并将结果发送给管理员\">#</a> 2.4.3 配置脚本校验数据并将结果发送给管理员</h6>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup mysql<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /scripts/check_backup.sh </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#!/bin/bash</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">PATH</span></span><span class=\"token operator\">=</span>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#1、定义变量</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token assign-left variable\">Path</span><span class=\"token operator\">=</span>/backup/mysql</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token assign-left variable\">Date</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">date</span> +%F<span class=\"token variable\">)</span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">#2、查看 flag 文件，并对对文件进行校验，然后将校验的结果保存至 result_时间</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token function\">find</span> <span class=\"token variable\">$Path</span> <span class=\"token parameter variable\">-type</span> f <span class=\"token parameter variable\">-name</span> <span class=\"token string\">\"backup_check_<span class=\"token variable\">$&#123;Date&#125;</span>*\"</span><span class=\"token operator\">|</span><span class=\"token function\">xargs</span> md5sum <span class=\"token parameter variable\">-c</span> <span class=\"token operator\">></span><span class=\"token variable\">$Path</span>/result_<span class=\"token variable\">$&#123;Date&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">#3、将校验结果发送邮件给管理员</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>mail <span class=\"token parameter variable\">-s</span> <span class=\"token string\">\"Mysql Backup\"</span> <span class=\"token number\">373370405</span>@qq.com <span class=\"token operator\">&lt;</span><span class=\"token variable\">$Path</span>/result_<span class=\"token variable\">$&#123;Date&#125;</span> <span class=\"token operator\">&amp;></span> /dev/null</pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">#4、删除超过 7 天的校验结果文件，删除超过 180 天的备份数据文件</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token function\">find</span> <span class=\"token variable\">$Path</span> <span class=\"token parameter variable\">-type</span> f <span class=\"token parameter variable\">-name</span> <span class=\"token string\">\"result*\"</span> <span class=\"token parameter variable\">-mtime</span> +7 <span class=\"token operator\">|</span> <span class=\"token function\">xargs</span> <span class=\"token function\">rm</span> <span class=\"token parameter variable\">-rf</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token function\">find</span> <span class=\"token variable\">$Path</span> <span class=\"token parameter variable\">-type</span> f <span class=\"token parameter variable\">-mtime</span> +180 <span class=\"token operator\">|</span> <span class=\"token function\">xargs</span> <span class=\"token function\">rm</span> <span class=\"token parameter variable\">-rf</span></pre></td></tr></table></figure><h6 id=\"244-写计划任务\"><a class=\"anchor\" href=\"#244-写计划任务\">#</a> <strong>2.4.4 写计划任务</strong></h6>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chmod +x /scripts/check_backup.sh </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@db01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># crontab -e</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>00 06 * * * /bin/bash /scripts/mysql_backup.sh <span class=\"token operator\">&amp;></span> /dev/null</pre></td></tr></table></figure><h3 id=\"rsyncsersync实现数据实时同步\"><a class=\"anchor\" href=\"#rsyncsersync实现数据实时同步\">#</a> Rsync+sersync 实现数据实时同步</h3>\n<p><strong>环境准备</strong></p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">主机名</th>\n<th style=\"text-align:center\"><strong>IP</strong></th>\n<th><strong>角色</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">server</td>\n<td style=\"text-align:center\">192.168.40.101</td>\n<td>rsync 服务端</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">client</td>\n<td style=\"text-align:center\">192.168.40.102</td>\n<td>rsync 客户</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"1rsync服务端-2\"><a class=\"anchor\" href=\"#1rsync服务端-2\">#</a> 1.rsync 服务端</h4>\n<h5 id=\"11-关闭防火墙-selinux-3\"><a class=\"anchor\" href=\"#11-关闭防火墙-selinux-3\">#</a> 1.1 关闭防火墙、selinux</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># hostnamectl set-hostname backup</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># bash</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># hostnamectl set-hostname aizj_lb01</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl stop firewalld</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl disable firewalld</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># sed -i 's/^SELINUX=enforcing/SELINUX=disabled/g' /etc/sysconfig/selinux</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># sed -i 's/^SELINUX=enforcing/SELINUX=disabled/g' /etc/selinux/config</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum install net-tools vim tree lrzsz wget unzip dos2unix bash-completion  lsof ntp ntpdate git -y</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum update -y --exclude=kernel* &amp;&amp; reboot</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># echo 'Asia/Shanghai' >/etc/timezone</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ntpdate time2.aliyun.com</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># crontab -e</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>*/5 * * * * /usr/sbin/ntpdate time2.aliyun.com <span class=\"token operator\">&amp;></span> /dev/nul</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir /soft /data /scripts /backup</span></pre></td></tr></table></figure><h5 id=\"12-安装rsync-3\"><a class=\"anchor\" href=\"#12-安装rsync-3\">#</a> 1.2 安装 rsync</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum install -y rsync</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@server ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl start rsyncd</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@server ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl enable rsyncd</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># useradd -M -s /sbin/nologin rsync</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir -p /backup/mysql  /backup/file</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chown -R rsync.rsync /backup/mysql /backup/file</span></pre></td></tr></table></figure><h5 id=\"13-修改配置文件-3\"><a class=\"anchor\" href=\"#13-修改配置文件-3\">#</a> 1.3 修改配置文件</h5>\n<p><em><mark>#生产环境中取消注释，导致备份数据报错</mark></em></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#带注释配置文件</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim /etc/rsyncd.conf</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>uid <span class=\"token operator\">=</span> <span class=\"token function\">rsync</span>             <span class=\"token comment\">#运行服务的用户</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>gid <span class=\"token operator\">=</span> <span class=\"token function\">rsync</span>             <span class=\"token comment\">#运行服务的组</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>port <span class=\"token operator\">=</span> <span class=\"token number\">873</span>              <span class=\"token comment\">#服务监听端口</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>fake super <span class=\"token operator\">=</span> <span class=\"token function\">yes</span>        <span class=\"token comment\">#服务无需使用 root 用户身份，即可接收文件的完整属性</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>use <span class=\"token function\">chroot</span> <span class=\"token operator\">=</span> no         <span class=\"token comment\">#禁锢目录，不允许获取 root 权限</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>max connections <span class=\"token operator\">=</span> <span class=\"token number\">200</span>   <span class=\"token comment\">#最大连接数，最多能有多少个客户端跟服务端的 873 端口建立连接</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token function\">timeout</span> <span class=\"token operator\">=</span> <span class=\"token number\">600</span>           <span class=\"token comment\">#超时时间</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>ignore errors          <span class=\"token comment\">#忽略错误</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token builtin class-name\">read</span> only <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>      <span class=\"token comment\">#客户是否只读</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>list <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>           <span class=\"token comment\">#不允许查看模块信息</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>auth <span class=\"token function\">users</span> <span class=\"token operator\">=</span> rsync_backup         <span class=\"token comment\">#定义虚拟用户，用户数据传输</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>secrets <span class=\"token function\">file</span> <span class=\"token operator\">=</span> /etc/rsync.passwd  <span class=\"token comment\">#定义虚拟用户密码认证文件</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>log <span class=\"token function\">file</span> <span class=\"token operator\">=</span> /var/log/rsyncd.log    <span class=\"token comment\">#日志文件存放的位置</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">[</span>backup_mysql<span class=\"token punctuation\">]</span>         <span class=\"token comment\">#模块名</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>comment <span class=\"token operator\">=</span> welcome to rsync_backup</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>path <span class=\"token operator\">=</span> /backup/mysql   <span class=\"token comment\">#数据存放目录</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">[</span>backup_file<span class=\"token punctuation\">]</span>          <span class=\"token comment\">#模块名</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>comment <span class=\"token operator\">=</span> welcome to rsync_backup</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>path <span class=\"token operator\">=</span> /backup/file    <span class=\"token comment\">#数据存放目录 </span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">#不带注释配置文件</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/rsyncd.conf</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>uid <span class=\"token operator\">=</span> <span class=\"token function\">rsync</span>        </pre></td></tr><tr><td data-num=\"26\"></td><td><pre>gid <span class=\"token operator\">=</span> <span class=\"token function\">rsync</span>         </pre></td></tr><tr><td data-num=\"27\"></td><td><pre>port <span class=\"token operator\">=</span> <span class=\"token number\">873</span>     </pre></td></tr><tr><td data-num=\"28\"></td><td><pre>fake super <span class=\"token operator\">=</span> <span class=\"token function\">yes</span>     </pre></td></tr><tr><td data-num=\"29\"></td><td><pre>use <span class=\"token function\">chroot</span> <span class=\"token operator\">=</span> no        </pre></td></tr><tr><td data-num=\"30\"></td><td><pre>max connections <span class=\"token operator\">=</span> <span class=\"token number\">200</span>  </pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token function\">timeout</span> <span class=\"token operator\">=</span> <span class=\"token number\">600</span>         </pre></td></tr><tr><td data-num=\"32\"></td><td><pre>ignore errors       </pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token builtin class-name\">read</span> only <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>    </pre></td></tr><tr><td data-num=\"34\"></td><td><pre>list <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>          </pre></td></tr><tr><td data-num=\"35\"></td><td><pre>auth <span class=\"token function\">users</span> <span class=\"token operator\">=</span> rsync_backup        </pre></td></tr><tr><td data-num=\"36\"></td><td><pre>secrets <span class=\"token function\">file</span> <span class=\"token operator\">=</span> /etc/rsync.passwd</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>log <span class=\"token function\">file</span> <span class=\"token operator\">=</span> /var/log/rsyncd.log    </pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token punctuation\">[</span>backup_mysql<span class=\"token punctuation\">]</span>       </pre></td></tr><tr><td data-num=\"39\"></td><td><pre>comment <span class=\"token operator\">=</span> welcome to rsync_backup</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>path <span class=\"token operator\">=</span> /backup/mysql  </pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token punctuation\">[</span>backup_file<span class=\"token punctuation\">]</span>         </pre></td></tr><tr><td data-num=\"42\"></td><td><pre>comment <span class=\"token operator\">=</span> welcome to rsync_backup</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>path <span class=\"token operator\">=</span> /backup/file</pre></td></tr></table></figure><h5 id=\"4-创建虚拟用户密码文件并设置权限-3\"><a class=\"anchor\" href=\"#4-创建虚拟用户密码文件并设置权限-3\">#</a> 4. 创建虚拟用户密码文件并设置权限</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/rsync.passwd</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>rsync_backup:your <span class=\"token function\">passwd</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chmod 600 /etc/rsync.passwd</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl restart rsyncd &amp;&amp; systemctl status rsyncd</span></pre></td></tr></table></figure><h5 id=\"5-检查服务端口是否开启-3\"><a class=\"anchor\" href=\"#5-检查服务端口是否开启-3\">#</a> 5. 检查服务端口是否开启</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># netstat -lntp | grep \"rsync\"</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>tcp        <span class=\"token number\">0</span>      <span class=\"token number\">0</span> <span class=\"token number\">0.0</span>.0.0:873             <span class=\"token number\">0.0</span>.0.0:*               LISTEN      <span class=\"token number\">20357</span>/rsync         </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>tcp6       <span class=\"token number\">0</span>      <span class=\"token number\">0</span> :::873                  :::*                    LISTEN      <span class=\"token number\">20357</span>/rsync</pre></td></tr></table></figure><h4 id=\"2-客户端安装sersync\"><a class=\"anchor\" href=\"#2-客户端安装sersync\">#</a> 2. 客户端安装 sersync</h4>\n<p><strong>2.1 安装 sercync 依赖</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum install -y inotify-tools rsync</span></pre></td></tr></table></figure><p><strong>2.2 安装 sercync</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir -p /soft</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cd /soft/</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># wget https://down.whsir.com/downloads/sersync2.5.4_64bit_binary_stable_final.tar.gz</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs soft<span class=\"token punctuation\">]</span><span class=\"token comment\"># tar -xf sersync2.5.4_64bit_binary_stable_final.tar.gz</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs soft<span class=\"token punctuation\">]</span><span class=\"token comment\"># mv GNU-Linux-x86 /usr/local/sersync</span></pre></td></tr></table></figure><h5 id=\"23-修改配置文件\"><a class=\"anchor\" href=\"#23-修改配置文件\">#</a> 2.3 <strong>修改配置文件</strong></h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs soft<span class=\"token punctuation\">]</span><span class=\"token comment\"># cd /usr/local/sersync/</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs sersync<span class=\"token punctuation\">]</span><span class=\"token comment\"># cp confxml.xml confxml.xml.bak</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs sersync<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim confxml.xml</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">5</span>    <span class=\"token operator\">&lt;</span>fileSystem <span class=\"token assign-left variable\">xfs</span><span class=\"token operator\">=</span><span class=\"token string\">\"true\"</span>/<span class=\"token operator\">></span>    <span class=\"token comment\">#第 5 行 false 改为 true</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">13</span>          <span class=\"token operator\">&lt;</span>delete <span class=\"token assign-left variable\">start</span><span class=\"token operator\">=</span><span class=\"token string\">\"true\"</span>/<span class=\"token operator\">></span> <span class=\"token comment\">#第 13-20 行 false 改为 true,# 说明：监控以上变化推送</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">14</span>        <span class=\"token operator\">&lt;</span>createFolder <span class=\"token assign-left variable\">start</span><span class=\"token operator\">=</span><span class=\"token string\">\"true\"</span>/<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">15</span>        <span class=\"token operator\">&lt;</span>createFile <span class=\"token assign-left variable\">start</span><span class=\"token operator\">=</span><span class=\"token string\">\"false\"</span>/<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">16</span>        <span class=\"token operator\">&lt;</span>closeWrite <span class=\"token assign-left variable\">start</span><span class=\"token operator\">=</span><span class=\"token string\">\"true\"</span>/<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">17</span>        <span class=\"token operator\">&lt;</span>moveFrom <span class=\"token assign-left variable\">start</span><span class=\"token operator\">=</span><span class=\"token string\">\"true\"</span>/<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">18</span>        <span class=\"token operator\">&lt;</span>moveTo <span class=\"token assign-left variable\">start</span><span class=\"token operator\">=</span><span class=\"token string\">\"true\"</span>/<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token number\">19</span>        <span class=\"token operator\">&lt;</span>attrib <span class=\"token assign-left variable\">start</span><span class=\"token operator\">=</span><span class=\"token string\">\"true\"</span>/<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token number\">20</span>        <span class=\"token operator\">&lt;</span>modify <span class=\"token assign-left variable\">start</span><span class=\"token operator\">=</span><span class=\"token string\">\"true\"</span>/<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token number\">24</span>        <span class=\"token operator\">&lt;</span>localpath <span class=\"token assign-left variable\">watch</span><span class=\"token operator\">=</span><span class=\"token string\">\"/data\"</span><span class=\"token operator\">></span>      <span class=\"token comment\">#监控的本地目录</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token number\">25</span>             <span class=\"token operator\">&lt;</span>remote <span class=\"token assign-left variable\">ip</span><span class=\"token operator\">=</span><span class=\"token string\">\"192.168.1.145\"</span> <span class=\"token assign-left variable\">name</span><span class=\"token operator\">=</span><span class=\"token string\">\"backup_file\"</span>/<span class=\"token operator\">></span>  <span class=\"token comment\">#rsync 服务端 IP 和模块名 backup_file</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token number\">30</span>      <span class=\"token operator\">&lt;</span>commonParams <span class=\"token assign-left variable\">params</span><span class=\"token operator\">=</span><span class=\"token string\">\"-avz\"</span>/<span class=\"token operator\">></span>  <span class=\"token comment\">#rsync 命令选项</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token number\">31</span>      <span class=\"token operator\">&lt;</span>auth <span class=\"token assign-left variable\">start</span><span class=\"token operator\">=</span><span class=\"token string\">\"true\"</span> <span class=\"token assign-left variable\">users</span><span class=\"token operator\">=</span><span class=\"token string\">\"rsync_backup\"</span> <span class=\"token assign-left variable\">passwordfile</span><span class=\"token operator\">=</span><span class=\"token string\">\"/etc/rsync.passwd\"</span>/<span class=\"token operator\">></span> <span class=\"token comment\">#rsync 认证信息</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr></table></figure><h5 id=\"24-生成密码文件\"><a class=\"anchor\" href=\"#24-生成密码文件\">#</a> 2.4 生成密码文件</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs sersync<span class=\"token punctuation\">]</span><span class=\"token comment\"># echo 'your passwd' > /etc/rsync.passwd</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs sersync<span class=\"token punctuation\">]</span><span class=\"token comment\"># chmod 600 /etc/rsync.passwd</span></pre></td></tr></table></figure><h5 id=\"25-启动sersync\"><a class=\"anchor\" href=\"#25-启动sersync\">#</a> 2.5 启动 sersync</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs sersync<span class=\"token punctuation\">]</span><span class=\"token comment\"># ln -s /usr/local/sersync/sersync2 /usr/bin/</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs sersync<span class=\"token punctuation\">]</span><span class=\"token comment\"># sersync2 -dro /usr/local/sersync/confxml.xml     #针对配置文件 confxml.xml 启动 sersync</span></pre></td></tr></table></figure><p><strong>2.5 设置 sersync 开机自启</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@qzj_nfs sersync<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim /etc/rc.d/rc.local   </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>/usr/local/sersync/sersync2 <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">-r</span> <span class=\"token parameter variable\">-o</span>  /usr/local/sersync/confxml.xml  <span class=\"token comment\">#在最后添加一行</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@qzj_nfs sersync<span class=\"token punctuation\">]</span><span class=\"token comment\"># chmod +x /etc/rc.d/rc.local</span></pre></td></tr></table></figure><p><strong>2.6 测试</strong></p>\n<p><em>在客户端 /data 目录增删改目录文件，rsync 服务端数据存放目录变化</em></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup backup<span class=\"token punctuation\">]</span><span class=\"token comment\"># watch ls</span></pre></td></tr></table></figure><p><strong>2.7 添加脚本监控 sersync 是否正常运行</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs sersync<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /scripts/check_sersync.sh </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#!/bin/sh</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token assign-left variable\">sersync</span><span class=\"token operator\">=</span><span class=\"token string\">\"/usr/local/sersync/sersync2\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">confxml</span><span class=\"token operator\">=</span><span class=\"token string\">\"/usr/local/sersync/confxml.xml\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token assign-left variable\">status</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">ps</span> aux <span class=\"token operator\">|</span><span class=\"token function\">grep</span> <span class=\"token string\">'sersync2'</span><span class=\"token operator\">|</span><span class=\"token function\">grep</span> <span class=\"token parameter variable\">-v</span> <span class=\"token string\">'grep'</span><span class=\"token operator\">|</span><span class=\"token function\">wc</span> <span class=\"token parameter variable\">-l</span><span class=\"token variable\">)</span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token variable\">$status</span> <span class=\"token parameter variable\">-eq</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token variable\">$sersync</span> <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">-r</span> <span class=\"token parameter variable\">-o</span> <span class=\"token variable\">$confxml</span> <span class=\"token operator\">&amp;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token builtin class-name\">exit</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">fi</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs sersync<span class=\"token punctuation\">]</span><span class=\"token comment\"># chmod +x /scripts/check_sersync.sh</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs sersync<span class=\"token punctuation\">]</span><span class=\"token comment\"># crontab -l</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>*/5 * * * * /usr/bin/sh /scripts/check_sersync.sh <span class=\"token operator\">&amp;></span> /dev/null</pre></td></tr></table></figure><p><em><strong>补充： 多实例情况</strong></em><br />\n 1、配置多个 confxml.xml 文件（比如：www、bbs、blog.... 等等）<br />\n2、修改端口、同步路径、模块名称<br />\n 3、根据不同的需求同步对应的实例文件<br />\n /usr/local/sersync/sersync2 -dro /usr/local/sersync/www_confxml.xml<br />\n/usr/local/sersync/sersync2 -dro /usr/local/sersync/bbs_confxml.xml</p>\n",
            "tags": [
                "rsync"
            ]
        }
    ]
}