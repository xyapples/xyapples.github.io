{
    "version": "https://jsonfeed.org/version/1",
    "title": "LinuxSre云原生 • All posts by \"linux\" category",
    "description": "专注于 Linux 运维、云计算、云原⽣等技术",
    "home_page_url": "http://ixuyong.cn",
    "items": [
        {
            "id": "http://ixuyong.cn/posts/4120829732.html",
            "url": "http://ixuyong.cn/posts/4120829732.html",
            "title": "DNS域名解析服务",
            "date_published": "2025-09-19T14:12:25.000Z",
            "content_html": "<h3 id=\"dns域名解析服务\"><a class=\"anchor\" href=\"#dns域名解析服务\">#</a> DNS 域名解析服务</h3>\n<h4 id=\"1-dns基本概述\"><a class=\"anchor\" href=\"#1-dns基本概述\">#</a> 1. DNS 基本概述</h4>\n<h5 id=\"11-为什么需要域名\"><a class=\"anchor\" href=\"#11-为什么需要域名\">#</a> 1.1 为什么需要域名</h5>\n<p>在互联网中，使用 IP 地址与服务器进行通信根本行不通，原因如下：</p>\n<ul>\n<li>1、不好记忆，例如：学校官网的 IP 地址是 &quot;39.104.16.126&quot; ，难以记忆；</li>\n<li>2、IP 地址会经常变更，所以通过 IP 地址去访问某台机器就会发生访不到的问题；</li>\n</ul>\n<p>此时 DNS 协议就应运而生了，那 DNS 解决了什么问题？DNS 主要用来管理域名（比较好记忆的字符）与 IP 地址（比较难记忆）的对应关系表。</p>\n<h5 id=\"12-什么是dns\"><a class=\"anchor\" href=\"#12-什么是dns\">#</a> 1.2 什么是 DNS</h5>\n<p>DNS（Domain Name System） 是 ” 域名系统 “英文缩写，它所提供的服务是用来将域名转换为 IP 地址的工作。 DNS 就是一位” 翻译官 “，它的基本工作原理可以用下图来表示；</p>\n<p><img loading=\"lazy\" data-src=\"https://wp-cdn.4ce.cn/v2/S1Ee9BX.jpeg\" alt=\"1.jpg\" /></p>\n<h5 id=\"13-dns域名结构\"><a class=\"anchor\" href=\"#13-dns域名结构\">#</a> 1.3 DNS 域名结构</h5>\n<p>由于因特网的用户数量较多，所以因特网在命名时采用的是层次树状结构的命名方法。</p>\n<ul>\n<li>1. 互联网中的域名是有结构有规划的；</li>\n<li>2. 由于域名进行了分级，在进行域名和 IP 地址解析时能更容易找到；</li>\n<li>3. 其次域名具备全球唯一性；</li>\n</ul>\n<p><img loading=\"lazy\" data-src=\"https://wp-cdn.4ce.cn/v2/ec0zOe9.png\" alt=\"918540-20230506205656234-525954592.png\" /></p>\n<h5 id=\"14-域名分类\"><a class=\"anchor\" href=\"#14-域名分类\">#</a> 1.4 域名分类</h5>\n<ul>\n<li>\n<p>根域：知道所有顶级域名服务器的域名和地址全世界只有 13 组根服务器，其中 10 台设置在美国，另外的三台设置与英国，瑞典，日本；</p>\n</li>\n<li>\n<p>顶级域：知道所有顶级域名服务器下注册的所有二级域名的 IP 地址。</p>\n<ul>\n<li>\n<p>顶级域有两种：通用域 （com） 域和国家域 （cn【包括 hk/tw】、jp）。</p>\n</li>\n<li>\n<p>顶级域名由 ICANN （互联网名称与数字地址分配机构）委任的注册机构负责运行。</p>\n</li>\n</ul>\n</li>\n<li>\n<p>二级域：负责一个区的域名服务器 （<a href=\"http://hmallleasing.com\">hmallleasing.com</a>）</p>\n<ul>\n<li>无需到 ICANN 进行申请，只需要到运行顶级域的注册机构（阿里、腾讯）去申请即可。</li>\n<li>如果申请的域名没有被注册，也没有被注册为商标，仅需要缴纳一笔年费即可得到心仪的域名。</li>\n</ul>\n</li>\n<li>\n<p>三级域或主机名：根据服务器所提供的业务功能，选择配置对应的主机名称解析记录，比如（www、ops）</p>\n</li>\n</ul>\n<h5 id=\"15-dns查询原理\"><a class=\"anchor\" href=\"#15-dns查询原理\">#</a> 1.5 DNS 查询原理</h5>\n<p>DNS 查询的结果通常会在本地域名服务器中进行缓存，如果本地域名服务器中有缓存的情况下，则会跳过如下 DNS 查询步骤，很快返回解析结果。<br />\n下面的示例则概述了本地域名服务器没有缓存的情况下， DNS 查询所需的步骤：</p>\n<ul>\n<li>1、用户在浏览器中输入 <a href=\"http://example.com\">example.com</a> ， 则由本地域名服务器开始进行递归查询。</li>\n<li>2、本地域名服务器采用迭代查询的方法，向根域名服务器进行查询。</li>\n<li>3、根域名服务器告诉本地域名服务器，下一步应该查询的顶级域名服务器 .TLD 的 IP 地址。</li>\n<li>4、本地域名服务器向顶级域名服务器 .com TLD 进行查询。</li>\n<li>5、.com TLD 服务器告诉本地域名服务器，下一步查询 <a href=\"http://example.com\">example.com</a> 权威域名服务器的 IP 地址。</li>\n<li>6、本地域名服务器向 <a href=\"http://example.com\">example.com</a> 权威域名服务器发送查询。</li>\n<li>7、<a href=\"http://example.com\">example.com</a> 权威域名服务器告诉本地域名服务器所查询的主机 IP 地址。</li>\n<li>8、本地域名服务器最后把查询的 IP 地址响应给浏览器。</li>\n</ul>\n<p><img loading=\"lazy\" data-src=\"https://wp-cdn.4ce.cn/v2/tskD255.jpeg\" alt=\"Snipaste_2025-09-19_22-27-08.jpg\" /></p>\n<h6 id=\"151-递归查询\"><a class=\"anchor\" href=\"#151-递归查询\">#</a> 1.5.1 递归查询</h6>\n<p>递归查询是指 DNS 服务器在收到用户发起的请求时，必须向用户返回一个准确的查询结果。<br />\n如果 DNS 服务器本地没有存储与之对应的信息，则该服务器需要询问其他服务器，并将返回的查询结构提交给用户。</p>\n<h6 id=\"152-迭代查询\"><a class=\"anchor\" href=\"#152-迭代查询\">#</a> 1.5.2 迭代查询</h6>\n<p>迭代查询是指 DNS 服务器在收到用户发起的请求时，并不直接回复查询结果，而是告诉另一台 DNS 服务器的地址，用户再向这台 DNS 服务器提交请求，这样依次反复，直到返回查询结果。</p>\n<h5 id=\"16-dns解析类型\"><a class=\"anchor\" href=\"#16-dns解析类型\">#</a> 1.6 DNS 解析类型</h5>\n<h6 id=\"161-a\"><a class=\"anchor\" href=\"#161-a\">#</a> 1.6.1 A</h6>\n<ul>\n<li>A 记录可实现将域名指向 IP 地址，也称为正向解析；</li>\n<li>正向解析：域名 --&gt; DNS 服务返回 IP；</li>\n</ul>\n<p><img loading=\"lazy\" data-src=\"https://wp-cdn.4ce.cn/v2/3WCbtLs.jpeg\" alt=\"1.jpg\" /></p>\n<h6 id=\"162-ptr\"><a class=\"anchor\" href=\"#162-ptr\">#</a> 1.6.2 PTR</h6>\n<ul>\n<li>PTR 记录可以实现 IP 查找域名，也称为反向解析；</li>\n<li>反向解析： IP--&gt;DNS 服务返回域名；</li>\n</ul>\n<p><img loading=\"lazy\" data-src=\"https://wp-cdn.4ce.cn/v2/BWcFQtl.jpeg\" alt=\"2.jpg\" /></p>\n<h6 id=\"163-cname\"><a class=\"anchor\" href=\"#163-cname\">#</a> 1.6.3 CNAME</h6>\n<ul>\n<li>当需要将域名指向另一个域名，再由另一个域名提供 IP 地址，就需要添加 CNAME 记录；</li>\n<li>最常用 CNAME 的场景有 WAF (Web Application Firewall)、CDN；</li>\n</ul>\n<p><img loading=\"lazy\" data-src=\"https://wp-cdn.4ce.cn/v2/icO0aXj.jpeg\" alt=\"3.jpg\" /></p>\n<h6 id=\"164-ns\"><a class=\"anchor\" href=\"#164-ns\">#</a> 1.6.4 NS</h6>\n<ul>\n<li>1、客户端查询 DNS 服务，如当前 DNS 无法提供权威解析，则返回一条 NS 记录；</li>\n<li>2、客户端在通过 NS 记录中提供的 DNS 权威服务器进行解析；</li>\n</ul>\n<p><img loading=\"lazy\" data-src=\"https://wp-cdn.4ce.cn/v2/e8xVQa8.jpeg\" alt=\"4.jpg\" /></p>\n<h6 id=\"165-mx\"><a class=\"anchor\" href=\"#165-mx\">#</a> 1.6.5 MX</h6>\n<p>MX 记录用于说明哪台服务器是当前区域的邮件服务器，包含内容：</p>\n<ul>\n<li>name：域名</li>\n<li>IN MX：表示是邮件服务器的记录</li>\n<li>数字：代表优先级</li>\n<li>邮件服务器的完整域名：FQDN</li>\n</ul>\n<h5 id=\"17-企业自建dns方式\"><a class=\"anchor\" href=\"#17-企业自建dns方式\">#</a> 1.7 企业自建 DNS 方式</h5>\n<p>企业常规做法：购买域名、完成 ICP 备案，并使用公网 DNS 服务（万网..）进行免费（付费）解析。</p>\n<p>为什么需要自建 DNS？</p>\n<ul>\n<li>1、内网 web 服务，例如： jenkins、jumpserver、wiki 等，不适合解析至公网；</li>\n<li>2、内网中间件服务 db、mq 等，由于会经常迁移或扩缩容，应该使用域名对外提供，便于维护；</li>\n<li>3、服务器都有 hostname ， hostname 应该设置为 FQDN ，如何维护主机名和主机的内网 IP 的关系；</li>\n</ul>\n<p>综上：我们需要构建至少一套企业内部的 DNS 服务；</p>\n<h4 id=\"2-bind基础应用\"><a class=\"anchor\" href=\"#2-bind基础应用\">#</a> 2. BIND 基础应用</h4>\n<h5 id=\"21-什么是bind\"><a class=\"anchor\" href=\"#21-什么是bind\">#</a> 2.1 什么是 BIND</h5>\n<p>BIND （由美国加州大学开发并且维护的）、BIND 是一个开源、稳定、且应用广泛的 DNS 服务。</p>\n<ul>\n<li>开源：指 BIND 服务源代码是开放的；</li>\n<li>稳定：指 BIND 服务运行非常稳定；</li>\n<li>广泛：政府企业、单位机构、学校、等；</li>\n</ul>\n<h5 id=\"22-bind的组成\"><a class=\"anchor\" href=\"#22-bind的组成\">#</a> 2.2 BIND 的组成</h5>\n<p>BIND 提供（域名解析服务、权威域名服务、DNS 调试工具）</p>\n<ul>\n<li>域名解析服务：将域名解析为 IP 地址；</li>\n<li>权威域名服务：能从该服务器查询到完整域名对应的 IP 地址，则这台服务器就算权威解析；</li>\n<li>DNS 调试工具：主要提供 DNS 客户端调试工具，供客户端使用；</li>\n</ul>\n<h5 id=\"23-bind服务实战\"><a class=\"anchor\" href=\"#23-bind服务实战\">#</a> 2.3 BIND 服务实战</h5>\n<h6 id=\"231-bind环境准备\"><a class=\"anchor\" href=\"#231-bind环境准备\">#</a> 2.3.1 BIND 环境准备</h6>\n<table>\n<thead>\n<tr>\n<th>系统版本</th>\n<th>外网地址</th>\n<th>内网地址</th>\n<th>功能及作用</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Centos7</td>\n<td>eth0：192.168.40.91</td>\n<td>eth1：172.16.1.91</td>\n<td>DNS-Master</td>\n</tr>\n<tr>\n<td>Centos7</td>\n<td>eth0：192.168.40.92</td>\n<td>eth1：172.16.1.92</td>\n<td>DNS-Slave</td>\n</tr>\n<tr>\n<td>Centos7</td>\n<td>eth0：192.168.40.93</td>\n<td>eth1：172.16.1.93</td>\n<td>DNS-Son【子域】</td>\n</tr>\n</tbody>\n</table>\n<h6 id=\"232-bind服务安装\"><a class=\"anchor\" href=\"#232-bind服务安装\">#</a> 2.3.2 BIND 服务安装</h6>\n<p>Bind 的安装非常简单，只需要通过 yum 即可完成安装；</p>\n<ul>\n<li>1、bind 提供主程序包；</li>\n<li>2、bind-utils 提供工具包；</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum install bind bind-utils -y</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl start named &amp;&amp; systemctl enable named</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># rndc-confgen -r /dev/urandom -a</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chown root:named /etc/rndc.key</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chmod 640 /etc/rndc.key </span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl restart named</span></pre></td></tr></table></figure><h6 id=\"233-bind配置文件\"><a class=\"anchor\" href=\"#233-bind配置文件\">#</a> 2.3.3 BIND 配置文件</h6>\n<ol>\n<li>主配置文件格式</li>\n</ol>\n<ul>\n<li>options {} ：全局选项（监听端口、数据文件存储位置、缓存位置、权限等）</li>\n<li>logging {} ：服务日志选项</li>\n<li>zone . {}：自定义区域配置</li>\n<li>include：包含别的文件</li>\n</ul>\n<ol start=\"2\">\n<li>主配置文件注意事项</li>\n</ol>\n<ul>\n<li>语法非常严格；</li>\n<li>文件权限属主 root ，属组 named ，文件权限 640</li>\n</ul>\n<ol start=\"3\">\n<li>配置文件解析</li>\n</ol>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/named.conf </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>options <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t// ipv4监听地址及端口</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tlisten-on port <span class=\"token number\">53</span> <span class=\"token punctuation\">&#123;</span> any<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre> \t// ipv6监听地址及端口</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\tlisten-on-v6 port <span class=\"token number\">53</span> <span class=\"token punctuation\">&#123;</span> ::1<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t// 区域配置存储目录</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\tdirectory \t<span class=\"token string\">\"/var/named\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t// DNS解析过内容的缓存文件</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\tdump-file \t<span class=\"token string\">\"/var/named/data/cache_dump.db\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t// 静态解析文件（几乎不用）</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\tstatistics-file <span class=\"token string\">\"/var/named/data/named_stats.txt\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t// 内存的统计信息</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\tmemstatistics-file <span class=\"token string\">\"/var/named/data/named_mem_stats.txt\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\trecursing-file  <span class=\"token string\">\"/var/named/data/named.recursing\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\tsecroots-file   <span class=\"token string\">\"/var/named/data/named.secroots\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t// 允许谁本台DNS发起查询请求（localhost<span class=\"token operator\">|</span><span class=\"token function\">ip</span><span class=\"token operator\">|</span>any）</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\tallow-query     <span class=\"token punctuation\">&#123;</span> any<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t/* </pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t - If you are building an AUTHORITATIVE DNS server, <span class=\"token keyword\">do</span> NOT <span class=\"token builtin class-name\">enable</span> recursion.</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t - If you are building a RECURSIVE <span class=\"token punctuation\">(</span>caching<span class=\"token punctuation\">)</span> DNS server, you need to <span class=\"token builtin class-name\">enable</span> </pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t   recursion. </pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t - If your recursive DNS server has a public IP address, you MUST <span class=\"token builtin class-name\">enable</span> access </pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t   control to limit queries to your legitimate users. Failing to <span class=\"token keyword\">do</span> so will</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t   cause your server to become part of large scale DNS amplification </pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t   attacks. Implementing BCP38 within your network would greatly</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t   reduce such attack surface </pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t*/</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t//递归查询</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\trecursion <span class=\"token function\">yes</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t//安全校验相关的</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\tdnssec-enable <span class=\"token function\">yes</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t//安全校验相关的</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\tdnssec-validation <span class=\"token function\">yes</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>\t/* Path to ISC DLV key */</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>\tbindkeys-file <span class=\"token string\">\"/etc/named.root.key\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>\tmanaged-keys-directory <span class=\"token string\">\"/var/named/dynamic\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>\tpid-file <span class=\"token string\">\"/run/named/named.pid\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>\tsession-keyfile <span class=\"token string\">\"/run/named/session.key\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>// 控制日志输出的级别以及输出的位置</pre></td></tr><tr><td data-num=\"47\"></td><td><pre>logging <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        channel default_debug <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>                <span class=\"token function\">file</span> <span class=\"token string\">\"data/named.run\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>                severity dynamic<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>//默认可以对任何域名提供解析服务，因为named.ca中存储的是全球根域服务器<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>zone <span class=\"token string\">\".\"</span> IN <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>\t<span class=\"token builtin class-name\">type</span> hint<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>\t<span class=\"token function\">file</span> <span class=\"token string\">\"named.ca\"</span><span class=\"token punctuation\">;</span>  //区域配置文件名称</pre></td></tr><tr><td data-num=\"58\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>//包含其他文件</pre></td></tr><tr><td data-num=\"61\"></td><td><pre>include <span class=\"token string\">\"/etc/named.rfc1912.zones\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>include <span class=\"token string\">\"/etc/named.root.key\"</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h6 id=\"234-客户端验证dns解析的配置\"><a class=\"anchor\" href=\"#234-客户端验证dns解析的配置\">#</a> 2.3.4 客户端验证 DNS 解析的配置</h6>\n<p>1. 配置 DNS 服务器指向，在 /etc/resolv.conf 里配置 dns 的 IP 地址</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/resolv.conf </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># Generated by NetworkManager</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>nameserver <span class=\"token number\">192.168</span>.40.91</pre></td></tr></table></figure><ol start=\"2\">\n<li>使用 ping 命令验证解析</li>\n</ol>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ping www.baidu.com</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>PING www.a.shifen.com <span class=\"token punctuation\">(</span><span class=\"token number\">183.2</span>.172.177<span class=\"token punctuation\">)</span> <span class=\"token number\">56</span><span class=\"token punctuation\">(</span><span class=\"token number\">84</span><span class=\"token punctuation\">)</span> bytes of data.</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">64</span> bytes from <span class=\"token number\">183.2</span>.172.177 <span class=\"token punctuation\">(</span><span class=\"token number\">183.2</span>.172.177<span class=\"token punctuation\">)</span>: <span class=\"token assign-left variable\">icmp_seq</span><span class=\"token operator\">=</span><span class=\"token number\">1</span> <span class=\"token assign-left variable\">ttl</span><span class=\"token operator\">=</span><span class=\"token number\">128</span> <span class=\"token assign-left variable\">time</span><span class=\"token operator\">=</span><span class=\"token number\">15.5</span> ms</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">64</span> bytes from <span class=\"token number\">183.2</span>.172.177 <span class=\"token punctuation\">(</span><span class=\"token number\">183.2</span>.172.177<span class=\"token punctuation\">)</span>: <span class=\"token assign-left variable\">icmp_seq</span><span class=\"token operator\">=</span><span class=\"token number\">2</span> <span class=\"token assign-left variable\">ttl</span><span class=\"token operator\">=</span><span class=\"token number\">128</span> <span class=\"token assign-left variable\">time</span><span class=\"token operator\">=</span><span class=\"token number\">12.2</span> ms</pre></td></tr></table></figure><h5 id=\"24-自定义区域\"><a class=\"anchor\" href=\"#24-自定义区域\">#</a> 2.4 自定义区域</h5>\n<p>自定义域分为如下两类：</p>\n<p>主机域（内网）</p>\n<ul>\n<li>1、主机域其实是一个假域；</li>\n<li>2、主机域其实是不能解析到互联网上；</li>\n<li>3、主机域它只对局域网（内网）提供服务；</li>\n</ul>\n<p>业务域（外网）</p>\n<ul>\n<li>1、业务域一般都是真实可用的；</li>\n<li>2、业务域则为一个真正需要对外提供服务的域名；</li>\n</ul>\n<h6 id=\"241-自定义区域配置文件解析\"><a class=\"anchor\" href=\"#241-自定义区域配置文件解析\">#</a> 2.4.1 自定义区域配置文件解析</h6>\n<ul>\n<li>区域 zone 文件定义在 /etc/named.conf 配置；</li>\n<li>也可以配置在自定义的其他文件里，并在 named.conf 里 include</li>\n<li>注意文件的权限，属主 root 属组 named 文件权限 640</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>zone <span class=\"token string\">\"hmallleasing.com\"</span> IN <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token builtin class-name\">type</span> master<span class=\"token operator\">|</span>slave<span class=\"token punctuation\">;</span>      // 自定义区域类型</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token function\">file</span> /path/to/zonefile<span class=\"token punctuation\">;</span> // 绝对路径和相对路径</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tallow-update <span class=\"token punctuation\">&#123;</span>ip<span class=\"token operator\">|</span>none<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span> // 允许哪个ip可以使用nsupdate动态更新区域文件</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h6 id=\"242-自定义区域数据库文件\"><a class=\"anchor\" href=\"#242-自定义区域数据库文件\">#</a> 2.4.2 自定义区域数据库文件</h6>\n<p>范例以及编写注意事项：</p>\n<ul>\n<li>1、严格注意语法书写，其格式非常严格；</li>\n<li>2、记录不准许折行书写；</li>\n<li>3、单行记录开头不准许空格或 tab 开头；</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /var/named/example.com.zone</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token variable\">$TTL</span> <span class=\"token number\">600</span> <span class=\"token punctuation\">;</span> DNS失效时间，单位秒<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>hmallleasing.com. IN SOA ns.hmallleasinge.com. xuyong.hmallleasing.com. <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">;</span> 区域名称 IN SOA dns.hmallleasing.com. 管理员邮箱</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">;</span> 区域名称可以使用过@表示，@表示当前域</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token number\">2021041514</span> <span class=\"token punctuation\">;</span> 序列号<span class=\"token punctuation\">(</span>serial number<span class=\"token punctuation\">)</span> 十进制，不能超过10位，通常使用日期时间戳，例如2018121601</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token number\">10800</span>      <span class=\"token punctuation\">;</span> 刷新时间<span class=\"token punctuation\">(</span>refresh <span class=\"token function\">time</span><span class=\"token punctuation\">)</span> 即每隔多久到主服务器检查一次</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token number\">900</span>        <span class=\"token punctuation\">;</span> 重试时间<span class=\"token punctuation\">(</span>retry <span class=\"token function\">time</span><span class=\"token punctuation\">)</span> 即刷新不成功多久后重试，应该小于refresh <span class=\"token function\">time</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token number\">604800</span>     <span class=\"token punctuation\">;</span> 过期时间<span class=\"token punctuation\">(</span>expire <span class=\"token function\">time</span><span class=\"token punctuation\">)</span> 当辅助DNS无法联系主DNS时，辅助DNS在多长时间内认为其缓存是有效的。</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token number\">86400</span>      <span class=\"token punctuation\">;</span> 权威应答的ttl<span class=\"token punctuation\">(</span>netgative answer ttl<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">;</span>缓存DNS服务器可以缓存记录多长时间</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">;</span> 给客户端返回NS记录，hmallleasing.com. 域名由哪几台权威服务器提供解析</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>hmallleasing.com. IN NS ns1.hmallleasing.com.</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>hmallleasing.com. IN NS ns2.hmallleasing.com.</pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">;</span> A记录，配置权威域名的真实IP地址；</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>ns1.hmallleasing.com. IN A <span class=\"token number\">172.16</span>.1.91</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>ns2.hmallleasing.com. IN A <span class=\"token number\">172.16</span>.1.92</pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">;</span> 真正的域名解析</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>www.hmallleasing.com. IN A <span class=\"token number\">1.1</span>.1.1</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>web.hmallleasing.com. IN A <span class=\"token number\">2.2</span>.2.2</pre></td></tr></table></figure><h5 id=\"25-bind增加a记录正向解析实战\"><a class=\"anchor\" href=\"#25-bind增加a记录正向解析实战\">#</a> 2.5 BIND 增加 A 记录正向解析实战</h5>\n<p>用户通过 DNS 服务器 172.16.1.91 解析 <a href=\"http://www.hmalleasing.com\">www.hmalleasing.com</a></p>\n<ul>\n<li>1、添加 <a href=\"http://hmallleasing.com\">hmallleasing.com</a> 区域配置文件</li>\n<li>2、添加区域数据库文件，配置 NS 记录，返回 DNS 权威服务器地址</li>\n<li>3、该域的 DNS 权威服务器为 172.16.1.91</li>\n<li>4、添加该域的 A 记录解析</li>\n</ul>\n<h6 id=\"251-新增区域配置文件\"><a class=\"anchor\" href=\"#251-新增区域配置文件\">#</a> 2.5.1 新增区域配置文件</h6>\n<p>1. 在主配置文件 /etc/named.conf，新增一个 hmallleasing.com 区域配置</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/named.conf</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>options <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t// ipv4监听地址及端口</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\tlisten-on port <span class=\"token number\">53</span> <span class=\"token punctuation\">&#123;</span> any<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t// 允许谁本台DNS发起查询请求（localhost<span class=\"token operator\">|</span><span class=\"token function\">ip</span><span class=\"token operator\">|</span>any）</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\tallow-query     <span class=\"token punctuation\">&#123;</span> any<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>//自行配置权威域名解析hmallleaing.com</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>zone <span class=\"token string\">\"hmallleasing.com\"</span> IN <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre> \t <span class=\"token builtin class-name\">type</span> master<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre> \t <span class=\"token function\">file</span> <span class=\"token string\">\"hmallleasing.com.zone\"</span><span class=\"token punctuation\">;</span>    //具体解析记录配置存储至哪个文件</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr></table></figure><p>2. 检查配置文件语法是否正常</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># named-checkconf</span></pre></td></tr></table></figure><h6 id=\"252-新增区域数据库文件\"><a class=\"anchor\" href=\"#252-新增区域数据库文件\">#</a> 2.5.2 新增区域数据库文件</h6>\n<p>1. 添加区域数据库文件</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /var/named/hmallleasing.com.zone</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token variable\">$TTL</span> <span class=\"token number\">600</span> <span class=\"token punctuation\">;</span> DNS失效时间，单位秒<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>hmallleasing.com. IN SOA ns.hmallleasing.com. xuy.nf-leasing.com. <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">;</span> 区域名称 IN SOA dns.hmallleasing.com. 管理员邮箱</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">;</span> 区域名称可以使用过@表示，@表示当前域</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token number\">2025092018</span> <span class=\"token punctuation\">;</span> 序列号<span class=\"token punctuation\">(</span>serial number<span class=\"token punctuation\">)</span> 十进制，不能超过10位，通常使用日期时间戳，例如2018121601</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token number\">10800</span>      <span class=\"token punctuation\">;</span> 刷新时间<span class=\"token punctuation\">(</span>refresh <span class=\"token function\">time</span><span class=\"token punctuation\">)</span> 即每隔多久到主服务器检查一次</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token number\">900</span>        <span class=\"token punctuation\">;</span> 重试时间<span class=\"token punctuation\">(</span>retry <span class=\"token function\">time</span><span class=\"token punctuation\">)</span> 即刷新不成功多久后重试，应该小于refresh <span class=\"token function\">time</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token number\">604800</span>     <span class=\"token punctuation\">;</span> 过期时间<span class=\"token punctuation\">(</span>expire <span class=\"token function\">time</span><span class=\"token punctuation\">)</span> 当辅助DNS无法联系主DNS时，辅助DNS在多长时间内认为其缓存是有效的。</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token number\">86400</span>      <span class=\"token punctuation\">;</span> 权威应答的ttl<span class=\"token punctuation\">(</span>netgative answer ttl<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">;</span>缓存DNS服务器可以缓存记录多长时间</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">;</span> 给客户端返回NS记录，hmallleasing.com. 域名由哪几台权威服务器提供解析</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>hmallleasing.com. IN NS ns1.hmallleasing.com.</pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">;</span> A记录，配置权威域名的真实IP地址；</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>ns1.hmallleasing.com. IN A <span class=\"token number\">172.16</span>.1.91</pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">;</span> 真正的域名解析</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>www.hmallleasing.com. IN A <span class=\"token number\">1.1</span>.1.1</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>web.hmallleasing.com. IN A <span class=\"token number\">2.2</span>.2.2</pre></td></tr></table></figure><p>2. 检查区域数据库文件</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># named-checkzone hmallleasing.com  /var/named/hmallleasing.com.zone</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>zone hmallleasing.com/IN: loaded serial <span class=\"token number\">2025092018</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>OK</pre></td></tr></table></figure><p>3. 重载 DNS 服务器</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># rndc reload</span></pre></td></tr></table></figure><h6 id=\"253-客户端测试域名解析\"><a class=\"anchor\" href=\"#253-客户端测试域名解析\">#</a> 2.5.3 客户端测试域名解析</h6>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum install bind-utils -y</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># dig web.hmallleasing.com @172.16.1.91 +short</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">2.2</span>.2.2</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># dig www.hmallleasing.com @172.16.1.91 +short</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">1.1</span>.1.1</pre></td></tr></table></figure><h5 id=\"26-bind增加cname记录实战\"><a class=\"anchor\" href=\"#26-bind增加cname记录实战\">#</a> 2.6 BIND 增加 CNAME 记录实战</h5>\n<p>用户通过 DNS 服务器 172.16.1.91 解析 <a href=\"http://www.job.com\">www.job.com</a></p>\n<p>1、添加 <a href=\"http://job.com\">job.com</a> 区域配置文件</p>\n<p>2、添加区域数据库文件，配置 NS 记录，返回 DNS 权威服务器地址</p>\n<p>3、该域的 DNS 权威服务器为 172.16.1.91</p>\n<p>4、添加该域的 CNAME 解析记录，解析至 <a href=\"http://www.hmallleasing.com\">www.hmallleasing.com</a> 域名上</p>\n<p><img loading=\"lazy\" data-src=\"https://wp-cdn.4ce.cn/v2/RBrxONj.jpeg\" alt=\"1.jpg\" /></p>\n<h6 id=\"261-新增区域配置文件\"><a class=\"anchor\" href=\"#261-新增区域配置文件\">#</a> 2.6.1 新增区域配置文件</h6>\n<p>1. 在主配置文件 /etc/named.conf，新增一个 hmallleasing.com 区域配置</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/named.conf</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>options <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t// ipv4监听地址及端口</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\tlisten-on port <span class=\"token number\">53</span> <span class=\"token punctuation\">&#123;</span> any<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t// 允许谁本台DNS发起查询请求（localhost<span class=\"token operator\">|</span><span class=\"token function\">ip</span><span class=\"token operator\">|</span>any）</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\tallow-query     <span class=\"token punctuation\">&#123;</span> any<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>//自行配置权威域名解析job.com</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>zone <span class=\"token string\">\"job.com\"</span> IN <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre> \t <span class=\"token builtin class-name\">type</span> master<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre> \t <span class=\"token function\">file</span> <span class=\"token string\">\"job.com.zone\"</span><span class=\"token punctuation\">;</span>    //具体解析记录配置存储至哪个文件</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr></table></figure><p>2. 检查配置文件语法是否正常</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># named-checkconf</span></pre></td></tr></table></figure><h6 id=\"262-新增区域数据库文件\"><a class=\"anchor\" href=\"#262-新增区域数据库文件\">#</a> 2.6.2 新增区域数据库文件</h6>\n<p>1. 添加区域数据库文件</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /var/named/job.com.zone</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token variable\">$TTL</span> <span class=\"token number\">600</span> <span class=\"token punctuation\">;</span> DNS失效时间，单位秒<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>job.com. IN SOA ns.job.com. xuy.nf-leasing.com. <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">;</span> 区域名称 IN SOA dns.hmallleasing.com. 管理员邮箱</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">;</span> 区域名称可以使用过@表示，@表示当前域</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token number\">2025092018</span> <span class=\"token punctuation\">;</span> 序列号<span class=\"token punctuation\">(</span>serial number<span class=\"token punctuation\">)</span> 十进制，不能超过10位，通常使用日期时间戳，例如2018121601</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token number\">10800</span>      <span class=\"token punctuation\">;</span> 刷新时间<span class=\"token punctuation\">(</span>refresh <span class=\"token function\">time</span><span class=\"token punctuation\">)</span> 即每隔多久到主服务器检查一次</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token number\">900</span>        <span class=\"token punctuation\">;</span> 重试时间<span class=\"token punctuation\">(</span>retry <span class=\"token function\">time</span><span class=\"token punctuation\">)</span> 即刷新不成功多久后重试，应该小于refresh <span class=\"token function\">time</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token number\">604800</span>     <span class=\"token punctuation\">;</span> 过期时间<span class=\"token punctuation\">(</span>expire <span class=\"token function\">time</span><span class=\"token punctuation\">)</span> 当辅助DNS无法联系主DNS时，辅助DNS在多长时间内认为其缓存是有效的。</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token number\">86400</span>      <span class=\"token punctuation\">;</span> 权威应答的ttl<span class=\"token punctuation\">(</span>netgative answer ttl<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">;</span>缓存DNS服务器可以缓存记录多长时间</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">;</span> 给客户端返回NS记录，hmallleasing.com. 域名由哪几台权威服务器提供解析</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>job.com. IN NS ns1.job.com.</pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">;</span> A记录，配置权威域名的真实IP地址；</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>ns1.job.com. IN A <span class=\"token number\">172.16</span>.1.91</pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">;</span> 真正的域名解析</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>www.job.com. IN CNAME www.hmallleasing.com.</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>dev.job.com. IN A <span class=\"token number\">2.2</span>.2.3</pre></td></tr></table></figure><p>2. 检查区域数据库文件</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># named-checkzone job.com  /var/named/job.com.zone</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>zone job.com/IN: loaded serial <span class=\"token number\">2025092018</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>OK</pre></td></tr></table></figure><p>3. 重载 DNS 服务器</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># rndc reload</span></pre></td></tr></table></figure><h6 id=\"263-客户端测试域名解析\"><a class=\"anchor\" href=\"#263-客户端测试域名解析\">#</a> 2.6.3 客户端测试域名解析</h6>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># dig www.job.com @172.16.1.91 +short</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>www.hmallleasing.com.</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">1.1</span>.1.1</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># dig dev.job.com @172.16.1.91 +short</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">2.2</span>.2.3</pre></td></tr></table></figure><h5 id=\"27-bind增加ptr记录反向解析实战\"><a class=\"anchor\" href=\"#27-bind增加ptr记录反向解析实战\">#</a> 2.7 BIND 增加 PTR 记录反向解析实战</h5>\n<p>配置反向解析 PTR：IP--&gt;FQDN</p>\n<ul>\n<li>1、反向区域文件名称为逆向网络地址 加  .in-addr.arpa. 后缀组成</li>\n<li>2、反向区域数据库文件，例如 172.16.1.200 的 name 为 200 ，完全格式为：1.16.172.in-addr.arpa.</li>\n</ul>\n<h6 id=\"271-新增区域配置文件\"><a class=\"anchor\" href=\"#271-新增区域配置文件\">#</a> 2.7.1 新增区域配置文件</h6>\n<p>1. 在主配置文件 /etc/named.conf，新增一个反向区域配置</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/named.conf</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>options <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t// ipv4监听地址及端口</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\tlisten-on port <span class=\"token number\">53</span> <span class=\"token punctuation\">&#123;</span> any<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t// 允许谁本台DNS发起查询请求（localhost<span class=\"token operator\">|</span><span class=\"token function\">ip</span><span class=\"token operator\">|</span>any）</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\tallow-query     <span class=\"token punctuation\">&#123;</span> any<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>//配置反向解析</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>zone <span class=\"token string\">\"1.16.172.in-addr.arpa\"</span> IN <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token builtin class-name\">type</span> master<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token function\">file</span> <span class=\"token string\">\"1.16.172.zone\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr></table></figure><p>2. 检查配置文件语法是否正常</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># named-checkconf</span></pre></td></tr></table></figure><h6 id=\"272-新增区域数据库文件\"><a class=\"anchor\" href=\"#272-新增区域数据库文件\">#</a> 2.7.2 新增区域数据库文件</h6>\n<p>1. 添加反向解析区域数据库文件</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /var/named/1.16.172.zone</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token variable\">$TTL</span> <span class=\"token number\">600</span> <span class=\"token punctuation\">;</span> DNS失效时间，单位秒<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>@ IN SOA <span class=\"token number\">1.16</span>.172.in-addr.arpa. xuy.nf-leasing.com. <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token number\">2025092018</span> <span class=\"token punctuation\">;</span> 序列号<span class=\"token punctuation\">(</span>serial number<span class=\"token punctuation\">)</span> 十进制，不能超过10位，通常使用日期时间戳，例如2018121601</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token number\">10800</span>      <span class=\"token punctuation\">;</span> 刷新时间<span class=\"token punctuation\">(</span>refresh <span class=\"token function\">time</span><span class=\"token punctuation\">)</span> 即每隔多久到主服务器检查一次</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token number\">900</span>        <span class=\"token punctuation\">;</span> 重试时间<span class=\"token punctuation\">(</span>retry <span class=\"token function\">time</span><span class=\"token punctuation\">)</span> 即刷新不成功多久后重试，应该小于refresh <span class=\"token function\">time</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token number\">604800</span>     <span class=\"token punctuation\">;</span> 过期时间<span class=\"token punctuation\">(</span>expire <span class=\"token function\">time</span><span class=\"token punctuation\">)</span> 当辅助DNS无法联系主DNS时，辅助DNS在多长时间内认为其缓存是有效的。</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token number\">86400</span>      <span class=\"token punctuation\">;</span> 权威应答的ttl<span class=\"token punctuation\">(</span>netgative answer ttl<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">;</span>缓存DNS服务器可以缓存记录多长时间</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">;</span>ns反向解析</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>@ IN NS ns1.hmallleasing.com.</pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">;</span>权威DNS反向解析</pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token number\">91</span> IN PTR ns1.hmallleasing.com.</pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">;</span>www反向解析</pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token number\">200</span> IN PTR route.hmallleasing.com.</pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token number\">5</span> IN PTR lb.hmallleasing.com.</pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token number\">7</span> IN PTR web01.hmallleasing.com.</pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token number\">8</span> IN PTR web02.hmallleasing.com.</pre></td></tr></table></figure><p>2. 检查区域数据库文件</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># named-checkzone job.com /var/named/1.16.172.zone</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>zone job.com/IN: loaded serial <span class=\"token number\">2025092018</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>OK</pre></td></tr></table></figure><p>3. 重载 DNS 服务器</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># rndc reload</span></pre></td></tr></table></figure><h6 id=\"273-客户端测试域名解析\"><a class=\"anchor\" href=\"#273-客户端测试域名解析\">#</a> 2.7.3 客户端测试域名解析</h6>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># dig -x 172.16.1.200 @172.16.1.91 +short</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>route.hmallleasing.com.</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># dig -x 172.16.1.7 @172.16.1.91 +short</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>web01.hmallleasing.com.</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># dig -x 172.16.1.8 @172.16.1.91 +short</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>web02.hmallleasing.com.</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">[</span>root@client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># dig -x 172.16.1.5 @172.16.1.91 +short</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>lb.hmallleasing.com.</pre></td></tr></table></figure><h4 id=\"3-递归查询\"><a class=\"anchor\" href=\"#3-递归查询\">#</a> 3. 递归查询</h4>\n<h5 id=\"31-什么是递归查询\"><a class=\"anchor\" href=\"#31-什么是递归查询\">#</a> 3.1 什么是递归查询</h5>\n<p><img loading=\"lazy\" data-src=\"https://wp-cdn.4ce.cn/v2/zLPqMP3.jpeg\" alt=\"3.jpg\" /></p>\n<ul>\n<li>如果你要建立一个【授权域名】服务器，仅提供本地已存在域名解析即可；那么不要开启 recursion 功能。</li>\n<li>如果你要建立一个递归 DNS 服务器，那么需要开启 recursion 功能。</li>\n<li>如果你的递归 DNS 服务器有公网 IP 地址，你必须开启访问控制功能，只有合法用户才可以发询问。</li>\n</ul>\n<h5 id=\"32-递归查询配置参数\"><a class=\"anchor\" href=\"#32-递归查询配置参数\">#</a> 3.2 递归查询配置参数</h5>\n<table>\n<thead>\n<tr>\n<th>参数</th>\n<th>选项</th>\n<th>作用</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>recurison</td>\n<td>yes/no</td>\n<td>是否开启递归查询请求</td>\n</tr>\n<tr>\n<td>allow-recursion</td>\n<td>{address_match_list | any | none };</td>\n<td>限制客户端递归请求的范围</td>\n</tr>\n</tbody>\n</table>\n<h5 id=\"33-递归查询配置场景\"><a class=\"anchor\" href=\"#33-递归查询配置场景\">#</a> 3.3 递归查询配置场景</h5>\n<h6 id=\"331-开启递归查询\"><a class=\"anchor\" href=\"#331-开启递归查询\">#</a> 3.3.1 开启递归查询</h6>\n<p>BIND 默认配置中的 recurison 参数是启用的；</p>\n<ul>\n<li>1、配置仅允许 172.16.1.0 网段用户可以查询（可选）；</li>\n<li>2、使用客户端查询系统中存在的域名；</li>\n<li>3、使用客户端查询系统中不存在的域名（让 BIND 进行递归查询）；</li>\n</ul>\n<p>1. 修改 /etc/named.conf 配置文件</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/named.conf </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t//递归查询</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\trecursion <span class=\"token function\">yes</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\tallow-recursion <span class=\"token punctuation\">&#123;</span> <span class=\"token number\">192.168</span>.40.0/24<span class=\"token punctuation\">;</span><span class=\"token number\">172.16</span>.1.0/24<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr></table></figure><p>2. 语法检查且重新加载 named</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># named-checkconf </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># rndc reload</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>server reload successful</pre></td></tr></table></figure><p>3. 查询存在 BIND 服务中的域名</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># dig web.hmallleasing.com @172.16.1.91 +short</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">2.2</span>.2.2</pre></td></tr></table></figure><p>4. 查询不在 BIND 服务中的域名，可以获取正确返回，原因是 BIND 进行了递归查询</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># dig www.qq.com @172.16.1.91 +short</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>ins-r23tsuuf.ias.tencent-cloud.net.</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">121.14</span>.77.221</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">121.14</span>.77.201</pre></td></tr></table></figure><h6 id=\"332-关闭递归查询\"><a class=\"anchor\" href=\"#332-关闭递归查询\">#</a> 3.3.2 关闭递归查询</h6>\n<p>1. 修改 /etc/named.conf 配置文件</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/named.conf </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t//递归查询</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\trecursion no<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token comment\">#allow-recursion &#123; 192.168.40.0/24;172.16.1.0/24; &#125;;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr></table></figure><p>2. 语法检查且重新加载 named</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># named-checkconf </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># rndc reload</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>server reload successful</pre></td></tr></table></figure><p>3. 查询存在 BIND 服务中的域名会返回权威结果，因为本地无需进行递归查询，即可返回权威解析</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># dig web.hmallleasing.com @172.16.1.91 +short</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">2.2</span>.2.2</pre></td></tr></table></figure><p>4. 由于本地无法返回权威结果，同时也禁用了递归查询，所以查询本地不存在域名会有 WARNING 提示</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># dig www.qq.com @172.16.1.91</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">;</span> <span class=\"token operator\">&lt;&lt;</span><span class=\"token operator\">>></span> DiG <span class=\"token number\">9.11</span>.4-P2-RedHat-9.11.4-26.P2.el7_9.16 <span class=\"token operator\">&lt;&lt;</span><span class=\"token operator\">>></span> www.qq.com @172.16.1.91</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> global options: +cmd</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> Got answer:</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> -<span class=\"token operator\">>></span>HEADER<span class=\"token operator\">&lt;&lt;-</span> opcode: QUERY, status: REFUSED, id: <span class=\"token number\">30635</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> flags: qr rd<span class=\"token punctuation\">;</span> QUERY: <span class=\"token number\">1</span>, ANSWER: <span class=\"token number\">0</span>, AUTHORITY: <span class=\"token number\">0</span>, ADDITIONAL: <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> WARNING: recursion requested but not available   <span class=\"token comment\">#递归查询不可用</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> OPT PSEUDOSECTION:</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">;</span> EDNS: version: <span class=\"token number\">0</span>, flags:<span class=\"token punctuation\">;</span> udp: <span class=\"token number\">4096</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> QUESTION SECTION:</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">;</span>www.qq.com.\t\t\tIN\tA</pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> Query time: <span class=\"token number\">0</span> msec</pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> SERVER: <span class=\"token number\">172.16</span>.1.91<span class=\"token comment\">#53(172.16.1.91)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> WHEN: Sat Sep <span class=\"token number\">20</span> <span class=\"token number\">21</span>:33:54 CST <span class=\"token number\">2025</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> MSG SIZE  rcvd: <span class=\"token number\">39</span></pre></td></tr></table></figure><h4 id=\"4-dns主辅同步\"><a class=\"anchor\" href=\"#4-dns主辅同步\">#</a> 4. DNS 主辅同步</h4>\n<h5 id=\"41-dns主辅同步概念\"><a class=\"anchor\" href=\"#41-dns主辅同步概念\">#</a> 4.1 DNS 主辅同步概念</h5>\n<p>辅助 DNS 是 DNS 容灾备份服务：在主 DNS 和辅 DNS 之间建立区域数据传输机制，当主 DNS 遇到故障或者服务中断时，辅 DNS 仍可以继续提供解析服务，因此保障业务稳定运行。</p>\n<p>辅助 DNS 的优势：</p>\n<ul>\n<li>容灾备份，降低业务中断风险：主 DNS 系统故障，辅助 DNS 可继续提供域名解析服务，保障业务可用性。</li>\n<li>负责均衡，流量均摊降低负载：当辅助 DNS 与主 DNS 同时对外提供解析服务时，可以达到流量负载均衡的效果。</li>\n</ul>\n<h5 id=\"42-dns主从同步原理\"><a class=\"anchor\" href=\"#42-dns主从同步原理\">#</a> 4.2 DNS 主从同步原理</h5>\n<p><img loading=\"lazy\" data-src=\"https://wp-cdn.4ce.cn/v2/4XJrCeP.jpeg\" alt=\"918540-20230508112130365-444561605.jpg\" /></p>\n<h5 id=\"43-dns主从同步场景\"><a class=\"anchor\" href=\"#43-dns主从同步场景\">#</a> 4.3 DNS 主从同步场景</h5>\n<h6 id=\"431-主从环境准备\"><a class=\"anchor\" href=\"#431-主从环境准备\">#</a> 4.3.1 主从环境准备</h6>\n<ul>\n<li>1、确保防火墙规则开放（建议关闭）</li>\n<li>2、保持主从服务器时钟一致；</li>\n<li>3、搭建完主从后，若修改主服务器域配置， Serail Number 必须递增，否则不同步；</li>\n</ul>\n<h6 id=\"432-主辅同步配置要点\"><a class=\"anchor\" href=\"#432-主辅同步配置要点\">#</a> 4.3.2 主辅同步配置要点</h6>\n<ul>\n<li>1、主 DNS 的 named.conf 里配置 allow-transfer 和 also-notify 选项；</li>\n<li>2、辅助 DNS 主配置文件 option 段添加 masterfile-format text ，否则同步的文件为 data 类型；</li>\n<li>3、辅助 DNS 添加区域配置文件，类型为 slave ，同时指向 masters 参数指向 master 地址；</li>\n<li>4、辅助 DNS 不可主动修改 DNS 数据库文件；</li>\n</ul>\n<h6 id=\"433-master服务器的配置\"><a class=\"anchor\" href=\"#433-master服务器的配置\">#</a> 4.3.3 Master 服务器的配置</h6>\n<p>1. 在主配置文件 /etc/named.conf，新增一个反向区域配置</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/named.conf</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>options <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t//允许哪个地址同步master配置信息</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    allow-transfer <span class=\"token punctuation\">&#123;</span> <span class=\"token number\">172.16</span>.1.92<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t//主动通知辅助DNS域名变更\t</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    also-notify <span class=\"token punctuation\">&#123;</span> <span class=\"token number\">172.16</span>.1.92<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>//自行配置权威域名解析hmallleaing.com</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>zone <span class=\"token string\">\"hmallleasing.com\"</span> IN <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre> \t <span class=\"token builtin class-name\">type</span> master<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre> \t <span class=\"token function\">file</span> <span class=\"token string\">\"hmallleasing.com.zone\"</span><span class=\"token punctuation\">;</span>    //具体解析记录配置存储至哪个文件</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>zone <span class=\"token string\">\"job.com\"</span> IN <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre> \t <span class=\"token builtin class-name\">type</span> master<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre> \t <span class=\"token function\">file</span> <span class=\"token string\">\"job.com.zone\"</span><span class=\"token punctuation\">;</span>    //具体解析记录配置存储至哪个文件</pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>//配置反向解析</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>zone <span class=\"token string\">\"1.16.172.in-addr.arpa\"</span> IN <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>  <span class=\"token builtin class-name\">type</span> master<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  <span class=\"token function\">file</span> <span class=\"token string\">\"1.16.172.zone\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr></table></figure><p>2. 添加区域数据库文件 (需要多添加一条 ns 记录)</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#1.hmallleasing.com.zone 需要多添加一条 ns 记录</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /var/named/hmallleasing.com.zone </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token variable\">$TTL</span> <span class=\"token number\">600</span> <span class=\"token punctuation\">;</span> DNS失效时间，单位秒<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>hmallleasing.com. IN SOA ns.hmallleasing.com. xuy.nf-leasing.com. <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">;</span> 区域名称 IN SOA dns.hmallleasing.com. 管理员邮箱</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">;</span> 区域名称可以使用过@表示，@表示当前域</pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token number\">2025092018</span> <span class=\"token punctuation\">;</span> 序列号<span class=\"token punctuation\">(</span>serial number<span class=\"token punctuation\">)</span> 十进制，不能超过10位，通常使用日期时间戳，例如2018121601</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token number\">10800</span>      <span class=\"token punctuation\">;</span> 刷新时间<span class=\"token punctuation\">(</span>refresh <span class=\"token function\">time</span><span class=\"token punctuation\">)</span> 即每隔多久到主服务器检查一次</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token number\">900</span>        <span class=\"token punctuation\">;</span> 重试时间<span class=\"token punctuation\">(</span>retry <span class=\"token function\">time</span><span class=\"token punctuation\">)</span> 即刷新不成功多久后重试，应该小于refresh <span class=\"token function\">time</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token number\">604800</span>     <span class=\"token punctuation\">;</span> 过期时间<span class=\"token punctuation\">(</span>expire <span class=\"token function\">time</span><span class=\"token punctuation\">)</span> 当辅助DNS无法联系主DNS时，辅助DNS在多长时间内认为其缓存是有效的。</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t<span class=\"token number\">86400</span>      <span class=\"token punctuation\">;</span> 权威应答的ttl<span class=\"token punctuation\">(</span>netgative answer ttl<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">;</span>缓存DNS服务器可以缓存记录多长时间</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">;</span> 给客户端返回NS记录，hmallleasing.com. 域名由哪几台权威服务器提供解析</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>hmallleasing.com. IN NS ns1.hmallleasing.com.</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>hmallleasing.com. IN NS ns2.hmallleasing.com.</pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">;</span> A记录，配置权威域名的真实IP地址；</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>ns1.hmallleasing.com. IN A <span class=\"token number\">172.16</span>.1.91</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>ns2.hmallleasing.com. IN A <span class=\"token number\">172.16</span>.1.92</pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">;</span> 真正的域名解析</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>www.hmallleasing.com. IN A <span class=\"token number\">1.1</span>.1.1</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>web.hmallleasing.com. IN A <span class=\"token number\">2.2</span>.2.2</pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token comment\">#2./1.16.172.zone 需要多添加一条 ns 记录</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /var/named/1.16.172.zone </span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token variable\">$TTL</span> <span class=\"token number\">600</span> <span class=\"token punctuation\">;</span> DNS失效时间，单位秒<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>@ IN SOA <span class=\"token number\">1.16</span>.172.in-addr.arpa. xuy.nf-leasing.com. <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\t<span class=\"token number\">2025092018</span> <span class=\"token punctuation\">;</span> 序列号<span class=\"token punctuation\">(</span>serial number<span class=\"token punctuation\">)</span> 十进制，不能超过10位，通常使用日期时间戳，例如2018121601</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t<span class=\"token number\">10800</span>      <span class=\"token punctuation\">;</span> 刷新时间<span class=\"token punctuation\">(</span>refresh <span class=\"token function\">time</span><span class=\"token punctuation\">)</span> 即每隔多久到主服务器检查一次</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t<span class=\"token number\">900</span>        <span class=\"token punctuation\">;</span> 重试时间<span class=\"token punctuation\">(</span>retry <span class=\"token function\">time</span><span class=\"token punctuation\">)</span> 即刷新不成功多久后重试，应该小于refresh <span class=\"token function\">time</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t<span class=\"token number\">604800</span>     <span class=\"token punctuation\">;</span> 过期时间<span class=\"token punctuation\">(</span>expire <span class=\"token function\">time</span><span class=\"token punctuation\">)</span> 当辅助DNS无法联系主DNS时，辅助DNS在多长时间内认为其缓存是有效的。</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\t<span class=\"token number\">86400</span>      <span class=\"token punctuation\">;</span> 权威应答的ttl<span class=\"token punctuation\">(</span>netgative answer ttl<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">;</span>缓存DNS服务器可以缓存记录多长时间</pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token punctuation\">;</span>ns反向解析</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>@ IN NS ns1.hmallleasing.com.</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>@ IN NS ns2.hmallleasing.com.</pre></td></tr><tr><td data-num=\"41\"></td><td><pre></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token punctuation\">;</span>权威DNS反向解析</pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token number\">91</span> IN PTR ns1.hmallleasing.com.</pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token number\">92</span> IN PTR ns2.hmallleasing.com.</pre></td></tr><tr><td data-num=\"45\"></td><td><pre></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token punctuation\">;</span>www反向解析</pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token number\">200</span> IN PTR route.hmallleasing.com.</pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token number\">5</span> IN PTR lb.hmallleasing.com.</pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token number\">7</span> IN PTR web01.hmallleasing.com.</pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token number\">8</span> IN PTR web02.hmallleasing.com.</pre></td></tr><tr><td data-num=\"51\"></td><td><pre></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token comment\">#2.job.com.zone 需要多添加一条 ns 记录</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master named<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat job.com.zone </span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token variable\">$TTL</span> <span class=\"token number\">600</span> <span class=\"token punctuation\">;</span> DNS失效时间，单位秒<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>job.com. IN SOA ns.job.com. xuy.nf-leasing.com. <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token punctuation\">;</span> 区域名称 IN SOA dns.hmallleasing.com. 管理员邮箱</pre></td></tr><tr><td data-num=\"57\"></td><td><pre><span class=\"token punctuation\">;</span> 区域名称可以使用过@表示，@表示当前域</pre></td></tr><tr><td data-num=\"58\"></td><td><pre></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>\t<span class=\"token number\">2025092019</span> <span class=\"token punctuation\">;</span> 序列号<span class=\"token punctuation\">(</span>serial number<span class=\"token punctuation\">)</span> 十进制，不能超过10位，通常使用日期时间戳，例如2018121601</pre></td></tr><tr><td data-num=\"60\"></td><td><pre>\t<span class=\"token number\">10800</span>      <span class=\"token punctuation\">;</span> 刷新时间<span class=\"token punctuation\">(</span>refresh <span class=\"token function\">time</span><span class=\"token punctuation\">)</span> 即每隔多久到主服务器检查一次</pre></td></tr><tr><td data-num=\"61\"></td><td><pre>\t<span class=\"token number\">900</span>        <span class=\"token punctuation\">;</span> 重试时间<span class=\"token punctuation\">(</span>retry <span class=\"token function\">time</span><span class=\"token punctuation\">)</span> 即刷新不成功多久后重试，应该小于refresh <span class=\"token function\">time</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>\t<span class=\"token number\">604800</span>     <span class=\"token punctuation\">;</span> 过期时间<span class=\"token punctuation\">(</span>expire <span class=\"token function\">time</span><span class=\"token punctuation\">)</span> 当辅助DNS无法联系主DNS时，辅助DNS在多长时间内认为其缓存是有效的。</pre></td></tr><tr><td data-num=\"63\"></td><td><pre>\t<span class=\"token number\">86400</span>      <span class=\"token punctuation\">;</span> 权威应答的ttl<span class=\"token punctuation\">(</span>netgative answer ttl<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">;</span>缓存DNS服务器可以缓存记录多长时间</pre></td></tr><tr><td data-num=\"64\"></td><td><pre><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre></pre></td></tr><tr><td data-num=\"66\"></td><td><pre><span class=\"token punctuation\">;</span> 给客户端返回NS记录，hmallleasing.com. 域名由哪几台权威服务器提供解析</pre></td></tr><tr><td data-num=\"67\"></td><td><pre>job.com. IN NS ns1.job.com.</pre></td></tr><tr><td data-num=\"68\"></td><td><pre>job.com. IN NS ns2.job.com.</pre></td></tr><tr><td data-num=\"69\"></td><td><pre></pre></td></tr><tr><td data-num=\"70\"></td><td><pre><span class=\"token punctuation\">;</span> A记录，配置权威域名的真实IP地址；</pre></td></tr><tr><td data-num=\"71\"></td><td><pre>ns1.job.com. IN A <span class=\"token number\">172.16</span>.1.91</pre></td></tr><tr><td data-num=\"72\"></td><td><pre>ns2.job.com. IN A <span class=\"token number\">172.16</span>.1.92</pre></td></tr><tr><td data-num=\"73\"></td><td><pre></pre></td></tr><tr><td data-num=\"74\"></td><td><pre><span class=\"token punctuation\">;</span> 真正的域名解析</pre></td></tr><tr><td data-num=\"75\"></td><td><pre>www.job.com. IN CNAME www.hmallleasing.com.</pre></td></tr><tr><td data-num=\"76\"></td><td><pre>dev.job.com. IN A <span class=\"token number\">2.2</span>.2.3</pre></td></tr></table></figure><p>3. 检查语法并重载 DNS 服务器</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># named-checkconf</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># named-checkzone hmallleasing.com /var/named/hmallleasing.com.zone </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># rndc reload</span></pre></td></tr></table></figure><h6 id=\"434-slave服务器的配置\"><a class=\"anchor\" href=\"#434-slave服务器的配置\">#</a> 4.3.4 Slave 服务器的配置</h6>\n<p>1. 安装 bind 服务</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-slave ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum install bind bind-utils -y</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-slave ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl start named &amp;&amp; systemctl enable named</span></pre></td></tr></table></figure><p>2. 配置 rndc【首次需要配置】</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-slave ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># rndc-confgen -r /dev/urandom -a</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-slave ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chown root:named /etc/rndc.key</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-slave ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chmod 640 /etc/rndc.key </span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-slave ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl restart named</span></pre></td></tr></table></figure><p>3. 修改主配置文件</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-slave ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/named.conf </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>options <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tlisten-on port <span class=\"token number\">53</span> <span class=\"token punctuation\">&#123;</span> any<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\tallow-query     <span class=\"token punctuation\">&#123;</span> any<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    masterfile-format text<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr></table></figure><p>4. 添加区域配置文件，类型为 slave，然后指向 master 地址</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-slave ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/named.conf </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>//自行配置权威域名解析hmallleaing.com</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>zone <span class=\"token string\">\"hmallleasing.com\"</span> IN <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>         <span class=\"token builtin class-name\">type</span> slave<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>         <span class=\"token function\">file</span> <span class=\"token string\">\"slaves/hmallleasing.com.zone\"</span><span class=\"token punctuation\">;</span>    //具体解析记录配置存储至哪个文件</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>         masters <span class=\"token punctuation\">&#123;</span> <span class=\"token number\">172.16</span>.1.91<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>zone <span class=\"token string\">\"job.com\"</span> IN <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>         <span class=\"token builtin class-name\">type</span> slave<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>         <span class=\"token function\">file</span> <span class=\"token string\">\"slaves/job.com.zone\"</span><span class=\"token punctuation\">;</span>    //具体解析记录配置存储至哪个文件</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>         masters <span class=\"token punctuation\">&#123;</span> <span class=\"token number\">172.16</span>.1.91<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>//配置反向解析</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>zone <span class=\"token string\">\"1.16.172.in-addr.arpa\"</span> IN <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre> \t<span class=\"token builtin class-name\">type</span> slave<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre> \t<span class=\"token function\">file</span> <span class=\"token string\">\"slaves/1.16.172.zone\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>  \tmasters <span class=\"token punctuation\">&#123;</span> <span class=\"token number\">172.16</span>.1.91<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>include <span class=\"token string\">\"/etc/named.rfc1912.zones\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>include <span class=\"token string\">\"/etc/named.root.key\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr></table></figure><p>4. 检查语法并重载 DNS 服务器</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># named-checkconf</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># rndc reload</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-slave ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll /var/named/slaves/</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>-rw-r--r-- <span class=\"token number\">1</span> named named <span class=\"token number\">549</span> Sep <span class=\"token number\">20</span> <span class=\"token number\">22</span>:30 <span class=\"token number\">1.16</span>.172.zone</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>-rw-r--r-- <span class=\"token number\">1</span> named named <span class=\"token number\">420</span> Sep <span class=\"token number\">20</span> <span class=\"token number\">22</span>:30 hmallleasing.com.zone</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>-rw-r--r-- <span class=\"token number\">1</span> named named <span class=\"token number\">356</span> Sep <span class=\"token number\">20</span> <span class=\"token number\">22</span>:30 job.com.zone</pre></td></tr></table></figure><h6 id=\"435-测试主辅解析\"><a class=\"anchor\" href=\"#435-测试主辅解析\">#</a> 4.3.5 测试主辅解析</h6>\n<p>使用 dig 进行域名解析，先通过 master 解析，然后在使用 slave 测试解析</p>\n<p>1. 通过 master 解析</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># dig www.hmallleasing.com @172.16.1.91 </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">;</span> <span class=\"token operator\">&lt;&lt;</span><span class=\"token operator\">>></span> DiG <span class=\"token number\">9.11</span>.4-P2-RedHat-9.11.4-26.P2.el7_9.16 <span class=\"token operator\">&lt;&lt;</span><span class=\"token operator\">>></span> www.hmallleasing.com @172.16.1.91</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> global options: +cmd</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> Got answer:</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> -<span class=\"token operator\">>></span>HEADER<span class=\"token operator\">&lt;&lt;-</span> opcode: QUERY, status: NOERROR, id: <span class=\"token number\">34451</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> flags: qr aa rd ra<span class=\"token punctuation\">;</span> QUERY: <span class=\"token number\">1</span>, ANSWER: <span class=\"token number\">1</span>, AUTHORITY: <span class=\"token number\">2</span>, ADDITIONAL: <span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> OPT PSEUDOSECTION:</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">;</span> EDNS: version: <span class=\"token number\">0</span>, flags:<span class=\"token punctuation\">;</span> udp: <span class=\"token number\">4096</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> QUESTION SECTION:</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">;</span>www.hmallleasing.com.\t\tIN\tA</pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> ANSWER SECTION:</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>www.hmallleasing.com.\t<span class=\"token number\">600</span>\tIN\tA\t<span class=\"token number\">1.1</span>.1.1</pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> AUTHORITY SECTION:</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>hmallleasing.com.\t<span class=\"token number\">600</span>\tIN\tNS\tns2.hmallleasing.com.</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>hmallleasing.com.\t<span class=\"token number\">600</span>\tIN\tNS\tns1.hmallleasing.com.</pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> ADDITIONAL SECTION:</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>ns1.hmallleasing.com.\t<span class=\"token number\">600</span>\tIN\tA\t<span class=\"token number\">172.16</span>.1.91</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>ns2.hmallleasing.com.\t<span class=\"token number\">600</span>\tIN\tA\t<span class=\"token number\">172.16</span>.1.92</pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> Query time: <span class=\"token number\">0</span> msec</pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> SERVER: <span class=\"token number\">172.16</span>.1.91<span class=\"token comment\">#53(172.16.1.91)</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> WHEN: Sat Sep <span class=\"token number\">20</span> <span class=\"token number\">23</span>:03:40 CST <span class=\"token number\">2025</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> MSG SIZE  rcvd: <span class=\"token number\">133</span></pre></td></tr></table></figure><p>2. 通过 slave 解析</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># dig www.hmallleasing.com @172.16.1.92 </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">;</span> <span class=\"token operator\">&lt;&lt;</span><span class=\"token operator\">>></span> DiG <span class=\"token number\">9.11</span>.4-P2-RedHat-9.11.4-26.P2.el7_9.16 <span class=\"token operator\">&lt;&lt;</span><span class=\"token operator\">>></span> www.hmallleasing.com @172.16.1.92</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> global options: +cmd</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> Got answer:</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> -<span class=\"token operator\">>></span>HEADER<span class=\"token operator\">&lt;&lt;-</span> opcode: QUERY, status: NOERROR, id: <span class=\"token number\">4506</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> flags: qr aa rd ra<span class=\"token punctuation\">;</span> QUERY: <span class=\"token number\">1</span>, ANSWER: <span class=\"token number\">1</span>, AUTHORITY: <span class=\"token number\">2</span>, ADDITIONAL: <span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> OPT PSEUDOSECTION:</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">;</span> EDNS: version: <span class=\"token number\">0</span>, flags:<span class=\"token punctuation\">;</span> udp: <span class=\"token number\">4096</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> QUESTION SECTION:</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">;</span>www.hmallleasing.com.\t\tIN\tA</pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> ANSWER SECTION:</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>www.hmallleasing.com.\t<span class=\"token number\">600</span>\tIN\tA\t<span class=\"token number\">1.1</span>.1.1</pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> AUTHORITY SECTION:</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>hmallleasing.com.\t<span class=\"token number\">600</span>\tIN\tNS\tns2.hmallleasing.com.</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>hmallleasing.com.\t<span class=\"token number\">600</span>\tIN\tNS\tns1.hmallleasing.com.</pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> ADDITIONAL SECTION:</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>ns1.hmallleasing.com.\t<span class=\"token number\">600</span>\tIN\tA\t<span class=\"token number\">172.16</span>.1.91</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>ns2.hmallleasing.com.\t<span class=\"token number\">600</span>\tIN\tA\t<span class=\"token number\">172.16</span>.1.92</pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> Query time: <span class=\"token number\">0</span> msec</pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> SERVER: <span class=\"token number\">172.16</span>.1.92<span class=\"token comment\">#53(172.16.1.92)</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> WHEN: Sat Sep <span class=\"token number\">20</span> <span class=\"token number\">23</span>:03:23 CST <span class=\"token number\">2025</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> MSG SIZE  rcvd: <span class=\"token number\">133</span></pre></td></tr></table></figure><p>3. 测试主辅同步</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#1.dns master 新增一条记录，然后滚动 seria2025092019 自增 1</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master named<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat hmallleasing.com.zone </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token variable\">$TTL</span> <span class=\"token number\">600</span> <span class=\"token punctuation\">;</span> DNS失效时间，单位秒<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>hmallleasing.com. IN SOA ns.hmallleasing.com. xuy.nf-leasing.com. <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">;</span> 区域名称 IN SOA dns.hmallleasing.com. 管理员邮箱</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">;</span> 区域名称可以使用过@表示，@表示当前域</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token number\">2025092019</span> <span class=\"token punctuation\">;</span> 序列号<span class=\"token punctuation\">(</span>serial number<span class=\"token punctuation\">)</span> 十进制，不能超过10位，通常使用日期时间戳，例如2018121601</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token number\">10800</span>      <span class=\"token punctuation\">;</span> 刷新时间<span class=\"token punctuation\">(</span>refresh <span class=\"token function\">time</span><span class=\"token punctuation\">)</span> 即每隔多久到主服务器检查一次</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token number\">900</span>        <span class=\"token punctuation\">;</span> 重试时间<span class=\"token punctuation\">(</span>retry <span class=\"token function\">time</span><span class=\"token punctuation\">)</span> 即刷新不成功多久后重试，应该小于refresh <span class=\"token function\">time</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token number\">604800</span>     <span class=\"token punctuation\">;</span> 过期时间<span class=\"token punctuation\">(</span>expire <span class=\"token function\">time</span><span class=\"token punctuation\">)</span> 当辅助DNS无法联系主DNS时，辅助DNS在多长时间内认为其缓存是有效的。</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token number\">86400</span>      <span class=\"token punctuation\">;</span> 权威应答的ttl<span class=\"token punctuation\">(</span>netgative answer ttl<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">;</span>缓存DNS服务器可以缓存记录多长时间</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">;</span> 给客户端返回NS记录，hmallleasing.com. 域名由哪几台权威服务器提供解析</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>hmallleasing.com. IN NS ns1.hmallleasing.com.</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>hmallleasing.com. IN NS ns2.hmallleasing.com.</pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">;</span> A记录，配置权威域名的真实IP地址；</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>ns1.hmallleasing.com. IN A <span class=\"token number\">172.16</span>.1.91</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>ns2.hmallleasing.com. IN A <span class=\"token number\">172.16</span>.1.92</pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">;</span> 真正的域名解析</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>www.hmallleasing.com. IN A <span class=\"token number\">1.1</span>.1.1</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>web.hmallleasing.com. IN A <span class=\"token number\">2.2</span>.2.2</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>blog.hmallleasing.com. IN A <span class=\"token number\">3.3</span>.3.3</pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token comment\">#2. 重载 DNS 服务器</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master named<span class=\"token punctuation\">]</span><span class=\"token comment\"># rndc reload</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token comment\">#3. 使用 master 以及 slave 地址测试新添加的记录是否能解析</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token punctuation\">[</span>root@client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># dig blog.hmallleasing.com @172.16.1.91 </span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token punctuation\">[</span>root@client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># dig blog.hmallleasing.com @172.16.1.92 </span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token punctuation\">;</span> <span class=\"token operator\">&lt;&lt;</span><span class=\"token operator\">>></span> DiG <span class=\"token number\">9.11</span>.4-P2-RedHat-9.11.4-26.P2.el7_9.16 <span class=\"token operator\">&lt;&lt;</span><span class=\"token operator\">>></span> blog.hmallleasing.com @172.16.1.91</pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> global options: +cmd</pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> Got answer:</pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> -<span class=\"token operator\">>></span>HEADER<span class=\"token operator\">&lt;&lt;-</span> opcode: QUERY, status: NOERROR, id: <span class=\"token number\">60136</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> flags: qr aa rd ra<span class=\"token punctuation\">;</span> QUERY: <span class=\"token number\">1</span>, ANSWER: <span class=\"token number\">1</span>, AUTHORITY: <span class=\"token number\">2</span>, ADDITIONAL: <span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> OPT PSEUDOSECTION:</pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token punctuation\">;</span> EDNS: version: <span class=\"token number\">0</span>, flags:<span class=\"token punctuation\">;</span> udp: <span class=\"token number\">4096</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> QUESTION SECTION:</pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token punctuation\">;</span>blog.hmallleasing.com.\t\tIN\tA</pre></td></tr><tr><td data-num=\"44\"></td><td><pre></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> ANSWER SECTION:</pre></td></tr><tr><td data-num=\"46\"></td><td><pre>blog.hmallleasing.com.\t<span class=\"token number\">600</span>\tIN\tA\t<span class=\"token number\">3.3</span>.3.3</pre></td></tr><tr><td data-num=\"47\"></td><td><pre></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> AUTHORITY SECTION:</pre></td></tr><tr><td data-num=\"49\"></td><td><pre>hmallleasing.com.\t<span class=\"token number\">600</span>\tIN\tNS\tns1.hmallleasing.com.</pre></td></tr><tr><td data-num=\"50\"></td><td><pre>hmallleasing.com.\t<span class=\"token number\">600</span>\tIN\tNS\tns2.hmallleasing.com.</pre></td></tr><tr><td data-num=\"51\"></td><td><pre></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> ADDITIONAL SECTION:</pre></td></tr><tr><td data-num=\"53\"></td><td><pre>ns1.hmallleasing.com.\t<span class=\"token number\">600</span>\tIN\tA\t<span class=\"token number\">172.16</span>.1.91</pre></td></tr><tr><td data-num=\"54\"></td><td><pre>ns2.hmallleasing.com.\t<span class=\"token number\">600</span>\tIN\tA\t<span class=\"token number\">172.16</span>.1.92</pre></td></tr><tr><td data-num=\"55\"></td><td><pre></pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> Query time: <span class=\"token number\">0</span> msec</pre></td></tr><tr><td data-num=\"57\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> SERVER: <span class=\"token number\">172.16</span>.1.91<span class=\"token comment\">#53(172.16.1.91)</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> WHEN: Sat Sep <span class=\"token number\">20</span> <span class=\"token number\">23</span>:10:17 CST <span class=\"token number\">2025</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre><span class=\"token punctuation\">;</span><span class=\"token punctuation\">;</span> MSG SIZE  rcvd: <span class=\"token number\">134</span></pre></td></tr></table></figure><h4 id=\"5-dns子域授权配置\"><a class=\"anchor\" href=\"#5-dns子域授权配置\">#</a> 5. DNS 子域授权配置</h4>\n<h5 id=\"51-什么是dns子域授权\"><a class=\"anchor\" href=\"#51-什么是dns子域授权\">#</a> 5.1 什么是 DNS 子域授权</h5>\n<p>A 服务负责 （<a href=\"http://hmallleasing.com\">hmallleasing.com</a>）域名解析，授权 B 服务器管理 （<a href=\"http://ops.hmallleasing.com\">ops.hmallleasing.com</a>） 的域名解析；</p>\n<ul>\n<li>父域： <a href=\"http://hmallleasing.com\">hmallleasing.com</a></li>\n<li>子域： <a href=\"http://ops.hmallleasing.com\">ops.hmallleasing.com</a>\n<ul>\n<li>​      <a href=\"http://www.ops.hmallleasing.com\">www.ops.hmallleasing.com</a></li>\n<li>​       <a href=\"http://blog.ops.hmallleasing.com\">blog.ops.hmallleasing.com</a></li>\n</ul>\n</li>\n</ul>\n<p><img loading=\"lazy\" data-src=\"https://wp-cdn.4ce.cn/v2/at9yUkE.jpeg\" alt=\"1.jpg\" /></p>\n<h5 id=\"52-dns子域授权环境\"><a class=\"anchor\" href=\"#52-dns子域授权环境\">#</a> 5.2 DNS 子域授权环境</h5>\n<table>\n<thead>\n<tr>\n<th>环境</th>\n<th>域名</th>\n<th>节点外网地址</th>\n<th>节点内网地址</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>父域 Master</td>\n<td><a href=\"http://hmallleasing.com\">hmallleasing.com</a></td>\n<td>192.168.40.91</td>\n<td>172.16.1.91</td>\n</tr>\n<tr>\n<td>父域 Slace</td>\n<td><a href=\"http://hmamllleasing.com\">hmamllleasing.com</a></td>\n<td>192.168.40.92</td>\n<td>172.16.1.93</td>\n</tr>\n<tr>\n<td>子域</td>\n<td><a href=\"http://ops.hmallleasing.com\">ops.hmallleasing.com</a></td>\n<td>192.168.40.92</td>\n<td>172.16.1.93</td>\n</tr>\n</tbody>\n</table>\n<h5 id=\"53-dns子域授权的配置\"><a class=\"anchor\" href=\"#53-dns子域授权的配置\">#</a> 5.3 DNS 子域授权的配置</h5>\n<h6 id=\"531-dns-master父域配置\"><a class=\"anchor\" href=\"#531-dns-master父域配置\">#</a> 5.3.1 DNS Master 父域配置</h6>\n<p>1. 区域配置文件此前可以复用之前主辅配置，所以无需修改；</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/named.conf </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>options <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t//允许哪个地址同步master配置信息</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    allow-transfer <span class=\"token punctuation\">&#123;</span> <span class=\"token number\">172.16</span>.1.92<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t//主动通知辅助DNS域名变更\t</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>     also-notify <span class=\"token punctuation\">&#123;</span> <span class=\"token number\">172.16</span>.1.92<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>//自行配置权威域名解析hmallleaing.com</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>zone <span class=\"token string\">\"hmallleasing.com\"</span> IN <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre> \t <span class=\"token builtin class-name\">type</span> master<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre> \t <span class=\"token function\">file</span> <span class=\"token string\">\"hmallleasing.com.zone\"</span><span class=\"token punctuation\">;</span>    //具体解析记录配置存储至哪个文件</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>zone <span class=\"token string\">\"job.com\"</span> IN <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre> \t <span class=\"token builtin class-name\">type</span> master<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre> \t <span class=\"token function\">file</span> <span class=\"token string\">\"job.com.zone\"</span><span class=\"token punctuation\">;</span>    //具体解析记录配置存储至哪个文件</pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>//配置反向解析</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>zone <span class=\"token string\">\"1.16.172.in-addr.arpa\"</span> IN <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>  <span class=\"token builtin class-name\">type</span> master<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  <span class=\"token function\">file</span> <span class=\"token string\">\"1.16.172.zone\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>2. 区域数据库文件，将 ops 三级子域授权给子域服务器</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /var/named/hmallleasing.com.zone </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token variable\">$TTL</span> <span class=\"token number\">600</span> <span class=\"token punctuation\">;</span> DNS失效时间，单位秒<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>hmallleasing.com. IN SOA ns.hmallleasing.com. xuy.nf-leasing.com. <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">;</span> 区域名称 IN SOA dns.hmallleasing.com. 管理员邮箱</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">;</span> 区域名称可以使用过@表示，@表示当前域</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token number\">2025092019</span> <span class=\"token punctuation\">;</span> 序列号<span class=\"token punctuation\">(</span>serial number<span class=\"token punctuation\">)</span> 十进制，不能超过10位，通常使用日期时间戳，例如2018121601</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token number\">10800</span>      <span class=\"token punctuation\">;</span> 刷新时间<span class=\"token punctuation\">(</span>refresh <span class=\"token function\">time</span><span class=\"token punctuation\">)</span> 即每隔多久到主服务器检查一次</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token number\">900</span>        <span class=\"token punctuation\">;</span> 重试时间<span class=\"token punctuation\">(</span>retry <span class=\"token function\">time</span><span class=\"token punctuation\">)</span> 即刷新不成功多久后重试，应该小于refresh <span class=\"token function\">time</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token number\">604800</span>     <span class=\"token punctuation\">;</span> 过期时间<span class=\"token punctuation\">(</span>expire <span class=\"token function\">time</span><span class=\"token punctuation\">)</span> 当辅助DNS无法联系主DNS时，辅助DNS在多长时间内认为其缓存是有效的。</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token number\">86400</span>      <span class=\"token punctuation\">;</span> 权威应答的ttl<span class=\"token punctuation\">(</span>netgative answer ttl<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">;</span>缓存DNS服务器可以缓存记录多长时间</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">;</span> 给客户端返回NS记录，hmallleasing.com. 域名由哪几台权威服务器提供解析</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>hmallleasing.com. IN NS ns1.hmallleasing.com.</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>hmallleasing.com. IN NS ns2.hmallleasing.com.</pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">;</span> A记录，配置权威域名的真实IP地址；</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>ns1.hmallleasing.com. IN A <span class=\"token number\">172.16</span>.1.91</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>ns2.hmallleasing.com. IN A <span class=\"token number\">172.16</span>.1.92</pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">;</span> 真正的域名解析</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>www.hmallleasing.com. IN A <span class=\"token number\">1.1</span>.1.1</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>web.hmallleasing.com. IN A <span class=\"token number\">2.2</span>.2.2</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>blog.hmallleasing.com. IN A <span class=\"token number\">3.3</span>.3.3</pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">;</span>增加子域的配置</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>ops.hmallleasing.com.\t\t IN\t NS\t ns1.ops.hmallleasing.com.</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>ns1.ops.hmallleasing.com.\t IN\t A\t <span class=\"token number\">172.16</span>.1.93</pre></td></tr></table></figure><ol start=\"3\">\n<li>检查配置文件，区域数据库文件，重载服务</li>\n</ol>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># named-checkconf</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># named-checkzone hmallleasing.com /var/named/hmallleasing.com.zone </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl restart named</span></pre></td></tr></table></figure><h6 id=\"532-dns子域配置other\"><a class=\"anchor\" href=\"#532-dns子域配置other\">#</a> 5.3.2 DNS 子域配置 (Other)</h6>\n<p>1.bind 软件安装</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-son ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum install bind bind-utils -y</span></pre></td></tr></table></figure><p>2. 修改配置文件，然后增加紫玉的 zone 配置文件</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-son ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/named.conf </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>options <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tlisten-on port <span class=\"token number\">53</span> <span class=\"token punctuation\">&#123;</span> any<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\tallow-query     <span class=\"token punctuation\">&#123;</span> any<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>//增加如下配置</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>zone <span class=\"token string\">\"ops.hmallleasing.com\"</span> IN <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token builtin class-name\">type</span> master<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token function\">file</span> <span class=\"token string\">\"ops.hmallleasing.com.zone\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>3. 添加区域数据数据库文件</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-son ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /var/named/ops.hmallleasing.com.zone</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token variable\">$TTL</span> <span class=\"token number\">600</span> <span class=\"token punctuation\">;</span> DNS失效时间，单位秒<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>ops.hmallleasing.com. IN SOA ns.ops.hmallleasing.com. xuy.nf-leasing.com. <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">;</span> 区域名称 IN SOA dns.hmallleasing.com. 管理员邮箱</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">;</span> 区域名称可以使用过@表示，@表示当前域</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token number\">2025092018</span> <span class=\"token punctuation\">;</span> 序列号<span class=\"token punctuation\">(</span>serial number<span class=\"token punctuation\">)</span> 十进制，不能超过10位，通常使用日期时间戳，例如2018121601</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token number\">10800</span>      <span class=\"token punctuation\">;</span> 刷新时间<span class=\"token punctuation\">(</span>refresh <span class=\"token function\">time</span><span class=\"token punctuation\">)</span> 即每隔多久到主服务器检查一次</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token number\">900</span>        <span class=\"token punctuation\">;</span> 重试时间<span class=\"token punctuation\">(</span>retry <span class=\"token function\">time</span><span class=\"token punctuation\">)</span> 即刷新不成功多久后重试，应该小于refresh <span class=\"token function\">time</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token number\">604800</span>     <span class=\"token punctuation\">;</span> 过期时间<span class=\"token punctuation\">(</span>expire <span class=\"token function\">time</span><span class=\"token punctuation\">)</span> 当辅助DNS无法联系主DNS时，辅助DNS在多长时间内认为其缓存是有效的。</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token number\">86400</span>      <span class=\"token punctuation\">;</span> 权威应答的ttl<span class=\"token punctuation\">(</span>netgative answer ttl<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">;</span>缓存DNS服务器可以缓存记录多长时间</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">;</span> 给客户端返回NS记录，hmallleasing.com. 域名由哪几台权威服务器提供解析</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>ops.hmallleasing.com. IN NS ns1.ops.hmallleasing.com.</pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">;</span> A记录，配置权威域名的真实IP地址；</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>ns1.ops.hmallleasing.com. IN A <span class=\"token number\">172.16</span>.1.93</pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">;</span> 真正的域名解析</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>www.ops.hmallleasing.com.      \tIN     \tA  <span class=\"token number\">6.6</span>.6.6</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>blog.ops.hmallleasing.com.      IN      A  <span class=\"token number\">7.7</span>.7.7</pre></td></tr></table></figure><p>4. 检查配置文件，区域数据库文件，重载服务</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-son ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># named-checkconf</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-son ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># named-checkzone ops.hmallleasing.com /var/named/ops.hmallleasing.com.zone </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-son ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl start named  &amp;&amp; systemctl enable named</span></pre></td></tr></table></figure><h6 id=\"533-验证结果\"><a class=\"anchor\" href=\"#533-验证结果\">#</a> 5.3.3 验证结果</h6>\n<p>1. 客户端获取子域对应的解析</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># dig www.ops.hmallleasing.com @172.16.1.93 +short</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">6.6</span>.6.6</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># dig blog.ops.hmallleasing.com @172.16.1.93 +short</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">7.7</span>.7.7</pre></td></tr></table></figure><p>2. 客户端获取子域对应的解析（使用父域的 IP）</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># dig blog.ops.hmallleasing.com @172.16.1.91 +short</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">7.7</span>.7.7</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># dig www.ops.hmallleasing.com @172.16.1.92 +short</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">6.6</span>.6.6</pre></td></tr></table></figure><p>3. 客户端获取父域对应的解析（使用子域的 IP）</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 无法正常解析</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># dig www.hmallleasing.com @172.16.1.93 +short</span></pre></td></tr></table></figure><p>问题：由于父域与子域互相维护不同的区域配置，它们之间并不存在任何的联系，所以子域在解析父域的域名时，它并不会直接通过父域来获取权威的解析记录，那它会怎么做呢？</p>\n<ul>\n<li>第一步：它会先找顶点根域；</li>\n<li>第二步：寻找找 com 域对应的 DNS 服务器；</li>\n<li>第三步：寻找 example 域对应的 DNS 服务器，而后获取 www 对应的解析记录；</li>\n<li>这种查找模式是由 DNS 的机制所决定的；</li>\n</ul>\n<p>解决方法：明确告诉子域，让其能找到父域进项查询解析，而无需查找根域；（需要配置 DNS 的转发），参考小节：6.2、子域名转发的配置。</p>\n<h4 id=\"6-dns转发模式\"><a class=\"anchor\" href=\"#6-dns转发模式\">#</a> 6. DNS 转发模式</h4>\n<h5 id=\"61-什么是dns转发\"><a class=\"anchor\" href=\"#61-什么是dns转发\">#</a> 6.1 什么是 DNS 转发</h5>\n<p>转发指的是将域名查询请求，转至某一台服务器解析（被转发的服务器必须允许为当前服务器做递归）<br />\n转发分为两类；</p>\n<ul>\n<li>区域转发：仅转发对某特定区域的解析请求；</li>\n<li>全局转发：针对本地没有通过 zone 定义的区域查询请求，统统转发；</li>\n</ul>\n<p>转发参数：</p>\n<ul>\n<li>forwarders：转发给哪台服务器，可以多台；</li>\n<li>forwarder only：仅转发；</li>\n<li>forwarder first：优先转发给对应的服务器查询，如转发未响应，则自行迭代查询；</li>\n</ul>\n<h5 id=\"62-dns转发示例\"><a class=\"anchor\" href=\"#62-dns转发示例\">#</a> 6.2 DNS 转发示例</h5>\n<p>全局转发示例配置（所有本地不存在的域名都进行转发）</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>options <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tforward <span class=\"token punctuation\">&#123;</span> first <span class=\"token operator\">|</span> only <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tforwarders <span class=\"token punctuation\">&#123;</span> SERVER_IP<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>区域转发示例配置（符合该区域则进行条件转发）</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>zone <span class=\"token string\">\"ZONE_NAME\"</span> IN <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token builtin class-name\">type</span> forward<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tforward first<span class=\"token operator\">|</span>only <span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tforwarders <span class=\"token punctuation\">&#123;</span> SERVER_IP<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h5 id=\"63-dns区域转发实践\"><a class=\"anchor\" href=\"#63-dns区域转发实践\">#</a> 6.3 DNS 区域转发实践</h5>\n<p>1. 在子域服务器上，添加父域的域名，然后配置转发；</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-son ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/named.conf </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>zone <span class=\"token string\">\"ops.hmallleasing.com\"</span> IN <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token builtin class-name\">type</span> master<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token function\">file</span> <span class=\"token string\">\"ops.hmallleasing.com.zone\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>//增加如下配置</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>zone <span class=\"token string\">\"hmallleasing.com\"</span> IN <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token builtin class-name\">type</span> forward<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\tforward first<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\tforwarders <span class=\"token punctuation\">&#123;</span> <span class=\"token number\">172.16</span>.1.91<span class=\"token punctuation\">;</span> <span class=\"token number\">172.16</span>.1.92<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>2. 检查配置文件，区域数据库文件，重载服务</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-son ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># named-checkconf</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-son ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl restart named</span></pre></td></tr></table></figure><p>3. 测试转发效果</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># dig www.hmallleasing.com @172.16.1.93 +short</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">1.1</span>.1.1</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># dig web.hmallleasing.com @172.16.1.93 +short</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">2.2</span>.2.2</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># dig blog.hmallleasing.com @172.16.1.93 +short</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">3.3</span>.3.3</pre></td></tr></table></figure><h4 id=\"7-智能dns概述\"><a class=\"anchor\" href=\"#7-智能dns概述\">#</a> 7. 智能 DNS 概述</h4>\n<p>智能 DNS 就是根据用户的来源地域，自动智能化判断来路 IP 返回给用户，而不需要用户进行选择；</p>\n<h5 id=\"71-什么是智能dns\"><a class=\"anchor\" href=\"#71-什么是智能dns\">#</a> 7.1 什么是智能 DNS</h5>\n<p>DNS 解析，不判断访问者来源，会随机选择其中一个 IP 地址返回给访问者。</p>\n<p>智能 DNS 解析，会判断访问者的来源，为不同的访问者智能返回不同的 IP 地址，可使访问者在访问网站时可获取用户指定的 IP 地址，能够减少解析时延，并提升网站访问速度的功效。</p>\n<p>比方一个企业的站点三个运营商的带宽都有：电信、联通、移动；同样来自三个不同 运营商网络的访问用户，假设电信用户访问企业网址的时候，智能 DNS 会自动根据 IP 判断，再从电信返回给电信用户，其它的也同理；</p>\n<ul>\n<li>电信用户：访问 <a href=\"http://www.hmallleasing.com\">www.hmallleasing.com</a> 返回 1.1.1.1</li>\n<li>联通用户：访问 <a href=\"http://www.hmallleasing.com\">www.hmallleasing.com</a> 返回 2.2.2.2</li>\n<li>移动用户：访问 <a href=\"http://www.hmallleasing.com\">www.hmallleasing.com</a> 返回 3.3.3.3</li>\n</ul>\n<p><img loading=\"lazy\" data-src=\"https://wp-cdn.4ce.cn/v2/rq4jDva.jpeg\" alt=\"2.jpg\" /></p>\n<h5 id=\"72-如何实现智能dns\"><a class=\"anchor\" href=\"#72-如何实现智能dns\">#</a> 7.2 如何实现智能 DNS</h5>\n<p>实现智能 DNS 需要 VIEW 试图以及 ACL 访问控制列表协同完成；</p>\n<p><img loading=\"lazy\" data-src=\"https://wp-cdn.4ce.cn/v2/B5zXQz2.jpeg\" alt=\"3.jpg\" /></p>\n<h6 id=\"721-acl访问控制列表\"><a class=\"anchor\" href=\"#721-acl访问控制列表\">#</a> 7.2.1 ACL 访问控制列表</h6>\n<p>ACL 访问控制列表，是用来限制哪些主机可以通过 DNS 查询，哪些不可以；</p>\n<p>系统默认内置四种 ACL：</p>\n<ul>\n<li>any ：允许所有主机节点查询；</li>\n<li>none ：拒绝所有主机节点查询；</li>\n<li>localhost ：仅允许本地接口网络主机查询；</li>\n<li>localnet ：本地子网所有 IP；</li>\n</ul>\n<p>1. 简单 ACL 规则定义</p>\n<pre><code class=\"language-ba\">acl &quot;ips&quot; &#123;                           //定义一个名为ips的ACL\n  \t 10.0.0.1; 10.0.0.2; 192.168.1.1; //包含3个单个IP\n \t 172.16.1.0/24;\n...\n&#125;;\n</code></pre>\n<p>2. 复杂 ACL 规则定义</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>acl <span class=\"token string\">\"all_rule\"</span> <span class=\"token punctuation\">&#123;</span>  \t\t\t//定义一个名为all_rule的ACL</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token string\">\"ips\"</span><span class=\"token punctuation\">;</span>         \t \t\t//可以嵌套包含其他ACL</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token number\">10.0</span>.15.0/24<span class=\"token punctuation\">;</span> \t\t  \t//包含10.0.15.0子网中的所有IP</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token operator\">!</span><span class=\"token number\">10.0</span>.16.1/24<span class=\"token punctuation\">;</span>   \t\t\t//非10.0.16.1子网的IP</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token punctuation\">&#123;</span><span class=\"token number\">10.0</span>.17.1<span class=\"token punctuation\">;</span><span class=\"token number\">10.0</span>.18.2<span class=\"token punctuation\">;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span>   //包含了一个IP组</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  localhost；               //本地网络接口IP（含实际接口IP和127.0.0.1）</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>3. 定义的 ACL 规则如何使用</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>allow-update <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"ips\"</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span>        //允许谁能更新</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>allow-transfer <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"all_rule\"</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span> //允许谁能同步</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr></table></figure><h6 id=\"722-view视图功能\"><a class=\"anchor\" href=\"#722-view视图功能\">#</a> 7.2.2 VIEW 视图功能</h6>\n<p>view 语句定义了视图功能，视图是 BIND9 提供的强大的新功能，允许 DNS 服务器根据不同的客户端，请求相同的域名，但返回不同的解析结果；</p>\n<p>view 语法示例：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>view view_name <span class=\"token punctuation\">[</span>class<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\tmatch-clients <span class=\"token punctuation\">&#123;</span> address_match_list <span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tmatch-destinations <span class=\"token punctuation\">&#123;</span> address_match_list <span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tmatch-recursive-only <span class=\"token punctuation\">&#123;</span> yes_or_no <span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token punctuation\">[</span> view_option<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">..</span>.<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token punctuation\">[</span>zone<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">..</span>.<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h5 id=\"73-智能dns场景实战\"><a class=\"anchor\" href=\"#73-智能dns场景实战\">#</a> 7.3 智能 DNS 场景实战</h5>\n<ul>\n<li>维护一个主机域；根据不同环境的 IP 请求，查询相同域名，返回不同的解析结果；（企业常用）</li>\n<li>维护一个业务域；根据不同的运营商 IP 地址，解析到不同的地址；（需要大量 IP 地址库）</li>\n</ul>\n<h6 id=\"731-定义acl规则\"><a class=\"anchor\" href=\"#731-定义acl规则\">#</a> 7.3.1 定义 ACL 规则</h6>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>//模拟测试业务地址段</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>acl <span class=\"token string\">\"env-test\"</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token number\">172.16</span>.1.10<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>//模拟生产业务地址段</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>acl <span class=\"token string\">\"env-prod\"</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token number\">172.16</span>.1.200<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h6 id=\"732-定义view视图\"><a class=\"anchor\" href=\"#732-定义view视图\">#</a> 7.3.2 定义 VIEW 视图</h6>\n<p>1. 修改 /etc/named.conf 配置文件</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cp /etc/named.conf /etc/named.conf.bak</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/named.conf</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>//模拟测试业务地址段</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>acl <span class=\"token string\">\"test\"</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token number\">172.16</span>.1.10<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>//模拟生产业务地址段</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>acl <span class=\"token string\">\"prod\"</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token number\">172.16</span>.1.200<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>//测试业务view</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>view <span class=\"token string\">\"test-project\"</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  match-clients <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"test\"</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  recursion <span class=\"token function\">yes</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>  zone <span class=\"token string\">\".\"</span> IN <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token builtin class-name\">type</span> hint<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token function\">file</span> <span class=\"token string\">\"named.ca\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  zone <span class=\"token string\">\"example.com\"</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token builtin class-name\">type</span> master<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token function\">file</span> <span class=\"token string\">\"test/example.com.zone\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>//生产业务view</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>view <span class=\"token string\">\"prod-project\"</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>  match-clients <span class=\"token punctuation\">&#123;</span> <span class=\"token string\">\"prod\"</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>  recursion <span class=\"token function\">yes</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>  zone <span class=\"token string\">\".\"</span> IN <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token builtin class-name\">type</span> hint<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token function\">file</span> <span class=\"token string\">\"named.ca\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>  zone <span class=\"token string\">\"example.com\"</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token builtin class-name\">type</span> master<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token function\">file</span> <span class=\"token string\">\"prod/example.com.zone\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>//默认的view</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>view <span class=\"token string\">\"default\"</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>  match-clients <span class=\"token punctuation\">&#123;</span> any<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>  recursion <span class=\"token function\">yes</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"52\"></td><td><pre>  zone <span class=\"token string\">\".\"</span> IN <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>    <span class=\"token builtin class-name\">type</span> hint<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>    <span class=\"token function\">file</span> <span class=\"token string\">\"named.ca\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"57\"></td><td><pre>  zone <span class=\"token string\">\"example.com\"</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    <span class=\"token builtin class-name\">type</span> master<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>    <span class=\"token function\">file</span> <span class=\"token string\">\"default/example.com.zone\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre></pre></td></tr><tr><td data-num=\"62\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>//包含其他文件</pre></td></tr><tr><td data-num=\"65\"></td><td><pre><span class=\"token comment\">#include \"/etc/named.rfc1912.zones\";</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>include <span class=\"token string\">\"/etc/named.root.key\"</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>2. 检查配置文件语法</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># named-checkconf</span></pre></td></tr></table></figure><h6 id=\"733-测试环境zone电信\"><a class=\"anchor\" href=\"#733-测试环境zone电信\">#</a> 7.3.3 测试环境 zone (电信)</h6>\n<p>1. 创建目录并修改属组</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir /var/named/test</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chgrp named /var/named/test/</span></pre></td></tr></table></figure><p>2. 准备测试环境的 zone 区域配置文件</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /var/named/test/example.com.zone</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token variable\">$TTL</span> <span class=\"token number\">600</span> <span class=\"token punctuation\">;</span> DNS失效时间，单位秒<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>example.com. IN SOA ns.example.com. xuy.nf-leasing.com. <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">;</span> 区域名称 IN SOA dns.hmallleasing.com. 管理员邮箱</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">;</span> 区域名称可以使用过@表示，@表示当前域</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token number\">2025092018</span> <span class=\"token punctuation\">;</span> 序列号<span class=\"token punctuation\">(</span>serial number<span class=\"token punctuation\">)</span> 十进制，不能超过10位，通常使用日期时间戳，例如2018121601</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token number\">10800</span>      <span class=\"token punctuation\">;</span> 刷新时间<span class=\"token punctuation\">(</span>refresh <span class=\"token function\">time</span><span class=\"token punctuation\">)</span> 即每隔多久到主服务器检查一次</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token number\">900</span>        <span class=\"token punctuation\">;</span> 重试时间<span class=\"token punctuation\">(</span>retry <span class=\"token function\">time</span><span class=\"token punctuation\">)</span> 即刷新不成功多久后重试，应该小于refresh <span class=\"token function\">time</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token number\">604800</span>     <span class=\"token punctuation\">;</span> 过期时间<span class=\"token punctuation\">(</span>expire <span class=\"token function\">time</span><span class=\"token punctuation\">)</span> 当辅助DNS无法联系主DNS时，辅助DNS在多长时间内认为其缓存是有效的。</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token number\">86400</span>      <span class=\"token punctuation\">;</span> 权威应答的ttl<span class=\"token punctuation\">(</span>netgative answer ttl<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">;</span>缓存DNS服务器可以缓存记录多长时间</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">;</span> 给客户端返回NS记录，example.com. 域名由哪几台权威服务器提供解析</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>example.com. IN NS ns1.example.com.</pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">;</span> A记录，配置权威域名的真实IP地址；</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>ns1.example.com. IN A <span class=\"token number\">172.16</span>.1.91</pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">;</span> 真正的域名解析</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>www.example.com.      \tIN     \tA  <span class=\"token number\">1.1</span>.1.1</pre></td></tr></table></figure><p>3. 检查 zone 区域配置文件语法</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># named-checkzone example.com /var/named/test/example.com.zone</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl restart named</span></pre></td></tr></table></figure><h6 id=\"734-生产环境zone联通\"><a class=\"anchor\" href=\"#734-生产环境zone联通\">#</a> 7.3.4 生产环境 zone (联通)</h6>\n<p>1. 创建目录并修改属组</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir /var/named/prod</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chgrp named /var/named/prod/</span></pre></td></tr></table></figure><p>2. 准备测试环境的 zone 区域配置文件</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cp /var/named/test/example.com.zone /var/named/prod/example.com.zone </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /var/named/prod/example.com.zone </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token variable\">$TTL</span> <span class=\"token number\">600</span> <span class=\"token punctuation\">;</span> DNS失效时间，单位秒<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>example.com. IN SOA ns.example.com. xuy.nf-leasing.com. <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">;</span> 区域名称 IN SOA dns.hmallleasing.com. 管理员邮箱</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">;</span> 区域名称可以使用过@表示，@表示当前域</pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token number\">2025092018</span> <span class=\"token punctuation\">;</span> 序列号<span class=\"token punctuation\">(</span>serial number<span class=\"token punctuation\">)</span> 十进制，不能超过10位，通常使用日期时间戳，例如2018121601</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token number\">10800</span>      <span class=\"token punctuation\">;</span> 刷新时间<span class=\"token punctuation\">(</span>refresh <span class=\"token function\">time</span><span class=\"token punctuation\">)</span> 即每隔多久到主服务器检查一次</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token number\">900</span>        <span class=\"token punctuation\">;</span> 重试时间<span class=\"token punctuation\">(</span>retry <span class=\"token function\">time</span><span class=\"token punctuation\">)</span> 即刷新不成功多久后重试，应该小于refresh <span class=\"token function\">time</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token number\">604800</span>     <span class=\"token punctuation\">;</span> 过期时间<span class=\"token punctuation\">(</span>expire <span class=\"token function\">time</span><span class=\"token punctuation\">)</span> 当辅助DNS无法联系主DNS时，辅助DNS在多长时间内认为其缓存是有效的。</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t<span class=\"token number\">86400</span>      <span class=\"token punctuation\">;</span> 权威应答的ttl<span class=\"token punctuation\">(</span>netgative answer ttl<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">;</span>缓存DNS服务器可以缓存记录多长时间</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">;</span> 给客户端返回NS记录，example.com. 域名由哪几台权威服务器提供解析</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>example.com. IN NS ns1.example.com.</pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">;</span> A记录，配置权威域名的真实IP地址；</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>ns1.example.com. IN A <span class=\"token number\">172.16</span>.1.91</pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">;</span> 真正的域名解析</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>www.example.com.      \tIN     \tA  <span class=\"token number\">2.2</span>.2.2</pre></td></tr></table></figure><p>3. 检查 zone 区域配置文件语法</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># named-checkzone example.com /var/named/prod/example.com.zone</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl restart named</span></pre></td></tr></table></figure><h6 id=\"735-添加默认zone\"><a class=\"anchor\" href=\"#735-添加默认zone\">#</a> 7.3.5 添加默认 zone</h6>\n<p>1. 创建目录并修改属组</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir /var/named/default</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chgrp named /var/named/default</span></pre></td></tr></table></figure><p>2. 准备测试环境的 zone 区域配置文件</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /var/named/default/example.com.zone </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token variable\">$TTL</span> <span class=\"token number\">600</span> <span class=\"token punctuation\">;</span> DNS失效时间，单位秒<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>example.com. IN SOA ns.example.com. xuy.nf-leasing.com. <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">;</span> 区域名称 IN SOA dns.hmallleasing.com. 管理员邮箱</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">;</span> 区域名称可以使用过@表示，@表示当前域</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token number\">2025092018</span> <span class=\"token punctuation\">;</span> 序列号<span class=\"token punctuation\">(</span>serial number<span class=\"token punctuation\">)</span> 十进制，不能超过10位，通常使用日期时间戳，例如2018121601</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token number\">10800</span>      <span class=\"token punctuation\">;</span> 刷新时间<span class=\"token punctuation\">(</span>refresh <span class=\"token function\">time</span><span class=\"token punctuation\">)</span> 即每隔多久到主服务器检查一次</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token number\">900</span>        <span class=\"token punctuation\">;</span> 重试时间<span class=\"token punctuation\">(</span>retry <span class=\"token function\">time</span><span class=\"token punctuation\">)</span> 即刷新不成功多久后重试，应该小于refresh <span class=\"token function\">time</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token number\">604800</span>     <span class=\"token punctuation\">;</span> 过期时间<span class=\"token punctuation\">(</span>expire <span class=\"token function\">time</span><span class=\"token punctuation\">)</span> 当辅助DNS无法联系主DNS时，辅助DNS在多长时间内认为其缓存是有效的。</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token number\">86400</span>      <span class=\"token punctuation\">;</span> 权威应答的ttl<span class=\"token punctuation\">(</span>netgative answer ttl<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">;</span>缓存DNS服务器可以缓存记录多长时间</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">;</span> 给客户端返回NS记录，example.com. 域名由哪几台权威服务器提供解析</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>example.com. IN NS ns1.example.com.</pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">;</span> A记录，配置权威域名的真实IP地址；</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>ns1.example.com. IN A <span class=\"token number\">172.16</span>.1.91</pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">;</span> 真正的域名解析</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>www.example.com.      \tIN     \tA  <span class=\"token number\">3.3</span>.3.3</pre></td></tr></table></figure><p>3. 检查 zone 区域配置文件语法</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># named-checkzone example.com /var/named/default/example.com.zone</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl restart named</span></pre></td></tr></table></figure><h6 id=\"736-客户端测试\"><a class=\"anchor\" href=\"#736-客户端测试\">#</a> 7.3.6 客户端测试</h6>\n<p>使用不同客户端查询相同的域名进行测试验证</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 172.16.1.10 解析结果</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># dig www.example.com @172.16.1.91 +short</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">1.1</span>.1.1</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># 172.16.1.200 解析结果</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@route ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># dig www.example.com @172.16.1.91 +short</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">2.2</span>.2.2</pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\"># 172.16.1.7 解析结果</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">[</span>root@web01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># dig www.example.com @172.16.1.91 +short</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">3.3</span>.3.3</pre></td></tr></table></figure><h5 id=\"74-智能dns主从场景实践\"><a class=\"anchor\" href=\"#74-智能dns主从场景实践\">#</a> 7.4 智能 DNS 主从场景实践</h5>\n<ul>\n<li>基于 TSIG KEY 实现多 VIEW 主从同步，TSIG KEY 是基于对称秘钥加密技术实现的 DNS 报文认证机制。</li>\n<li>秘钥生成后存放至通信双方的配置文件中，报文传送前使用对称加密计数。</li>\n</ul>\n<h6 id=\"741-生成tsig-key\"><a class=\"anchor\" href=\"#741-生成tsig-key\">#</a> 7.4.1 生成 TSIG-KEY</h6>\n<p>使用 BIND 自带的工具 ddns-confgen 生成 TSIG-KEY，每个 view 需要一对 TSIG-KEY</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#1. 生成 default 默认 TSIG-KEY</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ddns-confgen -a hmac-md5</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>key <span class=\"token string\">\"default-key\"</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\talgorithm hmac-md5<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\tsecret <span class=\"token string\">\"MGMtJqmFgFdGU1yh7/FzBQ==\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#2. 生成测试环境 TSIG-KEY</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ddns-confgen -a hmac-md5</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>key <span class=\"token string\">\"test-key\"</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\talgorithm hmac-md5<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\tsecret <span class=\"token string\">\"0huRl0JD1goOvb6/BupIKw==\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">#3. 生成生产环境 TSIG-KEY</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ddns-confgen -a hmac-md5</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>key <span class=\"token string\">\"prod-key\"</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\talgorithm hmac-md5<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\tsecret <span class=\"token string\">\"1q8T/d2fNp4Y4sLETWZPBA==\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h6 id=\"742-master-dns配置\"><a class=\"anchor\" href=\"#742-master-dns配置\">#</a> 7.4.2 Master DNS 配置</h6>\n<p>Master DNS named.conf 配置（172.16.1.91）</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/named.conf</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>//</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>// named.conf</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>//</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>// Provided by Red Hat <span class=\"token builtin class-name\">bind</span> package to configure the ISC BIND named<span class=\"token punctuation\">(</span><span class=\"token number\">8</span><span class=\"token punctuation\">)</span> DNS</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>// server as a caching only nameserver <span class=\"token punctuation\">(</span>as a localhost DNS resolver only<span class=\"token punctuation\">)</span>.</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>//</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>// See /usr/share/doc/bind*/sample/ <span class=\"token keyword\">for</span> example named configuration files.</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>//</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>// See the BIND Administrator's Reference Manual <span class=\"token punctuation\">(</span>ARM<span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> details about the</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>// configuration located <span class=\"token keyword\">in</span> /usr/share/doc/bind-<span class=\"token punctuation\">&#123;</span>version<span class=\"token punctuation\">&#125;</span>/Bv9ARM.html</pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>options <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t// ipv4监听地址及端口</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\tlisten-on port <span class=\"token number\">53</span> <span class=\"token punctuation\">&#123;</span> any<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre> \t// ipv6监听地址及端口</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\tlisten-on-v6 port <span class=\"token number\">53</span> <span class=\"token punctuation\">&#123;</span> ::1<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t// 区域配置存储目录</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\tdirectory \t<span class=\"token string\">\"/var/named\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t// DNS解析过内容的缓存文件</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\tdump-file \t<span class=\"token string\">\"/var/named/data/cache_dump.db\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t// 静态解析文件（几乎不用）</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\tstatistics-file <span class=\"token string\">\"/var/named/data/named_stats.txt\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t// 内存的统计信息</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\tmemstatistics-file <span class=\"token string\">\"/var/named/data/named_mem_stats.txt\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\trecursing-file  <span class=\"token string\">\"/var/named/data/named.recursing\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\tsecroots-file   <span class=\"token string\">\"/var/named/data/named.secroots\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t// 允许谁本台DNS发起查询请求（localhost<span class=\"token operator\">|</span><span class=\"token function\">ip</span><span class=\"token operator\">|</span>any）</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\tallow-query     <span class=\"token punctuation\">&#123;</span> any<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t//允许哪个地址同步master配置信息</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        allow-transfer <span class=\"token punctuation\">&#123;</span> <span class=\"token number\">172.16</span>.1.92<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t//主动通知辅助DNS域名变更\t</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        also-notify <span class=\"token punctuation\">&#123;</span> <span class=\"token number\">172.16</span>.1.92<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span> </pre></td></tr><tr><td data-num=\"34\"></td><td><pre></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\t/* </pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\t - If you are building an AUTHORITATIVE DNS server, <span class=\"token keyword\">do</span> NOT <span class=\"token builtin class-name\">enable</span> recursion.</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>\t - If you are building a RECURSIVE <span class=\"token punctuation\">(</span>caching<span class=\"token punctuation\">)</span> DNS server, you need to <span class=\"token builtin class-name\">enable</span> </pre></td></tr><tr><td data-num=\"38\"></td><td><pre>\t   recursion. </pre></td></tr><tr><td data-num=\"39\"></td><td><pre>\t - If your recursive DNS server has a public IP address, you MUST <span class=\"token builtin class-name\">enable</span> access </pre></td></tr><tr><td data-num=\"40\"></td><td><pre>\t   control to limit queries to your legitimate users. Failing to <span class=\"token keyword\">do</span> so will</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>\t   cause your server to become part of large scale DNS amplification </pre></td></tr><tr><td data-num=\"42\"></td><td><pre>\t   attacks. Implementing BCP38 within your network would greatly</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>\t   reduce such attack surface </pre></td></tr><tr><td data-num=\"44\"></td><td><pre>\t*/</pre></td></tr><tr><td data-num=\"45\"></td><td><pre>\t//递归查询</pre></td></tr><tr><td data-num=\"46\"></td><td><pre>\trecursion <span class=\"token function\">yes</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>\tallow-recursion <span class=\"token punctuation\">&#123;</span> <span class=\"token number\">192.168</span>.40.0/24<span class=\"token punctuation\">;</span><span class=\"token number\">172.16</span>.1.0/24<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>\t//安全校验相关的</pre></td></tr><tr><td data-num=\"49\"></td><td><pre>\tdnssec-enable <span class=\"token function\">yes</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>\t//安全校验相关的</pre></td></tr><tr><td data-num=\"51\"></td><td><pre>\tdnssec-validation <span class=\"token function\">yes</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>\t/* Path to ISC DLV key */</pre></td></tr><tr><td data-num=\"54\"></td><td><pre>\tbindkeys-file <span class=\"token string\">\"/etc/named.root.key\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>\tmanaged-keys-directory <span class=\"token string\">\"/var/named/dynamic\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>\tpid-file <span class=\"token string\">\"/run/named/named.pid\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>\tsession-keyfile <span class=\"token string\">\"/run/named/session.key\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>// 控制日志输出的级别以及输出的位置</pre></td></tr><tr><td data-num=\"63\"></td><td><pre>logging <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>        channel default_debug <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>                <span class=\"token function\">file</span> <span class=\"token string\">\"data/named.run\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>                severity dynamic<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>//模拟测试业务地址段</pre></td></tr><tr><td data-num=\"71\"></td><td><pre>acl <span class=\"token string\">\"test\"</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>\t<span class=\"token number\">172.16</span>.1.10<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>//模拟生产业务地址段</pre></td></tr><tr><td data-num=\"76\"></td><td><pre>acl <span class=\"token string\">\"prod\"</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>\t<span class=\"token number\">172.16</span>.1.200<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre></pre></td></tr><tr><td data-num=\"80\"></td><td><pre></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>//TSIG-KEY</pre></td></tr><tr><td data-num=\"82\"></td><td><pre>key <span class=\"token string\">\"default-key\"</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>\talgorithm hmac-md5<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>\tsecret <span class=\"token string\">\"MGMtJqmFgFdGU1yh7/FzBQ==\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>key <span class=\"token string\">\"test-key\"</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>\talgorithm hmac-md5<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>\tsecret <span class=\"token string\">\"0huRl0JD1goOvb6/BupIKw==\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>key <span class=\"token string\">\"prod-key\"</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>\talgorithm hmac-md5<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre>\tsecret <span class=\"token string\">\"1q8T/d2fNp4Y4sLETWZPBA==\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre></pre></td></tr><tr><td data-num=\"97\"></td><td><pre>//测试业务view</pre></td></tr><tr><td data-num=\"98\"></td><td><pre>view <span class=\"token string\">\"test-project\"</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre>  //须取消两台DNS主机通过地址匹配，使其通过TSIG-KEY匹配，如果不取消会出现拒绝访问</pre></td></tr><tr><td data-num=\"100\"></td><td><pre>  match-clients <span class=\"token punctuation\">&#123;</span> key test-key<span class=\"token punctuation\">;</span> <span class=\"token operator\">!</span><span class=\"token number\">172.16</span>.1.91<span class=\"token punctuation\">;</span><span class=\"token operator\">!</span><span class=\"token number\">172.16</span>.1.92<span class=\"token punctuation\">;</span> <span class=\"token string\">\"test\"</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"101\"></td><td><pre>  //Slave节点与Master节点通讯使用key-test</pre></td></tr><tr><td data-num=\"102\"></td><td><pre>  server <span class=\"token number\">172.16</span>.1.92 <span class=\"token punctuation\">&#123;</span> keys test-key<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre>  //允许test-project view区域使用test-key传输区域文件</pre></td></tr><tr><td data-num=\"104\"></td><td><pre>  allow-transfer <span class=\"token punctuation\">&#123;</span> key test-key<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"105\"></td><td><pre>  recursion <span class=\"token function\">yes</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"106\"></td><td><pre></pre></td></tr><tr><td data-num=\"107\"></td><td><pre>  zone <span class=\"token string\">\".\"</span> IN <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"108\"></td><td><pre>    <span class=\"token builtin class-name\">type</span> hint<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"109\"></td><td><pre>    <span class=\"token function\">file</span> <span class=\"token string\">\"named.ca\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"110\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"111\"></td><td><pre></pre></td></tr><tr><td data-num=\"112\"></td><td><pre>  zone <span class=\"token string\">\"example.com\"</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"113\"></td><td><pre>    <span class=\"token builtin class-name\">type</span> master<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"114\"></td><td><pre>    <span class=\"token function\">file</span> <span class=\"token string\">\"test/example.com.zone\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"115\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"116\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"117\"></td><td><pre></pre></td></tr><tr><td data-num=\"118\"></td><td><pre>//生产业务view</pre></td></tr><tr><td data-num=\"119\"></td><td><pre>view <span class=\"token string\">\"prod-project\"</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"120\"></td><td><pre>  //须取消两台DNS主机通过地址匹配，使其通过TSIG-KEY匹配，如果不取消会出现拒绝访问</pre></td></tr><tr><td data-num=\"121\"></td><td><pre>  match-clients <span class=\"token punctuation\">&#123;</span> key prod-key<span class=\"token punctuation\">;</span> <span class=\"token operator\">!</span><span class=\"token number\">172.16</span>.1.91<span class=\"token punctuation\">;</span><span class=\"token operator\">!</span><span class=\"token number\">172.16</span>.1.92<span class=\"token punctuation\">;</span> <span class=\"token string\">\"prod\"</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"122\"></td><td><pre>  //Slave节点与Master节点通讯使用prod-key</pre></td></tr><tr><td data-num=\"123\"></td><td><pre>  server <span class=\"token number\">172.16</span>.1.92 <span class=\"token punctuation\">&#123;</span> keys prod-key<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"124\"></td><td><pre>  //允许test-project view区域使用prod-key传输区域文件</pre></td></tr><tr><td data-num=\"125\"></td><td><pre>  allow-transfer <span class=\"token punctuation\">&#123;</span> key prod-key<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"126\"></td><td><pre>  recursion <span class=\"token function\">yes</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"127\"></td><td><pre></pre></td></tr><tr><td data-num=\"128\"></td><td><pre>  zone <span class=\"token string\">\".\"</span> IN <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"129\"></td><td><pre>    <span class=\"token builtin class-name\">type</span> hint<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"130\"></td><td><pre>    <span class=\"token function\">file</span> <span class=\"token string\">\"named.ca\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"131\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"132\"></td><td><pre></pre></td></tr><tr><td data-num=\"133\"></td><td><pre>  zone <span class=\"token string\">\"example.com\"</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"134\"></td><td><pre>    <span class=\"token builtin class-name\">type</span> master<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"135\"></td><td><pre>    <span class=\"token function\">file</span> <span class=\"token string\">\"prod/example.com.zone\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"136\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"137\"></td><td><pre></pre></td></tr><tr><td data-num=\"138\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"139\"></td><td><pre></pre></td></tr><tr><td data-num=\"140\"></td><td><pre>//默认的view</pre></td></tr><tr><td data-num=\"141\"></td><td><pre>view <span class=\"token string\">\"default\"</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"142\"></td><td><pre>  //须取消两台DNS主机通过地址匹配，使其通过TSIG-KEY匹配，如果不取消会出现拒绝访问</pre></td></tr><tr><td data-num=\"143\"></td><td><pre>  match-clients <span class=\"token punctuation\">&#123;</span> key default-key<span class=\"token punctuation\">;</span> <span class=\"token operator\">!</span><span class=\"token number\">172.16</span>.1.91<span class=\"token punctuation\">;</span><span class=\"token operator\">!</span><span class=\"token number\">172.16</span>.1.92<span class=\"token punctuation\">;</span> any<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"144\"></td><td><pre>  //Slave节点与Master节点通讯使用default-key</pre></td></tr><tr><td data-num=\"145\"></td><td><pre>  server <span class=\"token number\">172.16</span>.1.92 <span class=\"token punctuation\">&#123;</span> keys default-key<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"146\"></td><td><pre>  //允许test-project view区域使用default-key传输区域文件</pre></td></tr><tr><td data-num=\"147\"></td><td><pre>  allow-transfer <span class=\"token punctuation\">&#123;</span> key default-key<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"148\"></td><td><pre>  recursion <span class=\"token function\">yes</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"149\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"150\"></td><td><pre>  zone <span class=\"token string\">\".\"</span> IN <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"151\"></td><td><pre>    <span class=\"token builtin class-name\">type</span> hint<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"152\"></td><td><pre>    <span class=\"token function\">file</span> <span class=\"token string\">\"named.ca\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"153\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"154\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"155\"></td><td><pre>  zone <span class=\"token string\">\"example.com\"</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"156\"></td><td><pre>    <span class=\"token builtin class-name\">type</span> master<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"157\"></td><td><pre>    <span class=\"token function\">file</span> <span class=\"token string\">\"default/example.com.zone\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"158\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"159\"></td><td><pre></pre></td></tr><tr><td data-num=\"160\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"161\"></td><td><pre></pre></td></tr><tr><td data-num=\"162\"></td><td><pre>//包含其他文件</pre></td></tr><tr><td data-num=\"163\"></td><td><pre><span class=\"token comment\">#include \"/etc/named.rfc1912.zones\";</span></pre></td></tr><tr><td data-num=\"164\"></td><td><pre>include <span class=\"token string\">\"/etc/named.root.key\"</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h6 id=\"743-slave-dns配置\"><a class=\"anchor\" href=\"#743-slave-dns配置\">#</a> 7.4.3 Slave DNS 配置</h6>\n<p>Slave DNS named.conf 配置（172.16.1.92）</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-slave ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/named.conf </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>//</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>// named.conf</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>//</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>// Provided by Red Hat <span class=\"token builtin class-name\">bind</span> package to configure the ISC BIND named<span class=\"token punctuation\">(</span><span class=\"token number\">8</span><span class=\"token punctuation\">)</span> DNS</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>// server as a caching only nameserver <span class=\"token punctuation\">(</span>as a localhost DNS resolver only<span class=\"token punctuation\">)</span>.</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>//</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>// See /usr/share/doc/bind*/sample/ <span class=\"token keyword\">for</span> example named configuration files.</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>//</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>// See the BIND Administrator's Reference Manual <span class=\"token punctuation\">(</span>ARM<span class=\"token punctuation\">)</span> <span class=\"token keyword\">for</span> details about the</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>// configuration located <span class=\"token keyword\">in</span> /usr/share/doc/bind-<span class=\"token punctuation\">&#123;</span>version<span class=\"token punctuation\">&#125;</span>/Bv9ARM.html</pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>options <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\tlisten-on port <span class=\"token number\">53</span> <span class=\"token punctuation\">&#123;</span> any<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\tlisten-on-v6 port <span class=\"token number\">53</span> <span class=\"token punctuation\">&#123;</span> ::1<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\tdirectory \t<span class=\"token string\">\"/var/named\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\tdump-file \t<span class=\"token string\">\"/var/named/data/cache_dump.db\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\tstatistics-file <span class=\"token string\">\"/var/named/data/named_stats.txt\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\tmemstatistics-file <span class=\"token string\">\"/var/named/data/named_mem_stats.txt\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\trecursing-file  <span class=\"token string\">\"/var/named/data/named.recursing\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\tsecroots-file   <span class=\"token string\">\"/var/named/data/named.secroots\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\tallow-query     <span class=\"token punctuation\">&#123;</span> any<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        masterfile-format text<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t/* </pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t - If you are building an AUTHORITATIVE DNS server, <span class=\"token keyword\">do</span> NOT <span class=\"token builtin class-name\">enable</span> recursion.</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t - If you are building a RECURSIVE <span class=\"token punctuation\">(</span>caching<span class=\"token punctuation\">)</span> DNS server, you need to <span class=\"token builtin class-name\">enable</span> </pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t   recursion. </pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t - If your recursive DNS server has a public IP address, you MUST <span class=\"token builtin class-name\">enable</span> access </pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t   control to limit queries to your legitimate users. Failing to <span class=\"token keyword\">do</span> so will</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\t   cause your server to become part of large scale DNS amplification </pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t   attacks. Implementing BCP38 within your network would greatly</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t   reduce such attack surface </pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t*/</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\trecursion <span class=\"token function\">yes</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>\tdnssec-enable <span class=\"token function\">yes</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>\tdnssec-validation <span class=\"token function\">yes</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>\t/* Path to ISC DLV key */</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>\tbindkeys-file <span class=\"token string\">\"/etc/named.root.key\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>\tmanaged-keys-directory <span class=\"token string\">\"/var/named/dynamic\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>\tpid-file <span class=\"token string\">\"/run/named/named.pid\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>\tsession-keyfile <span class=\"token string\">\"/run/named/session.key\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>logging <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        channel default_debug <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>                <span class=\"token function\">file</span> <span class=\"token string\">\"data/named.run\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                severity dynamic<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>//模拟测试业务地址段</pre></td></tr><tr><td data-num=\"57\"></td><td><pre>acl <span class=\"token string\">\"test\"</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>\t<span class=\"token number\">172.16</span>.1.10<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>//模拟生产业务地址段</pre></td></tr><tr><td data-num=\"62\"></td><td><pre>acl <span class=\"token string\">\"prod\"</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>\t<span class=\"token number\">172.16</span>.1.200<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre></pre></td></tr><tr><td data-num=\"66\"></td><td><pre></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>//TSIG-KEY</pre></td></tr><tr><td data-num=\"68\"></td><td><pre>key <span class=\"token string\">\"default-key\"</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>\talgorithm hmac-md5<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>\tsecret <span class=\"token string\">\"MGMtJqmFgFdGU1yh7/FzBQ==\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>key <span class=\"token string\">\"test-key\"</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>\talgorithm hmac-md5<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>\tsecret <span class=\"token string\">\"0huRl0JD1goOvb6/BupIKw==\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>key <span class=\"token string\">\"prod-key\"</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>\talgorithm hmac-md5<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>\tsecret <span class=\"token string\">\"1q8T/d2fNp4Y4sLETWZPBA==\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>//测试业务view</pre></td></tr><tr><td data-num=\"84\"></td><td><pre>view <span class=\"token string\">\"test-project\"</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>  //须取消两台DNS主机通过地址匹配，使其通过TSIG-KEY匹配，如果不取消会出现拒绝访问</pre></td></tr><tr><td data-num=\"86\"></td><td><pre>  match-clients <span class=\"token punctuation\">&#123;</span> key test-key<span class=\"token punctuation\">;</span> <span class=\"token operator\">!</span><span class=\"token number\">172.16</span>.1.91<span class=\"token punctuation\">;</span><span class=\"token operator\">!</span><span class=\"token number\">172.16</span>.1.92<span class=\"token punctuation\">;</span> <span class=\"token string\">\"test\"</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>  //Slave节点与Master节点通讯使用key-test</pre></td></tr><tr><td data-num=\"88\"></td><td><pre>  server <span class=\"token number\">172.16</span>.1.91 <span class=\"token punctuation\">&#123;</span> keys test-key<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>  recursion <span class=\"token function\">yes</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>  zone <span class=\"token string\">\".\"</span> IN <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>    <span class=\"token builtin class-name\">type</span> hint<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>    <span class=\"token function\">file</span> <span class=\"token string\">\"named.ca\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre></pre></td></tr><tr><td data-num=\"96\"></td><td><pre>  zone <span class=\"token string\">\"example.com\"</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre>    <span class=\"token builtin class-name\">type</span> slave<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre>    <span class=\"token function\">file</span> <span class=\"token string\">\"test/example.com.zone\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre>    masters <span class=\"token punctuation\">&#123;</span> <span class=\"token number\">172.16</span>.1.91<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"101\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre></pre></td></tr><tr><td data-num=\"103\"></td><td><pre>//生产业务view</pre></td></tr><tr><td data-num=\"104\"></td><td><pre>view <span class=\"token string\">\"prod-project\"</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"105\"></td><td><pre>  //须取消两台DNS主机通过地址匹配，使其通过TSIG-KEY匹配，如果不取消会出现拒绝访问</pre></td></tr><tr><td data-num=\"106\"></td><td><pre>  match-clients <span class=\"token punctuation\">&#123;</span> key prod-key<span class=\"token punctuation\">;</span> <span class=\"token operator\">!</span><span class=\"token number\">172.16</span>.1.91<span class=\"token punctuation\">;</span><span class=\"token operator\">!</span><span class=\"token number\">172.16</span>.1.92<span class=\"token punctuation\">;</span> <span class=\"token string\">\"prod\"</span><span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"107\"></td><td><pre>  //Slave节点与Master节点通讯使用prod-key</pre></td></tr><tr><td data-num=\"108\"></td><td><pre>  server <span class=\"token number\">172.16</span>.1.91 <span class=\"token punctuation\">&#123;</span> keys prod-key<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"109\"></td><td><pre>  recursion <span class=\"token function\">yes</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"110\"></td><td><pre></pre></td></tr><tr><td data-num=\"111\"></td><td><pre>  zone <span class=\"token string\">\".\"</span> IN <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"112\"></td><td><pre>    <span class=\"token builtin class-name\">type</span> hint<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"113\"></td><td><pre>    <span class=\"token function\">file</span> <span class=\"token string\">\"named.ca\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"114\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"115\"></td><td><pre></pre></td></tr><tr><td data-num=\"116\"></td><td><pre>  zone <span class=\"token string\">\"example.com\"</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"117\"></td><td><pre>    <span class=\"token builtin class-name\">type</span> slave<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"118\"></td><td><pre>    <span class=\"token function\">file</span> <span class=\"token string\">\"prod/example.com.zone\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"119\"></td><td><pre>    masters <span class=\"token punctuation\">&#123;</span> <span class=\"token number\">172.16</span>.1.91<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"120\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"121\"></td><td><pre></pre></td></tr><tr><td data-num=\"122\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"123\"></td><td><pre></pre></td></tr><tr><td data-num=\"124\"></td><td><pre>//默认的view</pre></td></tr><tr><td data-num=\"125\"></td><td><pre>view <span class=\"token string\">\"default\"</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"126\"></td><td><pre>  //须取消两台DNS主机通过地址匹配，使其通过TSIG-KEY匹配，如果不取消会出现拒绝访问</pre></td></tr><tr><td data-num=\"127\"></td><td><pre>  match-clients <span class=\"token punctuation\">&#123;</span> key default-key<span class=\"token punctuation\">;</span> <span class=\"token operator\">!</span><span class=\"token number\">172.16</span>.1.91<span class=\"token punctuation\">;</span><span class=\"token operator\">!</span><span class=\"token number\">172.16</span>.1.92<span class=\"token punctuation\">;</span> any<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"128\"></td><td><pre>  //Slave节点与Master节点通讯使用default-key</pre></td></tr><tr><td data-num=\"129\"></td><td><pre>  server <span class=\"token number\">172.16</span>.1.91 <span class=\"token punctuation\">&#123;</span> keys default-key<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"130\"></td><td><pre>  recursion <span class=\"token function\">yes</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"131\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"132\"></td><td><pre>  zone <span class=\"token string\">\".\"</span> IN <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"133\"></td><td><pre>    <span class=\"token builtin class-name\">type</span> hint<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"134\"></td><td><pre>    <span class=\"token function\">file</span> <span class=\"token string\">\"named.ca\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"135\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"136\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"137\"></td><td><pre>  zone <span class=\"token string\">\"example.com\"</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"138\"></td><td><pre>    <span class=\"token builtin class-name\">type</span> slave<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"139\"></td><td><pre>    <span class=\"token function\">file</span> <span class=\"token string\">\"default/example.com.zone\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"140\"></td><td><pre>    masters <span class=\"token punctuation\">&#123;</span> <span class=\"token number\">172.16</span>.1.91<span class=\"token punctuation\">;</span> <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"141\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"142\"></td><td><pre></pre></td></tr><tr><td data-num=\"143\"></td><td><pre><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"144\"></td><td><pre></pre></td></tr><tr><td data-num=\"145\"></td><td><pre></pre></td></tr><tr><td data-num=\"146\"></td><td><pre><span class=\"token comment\">#include \"/etc/named.rfc1912.zones\";</span></pre></td></tr><tr><td data-num=\"147\"></td><td><pre>include <span class=\"token string\">\"/etc/named.root.key\"</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h6 id=\"744-验证结果\"><a class=\"anchor\" href=\"#744-验证结果\">#</a> 7.4.4 验证结果</h6>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#1. 新建目录并修改权限</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-slave ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir /var/named/test</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-slave ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir /var/named/prod</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-slave ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir /var/named/default</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-slave ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chown named.named /var/named/test</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-slave ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chown named.named /var/named/prod/</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-slave ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chown named.named /var/named/default/</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">#2. 修改 master 所有区域配置文件序列号并重启 master 和 slave</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl restart named</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-slave ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl restart named</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">#3. 检查区域配置文件是否同步</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-slave ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll /var/named/test/example.com.zone /var/named/default/example.com.zone </span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>-rw-r--r-- <span class=\"token number\">1</span> named named <span class=\"token number\">337</span> Sep <span class=\"token number\">21</span> <span class=\"token number\">19</span>:27 /var/named/default/example.com.zone</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>-rw-r--r-- <span class=\"token number\">1</span> named named <span class=\"token number\">337</span> Sep <span class=\"token number\">21</span> <span class=\"token number\">19</span>:27 /var/named/prod/example.com.zone</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>-rw-r--r-- <span class=\"token number\">1</span> named named <span class=\"token number\">337</span> Sep <span class=\"token number\">21</span> <span class=\"token number\">19</span>:27 /var/named/test/example.com.zone</pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\">#4.172.16.1.10 解析结果</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">[</span>root@client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># dig www.example.com @172.16.1.91 +short</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token number\">1.1</span>.1.1</pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">[</span>root@client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># dig www.example.com @172.16.1.92 +short</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token number\">1.1</span>.1.1</pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token comment\">#5.172.16.1.200 解析结果</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token punctuation\">[</span>root@route ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># dig www.example.com @172.16.1.91 +short</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token number\">2.2</span>.2.2</pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token punctuation\">[</span>root@route ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># dig www.example.com @172.16.1.92 +short</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token number\">2.2</span>.2.2</pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token comment\">#6.172.16.1.7 解析结果</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token punctuation\">[</span>root@web01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># dig www.example.com @172.16.1.91 +short</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token number\">2.2</span>.2.2</pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token punctuation\">[</span>root@web01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># dig www.example.com @172.16.1.92 +short</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token number\">2.2</span>.2.2</pre></td></tr></table></figure><p>修改 master 区域配置文件检查 slave 是否同步成功</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-master ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /var/named/default/example.com.zone </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token variable\">$TTL</span> <span class=\"token number\">600</span> <span class=\"token punctuation\">;</span> DNS失效时间，单位秒<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>example.com. IN SOA ns.example.com. xuy.nf-leasing.com. <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">;</span> 区域名称 IN SOA dns.hmallleasing.com. 管理员邮箱</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">;</span> 区域名称可以使用过@表示，@表示当前域</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token number\">2025092059</span> <span class=\"token punctuation\">;</span> 序列号<span class=\"token punctuation\">(</span>serial number<span class=\"token punctuation\">)</span> 十进制，不能超过10位，通常使用日期时间戳，例如2018121601</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token number\">10800</span>      <span class=\"token punctuation\">;</span> 刷新时间<span class=\"token punctuation\">(</span>refresh <span class=\"token function\">time</span><span class=\"token punctuation\">)</span> 即每隔多久到主服务器检查一次</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token number\">900</span>        <span class=\"token punctuation\">;</span> 重试时间<span class=\"token punctuation\">(</span>retry <span class=\"token function\">time</span><span class=\"token punctuation\">)</span> 即刷新不成功多久后重试，应该小于refresh <span class=\"token function\">time</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token number\">604800</span>     <span class=\"token punctuation\">;</span> 过期时间<span class=\"token punctuation\">(</span>expire <span class=\"token function\">time</span><span class=\"token punctuation\">)</span> 当辅助DNS无法联系主DNS时，辅助DNS在多长时间内认为其缓存是有效的。</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token number\">86400</span>      <span class=\"token punctuation\">;</span> 权威应答的ttl<span class=\"token punctuation\">(</span>netgative answer ttl<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">;</span>缓存DNS服务器可以缓存记录多长时间</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">;</span> 给客户端返回NS记录，example.com. 域名由哪几台权威服务器提供解析</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>example.com. IN NS ns1.example.com.</pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">;</span> A记录，配置权威域名的真实IP地址；</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>ns1.example.com. IN A <span class=\"token number\">172.16</span>.1.91</pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">;</span> 真正的域名解析</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>www.example.com.      \tIN     \tA  <span class=\"token number\">2.2</span>.2.2</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>bbs.example.com.      \tIN     \tA  <span class=\"token number\">8.8</span>.8.8</pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">[</span>root@dns-slave ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /var/named/default/example.com.zone </span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token variable\">$ORIGIN</span> <span class=\"token builtin class-name\">.</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token variable\">$TTL</span> <span class=\"token number\">600</span>\t<span class=\"token punctuation\">;</span> <span class=\"token number\">10</span> minutes</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>example.com\t\tIN SOA\tns.example.com. xuy.nf-leasing.com. <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t\t\t\t<span class=\"token number\">2025092059</span> <span class=\"token punctuation\">;</span> serial</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t\t\t\t<span class=\"token number\">10800</span>      <span class=\"token punctuation\">;</span> refresh <span class=\"token punctuation\">(</span><span class=\"token number\">3</span> hours<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t\t\t\t<span class=\"token number\">900</span>        <span class=\"token punctuation\">;</span> retry <span class=\"token punctuation\">(</span><span class=\"token number\">15</span> minutes<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\t\t\t\t<span class=\"token number\">604800</span>     <span class=\"token punctuation\">;</span> expire <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> week<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t\t\t\t<span class=\"token number\">86400</span>      <span class=\"token punctuation\">;</span> minimum <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> day<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t\t\t\t<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t\t\tNS\tns1.example.com.</pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token variable\">$ORIGIN</span> example.com.</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>bbs\t\t\tA\t<span class=\"token number\">8.8</span>.8.8</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>ns1\t\t\tA\t<span class=\"token number\">172.16</span>.1.91</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>www\t\t\tA\t<span class=\"token number\">2.2</span>.2.2</pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token punctuation\">[</span>root@web01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># dig bbs.example.com @172.16.1.92 +short</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token number\">8.8</span>.8.8</pre></td></tr></table></figure>",
            "tags": [
                "Linux"
            ]
        },
        {
            "id": "http://ixuyong.cn/posts/2889248111.html",
            "url": "http://ixuyong.cn/posts/2889248111.html",
            "title": "Vsftp服务实践",
            "date_published": "2025-08-20T14:12:00.000Z",
            "content_html": "<h3 id=\"vsftp服务实践\"><a class=\"anchor\" href=\"#vsftp服务实践\">#</a> Vsftp 服务实践</h3>\n<h4 id=\"一-vsftp-概述\"><a class=\"anchor\" href=\"#一-vsftp-概述\">#</a> 一、VSFTP 概述</h4>\n<p>FTP 是 File Transfer Protocol（文件传输协议）的英文简称，用于 Internet 上的文件的双向传输。使用 FTP 来传输时，是具有一定程度的危险性， 因为数据在因特网上面是完全没有受到保护的明文传输方式。</p>\n<p>VSFTP 是一个基于 GPL 发布的类 Unix 系统上使用的 FTP 服务器软件，它的全称是 Very Secure FTP，从名称定义上基本可以看出，这是为了解决 ftp 传输安全性问题的。</p>\n<h4 id=\"二-vsftp-工作模式\"><a class=\"anchor\" href=\"#二-vsftp-工作模式\">#</a> 二、VSFTP 工作模式</h4>\n<h5 id=\"21-port模式\"><a class=\"anchor\" href=\"#21-port模式\">#</a> 2.1 Port 模式</h5>\n<p>FTP 客户端首先和服务器的 TCP 21 端口建立连接，用来发送命令，客户端需要接收数据的时候在这个通道上发送 PORT 命令。PORT 命令包含了客户端用什么端口接收数据。在传送数据的时候，服务器端通过自己的 TCP 20 端口连接至客户端的指定端口发送数据。FTP server 必须和客户端建立一个新的连接用来传送数据。</p>\n<p><img loading=\"lazy\" data-src=\"https://wp-cdn.4ce.cn/v2/YAl4LqQ.jpeg\" alt=\"1.jpg\" /></p>\n<h5 id=\"22-passive模式\"><a class=\"anchor\" href=\"#22-passive模式\">#</a> 2.2 Passive 模式</h5>\n<p>FTP 客户端首先和服务器的 TCP 21 端口建立连接，用来建立控制通道发送命令，但建立连接后客户端发送 Pasv 命令。服务器收到 Pasv 命令后，打开一个临时端口（端口大于 1023 小于 65535）并且通知客户端在这个端口上传送数据的请求，客户端连接 FTP 服务器的临时端口，然后 FTP 服务器将通过这个端口传输数据。</p>\n<p><img loading=\"lazy\" data-src=\"https://wp-cdn.4ce.cn/v2/7mKqSbg.jpeg\" alt=\"2.jpg\" /></p>\n<h4 id=\"三-vsftp部署\"><a class=\"anchor\" href=\"#三-vsftp部署\">#</a> 三、VSFTP 部署</h4>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#1. 安装 vsftp</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum install vsftpd -y</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl start vsftpd &amp;&amp; systemctl enable vsftpd</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#2.vsftp 相关文件</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll /etc/vsftpd/</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>-rw------- <span class=\"token number\">1</span> root root  <span class=\"token number\">125</span> Jun <span class=\"token number\">10</span>  <span class=\"token number\">2021</span> ftpusers       <span class=\"token comment\">#黑名单</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>-rw------- <span class=\"token number\">1</span> root root  <span class=\"token number\">361</span> Jun <span class=\"token number\">10</span>  <span class=\"token number\">2021</span> user_list      <span class=\"token comment\">#默认为黑名单，如将 userlist_deny=NO 则为白名单</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>-rw------- <span class=\"token number\">1</span> root root <span class=\"token number\">5116</span> Jun <span class=\"token number\">10</span>  <span class=\"token number\">2021</span> vsftpd.conf    <span class=\"token comment\">#主配置文件</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>-rwxr--r-- <span class=\"token number\">1</span> root root  <span class=\"token number\">338</span> Jun <span class=\"token number\">10</span>  <span class=\"token number\">2021</span> vsftpd_conf_migrate.sh</pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">#3. 验证 vsftp 明文传输，tcpdump 抓包可以看到密码</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># useradd xuyong</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># echo \"123456\" | passwd --stdin xuyong</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># tcpdump -i eth0 -nnX port 21</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token number\">15</span>:05:40.187871 IP <span class=\"token number\">192.168</span>.40.1.54319 <span class=\"token operator\">></span> <span class=\"token number\">192.168</span>.40.50.21: Flags <span class=\"token punctuation\">[</span>P.<span class=\"token punctuation\">]</span>, <span class=\"token function\">seq</span> <span class=\"token number\">1</span>:14, ack <span class=\"token number\">21</span>, win <span class=\"token number\">1023</span>, length <span class=\"token number\">13</span>: FTP: <span class=\"token environment constant\">USER</span> xuyong  <span class=\"token comment\">#用户名</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t0x0000:  <span class=\"token number\">4500</span> 0035 36d8 <span class=\"token number\">4000</span> <span class=\"token number\">8006</span> f266 c0a8 <span class=\"token number\">2801</span>  E<span class=\"token punctuation\">..</span><span class=\"token number\">56</span>.@<span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span>f<span class=\"token punctuation\">..</span><span class=\"token punctuation\">(</span>.</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t0x0010:  c0a8 <span class=\"token number\">2832</span> d42f 0015 b46e 2af8 bd8d d6ef  <span class=\"token punctuation\">..</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span>./<span class=\"token punctuation\">..</span>.n*<span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t0x0020:  <span class=\"token number\">5018</span> 03ff <span class=\"token number\">8100</span> 0000 <span class=\"token number\">5553</span> <span class=\"token number\">4552</span> <span class=\"token number\">2078</span> <span class=\"token number\">7579</span>  P<span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span>.<span class=\"token environment constant\">USER</span>.xuy</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t0x0030:  6f6e 670d 0a                             ong<span class=\"token punctuation\">..</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token number\">15</span>:05:40.188149 IP <span class=\"token number\">192.168</span>.40.1.54319 <span class=\"token operator\">></span> <span class=\"token number\">192.168</span>.40.50.21: Flags <span class=\"token punctuation\">[</span>P.<span class=\"token punctuation\">]</span>, <span class=\"token function\">seq</span> <span class=\"token number\">14</span>:27, ack <span class=\"token number\">55</span>, win <span class=\"token number\">1023</span>, length <span class=\"token number\">13</span>: FTP: PASS <span class=\"token number\">123456</span>  <span class=\"token comment\">#密码</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t0x0000:  <span class=\"token number\">4500</span> 0035 36db <span class=\"token number\">4000</span> <span class=\"token number\">8006</span> f263 c0a8 <span class=\"token number\">2801</span>  E<span class=\"token punctuation\">..</span><span class=\"token number\">56</span>.@<span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span>c<span class=\"token punctuation\">..</span><span class=\"token punctuation\">(</span>.</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t0x0010:  c0a8 <span class=\"token number\">2832</span> d42f 0015 b46e 2b05 bd8d d711  <span class=\"token punctuation\">..</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span>./<span class=\"token punctuation\">..</span>.n+<span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t0x0020:  <span class=\"token number\">5018</span> 03ff 27a9 0000 <span class=\"token number\">5041</span> <span class=\"token number\">5353</span> <span class=\"token number\">2031</span> <span class=\"token number\">3233</span>  P<span class=\"token punctuation\">..</span>.'<span class=\"token punctuation\">..</span>.PASS.123</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t0x0030:  <span class=\"token number\">3435</span> 360d 0a                             <span class=\"token number\">456</span><span class=\"token punctuation\">..</span></pre></td></tr></table></figure><h4 id=\"四-登录验证方式\"><a class=\"anchor\" href=\"#四-登录验证方式\">#</a> 四、登录验证方式</h4>\n<p><strong>1. 匿名用户验证：</strong></p>\n<ul>\n<li>用户账号名称：ftp 或 anonymous</li>\n<li>用户账号密码：无密码</li>\n<li>工作目录：/var/ftp</li>\n<li>默认权限：默认可下载不可上传，上传权限由两部分组成（主配置文件和文件系统）</li>\n</ul>\n<p><strong>2. 本地用户验证：</strong></p>\n<ul>\n<li>用户账号名称：本地用户（/etc/passwd）</li>\n<li>用户账号密码：用户密码（/etc/shadow）</li>\n<li>工作目录：登录用户的家目录</li>\n<li>权限：最大权限（drwx------）</li>\n</ul>\n<p><strong>3. 虚拟（virtual）用户验证：</strong></p>\n<ul>\n<li>创建虚拟用户用来代替本地用户，减少本地用户曝光率</li>\n<li>使用本地用户作为虚拟用户的映射用户，为虚拟用户提供工作目录和权限控制</li>\n<li>能够设置严格的权限（为每一个用户生成单独的配置文件）</li>\n</ul>\n<h4 id=\"五-vsftp配置文件详解\"><a class=\"anchor\" href=\"#五-vsftp配置文件详解\">#</a> 五、VSFTP 配置文件详解</h4>\n<h5 id=\"51-vsftp默认配置文件\"><a class=\"anchor\" href=\"#51-vsftp默认配置文件\">#</a> 5.1 VSFTP 默认配置文件</h5>\n<ul>\n<li>允许匿名用户和本地用户登陆。anonymous_enable=YES 、local_enable=YES</li>\n<li>匿名用户使用的登陆名为 ftp 或 anonymous，口令为空；匿名用户不能离开匿名用户家目录 /var/ftp，且只能下载不能上传。</li>\n<li>本地用户的登录名为本地用户名，口令为此本地用户的口令；本地用户可以在自 己家目录中进行读写操作；本地用户可以离开自家目录切换至有权限访问的其他目录，并在权限允许的情况下进行上传 / 下载。write_enable=YES</li>\n<li>写在文件 /etc/vsftpd.ftpusers 中的本地用户禁止登陆。</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#  egrep -v \"^#|^$\" /etc/vsftpd/vsftpd.conf </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token assign-left variable\">anonymous_enable</span><span class=\"token operator\">=</span>YES         <span class=\"token comment\">#允许匿名用户登录</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token assign-left variable\">local_enable</span><span class=\"token operator\">=</span>YES             <span class=\"token comment\">#允许本地用户登录</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">write_enable</span><span class=\"token operator\">=</span>YES             <span class=\"token comment\">#允许本地用户上传</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token assign-left variable\">local_umask</span><span class=\"token operator\">=</span>022              <span class=\"token comment\">#umask 权限，上传默认文件权限 644，默认目录权限 755</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token assign-left variable\">dirmessage_enable</span><span class=\"token operator\">=</span>YES        <span class=\"token comment\">#用户进入目录时，显示 message 文件中信息</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token assign-left variable\">xferlog_enable</span><span class=\"token operator\">=</span>YES           <span class=\"token comment\">#激活记录日志</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token assign-left variable\">connect_from_port_20</span><span class=\"token operator\">=</span>YES     <span class=\"token comment\">#主动模式数据传输端口</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token assign-left variable\">xferlog_std_format</span><span class=\"token operator\">=</span>YES       <span class=\"token comment\">#使用标准的 ftp 日志格式</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token assign-left variable\">listen</span><span class=\"token operator\">=</span>NO\t\t\t\t\t <span class=\"token comment\">#允许被监听</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token assign-left variable\">listen_ipv6</span><span class=\"token operator\">=</span>YES              <span class=\"token comment\">#允许被监听</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token assign-left variable\">pam_service_name</span><span class=\"token operator\">=</span>vsftpd      <span class=\"token comment\">#开启 pam 认证</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token assign-left variable\">userlist_enable</span><span class=\"token operator\">=</span>YES          <span class=\"token comment\">#用户登入限制</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token assign-left variable\">tcp_wrappers</span><span class=\"token operator\">=</span>YES             <span class=\"token comment\">#主机访问控制模式</span></pre></td></tr></table></figure><h5 id=\"52-常用全局配置\"><a class=\"anchor\" href=\"#52-常用全局配置\">#</a> 5.2 常用全局配置</h5>\n<h6 id=\"521-匿名用户anonymous设置\"><a class=\"anchor\" href=\"#521-匿名用户anonymous设置\">#</a> 5.2.1 匿名用户（anonymous）设置</h6>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">anonymous_enable</span><span class=\"token operator\">=</span>YES         </pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#控制是否允许匿名用户登入，YES 为允许匿名登入，NO 为不允许。默认值为 YES。</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">write_enable</span><span class=\"token operator\">=</span>YES             </pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#是否允许登陆用户有写权限。属于全局设置，默认值为 YES。</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token assign-left variable\">no_anon_password</span><span class=\"token operator\">=</span>NO          </pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#若是启动这项功能，则使用匿名登入时，不会询问密码。默认值为 NO。</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token assign-left variable\">ftp_username</span><span class=\"token operator\">=</span>ftp             </pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">#定义匿名登入的使用者名称。默认值为 ftp。</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token assign-left variable\">anon_root</span><span class=\"token operator\">=</span>/var/ftp          </pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">#使用匿名登入时，所登入的目录。默认值为 /var/ftp。注意 ftp 目录不能是 777 的权限属性，即匿名用户的家目录不能有 777 的权限。</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token assign-left variable\">anon_upload_enable</span><span class=\"token operator\">=</span>NO        </pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">#如果设为 YES，则允许匿名登入者有上传文件（非目录）的权限，只有在 write_enable=YES 时，此项才有效。当然，匿名用户必须要有对上层目录的写入权。默认值为 NO。</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token assign-left variable\">anon_world_readable_only</span><span class=\"token operator\">=</span>YES </pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">#如果设为 YES，则允许匿名登入者下载可阅读的档案（可以下载到本机阅读，不能直接在 FTP 服务器中打开阅读）。默认值为 YES。</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token assign-left variable\">anon_mkdir_write_enable</span><span class=\"token operator\">=</span>NO   </pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">#如果设为 YES，则允许匿名登入者有新增目录的权限，只有在 write_enable=YES 时，此项才有效。当然，匿名用户必须要有对上层目录的写入权。默认值为 NO。</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token assign-left variable\">anon_other_write_enable</span><span class=\"token operator\">=</span>NO   </pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token comment\">#如果设为 YES，则允许匿名登入者更多于上传或者建立目录之外的权限，譬如删除或者重命名。（如果 anon_upload_enable=NO，则匿名用户不能上传文件，但可以删除或者重命名已经存在的文件；如果 anon_mkdir_write_enable=NO，则匿名用户不能上传或者新建文件夹，但可以删除或者重命名已经存在的文件夹。）默认值为 NO。</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token assign-left variable\">chown_uploads</span><span class=\"token operator\">=</span>NO            </pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token comment\">#设置是否改变匿名用户上传文件（非目录）的属主。默认值为 NO。</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token assign-left variable\">chown_username</span><span class=\"token operator\">=</span>username     </pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token comment\">#设置匿名用户上传文件（非目录）的属主名。建议不要设置为 root。</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token assign-left variable\">anon_umask</span><span class=\"token operator\">=</span>077             </pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token comment\">#设置匿名登入者新增或上传档案时的 umask 值。默认值为 077，则新建档案的对应权限为 700。</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token assign-left variable\">deny_email_enable</span><span class=\"token operator\">=</span>NO        </pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token comment\">#若是启动这项功能，则必须提供一个档案 /etc/vsftpd/banner_emails，内容为 email address。若是使用匿名登入，则会要求输入 email address，若输入的 email address 在此档案内，则不允许进入。默认值为 NO。</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token assign-left variable\">banned_email_file</span><span class=\"token operator\">=</span>/etc/vsftpd/banner_emails</pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token comment\">#此文件用来输入 email address，只有在 deny_email_enable=YES 时，才会使用到此档案。若是使用匿名登入，则会要求输入 email address，若输入的 email address 在此档案内，则不允许进入。</span></pre></td></tr></table></figure><h6 id=\"522-本地用户设置\"><a class=\"anchor\" href=\"#522-本地用户设置\">#</a> 5.2.2 本地用户设置</h6>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">local_enable</span><span class=\"token operator\">=</span>YES/NO（YES）</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#控制是否允许本地用户登入，YES 为允许本地用户登入，NO 为不允许。默认值为 YES。</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">local_root</span><span class=\"token operator\">=</span>/home/username</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#当本地用户登入时，将被更换到定义的目录下。默认值为各用户的家目录。</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token assign-left variable\">write_enable</span><span class=\"token operator\">=</span>YES/NO（YES）</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#是否允许登陆用户有写权限。属于全局设置，默认值为 YES。</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token assign-left variable\">local_umask</span><span class=\"token operator\">=</span>022</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">#本地用户新增档案时的 umask 值。默认值为 077。</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token assign-left variable\">file_open_mode</span><span class=\"token operator\">=</span>0755</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">#本地用户上传档案后的档案权限，与 chmod 所使用的数值相同。默认值为 0666。</span></pre></td></tr></table></figure><h6 id=\"523-欢迎语设置\"><a class=\"anchor\" href=\"#523-欢迎语设置\">#</a> 5.2.3 欢迎语设置</h6>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">dirmessage_enable</span><span class=\"token operator\">=</span>YES/NO（YES）</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#如果启动这个选项，那么使用者第一次进入一个目录时，会检查该目录下是否有.message 这个档案，如果有，则会出现此档案的内容，通常这个档案会放置欢迎话语，或是对该目录的说明。默认值为开启。</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">message_file</span><span class=\"token operator\">=</span>.message</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#设置目录消息文件，可将要显示的信息写入该文件。默认值为.message。</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token assign-left variable\">banner_file</span><span class=\"token operator\">=</span>/etc/vsftpd/banner</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#当使用者登入时，会显示此设定所在的档案内容，通常为欢迎话语或是说明。默认值为无。如果欢迎信息较多，则使用该配置项。</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token assign-left variable\">ftpd_banner</span><span class=\"token operator\">=</span>Welcome to BOB's FTP server</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">#这里用来定义欢迎话语的字符串，banner_file 是档案的形式，而 ftpd_banner 则是字符串的形式。预设为无。</span></pre></td></tr></table></figure><h6 id=\"524-控制用户是否允许切换到上级目录\"><a class=\"anchor\" href=\"#524-控制用户是否允许切换到上级目录\">#</a> 5.2.4 控制用户是否允许切换到上级目录</h6>\n<p>在默认配置下，本地用户登入 FTP 后可以使用 cd 命令切换到其他目录，这样会对系统带来安全隐患。可以通过以下三条配置文件来控制用户切换目录。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">chroot_list_enable</span><span class=\"token operator\">=</span>NO                     <span class=\"token comment\">#设置是否启用 chroot_list_file 配置项指定的用户列表文件。默认值为 NO</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token assign-left variable\">chroot_list_file</span><span class=\"token operator\">=</span>/etc/vsftpd.chroot_list  <span class=\"token comment\">#用于指定用户列表文件，该文件用于控制哪些用户可以切换到用户家目录的上级目录</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token assign-left variable\">chroot_local_user</span><span class=\"token operator\">=</span>NO                      <span class=\"token comment\">#用于指定用户列表文件中的用户是否允许切换到上级目录。默认值为 NO</span></pre></td></tr></table></figure><p>通过搭配能实现以下几种效果：</p>\n<ul>\n<li>当 chroot_list_enable=YES，chroot_local_user=YES 时，在 /etc/vsftpd.chroot_list 文件中列出的用户，可以切换到其他目录；未在文件中列出的用户，不能切换到其他目录。</li>\n<li>当 chroot_list_enable=YES，chroot_local_user=NO 时，在 /etc/vsftpd.chroot_list 文件中列出的用户，不能切换到其他目录；未在文件中列出的用户，可以切换到其他目录。</li>\n<li>当 chroot_list_enable=NO，chroot_local_user=YES 时，所有的用户均不能切换到其他目录。</li>\n<li>当 chroot_list_enable=NO，chroot_local_user=NO 时，所有的用户均可以切换到其他目录。</li>\n</ul>\n<h6 id=\"525-数据传输模式设置\"><a class=\"anchor\" href=\"#525-数据传输模式设置\">#</a> 5.2.5 数据传输模式设置</h6>\n<p>FTP 在传输数据时，可以使用二进制方式，也可以使用 ASCII 模式来上传或下载数据。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">ascii_upload_enable</span><span class=\"token operator\">=</span>YES/NO（NO）</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#设置是否启用 ASCII 模式上传数据。默认值为 NO。</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">ascii_download_enable</span><span class=\"token operator\">=</span>YES/NO（NO）</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#设置是否启用 ASCII 模式下载数据。默认值为 NO。</span></pre></td></tr></table></figure><h6 id=\"526-访问控制设置\"><a class=\"anchor\" href=\"#526-访问控制设置\">#</a> 5.2.6 访问控制设置</h6>\n<p>两种控制方式：一种控制主机访问，另一种控制用户访问。</p>\n<p>1、控制主机访问：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">tcp_wrappers</span><span class=\"token operator\">=</span>YES/NO（YES）</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#设置 vsftpd 是否与 tcp wrapper 相结合来进行主机的访问控制。默认值为 YES。如果启用，则 vsftpd 服务器会检查 /etc/hosts.allow 和 /etc/hosts.deny 中的设置，来决定请求连接的主机，是否允许访问该 FTP 服务器。这两个文件可以起到简易的防火墙功能。比如：若要仅允许 192.168.0.1—192.168.0.254 的用户可以连接 FTP 服务器，则在 /etc/hosts.allow 文件中添加以下内容：</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>vsftpd:192.168.0. :allow</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>all:all :deny</pre></td></tr></table></figure><p>2、控制用户访问</p>\n<p>对于用户的访问控制可以通过 /etc 目录下的 vsftpd.user_list 和 ftpusers 文件来实现。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">userlist_file</span><span class=\"token operator\">=</span>/etc/vsftpd.user_list</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#控制用户访问 FTP 的文件，里面写着用户名称。一个用户名称一行。</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">userlist_enable</span><span class=\"token operator\">=</span>YES/NO（NO）</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#是否启用 vsftpd.user_list 文件。</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token assign-left variable\">userlist_deny</span><span class=\"token operator\">=</span>YES/NO（YES）</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#决定 vsftpd.user_list 文件中的用户是否能够访问 FTP 服务器。若设置为 YES，则 vsftpd.user_list 文件中的用户不允许访问 FTP，若设置为 NO，则只有 vsftpd.user_list 文件中的用户才能访问 FTP。/etc/vsftpd/ftpusers 文件专门用于定义不允许访问 FTP 服务器的用户列表（注意：如果 userlist_enable=YES,userlist_deny=NO, 此时如果在 vsftpd.user_list 和 ftpusers 中都有某个用户时，那么这个用户是不能够访问 FTP 的，即 ftpusers 的优先级要高）。默认情况下 vsftpd.user_list 和 ftpusers，这两个文件已经预设置了一些不允许访问 FTP 服务器的系统内部账户。如果系统没有这两个文件，那么新建这两个文件，将用户添加进去即可。</span></pre></td></tr></table></figure><h6 id=\"527-访问速率设置\"><a class=\"anchor\" href=\"#527-访问速率设置\">#</a> 5.2.7 访问速率设置</h6>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">anon_max_rate</span><span class=\"token operator\">=</span><span class=\"token number\">0</span>                   <span class=\"token comment\">#设置匿名登入者使用的最大传输速度，单位为 B/s，0 表示不限制速度。默认值为 0</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token assign-left variable\">local_max_rate</span><span class=\"token operator\">=</span><span class=\"token number\">0</span>                  <span class=\"token comment\">#本地用户使用的最大传输速度，单位为 B/s，0 表示不限制速度。预设值为 0。</span></pre></td></tr></table></figure><h6 id=\"528-超时时间设置\"><a class=\"anchor\" href=\"#528-超时时间设置\">#</a> 5.2.8 超时时间设置</h6>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">accept_timeout</span><span class=\"token operator\">=</span><span class=\"token number\">60</span>                 <span class=\"token comment\">#被动模式设置建立 FTP 连接的超时时间，单位为秒。默认值为 60</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token assign-left variable\">connect_timeout</span><span class=\"token operator\">=</span><span class=\"token number\">60</span>                <span class=\"token comment\">#PORT 主动模式下建立数据连接的超时时间，单位为秒。默认值为 60</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token assign-left variable\">data_connection_timeout</span><span class=\"token operator\">=</span><span class=\"token number\">120</span>       <span class=\"token comment\">#设置建立 FTP 数据连接的超时时间，单位为秒。默认值为 120</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">idle_session_timeout</span><span class=\"token operator\">=</span><span class=\"token number\">300</span>          <span class=\"token comment\">#设置多长时间不对 FTP 服务器进行任何操作，则断开该 FTP 连接，默认值为 300 秒</span></pre></td></tr></table></figure><h6 id=\"529-日志文件设置\"><a class=\"anchor\" href=\"#529-日志文件设置\">#</a> 5.2.9 日志文件设置</h6>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">xferlog_enable</span><span class=\"token operator\">=</span> YES/NO（YES）</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#是否启用上传 / 下载日志记录。如果启用，则上传与下载的信息将被完整纪录在 xferlog_file 所定义的档案中。预设为开启。</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">xferlog_file</span><span class=\"token operator\">=</span>/var/log/vsftpd.log</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#设置日志文件名和路径，默认值为 /var/log/vsftpd.log。</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token assign-left variable\">xferlog_std_format</span><span class=\"token operator\">=</span>YES/NO（NO）</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#如果启用，则日志文件将会写成 xferlog 的标准格式，如同 wu-ftpd 一般。默认值为关闭。</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token assign-left variable\">log_ftp_protocol</span><span class=\"token operator\">=</span>YES<span class=\"token operator\">|</span>NO（NO）</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">#如果启用此选项，所有的 FTP 请求和响应都会被记录到日志中，默认日志文件在 /var/log/vsftpd.log。启用此选项时，xferlog_std_format 不能被激活。这个选项有助于调试。默认值为 NO。</span></pre></td></tr></table></figure><h6 id=\"5210-ftp工作模式与端口设置\"><a class=\"anchor\" href=\"#5210-ftp工作模式与端口设置\">#</a> 5.2.10 FTP 工作模式与端口设置</h6>\n<p>FTP 有两种工作方式：PORT FTP（主动模式）和 PASV FTP（被动模式）</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">listen_port</span><span class=\"token operator\">=</span><span class=\"token number\">21</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#设置 FTP 服务器建立连接所监听的端口，默认值为 21。</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">connect_from_port_20</span><span class=\"token operator\">=</span>YES/NO</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#指定 FTP 使用 20 端口进行数据传输，默认值为 YES。</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token assign-left variable\">ftp_data_port</span><span class=\"token operator\">=</span><span class=\"token number\">20</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#设置在 PORT 方式下，FTP 数据连接使用的端口，默认值为 20。</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token assign-left variable\">pasv_enable</span><span class=\"token operator\">=</span>YES/NO（YES）</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">#若设置为 YES，则使用 PASV 被动模式；若设置为 NO，则使用 PORT 模式。默认值为 YES，即使用 PASV 被动模式。</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token assign-left variable\">pasv_max_port</span><span class=\"token operator\">=</span><span class=\"token number\">24800</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">#在 PASV 工作模式下，数据连接可以使用的端口范围的最大端口，0 表示任意端口。默认值为 0。</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token assign-left variable\">pasv_min_port</span><span class=\"token operator\">=</span><span class=\"token number\">24500</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">#在 PASV 工作模式下，数据连接可以使用的端口范围的最小端口，0 表示任意端口。默认值为 0。</span></pre></td></tr></table></figure><h6 id=\"5211-与连接相关的设置\"><a class=\"anchor\" href=\"#5211-与连接相关的设置\">#</a> 5.2.11 与连接相关的设置</h6>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">listen</span><span class=\"token operator\">=</span>YES/NO（YES）</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#设置 vsftpd 服务器是否以 standalone 模式运行。以 standalone 模式运行是一种较好的方式，此时 listen 必须设置为 YES，此为默认值。建议不要更改，有很多与服务器运行相关的配置命令，需要在此模式下才有效。若设置为 NO，则 vsftpd 不是以独立的服务运行，要受到 xinetd 服务的管控，功能上会受到限制。</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">max_clients</span><span class=\"token operator\">=</span><span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#设置 vsftpd 允许的最大连接数，默认值为 0，表示不受限制。若设置为 100 时，则同时允许有 100 连接，超出的将被拒绝。只有在 standalone 模式运行才有效。</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token assign-left variable\">max_per_ip</span><span class=\"token operator\">=</span><span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#设置每个 IP 允许与 FTP 服务器同时建立连接的数目。默认值为 0，表示不受限制。只有在 standalone 模式运行才有效。</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token assign-left variable\">listen_address</span><span class=\"token operator\">=</span>IP 地址</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">#设置 FTP 服务器在指定的 IP 地址上侦听用户的 FTP 请求。若不设置，则对服务器绑定的所有 IP 地址进行侦听。只有在 standalone 模式运行才有效。</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token assign-left variable\">setproctitle_enable</span><span class=\"token operator\">=</span>YES/NO（NO）</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">#设置每个与 FTP 服务器的连接，是否以不同的进程表现出来。默认值为 NO，此时使用 ps aux |grep ftp 只会有一个 vsftpd 的进程。若设置为 YES，则每个连接都会有一个 vsftpd 的进程。</span></pre></td></tr></table></figure><h6 id=\"5212-虚拟用户设置\"><a class=\"anchor\" href=\"#5212-虚拟用户设置\">#</a> 5.2.12 虚拟用户设置</h6>\n<p>虚拟用户使用 PAM 认证方式。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">pam_service_name</span><span class=\"token operator\">=</span>vsftpd</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#设置 PAM 使用的名称，默认值为 /etc/pam.d/vsftpd。</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">guest_enable</span><span class=\"token operator\">=</span> YES/NO（NO）</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#启用虚拟用户。默认值为 NO。</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token assign-left variable\">guest_username</span><span class=\"token operator\">=</span>ftp</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#这里用来映射虚拟用户。默认值为 ftp。</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token assign-left variable\">virtual_use_local_privs</span><span class=\"token operator\">=</span>YES/NO（NO）</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">#当该参数激活（YES）时，虚拟用户使用与本地用户相同的权限。当此参数关闭（NO）时，虚拟用户使用与匿名用户相同的权限。默认情况下此参数是关闭的（NO）。</span></pre></td></tr></table></figure><h6 id=\"5213-定义用户配置文件\"><a class=\"anchor\" href=\"#5213-定义用户配置文件\">#</a> 5.2.13 定义用户配置文件</h6>\n<p>在 vsftpd 中，可以通过定义用户配置文件来实现不同的用户使用不同的配置。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">user_config_dir</span><span class=\"token operator\">=</span>/etc/vsftpd/userconf</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#设置用户配置文件所在的目录。当设置了该配置项后，用户登陆服务器后，系统就会到 /etc/vsftpd/userconf 目录下，读取与当前用户名相同的文件，并根据文件中的配置命令，对当前用户进行更进一步的配置。</span></pre></td></tr></table></figure><p><em>例如：定义 user_config_dir=/etc/vsftpd/userconf，且主机上有使用者 test1,test2，那么我们就在 user_config_dir 的目录新增文件名为 test1 和 test2 两个文件。若是 test1 登入，则会读取 user_config_dir 下的 test1 这个档案内的设定。默认值为无。利用用户配置文件，可以实现对不同用户进行访问速度的控制，在各用户配置文件中定义 local_max_rate=XX，即可。</em></p>\n<h4 id=\"六-vsftp匿名用户访问\"><a class=\"anchor\" href=\"#六-vsftp匿名用户访问\">#</a> 六、VSFTP 匿名用户访问</h4>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#1. 注释中带 * 为修改项或增加项 </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># egrep -v \"^#|^$\" /etc/vsftpd/vsftpd.conf </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token assign-left variable\">anonymous_enable</span><span class=\"token operator\">=</span>YES         <span class=\"token comment\">#允许匿名用户登录       ***</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">local_enable</span><span class=\"token operator\">=</span>YES             <span class=\"token comment\">#允许本地用户登录</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token assign-left variable\">write_enable</span><span class=\"token operator\">=</span>YES             <span class=\"token comment\">#允许本地用户上传</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token assign-left variable\">local_umask</span><span class=\"token operator\">=</span>022              <span class=\"token comment\">#umask 权限，上传文件权限默认 644，目录 755</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token assign-left variable\">anon_upload_enable</span><span class=\"token operator\">=</span>YES       <span class=\"token comment\">#允许匿名用户上传       ***</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token assign-left variable\">anon_mkdir_write_enable</span><span class=\"token operator\">=</span>YES  <span class=\"token comment\">#允许匿名用户新建目录   ***</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token assign-left variable\">anon_other_write_enable</span><span class=\"token operator\">=</span>YES  <span class=\"token comment\">#允许匿名用户删除或上传 ***</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token assign-left variable\">dirmessage_enable</span><span class=\"token operator\">=</span>YES        <span class=\"token comment\">#用户进入目录时，显示 message 文件中信息</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token assign-left variable\">xferlog_enable</span><span class=\"token operator\">=</span>YES           <span class=\"token comment\">#激活记录日志</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token assign-left variable\">connect_from_port_20</span><span class=\"token operator\">=</span>YES     <span class=\"token comment\">#主动模式数据传输端口</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token assign-left variable\">xferlog_std_format</span><span class=\"token operator\">=</span>YES       <span class=\"token comment\">#使用标准的 ftp 日志格式</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token assign-left variable\">listen</span><span class=\"token operator\">=</span>NO\t\t\t\t\t <span class=\"token comment\">#允许被监听</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token assign-left variable\">listen_ipv6</span><span class=\"token operator\">=</span>YES              <span class=\"token comment\">#允许被监听</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token assign-left variable\">pam_service_name</span><span class=\"token operator\">=</span>vsftpd      <span class=\"token comment\">#开启 pam 认证</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token assign-left variable\">userlist_enable</span><span class=\"token operator\">=</span>YES          <span class=\"token comment\">#用户登入限制</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token assign-left variable\">tcp_wrappers</span><span class=\"token operator\">=</span>YES             <span class=\"token comment\">#主机访问控制模式</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">#2. 匿名用户访问路径</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl restat vsftpd</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cd /var/ftp/</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">#3. 此时 ftp 无法上传文件，因为匿名登录为系统用户 ftp，对 /var/ftp/pub 目录没有写入权限</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll /var/ftp/pub -d</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>drwxr-xr-x <span class=\"token number\">3</span> root root <span class=\"token number\">30</span> Nov  <span class=\"token number\">4</span> <span class=\"token number\">23</span>:05 /var/ftp/</pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chown ftp /var/ftp/pub</span></pre></td></tr></table></figure><h4 id=\"七-vsftp系统用户访问\"><a class=\"anchor\" href=\"#七-vsftp系统用户访问\">#</a> 七、VSFTP 系统用户访问</h4>\n<h5 id=\"71-vsftp配置文件\"><a class=\"anchor\" href=\"#71-vsftp配置文件\">#</a> 7.1 VSFTP 配置文件</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># egrep -v \"^#|^$\" /etc/vsftpd/vsftpd.conf </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token assign-left variable\">anonymous_enable</span><span class=\"token operator\">=</span>YES         <span class=\"token comment\">#允许匿名用户登录       </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token assign-left variable\">local_enable</span><span class=\"token operator\">=</span>YES             <span class=\"token comment\">#允许本地用户登录</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">write_enable</span><span class=\"token operator\">=</span>YES             <span class=\"token comment\">#允许本地用户上传</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token assign-left variable\">local_umask</span><span class=\"token operator\">=</span>022              <span class=\"token comment\">#umask 权限，上传文件权限默认 644，目录 755</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token assign-left variable\">dirmessage_enable</span><span class=\"token operator\">=</span>YES        <span class=\"token comment\">#用户进入目录时，显示 message 文件中信息</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token assign-left variable\">xferlog_enable</span><span class=\"token operator\">=</span>YES           <span class=\"token comment\">#激活记录日志</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token assign-left variable\">connect_from_port_20</span><span class=\"token operator\">=</span>YES     <span class=\"token comment\">#主动模式数据传输端口</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token assign-left variable\">xferlog_std_format</span><span class=\"token operator\">=</span>YES       <span class=\"token comment\">#使用标准的 ftp 日志格式</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token assign-left variable\">listen</span><span class=\"token operator\">=</span>NO\t\t\t\t\t <span class=\"token comment\">#允许被监听</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token assign-left variable\">listen_ipv6</span><span class=\"token operator\">=</span>YES              <span class=\"token comment\">#允许被监听</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token assign-left variable\">pam_service_name</span><span class=\"token operator\">=</span>vsftpd      <span class=\"token comment\">#开启 pam 认证</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token assign-left variable\">userlist_enable</span><span class=\"token operator\">=</span>YES          <span class=\"token comment\">#用户登入限制</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token assign-left variable\">tcp_wrappers</span><span class=\"token operator\">=</span>YES             <span class=\"token comment\">#主机访问控制模式</span></pre></td></tr></table></figure><h5 id=\"72-新建系统用户\"><a class=\"anchor\" href=\"#72-新建系统用户\">#</a> 7.2 新建系统用户</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># useradd xuyong</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># passwd zhangshan</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># useradd xuyong</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># echo \"123456\" | passwd --stdin zhangshan</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># userdel -d zhangsan</span></pre></td></tr></table></figure><h5 id=\"73-vsftp基本配置\"><a class=\"anchor\" href=\"#73-vsftp基本配置\">#</a> 7.3 VSFTP 基本配置</h5>\n<p>vsftp 登录路径默认为用户家目录，可以通过修改配置文件自定义主目录，修改后所有用户登录的工作目录都是该路径 /share_home。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">local_root</span><span class=\"token operator\">=</span>/share_home      <span class=\"token comment\">#当本地用户登入时，将被更换到定义的目录下。默认值为各用户的家目录。\t</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token assign-left variable\">local_max_rate</span><span class=\"token operator\">=</span><span class=\"token number\">0</span>            <span class=\"token comment\">#限制最大传输速率 (字节 / 秒)</span></pre></td></tr></table></figure><p>此时用户登录后没有写入权限，原因为虽然 VSFTP 服务开启了写权限，但是 /share_home 目录属主属组为 root，用户没有目录写权限。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># groupadd caiwu</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># id xuyong</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token assign-left variable\">uid</span><span class=\"token operator\">=</span><span class=\"token number\">1000</span><span class=\"token punctuation\">(</span>xuyong<span class=\"token punctuation\">)</span> <span class=\"token assign-left variable\">gid</span><span class=\"token operator\">=</span><span class=\"token number\">1000</span><span class=\"token punctuation\">(</span>xuyong<span class=\"token punctuation\">)</span> <span class=\"token assign-left variable\">groups</span><span class=\"token operator\">=</span><span class=\"token number\">1000</span><span class=\"token punctuation\">(</span>xuyong<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># gpasswd -a xuyong caiwu    #已存在用户加入到 caiwu 组</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># id xuyong</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token assign-left variable\">uid</span><span class=\"token operator\">=</span><span class=\"token number\">1000</span><span class=\"token punctuation\">(</span>xuyong<span class=\"token punctuation\">)</span> <span class=\"token assign-left variable\">gid</span><span class=\"token operator\">=</span><span class=\"token number\">1000</span><span class=\"token punctuation\">(</span>xuyong<span class=\"token punctuation\">)</span> <span class=\"token assign-left variable\">groups</span><span class=\"token operator\">=</span><span class=\"token number\">1000</span><span class=\"token punctuation\">(</span>xuyong<span class=\"token punctuation\">)</span>,1003<span class=\"token punctuation\">(</span>caiwu<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir /share_home</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll /share_home/ -d</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>drwxr-xr-x <span class=\"token number\">2</span> root root <span class=\"token number\">6</span> Nov  <span class=\"token number\">5</span> 09:59 /share_home/</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chown root.caiwu /share_home/</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chmod 775 /share_home</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll /share_home/ -d</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>drwxrwxr-x <span class=\"token number\">2</span> root caiwu <span class=\"token number\">6</span> Jun <span class=\"token number\">22</span> <span class=\"token number\">16</span>:39 /share_home/</pre></td></tr></table></figure><h5 id=\"74-限制登录用户切换家目录\"><a class=\"anchor\" href=\"#74-限制登录用户切换家目录\">#</a> 7.4 限制登录用户切换家目录</h5>\n<p>1、限制所有登录用户切换家目录</p>\n<p>从 2.3.5 之后，vsftpd 增强了安全检查，如果用户被限定在了其主目录下，则该用户的主目录不能再具有写权限了！如果检查发现还有写权限，就会报该错误。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">chroot_local_user</span><span class=\"token operator\">=</span>YES                </pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token assign-left variable\">allow_writeable_chroot</span><span class=\"token operator\">=</span>YES</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#开启用户限制在家目录 (只开启以上行，把所有用户都限制在用户家目录中)</span></pre></td></tr></table></figure><p>2、仅允许写入 /etc/vsftpd/chroot_list 文件中的用户可以切换目录，其他用户都限制在用户主目录</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">chroot_local_user</span><span class=\"token operator\">=</span>YES                </pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token assign-left variable\">allow_writeable_chroot</span><span class=\"token operator\">=</span>YES</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token assign-left variable\">chroot_list_enable</span><span class=\"token operator\">=</span>YES</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">chroot_list_file</span><span class=\"token operator\">=</span>/etc/vsftpd/chroot_list  </pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#开启以上 4 行，写入 /etc/vsftpd/chroot_list 文件中的用户可以切换目录，其他用户都限制在用户主目录</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim /etc/vsftpd/chroot_list</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>xuyong</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl restart vsftpd</span></pre></td></tr></table></figure><h5 id=\"75-vsftp用户访问控制\"><a class=\"anchor\" href=\"#75-vsftp用户访问控制\">#</a> 7.5 VSFTP 用户访问控制</h5>\n<p>1、配置文件</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll /etc/vsftpd/</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>total <span class=\"token number\">36</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>-rw------- <span class=\"token number\">1</span> root root   <span class=\"token number\">125</span> Jun <span class=\"token number\">10</span>  <span class=\"token number\">2021</span> ftpusers         <span class=\"token comment\">#黑名单</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>-rw------- <span class=\"token number\">1</span> root root   <span class=\"token number\">361</span> Jun <span class=\"token number\">10</span>  <span class=\"token number\">2021</span> user_list        <span class=\"token comment\">#默认为黑名单，如将 userlist_deny=NO 则为白名单，仅允许该配置文件中用户可以访问</span></pre></td></tr></table></figure><p>2、将用户 xuyong 加入 user_list 文件中后默认为黑名单，不能登入 vsftp 服务器</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/vsftpd/user_list </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># vsftpd userlist</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># If userlist_deny=NO, only allow users in this file</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\"># If userlist_deny=YES (default), never allow users in this file, and</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># do not even prompt for a password.</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># Note that the default vsftpd pam config also checks /etc/vsftpd/ftpusers</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># for users that are denied.</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>root</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>bin</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>daemon</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>adm</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>lp</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token function\">sync</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token function\">shutdown</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token function\">halt</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>mail</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>news</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>uucp</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>operator</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>games</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>nobody</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>xuyong              <span class=\"token comment\">#用户加入黑名单</span></pre></td></tr></table></figure><p>3、通过修改配置文件 /etc/vsftpd/vsftpd.conf，仅写入 /etc/vsftpd/user_list 中的用户可以访问 vsftp 服务器，其他用户不可以访问。此时该文件为白名单。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">userlist_enable</span><span class=\"token operator\">=</span>YES                 <span class=\"token comment\">#开启用户访问控制，默认开启状态</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token assign-left variable\">userlist_deny</span><span class=\"token operator\">=</span>NO                    <span class=\"token comment\">#开启白名单功能</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token assign-left variable\">Userlist_file</span><span class=\"token operator\">=</span>/etc/vsftpd/user_list</pre></td></tr></table></figure><h4 id=\"八-vsftp虚拟用户访问\"><a class=\"anchor\" href=\"#八-vsftp虚拟用户访问\">#</a> 八、VSFTP 虚拟用户访问</h4>\n<h5 id=\"81-创建虚拟用户口令文件\"><a class=\"anchor\" href=\"#81-创建虚拟用户口令文件\">#</a> 8.1 创建虚拟用户口令文件</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/vsftpd/vusers </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>xuyong    <span class=\"token comment\">#用户名</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">123456</span>    <span class=\"token comment\">#密码</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>zhaomin</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">123456</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>zhangwuji</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">123456</span></pre></td></tr></table></figure><h5 id=\"82-生成虚拟用户已口令认证文件\"><a class=\"anchor\" href=\"#82-生成虚拟用户已口令认证文件\">#</a> 8.2 生成虚拟用户已口令认证文件</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#1. 安装口令认证命令</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum install db4-utils -y</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre> </pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">#2. 生成 Vsftpd 虚拟用户数据库认证文件，</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># db_load -T -t hash -f /etc/vsftpd/vusers /etc/vsftpd/vusers.db</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chmod 700 /etc/vsftpd/vusers.db</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll /etc/vsftpd/vusers.db </span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>-rw-r--r-- <span class=\"token number\">1</span> root root <span class=\"token number\">12288</span> Jun <span class=\"token number\">22</span> <span class=\"token number\">20</span>:41 /etc/vsftpd/vusers.db</pre></td></tr></table></figure><h5 id=\"83-编辑vsftp的pam认证文件\"><a class=\"anchor\" href=\"#83-编辑vsftp的pam认证文件\">#</a> 8.3 编辑 VSFTP 的 PAM 认证文件</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#配置 PAM 认证文件，/etc/pam.d/vsftpd 行尾加入如下两行，其余行注释掉，此时系统本地用户无法登入</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/pam.d/vsftpd</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#%PAM-1.0</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">#session    optional     pam_keyinit.so    force revoke</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#auth       required\tpam_listfile.so item=user sense=deny file=/etc/vsftpd/ftpusers onerr=succeed</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">#auth       required\tpam_shells.so</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">#auth       include\tpassword-auth</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#account    include\tpassword-auth</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">#session    required     pam_loginuid.so</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">#session    include\tpassword-auth</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>auth       required     pam_userdb.so  <span class=\"token assign-left variable\">db</span><span class=\"token operator\">=</span>/etc/vsftpd/vusers</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>account    required     pam_userdb.so  <span class=\"token assign-left variable\">db</span><span class=\"token operator\">=</span>/etc/vsftpd/vusers</pre></td></tr></table></figure><h5 id=\"84-建立本地映射用户并设置宿主目录权限\"><a class=\"anchor\" href=\"#84-建立本地映射用户并设置宿主目录权限\">#</a> 8.4 建立本地映射用户并设置宿主目录权限</h5>\n<ul>\n<li>所有 Vsftpd 虚拟用户需要映射到一个系统用户，该系统用户不需要密码，也不需要登录，主要用于虚拟用户映射使用；</li>\n<li>用户名必须和下一步配置文件中一致；</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># useradd -d /home/vftproot -s /sbin/nologin vuser</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chmod 755 /home/vftproot</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll /home/vftproot -d</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>drwxr-xr-x <span class=\"token number\">2</span> vuser vuser <span class=\"token number\">62</span> Jun <span class=\"token number\">22</span> <span class=\"token number\">20</span>:58 /home/vftproot</pre></td></tr></table></figure><h5 id=\"85-修改配置文件\"><a class=\"anchor\" href=\"#85-修改配置文件\">#</a> 8.5 修改配置文件</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim /etc/vsftpd/vsftpd.conf </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token assign-left variable\">guest_enable</span><span class=\"token operator\">=</span>YES              <span class=\"token comment\">#开启虚拟用户</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">guest_username</span><span class=\"token operator\">=</span>vuser          <span class=\"token comment\">#FTP 虚拟用户对应的系统用户</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token assign-left variable\">pam_service_name</span><span class=\"token operator\">=</span>vsftpd       <span class=\"token comment\">#PAM 认证文件（默认存在）</span></pre></td></tr></table></figure><h5 id=\"86-重启vsftp服务并测试\"><a class=\"anchor\" href=\"#86-重启vsftp服务并测试\">#</a> 8.6 重启 VSFTP 服务并测试</h5>\n<ul>\n<li>此时虚拟用户可以登录、查看、下载，不能上传</li>\n<li>默认上传文件的位置是虚拟用户的家目录</li>\n<li><strong>权限使用的是匿名用户权限进行管理</strong></li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl restart vsftpd</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#验证并测试，此时虚拟用户可以登录、查看、下载，不能上传报错</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp vftproot<span class=\"token punctuation\">]</span><span class=\"token comment\"># pwd</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>/home/vftproot</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp vftproot<span class=\"token punctuation\">]</span><span class=\"token comment\"># ls</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>a.txt</pre></td></tr></table></figure><p><img loading=\"lazy\" data-src=\"https://wp-cdn.4ce.cn/v2/WPjrX3b.jpeg\" alt=\"1.jpg\" /></p>\n<h5 id=\"87-调整虚拟用户权限\"><a class=\"anchor\" href=\"#87-调整虚拟用户权限\">#</a> 8.7 调整虚拟用户权限</h5>\n<ul>\n<li>给虚拟用户设定权限，允许所有虚拟用上传</li>\n<li>关闭匿名用户登录，更加安全（不影响虚拟用户登录）</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim /etc/vsftpd/vsftpd.conf </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token assign-left variable\">anonymous_enable</span><span class=\"token operator\">=</span>NO          <span class=\"token comment\">#允许匿名用户登录       ***</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token assign-left variable\">anon_upload_enable</span><span class=\"token operator\">=</span>YES       <span class=\"token comment\">#允许匿名用户上传       ***</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">anon_mkdir_write_enable</span><span class=\"token operator\">=</span>YES  <span class=\"token comment\">#允许匿名用户新建目录    ***</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token assign-left variable\">anon_other_write_enable</span><span class=\"token operator\">=</span>YES  <span class=\"token comment\">#允许匿名用户删除或上传  ***</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp vftproot<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl restart vsftpd</span></pre></td></tr></table></figure><p><img loading=\"lazy\" data-src=\"https://wp-cdn.4ce.cn/v2/AH9dxIX.jpeg\" alt=\"2.jpg\" /></p>\n<h5 id=\"88-单独定义虚拟用户权限\"><a class=\"anchor\" href=\"#88-单独定义虚拟用户权限\">#</a> 8.8 单独定义虚拟用户权限</h5>\n<p>为每个虚拟用户建立自己的配置文件，每个虚拟用户都有自己的共享目录，并单独定义权限；</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#1. 修改配置文件，指定保存虚拟用户配置文件的目录</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim /etc/vsftpd/vsftpd.conf</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token assign-left variable\">user_config_dir</span><span class=\"token operator\">=</span>/etc/vsftpd/vusers_dir       <span class=\"token comment\">#指定保存虚拟用户配置文件的目录</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#2. 建立目录</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir /etc/vsftpd/vusers_dir</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#3. 为每个虚拟用户建立配置文件，配置文件名称与虚拟用户一致，系统会读取与当前用户名相同的配置文件</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim /etc/vsftpd/vusers_dir/xuyong</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token assign-left variable\">anon_upload_enable</span><span class=\"token operator\">=</span>YES       <span class=\"token comment\">#允许匿名用户上传       ***</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token assign-left variable\">anon_mkdir_write_enable</span><span class=\"token operator\">=</span>YES  <span class=\"token comment\">#允许匿名用户新建目录    ***</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token assign-left variable\">anon_other_write_enable</span><span class=\"token operator\">=</span>YES  <span class=\"token comment\">#允许匿名用户删除       ***</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token assign-left variable\">local_root</span><span class=\"token operator\">=</span>/data/xuyong      <span class=\"token comment\">#xuyong 指定独立的上传目录</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim /etc/vsftpd/vusers_dir/zhangwuji</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token assign-left variable\">anon_upload_enable</span><span class=\"token operator\">=</span>YES       <span class=\"token comment\">#允许匿名用户上传       ***</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token assign-left variable\">anon_mkdir_write_enable</span><span class=\"token operator\">=</span>YES  <span class=\"token comment\">#允许匿名用户新建目录    ***</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token assign-left variable\">anon_other_write_enable</span><span class=\"token operator\">=</span>NO   <span class=\"token comment\">#允许匿名用户删除       ***</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token assign-left variable\">local_root</span><span class=\"token operator\">=</span>/data/zhangwuji   <span class=\"token comment\">#zhangwuji 指定独立的上传目录</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim /etc/vsftpd/vusers_dir/zhaomin</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token assign-left variable\">anon_upload_enable</span><span class=\"token operator\">=</span>YES       <span class=\"token comment\">#允许匿名用户上传       ***</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token assign-left variable\">anon_mkdir_write_enable</span><span class=\"token operator\">=</span>NO   <span class=\"token comment\">#允许匿名用户新建目录    ***</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token assign-left variable\">anon_other_write_enable</span><span class=\"token operator\">=</span>NO   <span class=\"token comment\">#允许匿名用户删除       ***</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token assign-left variable\">local_root</span><span class=\"token operator\">=</span>/data/zhaomin     <span class=\"token comment\">#zhaomin 指定独立的上传目录</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token comment\">#4. 新建上传目录并配置虚拟用户系统权限</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir /data/xuyong</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir /data/zhangwuji</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir /data/zhaomin</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chown vuser:vuser /data/xuyong</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chown vuser:vuser /data/zhangwuji</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chown vuser:vuser /data/zhaomi</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token comment\">#5. 重启服务验证并测试</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp vftproot<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl restart vsftpd</span></pre></td></tr></table></figure><ul>\n<li>用户 xuyong 可以登录、查看、下载，删除、创建目录和文件、上传</li>\n<li>用户 zhangwuji 可以登录、查看、下载、创建目录和文件，上传，无法删除</li>\n<li>用户 zhangwuji 可以登录、查看、下载、上传，无法删除、创建目录和文件</li>\n</ul>\n<h4 id=\"九-项目实战\"><a class=\"anchor\" href=\"#九-项目实战\">#</a> 九、项目实战</h4>\n<h5 id=\"91-公司ftp服务器需求\"><a class=\"anchor\" href=\"#91-公司ftp服务器需求\">#</a> 9.1 公司 FTP 服务器需求</h5>\n<ol>\n<li>每位员工有独立的目录，可上传、可读、可写、可删除权限，但目录本身员工不可删除</li>\n<li>每位员工拥有独立根目录，在自己目录下可见公司共享目录 public_share（只读）</li>\n<li>部门内部员工可见部门共享目录_caiwu_share（读写）</li>\n<li>禁锢虚拟用户的主目录，同时禁止访问除主目录之外的目录</li>\n<li>开启日志记录登录、上传、下载、删除信息</li>\n</ol>\n<p><img loading=\"lazy\" data-src=\"https://wp-cdn.4ce.cn/v2/ucO32qb.png\" alt=\"1.png\" /></p>\n<h5 id=\"92-vsftp-部署\"><a class=\"anchor\" href=\"#92-vsftp-部署\">#</a> 9.2 VSFTP 部署</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum install vsftpd -y</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl start vsftpd &amp;&amp; systemctl enable vsftpd</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># netstat -lntp|grep vsftpd</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>tcp6       <span class=\"token number\">0</span>      <span class=\"token number\">0</span> :::21                   :::*                    LISTEN      <span class=\"token number\">973</span>/vsftpd</pre></td></tr></table></figure><h5 id=\"93-配置虚拟用户访问\"><a class=\"anchor\" href=\"#93-配置虚拟用户访问\">#</a> 9.3 配置虚拟用户访问</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#1. 创建虚拟用户口令文件</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/vsftpd/vusers </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>xuyong</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">123456</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>zhaomin</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">123456</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>zhangwuji</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">123456</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">#2. 生成虚拟用户已口令认证文件</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum install db4-utils -y</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># db_load -T -t hash -f /etc/vsftpd/vusers /etc/vsftpd/vusers.db</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll /etc/vsftpd/vusers.db</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>-rw-r--r-- <span class=\"token number\">1</span> root root <span class=\"token number\">12288</span> Jun <span class=\"token number\">23</span> <span class=\"token number\">13</span>:54 /etc/vsftpd/vusers.db</pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\">#3. 配置 PAM 认证文件，/etc/pam.d/vsftpd 行尾加入如下两行，其余行注释掉，此时系统本地用户无法登入</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/pam.d/vsftpd</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">#%PAM-1.0</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\">#session    optional     pam_keyinit.so    force revoke</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">#auth       required\tpam_listfile.so item=user sense=deny file=/etc/vsftpd/ftpusers onerr=succeed</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">#auth       required\tpam_shells.so</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">#auth       include\tpassword-auth</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">#account    include\tpassword-auth</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">#session    required     pam_loginuid.so</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token comment\">#session    include\tpassword-auth</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>auth       required     pam_userdb.so  <span class=\"token assign-left variable\">db</span><span class=\"token operator\">=</span>/etc/vsftpd/vusers</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>account    required     pam_userdb.so  <span class=\"token assign-left variable\">db</span><span class=\"token operator\">=</span>/etc/vsftpd/vusers</pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token comment\">#4. 建立本地映射用户并设置宿主目录权限</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># useradd -d /home/vftproot -s /sbin/nologin vuser</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chmod 755 /home/vftproot</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll /home/vftproot -d</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>drwxr-xr-x <span class=\"token number\">2</span> vuser vuser <span class=\"token number\">62</span> Jun <span class=\"token number\">23</span> <span class=\"token number\">13</span>:55 /home/vftproot</pre></td></tr><tr><td data-num=\"34\"></td><td><pre></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token comment\">#5. 修改配置文件</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim /etc/vsftpd/vsftpd.conf </span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token assign-left variable\">anonymous_enable</span><span class=\"token operator\">=</span>NO</pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token assign-left variable\">chroot_local_user</span><span class=\"token operator\">=</span>YES         <span class=\"token comment\">#开启用户限制在家目录</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token assign-left variable\">allow_writeable_chroot</span><span class=\"token operator\">=</span>YES</pre></td></tr><tr><td data-num=\"41\"></td><td><pre></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token assign-left variable\">guest_enable</span><span class=\"token operator\">=</span>YES              <span class=\"token comment\">#开启虚拟用户</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token assign-left variable\">guest_username</span><span class=\"token operator\">=</span>vuser          <span class=\"token comment\">#FTP 虚拟用户对应的系统用户</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token assign-left variable\">pam_service_name</span><span class=\"token operator\">=</span>vsftpd       <span class=\"token comment\">#PAM 认证文件（默认存在）</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token comment\">#6. 修改配置文件，指定保存虚拟用户配置文件的目录</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim /etc/vsftpd/vsftpd.conf</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token assign-left variable\">user_config_dir</span><span class=\"token operator\">=</span>/etc/vsftpd/vusers_dir       <span class=\"token comment\">#指定保存虚拟用户配置文件的目录</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre></pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token comment\">#7. 建立目录</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir /etc/vsftpd/vusers_dir</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre></pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token comment\">#8. 为每个虚拟用户建立配置文件，配置文件名称与虚拟用户一致，系统会读取与当前用户名相同的配置文件</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre><span class=\"token comment\">###anon_upload_enable=YES         #允许匿名用户上传       </span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token comment\">###anon_mkdir_write_enable=YES    #允许匿名用户新建目录    </span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre><span class=\"token comment\">###anon_other_write_enable=YES    #允许匿名用户删除      </span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre><span class=\"token comment\">###local_root=/data/IT/xuyong     #xuyong 指定独立的上传目录</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre></pre></td></tr><tr><td data-num=\"60\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp vusers_dir<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/vsftpd/vusers_dir/xuyong </span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre><span class=\"token assign-left variable\">anon_upload_enable</span><span class=\"token operator\">=</span>YES</pre></td></tr><tr><td data-num=\"62\"></td><td><pre><span class=\"token assign-left variable\">anon_mkdir_write_enable</span><span class=\"token operator\">=</span>YES</pre></td></tr><tr><td data-num=\"63\"></td><td><pre><span class=\"token assign-left variable\">anon_other_write_enable</span><span class=\"token operator\">=</span>YES</pre></td></tr><tr><td data-num=\"64\"></td><td><pre><span class=\"token assign-left variable\">local_root</span><span class=\"token operator\">=</span>/data/it/xuyong</pre></td></tr><tr><td data-num=\"65\"></td><td><pre></pre></td></tr><tr><td data-num=\"66\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp vusers_dir<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/vsftpd/vusers_dir/zhangwuji </span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre><span class=\"token assign-left variable\">anon_upload_enable</span><span class=\"token operator\">=</span>YES</pre></td></tr><tr><td data-num=\"68\"></td><td><pre><span class=\"token assign-left variable\">anon_mkdir_write_enable</span><span class=\"token operator\">=</span>YES</pre></td></tr><tr><td data-num=\"69\"></td><td><pre><span class=\"token assign-left variable\">anon_other_write_enable</span><span class=\"token operator\">=</span>YES</pre></td></tr><tr><td data-num=\"70\"></td><td><pre><span class=\"token assign-left variable\">local_root</span><span class=\"token operator\">=</span>/data/caiwu/zhangwuji</pre></td></tr><tr><td data-num=\"71\"></td><td><pre></pre></td></tr><tr><td data-num=\"72\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp vusers_dir<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/vsftpd/vusers_dir/zhaomin </span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre><span class=\"token assign-left variable\">anon_upload_enable</span><span class=\"token operator\">=</span>YES</pre></td></tr><tr><td data-num=\"74\"></td><td><pre><span class=\"token assign-left variable\">anon_mkdir_write_enable</span><span class=\"token operator\">=</span>YES</pre></td></tr><tr><td data-num=\"75\"></td><td><pre><span class=\"token assign-left variable\">anon_other_write_enable</span><span class=\"token operator\">=</span>YES</pre></td></tr><tr><td data-num=\"76\"></td><td><pre><span class=\"token assign-left variable\">local_root</span><span class=\"token operator\">=</span>/data/caiwu/zhaomin</pre></td></tr><tr><td data-num=\"77\"></td><td><pre></pre></td></tr><tr><td data-num=\"78\"></td><td><pre><span class=\"token comment\">#10. 新建上传目录并配置虚拟用户系统权限</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir -p /data/it/xuyong</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir -p /data/caiwu/zhangwuji</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir -p /data/caiwu/zhaomin</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chown vuser:vuser /data/it/xuyong</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chown vuser:vuser /data/caiwu/zhangwuji</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chown vuser:vuser /data/caiwu/zhaomin</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre></pre></td></tr><tr><td data-num=\"86\"></td><td><pre><span class=\"token comment\">#11. 重启服务验证并测试</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp vftproot<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl restart vsftpd</span></pre></td></tr></table></figure><h5 id=\"94-配置公共目录共享\"><a class=\"anchor\" href=\"#94-配置公共目录共享\">#</a> 9.4 配置公共目录共享</h5>\n<p>因为 1 个虚拟用户只可以配置 1 个目录，故需要通过 mount -B 来实现目录共享</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#1. 创建公共目录</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /data/public_share</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /data/caiwu/caiwu_share</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /data/it/it_share</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /data/caiwu/zhangwuji/caiwu_share</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /data/caiwu/zhangwuji/public_share</pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /data/caiwu/zhaomin/caiwu_share</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /data/caiwu/zhaomin/public_share</pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /data/it/xuyong/it_share</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /data/it/xuyong/public_share</pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\">#2. 使用 mount -B -o rw,ro 来将公共目录、日志目录挂载至个人根目录。</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token function\">mount</span> <span class=\"token parameter variable\">-B</span> <span class=\"token parameter variable\">-o</span> rw /data/caiwu/caiwu_share /data/caiwu/zhangwuji/caiwu_share</pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token function\">mount</span> <span class=\"token parameter variable\">-B</span> <span class=\"token parameter variable\">-o</span> ro /data/public_share /data/caiwu/zhangwuji/public_share </pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token function\">mount</span> <span class=\"token parameter variable\">-B</span> <span class=\"token parameter variable\">-o</span> rw /data/caiwu/caiwu_share /data/caiwu/zhaomin/caiwu_share</pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token function\">mount</span> <span class=\"token parameter variable\">-B</span> <span class=\"token parameter variable\">-o</span> ro /data/public_share /data/caiwu/zhaomin/public_share </pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token function\">mount</span> <span class=\"token parameter variable\">-B</span> <span class=\"token parameter variable\">-o</span> rw /data/it/it_share /data/it/xuyong/it_share</pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token function\">mount</span> <span class=\"token parameter variable\">-B</span> <span class=\"token parameter variable\">-o</span> ro /data/public_share /data/it/xuyong/public_share </pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token comment\">#3. 为部门共享配置虚拟用户系统权限</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token function\">chown</span> vuser:vuser /data/caiwu/caiwu_share</pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token function\">chown</span> vuser:vuser /data/it/it_share</pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token comment\">#4. 配置自动挂载</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token punctuation\">[</span>root@vsftp ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim /etc/rc.local</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>追加内容如下：</pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token function\">mount</span> <span class=\"token parameter variable\">-B</span> <span class=\"token parameter variable\">-o</span> rw /data/caiwu/caiwu_share /data/caiwu/zhangwuji/caiwu_share</pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token function\">mount</span> <span class=\"token parameter variable\">-B</span> <span class=\"token parameter variable\">-o</span> ro /data/public_share /data/caiwu/zhangwuji/public_share </pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token function\">mount</span> <span class=\"token parameter variable\">-B</span> <span class=\"token parameter variable\">-o</span> rw /data/caiwu/caiwu_share /data/caiwu/zhaomin/caiwu_share</pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token function\">mount</span> <span class=\"token parameter variable\">-B</span> <span class=\"token parameter variable\">-o</span> ro /data/public_share /data/caiwu/zhaomin/public_share </pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token function\">mount</span> <span class=\"token parameter variable\">-B</span> <span class=\"token parameter variable\">-o</span> rw /data/it/it_share /data/it/xuyong/it_share</pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token function\">mount</span> <span class=\"token parameter variable\">-B</span> <span class=\"token parameter variable\">-o</span> ro /data/public_share /data/it/xuyong/public_share</pre></td></tr></table></figure>",
            "tags": [
                "Vsftp"
            ]
        },
        {
            "id": "http://ixuyong.cn/posts/269104229.html",
            "url": "http://ixuyong.cn/posts/269104229.html",
            "title": "Samba服务实践",
            "date_published": "2025-08-19T14:12:07.000Z",
            "content_html": "<h3 id=\"samba服务实践\"><a class=\"anchor\" href=\"#samba服务实践\">#</a> Samba 服务实践</h3>\n<h4 id=\"一-samba-概述\"><a class=\"anchor\" href=\"#一-samba-概述\">#</a> 一、Samba 概述</h4>\n<p>SMB（Server Messages Block，信息服务块）是一种在局域网上共享文件和打印机的一种通信协议，它为局域网内的不同操作系统的计算机之间提供文件及打印机等资源的共享服务。SMB 协议是客户机 / 服务器型协议，客户机通过该协议可以访问服务器上的共享文件系统、打印机及其他资源。如图：</p>\n<p><img loading=\"lazy\" data-src=\"https://wp-cdn.4ce.cn/v2/jBVTDjA.jpeg\" alt=\"1.jpg\" /></p>\n<p><strong>1. ftp 的优缺点：</strong></p>\n<p>优点：文件传输、应用层协议、可跨平台</p>\n<p>缺点：只能实现文件传输，无法实现文件系统挂载；无法直接修改服务器端文件</p>\n<p><strong>2. Samba 的特性：</strong></p>\n<p>使用 smb/cifs 协议、可跨平台、可实现文件系统挂载、可实现服务器端修改文件</p>\n<p><strong>3. smb</strong> <strong>协议和</strong> <strong>cifs</strong> <strong>之间的关系</strong></p>\n<p>随着 Internet 的流行，Microsoft 希望将这个协议扩展到 Internet 上去，成为 Internet 上计算机之间相互共享数据的一种标准。因此它<strong>将原有的几乎没有多少技术文档的 SMB 协议进行整理，重新命名为 CIFS（Common Internet File</strong> <strong>System），它使程序可以访问远程 Internet 计算机上的文件并要求此计算机提供服务</strong>。客户程序请求远在服务器上的服务器程序为它提供服务。服务器获得请求并返回响应。CIFS 是公共的或开放的 SMB 协议版本，并由 Microsoft 使用。SMB 协议在局域网上用于服务器文件访问和打印的协议。</p>\n<p><strong>4. 常见文件服务器对比</strong></p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">服务名称</th>\n<th style=\"text-align:left\">使用范围</th>\n<th style=\"text-align:left\">服务端</th>\n<th style=\"text-align:left\">客服端</th>\n<th style=\"text-align:left\">局限性</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">FTP</td>\n<td style=\"text-align:left\">内网和公网</td>\n<td style=\"text-align:left\">Windows、Linux</td>\n<td style=\"text-align:left\">Windows、Linux</td>\n<td style=\"text-align:left\">无法直接在服务器端修改数据</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Samba</td>\n<td style=\"text-align:left\">内网</td>\n<td style=\"text-align:left\">Windows、Linux</td>\n<td style=\"text-align:left\">Windows、Linux</td>\n<td style=\"text-align:left\">只能在内网使用</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">NFS</td>\n<td style=\"text-align:left\">内网和公网</td>\n<td style=\"text-align:left\">Linux</td>\n<td style=\"text-align:left\">Linux</td>\n<td style=\"text-align:left\">只能 Linux 之间使用</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"二-samba部署\"><a class=\"anchor\" href=\"#二-samba部署\">#</a> 二、Samba 部署</h4>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum install samba -y</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl start smb &amp;&amp; systemctl enable smb</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># netstat -lntp|grep smb</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>tcp        <span class=\"token number\">0</span>      <span class=\"token number\">0</span> <span class=\"token number\">0.0</span>.0.0:139             <span class=\"token number\">0.0</span>.0.0:*               LISTEN      <span class=\"token number\">1739</span>/smbd           </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>tcp        <span class=\"token number\">0</span>      <span class=\"token number\">0</span> <span class=\"token number\">0.0</span>.0.0:445             <span class=\"token number\">0.0</span>.0.0:*               LISTEN      <span class=\"token number\">1739</span>/smbd           </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>tcp6       <span class=\"token number\">0</span>      <span class=\"token number\">0</span> :::139                  :::*                    LISTEN      <span class=\"token number\">1739</span>/smbd           </pre></td></tr><tr><td data-num=\"7\"></td><td><pre>tcp6       <span class=\"token number\">0</span>      <span class=\"token number\">0</span> :::445                  :::*                    LISTEN      <span class=\"token number\">1739</span>/smbd </pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># testparm   #检测配置文件语法</span></pre></td></tr></table></figure><h4 id=\"三-samba配置文件详解\"><a class=\"anchor\" href=\"#三-samba配置文件详解\">#</a> 三、Samba 配置文件详解</h4>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># egrep -v '^#|^$' /etc/samba/smb.conf</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>global<span class=\"token punctuation\">]</span>           <span class=\"token comment\">#全局设置</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tworkgroup <span class=\"token operator\">=</span> SAMBA</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tsecurity <span class=\"token operator\">=</span> user</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\tpassdb backend <span class=\"token operator\">=</span> tdbsam</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\tprinting <span class=\"token operator\">=</span> cups</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token function\">printcap</span> name <span class=\"token operator\">=</span> cups</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\tload printers <span class=\"token operator\">=</span> <span class=\"token function\">yes</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\tcups options <span class=\"token operator\">=</span> raw</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">[</span>homes<span class=\"token punctuation\">]</span>            <span class=\"token comment\">#用户目录共享设置</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> Home Directories</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\tvalid <span class=\"token function\">users</span> <span class=\"token operator\">=</span> %S, %D%w%S</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\tbrowseable <span class=\"token operator\">=</span> No</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t<span class=\"token builtin class-name\">read</span> only <span class=\"token operator\">=</span> No</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\tinherit acls <span class=\"token operator\">=</span> Yes</pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">[</span>printers<span class=\"token punctuation\">]</span>         <span class=\"token comment\">#打印机共享设置</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> All Printers</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\tpath <span class=\"token operator\">=</span> /var/tmp</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\tprintable <span class=\"token operator\">=</span> Yes</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\tcreate mask <span class=\"token operator\">=</span> 0600</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\tbrowseable <span class=\"token operator\">=</span> No</pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">[</span>print$<span class=\"token punctuation\">]</span>           <span class=\"token comment\">#自定义名称的共享目录设置</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> Printer Drivers</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\tpath <span class=\"token operator\">=</span> /var/lib/samba/drivers</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t<span class=\"token function\">write</span> list <span class=\"token operator\">=</span> @printadmin root</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\tforce group <span class=\"token operator\">=</span> @printadmin</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\tcreate mask <span class=\"token operator\">=</span> 0664</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\tdirectory mask <span class=\"token operator\">=</span> 0775</pre></td></tr></table></figure><h5 id=\"31-全局参数详解\"><a class=\"anchor\" href=\"#31-全局参数详解\">#</a> 3.1 全局参数详解</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>workgroup <span class=\"token operator\">=</span> WORKGROUP</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#设定 Samba Server 所要加入的工作组或者域</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>server string <span class=\"token operator\">=</span> Samba Server Version %v</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#设定 Samba Server 的注释，可以是任何字符串，也可以不填。宏 % v 表示显示 Samba 的版本号</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>hosts allow <span class=\"token operator\">=</span> <span class=\"token number\">127</span>. <span class=\"token number\">192.168</span>.1. <span class=\"token number\">192.168</span>.10.1</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#表示允许连接到 Samba Server 的客户端，多个参数以空格隔开。可以用一个 IP 表示，也可以用一个网段表示。hosts deny 与 hosts allow 刚好相反。</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">#例如：hosts allow=172.17.2.EXCEPT172.17.2.50</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">#表示容许来自 172.17.2.* 的主机连接，但排除 172.17.2.50</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">#hosts allow=172.17.2.0/255.255.0.0</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">#表示容许来自 172.17.2.0/255.255.0.0 子网中的所有主机连接</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>log <span class=\"token function\">file</span> <span class=\"token operator\">=</span> /var/log/samba/log.%m</pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">#设置 Samba Server 日志文件的存储位置以及日志文件名称。在文件名后加个宏 % m（主机名），表示对每台访问 Samba Server 的机器都单独记录一个日志文件。如果 pc1、pc2 访问过 Samba Server，就会在 /var/log/samba 目录下留下 log.pc1 和 log.pc2 两个日志文件。</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>passdb backend <span class=\"token operator\">=</span> tdbsam</pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">#passdb backend 就是用户后台的意思。目前有三种后台：smbpasswd、tdbsam 和 ldapsam。sam 应该是 security account manager（安全账户管理）的简写。</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>security <span class=\"token operator\">=</span> user</pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">#说明：设置用户访问 Samba Server 的验证方式，一共有四种验证方式。</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">#1.share：用户访问 Samba Server 不需要提供用户名和口令，安全性能较低。</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">#2.user：Samba Server 共享目录只能被授权的用户访问，由 Samba Server 负责检查账号和密码的正确性。账号和密码要在本 Samba Server 中建立。</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">#3.server：依靠其他 Windows NT/2000 或 Samba Server 来验证用户的账号和密码，是一种代理验证。此种安全模式下，系统管理员可以把所有的 Windows 用户和口令集中到一个 NT 系统上，使用 Windows NT 进行 Samba 认证，远程服务器可以自动认证全部用户和口令，如果认证失败，Samba 将使用用户级安全模式作为替代的方式。</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token comment\">#4.domain：域安全级别，使用主域控制器 (PDC) 来完成认证。</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>max connections <span class=\"token operator\">=</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token comment\">#max connections 用来指定连接 Samba Server 的最大连接数目。如果超出连接数目，则新的连接请求将被拒绝。0 表示不限制。</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>load printers <span class=\"token operator\">=</span> yes/no</pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token comment\">#设置是否在启动 Samba 时就共享打印机。</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token function\">printcap</span> name <span class=\"token operator\">=</span> cups</pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token comment\">#设置共享打印机的配置文件</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>printing <span class=\"token operator\">=</span> cups</pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token comment\">#设置 Samba 共享打印机的类型。现在支持的打印系统有：bsd, sysv, plp, lprng, aix, hpux, qnx</span></pre></td></tr></table></figure><h5 id=\"32-共享参数详解\"><a class=\"anchor\" href=\"#32-共享参数详解\">#</a> 3.2 共享参数详解</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>共享名<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>comment <span class=\"token operator\">=</span> 任意字符串</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#comment 是对该共享的描述，可以是任意字符串</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>path <span class=\"token operator\">=</span> 共享目录路径</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">#path 用来指定共享目录的路径</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>guest ok <span class=\"token operator\">=</span> yes/no</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">#允许任何人访问，等同于同 “public”</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token builtin class-name\">read</span> only <span class=\"token operator\">=</span> <span class=\"token function\">yes</span>\t</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">#所有人只读</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>writable <span class=\"token operator\">=</span> yes/no</pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">#writable 用来指定该共享路径是否可写</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token function\">write</span> list <span class=\"token operator\">=</span> 允许写入该共享的用户</pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">#write list 用来指定可以在该共享下写入文件的用户。</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\">#例如：write list = bobyuan，@bob</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>browseable <span class=\"token operator\">=</span> yes/no</pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">#browseable 用来指定该共享是否可以浏览</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>valid <span class=\"token function\">users</span> <span class=\"token operator\">=</span> 允许访问该共享的用户</pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token comment\">#valid users 用来指定允许访问该共享资源的用户</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token comment\">#例如：valid users = bobyuan，@bob，@tech（多个用户或者组中间用逗号隔开，如果要加入一个组就用 “@+ 组名” 表示。）</span></pre></td></tr></table></figure><h4 id=\"四-samba-share权限访问\"><a class=\"anchor\" href=\"#四-samba-share权限访问\">#</a> 四、Samba share 权限访问</h4>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#1. 修改配置文件</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># egrep -v '^#|^$' /etc/samba/smb.conf</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>global<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tworkgroup <span class=\"token operator\">=</span> workgroup</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\tsecurity <span class=\"token operator\">=</span> User</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    map to guest <span class=\"token operator\">=</span> Bad User  <span class=\"token comment\">#目前 \"security = share\" 参数已被弃用，取而代之的是 map to guest = Bad User</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\tpassdb backend <span class=\"token operator\">=</span> tdbsam</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\tprinting <span class=\"token operator\">=</span> cups</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token function\">printcap</span> name <span class=\"token operator\">=</span> cups</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\tload printers <span class=\"token operator\">=</span> <span class=\"token function\">yes</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\tcups options <span class=\"token operator\">=</span> raw</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">[</span>homes<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> Home Directories</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\tvalid <span class=\"token function\">users</span> <span class=\"token operator\">=</span> %S, %D%w%S</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\tbrowseable <span class=\"token operator\">=</span> No</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t<span class=\"token builtin class-name\">read</span> only <span class=\"token operator\">=</span> No</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\tinherit acls <span class=\"token operator\">=</span> Yes</pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">[</span>printers<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> All Printers</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\tpath <span class=\"token operator\">=</span> /var/tmp</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\tprintable <span class=\"token operator\">=</span> Yes</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\tcreate mask <span class=\"token operator\">=</span> 0600</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\tbrowseable <span class=\"token operator\">=</span> No</pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">[</span>print$<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> Printer Drivers</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\tpath <span class=\"token operator\">=</span> /var/lib/samba/drivers</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t<span class=\"token function\">write</span> list <span class=\"token operator\">=</span> @printadmin root</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\tforce group <span class=\"token operator\">=</span> @printadmin</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\tcreate mask <span class=\"token operator\">=</span> 0664</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\tdirectory mask <span class=\"token operator\">=</span> 0775</pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token punctuation\">[</span>Public Share<span class=\"token punctuation\">]</span>                      <span class=\"token comment\">#共享名称      </span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> This is public share  <span class=\"token comment\">#所有人可写</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\tpath <span class=\"token operator\">=</span> /data                    <span class=\"token comment\">#共享目录</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\tbrowseable <span class=\"token operator\">=</span> <span class=\"token function\">yes</span>                <span class=\"token comment\">#共享是否可以见</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\twritable <span class=\"token operator\">=</span> <span class=\"token function\">yes</span>                  <span class=\"token comment\">#所有人可写</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\tguest ok <span class=\"token operator\">=</span> <span class=\"token function\">yes</span>                  <span class=\"token comment\">#所有人可访问</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token comment\">#2. 重启 smbf 服务</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># testparm</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl restart smb</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token comment\">#3. 修改系统权限</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir /data</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll -d /data/</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>drwxr-xr-x. <span class=\"token number\">5</span> root root <span class=\"token number\">49</span> Jun <span class=\"token number\">23</span> <span class=\"token number\">14</span>:26 /data/</pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token comment\">#share 访问全部映射成 nobody 用户访问，nobody 没有权限访问 data 目录，需要添加系统权限</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chown nobody /data</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll -d /data</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>drwxr-xr-x. <span class=\"token number\">5</span> nobody root <span class=\"token number\">73</span> Jun <span class=\"token number\">25</span> <span class=\"token number\">14</span>:22 /data</pre></td></tr></table></figure><h4 id=\"五-linux客户端命令行工具\"><a class=\"anchor\" href=\"#五-linux客户端命令行工具\">#</a> 五、Linux 客户端命令行工具</h4>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@qnyp-client1 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum install samba-client -y</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba-client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># smbclient -L //192.168.1.50 -U 用户名          #查看共享资源</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba-client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># smbclient //192.168.1.50 / 共享名 -U 用户名       #访问共享资源</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba-client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ls           #查看</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba-client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># get          #下载</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba-client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># push         #上传</span></pre></td></tr></table></figure><h4 id=\"六-samba-user级别访问\"><a class=\"anchor\" href=\"#六-samba-user级别访问\">#</a> 六、Samba user 级别访问</h4>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#1. 修改配置文件</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># egrep -v '^#|^$' /etc/samba/smb.conf</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>global<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tworkgroup <span class=\"token operator\">=</span> SAMBA</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\tsecurity <span class=\"token operator\">=</span> user   <span class=\"token comment\">#user 级别访问 </span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\tpassdb backend <span class=\"token operator\">=</span> tdbsam</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\tprinting <span class=\"token operator\">=</span> cups</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token function\">printcap</span> name <span class=\"token operator\">=</span> cups</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\tload printers <span class=\"token operator\">=</span> <span class=\"token function\">yes</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\tcups options <span class=\"token operator\">=</span> raw</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">[</span>homes<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> Home Directories</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\tvalid <span class=\"token function\">users</span> <span class=\"token operator\">=</span> %S, %D%w%S</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\tbrowseable <span class=\"token operator\">=</span> No</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t<span class=\"token builtin class-name\">read</span> only <span class=\"token operator\">=</span> No</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\tinherit acls <span class=\"token operator\">=</span> Yes</pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">[</span>printers<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> All Printers</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\tpath <span class=\"token operator\">=</span> /var/tmp</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\tprintable <span class=\"token operator\">=</span> Yes</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\tcreate mask <span class=\"token operator\">=</span> 0600</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\tbrowseable <span class=\"token operator\">=</span> No</pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">[</span>print$<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> Printer Drivers</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\tpath <span class=\"token operator\">=</span> /var/lib/samba/drivers</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t<span class=\"token function\">write</span> list <span class=\"token operator\">=</span> @printadmin root</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\tforce group <span class=\"token operator\">=</span> @printadmin</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\tcreate mask <span class=\"token operator\">=</span> 0664</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\tdirectory mask <span class=\"token operator\">=</span> 0775</pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">[</span>cawu_share<span class=\"token punctuation\">]</span>                     </pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> This is caiwu share </pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\tpath <span class=\"token operator\">=</span> /public         <span class=\"token comment\">#共享目录           </span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\tbrowseable <span class=\"token operator\">=</span> <span class=\"token function\">yes</span>       <span class=\"token comment\">#共享是否可以见       </span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\twritable <span class=\"token operator\">=</span> <span class=\"token function\">yes</span>         <span class=\"token comment\">#所有人可写      </span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token function\">write</span> list <span class=\"token operator\">=</span> yangxiao    <span class=\"token comment\">#允许写入该共享的用户</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    valid <span class=\"token function\">users</span> <span class=\"token operator\">=</span> yangxiao   <span class=\"token comment\">#允许访问该共享的用户</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>     </pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl restart smb</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token comment\">#2. 添加 samba 密码，该用户必须已经是系统用户</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir /public</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># useradd -s /sbin/nologin yangxiao</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># smbpasswd -a yangxiao               </span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># testparm            #测试语法</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll -d /public/</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>drwxr-xr-x <span class=\"token number\">2</span> root root <span class=\"token number\">6</span> Jun <span class=\"token number\">25</span> <span class=\"token number\">20</span>:25 /public/</pre></td></tr><tr><td data-num=\"47\"></td><td><pre></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token comment\">#3. 添加 publi 目录系统用户权限\t</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chown yangxiao.yangxiao /public/         </span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll /public/ -d</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>drwxr-xr-x <span class=\"token number\">2</span> yangxiao yangxiao <span class=\"token number\">55</span> Jun <span class=\"token number\">25</span> <span class=\"token number\">20</span>:44 /public/</pre></td></tr></table></figure><ul>\n<li>注释 valid users = yangxiao 后发现用户 weiyixiao 可以访问共享目录，但是无法上传</li>\n<li>注释 valid users = yangxiao，write list = yangxiao 后发现用户 weiyixiao 可以访问共享目录，仍然无法上传，原因 public 目录没有系统的写入权限</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#1. 修改配置文件</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># egrep -v '^#|^$' /etc/samba/smb.conf</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>global<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tworkgroup <span class=\"token operator\">=</span> SAMBA</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\tsecurity <span class=\"token operator\">=</span> user</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\tpassdb backend <span class=\"token operator\">=</span> tdbsam</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\tprinting <span class=\"token operator\">=</span> cups</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token function\">printcap</span> name <span class=\"token operator\">=</span> cups</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\tload printers <span class=\"token operator\">=</span> <span class=\"token function\">yes</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\tcups options <span class=\"token operator\">=</span> raw</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">[</span>homes<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> Home Directories</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\tvalid <span class=\"token function\">users</span> <span class=\"token operator\">=</span> %S, %D%w%S</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\tbrowseable <span class=\"token operator\">=</span> No</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t<span class=\"token builtin class-name\">read</span> only <span class=\"token operator\">=</span> No</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\tinherit acls <span class=\"token operator\">=</span> Yes</pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">[</span>printers<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> All Printers</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\tpath <span class=\"token operator\">=</span> /var/tmp</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\tprintable <span class=\"token operator\">=</span> Yes</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\tcreate mask <span class=\"token operator\">=</span> 0600</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\tbrowseable <span class=\"token operator\">=</span> No</pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">[</span>print$<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> Printer Drivers</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\tpath <span class=\"token operator\">=</span> /var/lib/samba/drivers</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t<span class=\"token function\">write</span> list <span class=\"token operator\">=</span> @printadmin root</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\tforce group <span class=\"token operator\">=</span> @printadmin</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\tcreate mask <span class=\"token operator\">=</span> 0664</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\tdirectory mask <span class=\"token operator\">=</span> 0775</pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">[</span>cawu_share<span class=\"token punctuation\">]</span>                     </pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> This is caiwu share </pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\tpath <span class=\"token operator\">=</span> /public           <span class=\"token comment\">#共享目录  </span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\tbrowseable <span class=\"token operator\">=</span> <span class=\"token function\">yes</span>         <span class=\"token comment\">#共享是否可以见    </span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\twritable <span class=\"token operator\">=</span> <span class=\"token function\">yes</span>           <span class=\"token comment\">#所有人可写  </span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token punctuation\">;</span>   <span class=\"token function\">write</span> list <span class=\"token operator\">=</span> yangxiao  <span class=\"token comment\">#允许写入该共享的用户</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token punctuation\">;</span>   valid <span class=\"token function\">users</span> <span class=\"token operator\">=</span> yangxiao <span class=\"token comment\">#允许访问该共享的用户</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token comment\">#2. 添加用户并授予系统权限</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># useradd -s /sbin/nologin weiyixiao</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># smbpasswd -a weiyixiao            #要给用户添加 samba 密码，该用户必须已经是系统用户</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll /public/ -d</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>drwxr-xr-x <span class=\"token number\">2</span> yangxiao yangxiao <span class=\"token number\">55</span> Jun <span class=\"token number\">25</span> <span class=\"token number\">20</span>:44 /public/</pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chmod 775 /public</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># usermod -a -G yangxiao weiyixiao    #将 weiyixiao 用户添加到 yangxiao 组</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl start smb</span></pre></td></tr></table></figure><h4 id=\"七-添加删除samba用户\"><a class=\"anchor\" href=\"#七-添加删除samba用户\">#</a> 七、添加删除 Samba 用户</h4>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#1. 添加系统用户</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># useradd -s /sbin/nologin test </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">#2. 添加 samba 密码，该用户必须已经是系统用户</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># smbpasswd -a test     </span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">#3. 查看 smb 用户</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># pdbedit -L</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>yangxiao:1003:</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>test:1005:</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>weiyixiao:1004:</pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">#4. 删除 smb 用户</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># smbpasswd -x test</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>Deleted user test.</pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># pdbedit -L</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>yangxiao:1003:</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>weiyixiao:1004:</pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">#5.samba Linux 客户端访问</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># smbclient //192.168.40.188/public -U xuyong   #public 共享名</span></pre></td></tr></table></figure><h4 id=\"八-samba企业实战\"><a class=\"anchor\" href=\"#八-samba企业实战\">#</a> 八、Samba 企业实战</h4>\n<p><img loading=\"lazy\" data-src=\"https://wp-cdn.4ce.cn/v2/G1pGXaJ.png\" alt=\"1.png\" /></p>\n<h5 id=\"81-samba服务器需求\"><a class=\"anchor\" href=\"#81-samba服务器需求\">#</a> 8.1 Samba 服务器需求</h5>\n<ol>\n<li>每位员工有独立的目录，可上传、可读、可写、可删除权限，但目录本身员工不可删除</li>\n<li>每位员工可见公司共享目录 public_share（只读）</li>\n<li>部门内部员工可见部门共享目录_caiwu_share（读写）</li>\n</ol>\n<h5 id=\"82-samba服务安装\"><a class=\"anchor\" href=\"#82-samba服务安装\">#</a> 8.2 Samba 服务安装</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum install samba -y</span></pre></td></tr></table></figure><h5 id=\"83-samba服务配置\"><a class=\"anchor\" href=\"#83-samba服务配置\">#</a> 8.3 Samba 服务配置</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@Harbor public_share<span class=\"token punctuation\">]</span><span class=\"token comment\"># egrep -v '^#|^$' /etc/samba/smb.conf</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>global<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tworkgroup <span class=\"token operator\">=</span> SAMBA</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tsecurity <span class=\"token operator\">=</span> user</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\tpassdb backend <span class=\"token operator\">=</span> tdbsam</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\tprinting <span class=\"token operator\">=</span> cups</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token function\">printcap</span> name <span class=\"token operator\">=</span> cups</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\tload printers <span class=\"token operator\">=</span> <span class=\"token function\">yes</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\tcups options <span class=\"token operator\">=</span> raw</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">[</span>homes<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> Home Directories</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\tvalid <span class=\"token function\">users</span> <span class=\"token operator\">=</span> %S, %D%w%S</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\tbrowseable <span class=\"token operator\">=</span> No</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t<span class=\"token builtin class-name\">read</span> only <span class=\"token operator\">=</span> No</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\tinherit acls <span class=\"token operator\">=</span> Yes</pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">[</span>printers<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> All Printers</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\tpath <span class=\"token operator\">=</span> /var/tmp</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\tprintable <span class=\"token operator\">=</span> Yes</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\tcreate mask <span class=\"token operator\">=</span> 0600</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\tbrowseable <span class=\"token operator\">=</span> No</pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">[</span>print$<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> Printer Drivers</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\tpath <span class=\"token operator\">=</span> /var/lib/samba/drivers</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t<span class=\"token function\">write</span> list <span class=\"token operator\">=</span> @printadmin root</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\tforce group <span class=\"token operator\">=</span> @printadmin</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\tcreate mask <span class=\"token operator\">=</span> 0664</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\tdirectory mask <span class=\"token operator\">=</span> 0775</pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token punctuation\">[</span>public_share<span class=\"token punctuation\">]</span>                          </pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\tcomment <span class=\"token operator\">=</span> This is public share  </pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\tpath <span class=\"token operator\">=</span> /samba_share/public_share</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\tbrowseable <span class=\"token operator\">=</span> <span class=\"token function\">yes</span>              </pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\twritable <span class=\"token operator\">=</span> <span class=\"token function\">yes</span>               </pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token punctuation\">[</span>yewu_share<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        comment <span class=\"token operator\">=</span> This is caiwu share</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        path <span class=\"token operator\">=</span> /samba_share/yewu_share</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        browseable <span class=\"token operator\">=</span> <span class=\"token function\">yes</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        writable <span class=\"token operator\">=</span> <span class=\"token function\">yes</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token punctuation\">[</span>caiwu_share<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        comment <span class=\"token operator\">=</span> This is yewu share</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        path <span class=\"token operator\">=</span> /samba_share/caiwu_share</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        browseable <span class=\"token operator\">=</span> <span class=\"token function\">yes</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        writable <span class=\"token operator\">=</span> <span class=\"token function\">yes</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl restart smb</span></pre></td></tr></table></figure><h5 id=\"84-创建共享目录\"><a class=\"anchor\" href=\"#84-创建共享目录\">#</a> 8.4 创建共享目录</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir /samba_share/</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cd /samba_share/</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba samba_share<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir caiwu_share</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba samba_share<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir yewu_share</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba samba_share<span class=\"token punctuation\">]</span><span class=\"token comment\"># public_share</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll -d /samba_share/yewu_share</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>drwxr-xr-x <span class=\"token number\">2</span> root root <span class=\"token number\">6</span> Jun <span class=\"token number\">26</span> <span class=\"token number\">11</span>:27 /samba_share/yewu_share</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll -d /samba_share/caiwu_share/</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>drwxr-xr-x <span class=\"token number\">2</span> root root <span class=\"token number\">6</span> Jun <span class=\"token number\">26</span> <span class=\"token number\">11</span>:26 /samba_share/caiwu_share</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll -d /samba_share/public_share/</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>drwxr-xr-x <span class=\"token number\">2</span> root root <span class=\"token number\">6</span> Jun <span class=\"token number\">26</span> <span class=\"token number\">11</span>:27 /samba_share/public_share</pre></td></tr></table></figure><h5 id=\"85-添加用户并设置smb密码\"><a class=\"anchor\" href=\"#85-添加用户并设置smb密码\">#</a> 8.5 添加用户并设置 smb 密码</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#1. 添加系统用户</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># useradd -s /sbin/nologin wangyuyan</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># useradd -s /sbin/nologin azhu</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># useradd -s /sbin/nologin duanyu</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># useradd -s /sbin/nologin xuzhu</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># useradd -s /sbin/nologin qiaofeng</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#2. 添加 smb 密码</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># smbpasswd -a wangyuyan</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># smbpasswd -a azhu</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># smbpasswd -a duanyu</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># smbpasswd -a xuzhu</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># smbpasswd -a qiaofeng</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">#3. 查看 smb 用户</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># pdbedit -L</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>wangyuyan:1002:</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>duanyu:1004:</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>qiaofeng:1006:</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>azhu:1003:</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>xuzhu:1005:</pre></td></tr></table></figure><h5 id=\"86-为用户添加acl权限\"><a class=\"anchor\" href=\"#86-为用户添加acl权限\">#</a> 8.6 为用户添加 ACL 权限</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#1. 修改目录权限</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chmod 700 /samba_share/public_share</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">#2. 为用户添加 ACL 权限</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#添加 ACL 权限</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># setfacl -m u:qiaofeng:rx /samba_share/public_share</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#3. 查看 ACL 权限</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># getfacl /samba_share/public_share</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>getfacl: Removing leading <span class=\"token string\">'/'</span> from absolute path names</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\"># file: samba_share/public_share</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\"># owner: root</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\"># group: root</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>user::rwx</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>user:qiaofeng:r-x</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>group::---</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>mask::r-x</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>other::---</pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">#4. 删除 ACL 权限</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># setfacl -x u:qiaofeng /samba_share/public_share</span></pre></td></tr></table></figure><h5 id=\"87-为组添加acl权限\"><a class=\"anchor\" href=\"#87-为组添加acl权限\">#</a> 8.7 为组添加 ACL 权限</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#1. 新建组并加入用户</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># groupadd caiwu</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># groupadd yewu</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># usermod -a -G caiwu wangyuyan</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># usermod -a -G caiwu azhu</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># usermod -a -G yewu duanyu</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># usermod -a -G yewu xuzhu</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">#从组中移除用户</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># gpasswd -d duanyu caiwu</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># gpasswd -d xuzhu caiwu</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">#2. 修改目录权限</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chmod 700 /samba_share/yewu_share</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chmod 700 /samba_share/caiwu_share</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">#3. 为组设定 ACL 权限</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># setfacl -m g:caiwu:rwx /samba_share/caiwu_share</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># setfacl -m g:caiwu:rx /samba_share/public_share</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># setfacl -m g:yewu:rwx /samba_share/yewu_share</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># setfacl -m g:yewu:rx /samba_share/public_share</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\">#4. 查看 ACL 权限</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># getfacl /samba_share/yewu_share</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>getfacl: Removing leading <span class=\"token string\">'/'</span> from absolute path names</pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token comment\"># file: samba_share/yewu_share</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token comment\"># owner: root</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token comment\"># group: root</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>user::rwx</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>group::---</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>group:yewu:rwx</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>mask::rwx</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>other::---</pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># getfacl /samba_share/caiwu_share</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>getfacl: Removing leading <span class=\"token string\">'/'</span> from absolute path names</pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token comment\"># file: samba_share/caiwu_share</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token comment\"># owner: root</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token comment\"># group: root</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>user::rwx</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>group::---</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>group:caiwu:rwx</pre></td></tr><tr><td data-num=\"44\"></td><td><pre>mask::rwx</pre></td></tr><tr><td data-num=\"45\"></td><td><pre>other::---</pre></td></tr><tr><td data-num=\"46\"></td><td><pre></pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># getfacl /samba_share/public_share</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>getfacl: Removing leading <span class=\"token string\">'/'</span> from absolute path names</pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token comment\"># file: samba_share/public_share</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token comment\"># owner: root</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token comment\"># group: root</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>user::rwx</pre></td></tr><tr><td data-num=\"53\"></td><td><pre>user:qiaofeng:r-x</pre></td></tr><tr><td data-num=\"54\"></td><td><pre>group::---</pre></td></tr><tr><td data-num=\"55\"></td><td><pre>group:caiwu:r-x</pre></td></tr><tr><td data-num=\"56\"></td><td><pre>group:yewu:r-x</pre></td></tr><tr><td data-num=\"57\"></td><td><pre>mask::r-x</pre></td></tr><tr><td data-num=\"58\"></td><td><pre>other::---</pre></td></tr><tr><td data-num=\"59\"></td><td><pre></pre></td></tr><tr><td data-num=\"60\"></td><td><pre><span class=\"token comment\">#5. 删除 ACL 权限</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># setfacl -x g:caiwu /samba_share/caiwu_share</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># setfacl -x g:yewu /samba_share/yewu_share</span></pre></td></tr></table></figure><h4 id=\"九-samba挂载及别名\"><a class=\"anchor\" href=\"#九-samba挂载及别名\">#</a> 九、Samba 挂载及别名</h4>\n<h5 id=\"91-samba挂载\"><a class=\"anchor\" href=\"#91-samba挂载\">#</a> 9.1 Samba 挂载</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#public_share 为共享名非共享目录</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mount -t cifs -o username=wangyuyan //192.168.1.50/public_share /mnt   </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">#配置自动挂载</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># echo \"//192.168.1.50/public_share /mnt cifs defaults,username=wangyuyan,passwd=123456 1 2\" >> /etc/fstab</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mount -a</span></pre></td></tr></table></figure><h5 id=\"92-samba别名\"><a class=\"anchor\" href=\"#92-samba别名\">#</a> 9.2 Samba 别名</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#1. 开启 smb 别名</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim /etc/samba/smb.conf</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>global<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        workgroup <span class=\"token operator\">=</span> workgroup</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        security <span class=\"token operator\">=</span> user</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        username map <span class=\"token operator\">=</span> /etc/samba/smbusers      <span class=\"token comment\">#添加此行配置</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">#2. 配置 smb 别名</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">[</span>root@samba ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim /etc/samba/smbusers</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>wangyuyan <span class=\"token operator\">=</span>  zhangsan lisi <span class=\"token comment\">#别名用户 zhangsan、lisi 登录后用于 wangyuyan 权限，权限及密码均一样</span></pre></td></tr></table></figure>",
            "tags": [
                "Samba"
            ]
        },
        {
            "id": "http://ixuyong.cn/posts/1922841233.html",
            "url": "http://ixuyong.cn/posts/1922841233.html",
            "title": "Rsync服务实践",
            "date_published": "2025-08-18T12:45:48.000Z",
            "content_html": "<h3 id=\"ursync服务实践u\"><a class=\"anchor\" href=\"#ursync服务实践u\">#</a> <u>Rsync 服务实践</u></h3>\n<p><strong>环境准备</strong></p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">主机名</th>\n<th style=\"text-align:center\"><strong>IP</strong></th>\n<th><strong>角色</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">server</td>\n<td style=\"text-align:center\">192.168.40.101</td>\n<td>rsync 服务端</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">client</td>\n<td style=\"text-align:center\">192.168.40.102</td>\n<td>rsync 客户</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"1rsync服务端\"><a class=\"anchor\" href=\"#1rsync服务端\">#</a> 1.rsync 服务端</h4>\n<h5 id=\"11-关闭防火墙-selinux\"><a class=\"anchor\" href=\"#11-关闭防火墙-selinux\">#</a> 1.1 关闭防火墙、selinux</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># hostnamectl set-hostname backup</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># bash</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># hostnamectl set-hostname aizj_lb01</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl stop firewalld</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl disable firewalld</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># sed -i 's/^SELINUX=enforcing/SELINUX=disabled/g' /etc/sysconfig/selinux</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># sed -i 's/^SELINUX=enforcing/SELINUX=disabled/g' /etc/selinux/config</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum install net-tools vim tree lrzsz wget unzip dos2unix bash-completion  lsof ntp ntpdate git -y</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum update -y --exclude=kernel* &amp;&amp; reboot</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># echo 'Asia/Shanghai' >/etc/timezone</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ntpdate time2.aliyun.com</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># crontab -e</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>*/5 * * * * /usr/sbin/ntpdate time2.aliyun.com <span class=\"token operator\">&amp;></span> /dev/nul</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir /soft /data /scripts /backup</span></pre></td></tr></table></figure><h5 id=\"12-安装rsync\"><a class=\"anchor\" href=\"#12-安装rsync\">#</a> 1.2 安装 rsync</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum install -y rsync</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@server ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl start rsyncd</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@server ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl enable rsyncd</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># useradd -M -s /sbin/nologin rsync</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir -p /backup/mysql  /backup/file</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chown -R rsync.rsync /backup/mysql /backup/file</span></pre></td></tr></table></figure><h5 id=\"13-修改配置文件\"><a class=\"anchor\" href=\"#13-修改配置文件\">#</a> 1.3 修改配置文件</h5>\n<p><em><mark>#生产环境中取消注释，导致备份数据报错</mark></em></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#带注释配置文件</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim /etc/rsyncd.conf</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>uid <span class=\"token operator\">=</span> <span class=\"token function\">rsync</span>             <span class=\"token comment\">#运行服务的用户</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>gid <span class=\"token operator\">=</span> <span class=\"token function\">rsync</span>             <span class=\"token comment\">#运行服务的组</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>port <span class=\"token operator\">=</span> <span class=\"token number\">873</span>              <span class=\"token comment\">#服务监听端口</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>fake super <span class=\"token operator\">=</span> <span class=\"token function\">yes</span>        <span class=\"token comment\">#服务无需使用 root 用户身份，即可接收文件的完整属性</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>use <span class=\"token function\">chroot</span> <span class=\"token operator\">=</span> no         <span class=\"token comment\">#禁锢目录，不允许获取 root 权限</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>max connections <span class=\"token operator\">=</span> <span class=\"token number\">200</span>   <span class=\"token comment\">#最大连接数，最多能有多少个客户端跟服务端的 873 端口建立连接</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token function\">timeout</span> <span class=\"token operator\">=</span> <span class=\"token number\">600</span>           <span class=\"token comment\">#超时时间</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>ignore errors          <span class=\"token comment\">#忽略错误</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token builtin class-name\">read</span> only <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>      <span class=\"token comment\">#客户是否只读</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>list <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>           <span class=\"token comment\">#不允许查看模块信息</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>auth <span class=\"token function\">users</span> <span class=\"token operator\">=</span> rsync_backup         <span class=\"token comment\">#定义虚拟用户，用户数据传输</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>secrets <span class=\"token function\">file</span> <span class=\"token operator\">=</span> /etc/rsync.passwd  <span class=\"token comment\">#定义虚拟用户密码认证文件</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>log <span class=\"token function\">file</span> <span class=\"token operator\">=</span> /var/log/rsyncd.log    <span class=\"token comment\">#日志文件存放的位置</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">[</span>backup_mysql<span class=\"token punctuation\">]</span>         <span class=\"token comment\">#模块名</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>comment <span class=\"token operator\">=</span> welcome to rsync_backup</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>path <span class=\"token operator\">=</span> /backup/mysql   <span class=\"token comment\">#数据存放目录</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">[</span>backup_file<span class=\"token punctuation\">]</span>          <span class=\"token comment\">#模块名</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>comment <span class=\"token operator\">=</span> welcome to rsync_backup</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>path <span class=\"token operator\">=</span> /backup/file    <span class=\"token comment\">#数据存放目录 </span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">#不带注释配置文件</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/rsyncd.conf</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>uid <span class=\"token operator\">=</span> <span class=\"token function\">rsync</span>        </pre></td></tr><tr><td data-num=\"26\"></td><td><pre>gid <span class=\"token operator\">=</span> <span class=\"token function\">rsync</span>         </pre></td></tr><tr><td data-num=\"27\"></td><td><pre>port <span class=\"token operator\">=</span> <span class=\"token number\">873</span>     </pre></td></tr><tr><td data-num=\"28\"></td><td><pre>fake super <span class=\"token operator\">=</span> <span class=\"token function\">yes</span>     </pre></td></tr><tr><td data-num=\"29\"></td><td><pre>use <span class=\"token function\">chroot</span> <span class=\"token operator\">=</span> no        </pre></td></tr><tr><td data-num=\"30\"></td><td><pre>max connections <span class=\"token operator\">=</span> <span class=\"token number\">200</span>  </pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token function\">timeout</span> <span class=\"token operator\">=</span> <span class=\"token number\">600</span>         </pre></td></tr><tr><td data-num=\"32\"></td><td><pre>ignore errors       </pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token builtin class-name\">read</span> only <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>    </pre></td></tr><tr><td data-num=\"34\"></td><td><pre>list <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>          </pre></td></tr><tr><td data-num=\"35\"></td><td><pre>auth <span class=\"token function\">users</span> <span class=\"token operator\">=</span> rsync_backup        </pre></td></tr><tr><td data-num=\"36\"></td><td><pre>secrets <span class=\"token function\">file</span> <span class=\"token operator\">=</span> /etc/rsync.passwd</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>log <span class=\"token function\">file</span> <span class=\"token operator\">=</span> /var/log/rsyncd.log    </pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token punctuation\">[</span>backup_mysql<span class=\"token punctuation\">]</span>       </pre></td></tr><tr><td data-num=\"39\"></td><td><pre>comment <span class=\"token operator\">=</span> welcome to rsync_backup</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>path <span class=\"token operator\">=</span> /backup/mysql  </pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token punctuation\">[</span>backup_file<span class=\"token punctuation\">]</span>         </pre></td></tr><tr><td data-num=\"42\"></td><td><pre>comment <span class=\"token operator\">=</span> welcome to rsync_backup</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>path <span class=\"token operator\">=</span> /backup/file</pre></td></tr></table></figure><h5 id=\"4-创建虚拟用户密码文件并设置权限\"><a class=\"anchor\" href=\"#4-创建虚拟用户密码文件并设置权限\">#</a> 4. 创建虚拟用户密码文件并设置权限</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/rsync.passwd</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>rsync_backup:your <span class=\"token function\">passwd</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chmod 600 /etc/rsync.passwd</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl restart rsyncd &amp;&amp; systemctl status rsyncd</span></pre></td></tr></table></figure><h5 id=\"5-检查服务端口是否开启\"><a class=\"anchor\" href=\"#5-检查服务端口是否开启\">#</a> 5. 检查服务端口是否开启</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># netstat -lntp | grep \"rsync\"</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>tcp        <span class=\"token number\">0</span>      <span class=\"token number\">0</span> <span class=\"token number\">0.0</span>.0.0:873             <span class=\"token number\">0.0</span>.0.0:*               LISTEN      <span class=\"token number\">20357</span>/rsync         </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>tcp6       <span class=\"token number\">0</span>      <span class=\"token number\">0</span> :::873                  :::*                    LISTEN      <span class=\"token number\">20357</span>/rsync</pre></td></tr></table></figure><h4 id=\"2-rsync客户端\"><a class=\"anchor\" href=\"#2-rsync客户端\">#</a> 2. rsync 客户端</h4>\n<h5 id=\"21-安装rsync\"><a class=\"anchor\" href=\"#21-安装rsync\">#</a> 2.1 安装 rsync</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@db01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum install nfs-utils -y</span></pre></td></tr></table></figure><h5 id=\"22-配置传输密码\"><a class=\"anchor\" href=\"#22-配置传输密码\">#</a> 2.2 配置传输密码</h5>\n<p>方法 1：将密码写入文件</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@db01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#  echo 'your passwd' > /etc/rsync.pass</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@db01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/rsync.pass </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>your <span class=\"token function\">passwd</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@db01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chmod 600 /etc/rsync.pass</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>--测试收发数据：</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@db01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># rsync -avz --password-file=/etc/rsync.pass /root/test rsync_backup@192.168.40.101::backup_file</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>sending incremental <span class=\"token function\">file</span> list</pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>sent <span class=\"token number\">47</span> bytes  received <span class=\"token number\">20</span> bytes  <span class=\"token number\">134.00</span> bytes/sec</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>total size is <span class=\"token number\">0</span>  speedup is <span class=\"token number\">0.00</span></pre></td></tr></table></figure><p>方法 2：使用密码环境变量 RSYNC_PASSWORD</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@db01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># export RSYNC_PASSWORD='your passwd'</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>--测试收发数据：</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@db01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># rsync -avz /root/test rsync_backup@192.168.40.101::backup_file</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>sending incremental <span class=\"token function\">file</span> list</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>sent <span class=\"token number\">47</span> bytes  received <span class=\"token number\">20</span> bytes  <span class=\"token number\">134.00</span> bytes/sec</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>total size is <span class=\"token number\">0</span>  speedup is <span class=\"token number\">0.00</span></pre></td></tr></table></figure><h3 id=\"ursync企业级备份案例u\"><a class=\"anchor\" href=\"#ursync企业级备份案例u\">#</a> <u>Rsync 企业级备份案例</u></h3>\n<p><strong>环境准备</strong></p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">主机名</th>\n<th style=\"text-align:center\"><strong>IP</strong></th>\n<th><strong>角色</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">server</td>\n<td style=\"text-align:center\">192.168.40.101</td>\n<td>rsync 服务端</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">client</td>\n<td style=\"text-align:center\">192.168.40.102</td>\n<td>rsync 客户</td>\n</tr>\n</tbody>\n</table>\n<p><strong>客户端需求</strong></p>\n<ul>\n<li>客户端每天凌晨 3 点备份 MySQL 至 /backup 下以 &quot;主机名_IP 地址_当前时间命名&quot; 的目录中</li>\n<li>客户端推送 /backup 目录下数据备份目录至 Rsync 备份服务器</li>\n<li>客户端只保留最近七天的备份数据，避免浪费磁盘空间</li>\n</ul>\n<p><strong>服务端需求</strong></p>\n<ul>\n<li>服务端部署 rsync 服务，用于接收用户的备份数据</li>\n<li>服务端每天校验客户端推送过来的数据是否完整，并将结果以邮件的方式发送给管理员</li>\n<li>服务端仅保留 6 个月的备份数据</li>\n</ul>\n<p><strong>注意</strong>：所有服务器的备份目录均为 /backup，所有脚本存放目录均为 /scripts。</p>\n<h4 id=\"1-服务端部署rsync服务\"><a class=\"anchor\" href=\"#1-服务端部署rsync服务\">#</a> <strong>1. 服务端部署 rsync 服务</strong></h4>\n<h5 id=\"11-关闭防火墙-selinux-2\"><a class=\"anchor\" href=\"#11-关闭防火墙-selinux-2\">#</a> 1.1 关闭防火墙、selinux</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># hostnamectl set-hostname backup</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># bash</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># hostnamectl set-hostname aizj_lb01</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl stop firewalld</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl disable firewalld</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># sed -i 's/^SELINUX=enforcing/SELINUX=disabled/g' /etc/sysconfig/selinux</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># sed -i 's/^SELINUX=enforcing/SELINUX=disabled/g' /etc/selinux/config</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum install net-tools vim tree lrzsz wget unzip dos2unix bash-completion  lsof ntp ntpdate git -y</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum update -y --exclude=kernel* &amp;&amp; reboot</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># echo 'Asia/Shanghai' >/etc/timezone</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ntpdate time2.aliyun.com</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># crontab -e</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>*/5 * * * * /usr/sbin/ntpdate time2.aliyun.com <span class=\"token operator\">&amp;></span> /dev/nul</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir /soft /data /scripts /backup</span></pre></td></tr></table></figure><h5 id=\"12-安装rsync-2\"><a class=\"anchor\" href=\"#12-安装rsync-2\">#</a> 1.2 安装 rsync</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum install -y rsync</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@server ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl start rsyncd</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@server ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl enable rsyncd</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># useradd -M -s /sbin/nologin rsync</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir -p /backup/mysql  /backup/file</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chown -R rsync.rsync /backup/mysql /backup/file</span></pre></td></tr></table></figure><h5 id=\"13-修改配置文件-2\"><a class=\"anchor\" href=\"#13-修改配置文件-2\">#</a> 1.3 修改配置文件</h5>\n<p><em><mark>#生产环境中取消注释，导致备份数据报错</mark></em></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#带注释配置文件</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim /etc/rsyncd.conf</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>uid <span class=\"token operator\">=</span> <span class=\"token function\">rsync</span>             <span class=\"token comment\">#运行服务的用户</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>gid <span class=\"token operator\">=</span> <span class=\"token function\">rsync</span>             <span class=\"token comment\">#运行服务的组</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>port <span class=\"token operator\">=</span> <span class=\"token number\">873</span>              <span class=\"token comment\">#服务监听端口</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>fake super <span class=\"token operator\">=</span> <span class=\"token function\">yes</span>        <span class=\"token comment\">#服务无需使用 root 用户身份，即可接收文件的完整属性</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>use <span class=\"token function\">chroot</span> <span class=\"token operator\">=</span> no         <span class=\"token comment\">#禁锢目录，不允许获取 root 权限</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>max connections <span class=\"token operator\">=</span> <span class=\"token number\">200</span>   <span class=\"token comment\">#最大连接数，最多能有多少个客户端跟服务端的 873 端口建立连接</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token function\">timeout</span> <span class=\"token operator\">=</span> <span class=\"token number\">600</span>           <span class=\"token comment\">#超时时间</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>ignore errors          <span class=\"token comment\">#忽略错误</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token builtin class-name\">read</span> only <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>      <span class=\"token comment\">#客户是否只读</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>list <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>           <span class=\"token comment\">#不允许查看模块信息</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>auth <span class=\"token function\">users</span> <span class=\"token operator\">=</span> rsync_backup         <span class=\"token comment\">#定义虚拟用户，用户数据传输</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>secrets <span class=\"token function\">file</span> <span class=\"token operator\">=</span> /etc/rsync.passwd  <span class=\"token comment\">#定义虚拟用户密码认证文件</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>log <span class=\"token function\">file</span> <span class=\"token operator\">=</span> /var/log/rsyncd.log    <span class=\"token comment\">#日志文件存放的位置</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">[</span>backup_mysql<span class=\"token punctuation\">]</span>         <span class=\"token comment\">#模块名</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>comment <span class=\"token operator\">=</span> welcome to rsync_backup</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>path <span class=\"token operator\">=</span> /backup/mysql   <span class=\"token comment\">#数据存放目录</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">[</span>backup_file<span class=\"token punctuation\">]</span>          <span class=\"token comment\">#模块名</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>comment <span class=\"token operator\">=</span> welcome to rsync_backup</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>path <span class=\"token operator\">=</span> /backup/file    <span class=\"token comment\">#数据存放目录 </span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">#不带注释配置文件</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/rsyncd.conf</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>uid <span class=\"token operator\">=</span> <span class=\"token function\">rsync</span>        </pre></td></tr><tr><td data-num=\"26\"></td><td><pre>gid <span class=\"token operator\">=</span> <span class=\"token function\">rsync</span>         </pre></td></tr><tr><td data-num=\"27\"></td><td><pre>port <span class=\"token operator\">=</span> <span class=\"token number\">873</span>     </pre></td></tr><tr><td data-num=\"28\"></td><td><pre>fake super <span class=\"token operator\">=</span> <span class=\"token function\">yes</span>     </pre></td></tr><tr><td data-num=\"29\"></td><td><pre>use <span class=\"token function\">chroot</span> <span class=\"token operator\">=</span> no        </pre></td></tr><tr><td data-num=\"30\"></td><td><pre>max connections <span class=\"token operator\">=</span> <span class=\"token number\">200</span>  </pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token function\">timeout</span> <span class=\"token operator\">=</span> <span class=\"token number\">600</span>         </pre></td></tr><tr><td data-num=\"32\"></td><td><pre>ignore errors       </pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token builtin class-name\">read</span> only <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>    </pre></td></tr><tr><td data-num=\"34\"></td><td><pre>list <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>          </pre></td></tr><tr><td data-num=\"35\"></td><td><pre>auth <span class=\"token function\">users</span> <span class=\"token operator\">=</span> rsync_backup        </pre></td></tr><tr><td data-num=\"36\"></td><td><pre>secrets <span class=\"token function\">file</span> <span class=\"token operator\">=</span> /etc/rsync.passwd</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>log <span class=\"token function\">file</span> <span class=\"token operator\">=</span> /var/log/rsyncd.log    </pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token punctuation\">[</span>backup_mysql<span class=\"token punctuation\">]</span>       </pre></td></tr><tr><td data-num=\"39\"></td><td><pre>comment <span class=\"token operator\">=</span> welcome to rsync_backup</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>path <span class=\"token operator\">=</span> /backup/mysql  </pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token punctuation\">[</span>backup_file<span class=\"token punctuation\">]</span>         </pre></td></tr><tr><td data-num=\"42\"></td><td><pre>comment <span class=\"token operator\">=</span> welcome to rsync_backup</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>path <span class=\"token operator\">=</span> /backup/file</pre></td></tr></table></figure><h5 id=\"4-创建虚拟用户密码文件并设置权限-2\"><a class=\"anchor\" href=\"#4-创建虚拟用户密码文件并设置权限-2\">#</a> 4. 创建虚拟用户密码文件并设置权限</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/rsync.passwd</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>rsync_backup:your <span class=\"token function\">passwd</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chmod 600 /etc/rsync.passwd</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl restart rsyncd &amp;&amp; systemctl status rsyncd</span></pre></td></tr></table></figure><h5 id=\"5-检查服务端口是否开启-2\"><a class=\"anchor\" href=\"#5-检查服务端口是否开启-2\">#</a> 5. 检查服务端口是否开启</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># netstat -lntp | grep \"rsync\"</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>tcp        <span class=\"token number\">0</span>      <span class=\"token number\">0</span> <span class=\"token number\">0.0</span>.0.0:873             <span class=\"token number\">0.0</span>.0.0:*               LISTEN      <span class=\"token number\">20357</span>/rsync         </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>tcp6       <span class=\"token number\">0</span>      <span class=\"token number\">0</span> :::873                  :::*                    LISTEN      <span class=\"token number\">20357</span>/rsync</pre></td></tr></table></figure><h4 id=\"2-rsync客户端-2\"><a class=\"anchor\" href=\"#2-rsync客户端-2\">#</a> 2. rsync 客户端</h4>\n<h5 id=\"21-安装rsync-2\"><a class=\"anchor\" href=\"#21-安装rsync-2\">#</a> 2.1 安装 rsync</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@db01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum install nfs-utils -y</span></pre></td></tr></table></figure><h5 id=\"22-测试客户端备份数据并推送至rsync服务器\"><a class=\"anchor\" href=\"#22-测试客户端备份数据并推送至rsync服务器\">#</a> 2.2 测试客户端备份数据并推送至 rsync 服务器</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@db01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># export RSYNC_PASSWORD='your passwd'</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@db01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># rsync -avz /root/test rsync_backup@192.168.40.101::backup_file</span></pre></td></tr></table></figure><h5 id=\"23-客户端备份数据并推送至rsync服务器\"><a class=\"anchor\" href=\"#23-客户端备份数据并推送至rsync服务器\">#</a> <strong>2.3 客户端备份数据并推送至 rsync 服务器</strong></h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@db01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir /scripts</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@db01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /scripts/mysql_backup.sh </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#!/bin/bash</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">PATH</span></span><span class=\"token operator\">=</span>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">#1、定义变量</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token assign-left variable\">Host</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">hostname</span><span class=\"token variable\">)</span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token assign-left variable\">Ip</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">ifconfig</span> ens192 <span class=\"token operator\">|</span> <span class=\"token function\">awk</span> <span class=\"token string\">'NR==2&#123;print $2&#125;'</span><span class=\"token variable\">)</span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token assign-left variable\">Date</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">date</span> +%F<span class=\"token variable\">)</span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token assign-left variable\">BackupDir</span><span class=\"token operator\">=</span>/backup/mysql</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token assign-left variable\">Dest</span><span class=\"token operator\">=</span><span class=\"token variable\">$&#123;BackupDir&#125;</span>/<span class=\"token variable\">$&#123;Host&#125;</span>_<span class=\"token variable\">$&#123;Ip&#125;</span>_<span class=\"token variable\">$&#123;Date&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token assign-left variable\">FILE_NAME</span><span class=\"token operator\">=</span>mysql_backup_<span class=\"token variable\"><span class=\"token variable\">`</span><span class=\"token function\">date</span> <span class=\"token string\">'+%Y%m%d%H%M%S'</span><span class=\"token variable\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token assign-left variable\">OLDBINLOG</span><span class=\"token operator\">=</span>/var/lib/mysql/oldbinlog</pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">#2、创建备份目录</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token operator\">!</span> <span class=\"token parameter variable\">-d</span> <span class=\"token variable\">$Dest</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span><span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> <span class=\"token variable\">$Dest</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">fi</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">#3、备份目录</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>/usr/bin/mysqldump -u<span class=\"token string\">'root'</span> -p<span class=\"token string\">'your passwd'</span> nf_flms <span class=\"token operator\">></span> <span class=\"token variable\">$Dest</span>/nf-flms_<span class=\"token variable\">$&#123;FILE_NAME&#125;</span>.sql</pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token function\">tar</span> <span class=\"token parameter variable\">-czvf</span> <span class=\"token variable\">$Dest</span>/<span class=\"token variable\">$&#123;FILE_NAME&#125;</span>.tar.gz <span class=\"token variable\">$Dest</span>/nf-flms_<span class=\"token variable\">$&#123;FILE_NAME&#125;</span>.sql</pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token function\">rm</span> <span class=\"token parameter variable\">-rf</span> <span class=\"token variable\">$Dest</span>/*<span class=\"token variable\">$&#123;FILE_NAME&#125;</span>.sql</pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"Your database backup successfully\"</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token comment\">#4、校验</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>md5sum <span class=\"token variable\">$Dest</span>/* <span class=\"token operator\">></span><span class=\"token variable\">$Dest</span>/backup_check_<span class=\"token variable\">$Date</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token comment\">#5、将备份目录推动到 rsync 服务端</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token assign-left variable\">Rsync_Ip</span><span class=\"token operator\">=</span><span class=\"token number\">192.168</span>.1.145</pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token assign-left variable\">Rsync_user</span><span class=\"token operator\">=</span>rsync_backup</pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token assign-left variable\">Rsync_Module</span><span class=\"token operator\">=</span>backup_mysql</pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">RSYNC_PASSWORD</span><span class=\"token operator\">=</span>your <span class=\"token function\">passwd</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token function\">rsync</span> <span class=\"token parameter variable\">-avz</span> <span class=\"token variable\">$Dest</span> <span class=\"token variable\">$Rsync_user</span>@<span class=\"token variable\">$Rsync_Ip</span>::<span class=\"token variable\">$Rsync_Module</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token comment\">#6、删除 15 天备份目录</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token function\">find</span> <span class=\"token variable\">$Dest</span> <span class=\"token parameter variable\">-type</span> d <span class=\"token parameter variable\">-mtime</span> +15 <span class=\"token operator\">|</span> <span class=\"token function\">xargs</span> <span class=\"token function\">rm</span> <span class=\"token parameter variable\">-rf</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">\"remove file  successfully\"</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token punctuation\">[</span>root@db01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chmod +x /scripts/etc_backup.sh</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token punctuation\">[</span>root@db01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># crontab -e</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>00 03 * * * /bin/bash /scripts/mysql_backup.sh <span class=\"token operator\">&amp;></span> /dev/null</pre></td></tr></table></figure><h5 id=\"24-服务端校验数据并将结果以邮件发送给管理员\"><a class=\"anchor\" href=\"#24-服务端校验数据并将结果以邮件发送给管理员\">#</a> <strong>2.4 服务端校验数据并将结果以邮件发送给管理员</strong></h5>\n<h6 id=\"241-配置邮件服务\"><a class=\"anchor\" href=\"#241-配置邮件服务\">#</a> 2.4.1 配置邮件服务</h6>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum -y install mailx</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/mail.rc      #最后一行插入</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token builtin class-name\">set</span> <span class=\"token assign-left variable\">from</span><span class=\"token operator\">=</span><span class=\"token number\">373370405</span>@qq.com</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token builtin class-name\">set</span> <span class=\"token assign-left variable\">smtp</span><span class=\"token operator\">=</span>smtps://smtp.qq.com:465</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token builtin class-name\">set</span> smtp-auth-user<span class=\"token operator\">=</span><span class=\"token number\">373370405</span>@qq.com</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token builtin class-name\">set</span> smtp-auth-password<span class=\"token operator\">=</span>**********   <span class=\"token comment\"># 发件邮箱的授权码</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token builtin class-name\">set</span> smtp-auth<span class=\"token operator\">=</span>login</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token builtin class-name\">set</span> ssl-verify<span class=\"token operator\">=</span>ignore</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token builtin class-name\">set</span> nss-config-dir<span class=\"token operator\">=</span>/etc/pki/nssdb</pre></td></tr></table></figure><h6 id=\"242-发送邮件测试\"><a class=\"anchor\" href=\"#242-发送邮件测试\">#</a> 2.4.2 发送邮件测试</h6>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\">#  echo Hello World | mail -s test 373370405@qq.com &amp;> /dev/null</span></pre></td></tr></table></figure><h6 id=\"243-配置脚本校验数据并将结果发送给管理员\"><a class=\"anchor\" href=\"#243-配置脚本校验数据并将结果发送给管理员\">#</a> 2.4.3 配置脚本校验数据并将结果发送给管理员</h6>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup mysql<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /scripts/check_backup.sh </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#!/bin/bash</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\"><span class=\"token environment constant\">PATH</span></span><span class=\"token operator\">=</span>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">#1、定义变量</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token assign-left variable\">Path</span><span class=\"token operator\">=</span>/backup/mysql</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token assign-left variable\">Date</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">date</span> +%F<span class=\"token variable\">)</span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">#2、查看 flag 文件，并对对文件进行校验，然后将校验的结果保存至 result_时间</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token function\">find</span> <span class=\"token variable\">$Path</span> <span class=\"token parameter variable\">-type</span> f <span class=\"token parameter variable\">-name</span> <span class=\"token string\">\"backup_check_<span class=\"token variable\">$&#123;Date&#125;</span>*\"</span><span class=\"token operator\">|</span><span class=\"token function\">xargs</span> md5sum <span class=\"token parameter variable\">-c</span> <span class=\"token operator\">></span><span class=\"token variable\">$Path</span>/result_<span class=\"token variable\">$&#123;Date&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">#3、将校验结果发送邮件给管理员</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>mail <span class=\"token parameter variable\">-s</span> <span class=\"token string\">\"Mysql Backup\"</span> <span class=\"token number\">373370405</span>@qq.com <span class=\"token operator\">&lt;</span><span class=\"token variable\">$Path</span>/result_<span class=\"token variable\">$&#123;Date&#125;</span> <span class=\"token operator\">&amp;></span> /dev/null</pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">#4、删除超过 7 天的校验结果文件，删除超过 180 天的备份数据文件</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token function\">find</span> <span class=\"token variable\">$Path</span> <span class=\"token parameter variable\">-type</span> f <span class=\"token parameter variable\">-name</span> <span class=\"token string\">\"result*\"</span> <span class=\"token parameter variable\">-mtime</span> +7 <span class=\"token operator\">|</span> <span class=\"token function\">xargs</span> <span class=\"token function\">rm</span> <span class=\"token parameter variable\">-rf</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token function\">find</span> <span class=\"token variable\">$Path</span> <span class=\"token parameter variable\">-type</span> f <span class=\"token parameter variable\">-mtime</span> +180 <span class=\"token operator\">|</span> <span class=\"token function\">xargs</span> <span class=\"token function\">rm</span> <span class=\"token parameter variable\">-rf</span></pre></td></tr></table></figure><h6 id=\"244-写计划任务\"><a class=\"anchor\" href=\"#244-写计划任务\">#</a> <strong>2.4.4 写计划任务</strong></h6>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chmod +x /scripts/check_backup.sh </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@db01 ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># crontab -e</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>00 06 * * * /bin/bash /scripts/mysql_backup.sh <span class=\"token operator\">&amp;></span> /dev/null</pre></td></tr></table></figure><h3 id=\"rsyncsersync实现数据实时同步\"><a class=\"anchor\" href=\"#rsyncsersync实现数据实时同步\">#</a> Rsync+sersync 实现数据实时同步</h3>\n<p><strong>环境准备</strong></p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">主机名</th>\n<th style=\"text-align:center\"><strong>IP</strong></th>\n<th><strong>角色</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">server</td>\n<td style=\"text-align:center\">192.168.40.101</td>\n<td>rsync 服务端</td>\n</tr>\n<tr>\n<td style=\"text-align:left\">client</td>\n<td style=\"text-align:center\">192.168.40.102</td>\n<td>rsync 客户</td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"1rsync服务端-2\"><a class=\"anchor\" href=\"#1rsync服务端-2\">#</a> 1.rsync 服务端</h4>\n<h5 id=\"11-关闭防火墙-selinux-3\"><a class=\"anchor\" href=\"#11-关闭防火墙-selinux-3\">#</a> 1.1 关闭防火墙、selinux</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># hostnamectl set-hostname backup</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@localhost ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># bash</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># hostnamectl set-hostname aizj_lb01</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl stop firewalld</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl disable firewalld</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># sed -i 's/^SELINUX=enforcing/SELINUX=disabled/g' /etc/sysconfig/selinux</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># sed -i 's/^SELINUX=enforcing/SELINUX=disabled/g' /etc/selinux/config</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum install net-tools vim tree lrzsz wget unzip dos2unix bash-completion  lsof ntp ntpdate git -y</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum update -y --exclude=kernel* &amp;&amp; reboot</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># echo 'Asia/Shanghai' >/etc/timezone</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ntpdate time2.aliyun.com</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># crontab -e</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>*/5 * * * * /usr/sbin/ntpdate time2.aliyun.com <span class=\"token operator\">&amp;></span> /dev/nul</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir /soft /data /scripts /backup</span></pre></td></tr></table></figure><h5 id=\"12-安装rsync-3\"><a class=\"anchor\" href=\"#12-安装rsync-3\">#</a> 1.2 安装 rsync</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum install -y rsync</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@server ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl start rsyncd</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@server ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl enable rsyncd</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># useradd -M -s /sbin/nologin rsync</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir -p /backup/mysql  /backup/file</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chown -R rsync.rsync /backup/mysql /backup/file</span></pre></td></tr></table></figure><h5 id=\"13-修改配置文件-3\"><a class=\"anchor\" href=\"#13-修改配置文件-3\">#</a> 1.3 修改配置文件</h5>\n<p><em><mark>#生产环境中取消注释，导致备份数据报错</mark></em></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#带注释配置文件</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim /etc/rsyncd.conf</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>uid <span class=\"token operator\">=</span> <span class=\"token function\">rsync</span>             <span class=\"token comment\">#运行服务的用户</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>gid <span class=\"token operator\">=</span> <span class=\"token function\">rsync</span>             <span class=\"token comment\">#运行服务的组</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>port <span class=\"token operator\">=</span> <span class=\"token number\">873</span>              <span class=\"token comment\">#服务监听端口</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>fake super <span class=\"token operator\">=</span> <span class=\"token function\">yes</span>        <span class=\"token comment\">#服务无需使用 root 用户身份，即可接收文件的完整属性</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>use <span class=\"token function\">chroot</span> <span class=\"token operator\">=</span> no         <span class=\"token comment\">#禁锢目录，不允许获取 root 权限</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>max connections <span class=\"token operator\">=</span> <span class=\"token number\">200</span>   <span class=\"token comment\">#最大连接数，最多能有多少个客户端跟服务端的 873 端口建立连接</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token function\">timeout</span> <span class=\"token operator\">=</span> <span class=\"token number\">600</span>           <span class=\"token comment\">#超时时间</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>ignore errors          <span class=\"token comment\">#忽略错误</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token builtin class-name\">read</span> only <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>      <span class=\"token comment\">#客户是否只读</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>list <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>           <span class=\"token comment\">#不允许查看模块信息</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>auth <span class=\"token function\">users</span> <span class=\"token operator\">=</span> rsync_backup         <span class=\"token comment\">#定义虚拟用户，用户数据传输</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>secrets <span class=\"token function\">file</span> <span class=\"token operator\">=</span> /etc/rsync.passwd  <span class=\"token comment\">#定义虚拟用户密码认证文件</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>log <span class=\"token function\">file</span> <span class=\"token operator\">=</span> /var/log/rsyncd.log    <span class=\"token comment\">#日志文件存放的位置</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">[</span>backup_mysql<span class=\"token punctuation\">]</span>         <span class=\"token comment\">#模块名</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>comment <span class=\"token operator\">=</span> welcome to rsync_backup</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>path <span class=\"token operator\">=</span> /backup/mysql   <span class=\"token comment\">#数据存放目录</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">[</span>backup_file<span class=\"token punctuation\">]</span>          <span class=\"token comment\">#模块名</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>comment <span class=\"token operator\">=</span> welcome to rsync_backup</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>path <span class=\"token operator\">=</span> /backup/file    <span class=\"token comment\">#数据存放目录 </span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">#不带注释配置文件</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/rsyncd.conf</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>uid <span class=\"token operator\">=</span> <span class=\"token function\">rsync</span>        </pre></td></tr><tr><td data-num=\"26\"></td><td><pre>gid <span class=\"token operator\">=</span> <span class=\"token function\">rsync</span>         </pre></td></tr><tr><td data-num=\"27\"></td><td><pre>port <span class=\"token operator\">=</span> <span class=\"token number\">873</span>     </pre></td></tr><tr><td data-num=\"28\"></td><td><pre>fake super <span class=\"token operator\">=</span> <span class=\"token function\">yes</span>     </pre></td></tr><tr><td data-num=\"29\"></td><td><pre>use <span class=\"token function\">chroot</span> <span class=\"token operator\">=</span> no        </pre></td></tr><tr><td data-num=\"30\"></td><td><pre>max connections <span class=\"token operator\">=</span> <span class=\"token number\">200</span>  </pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token function\">timeout</span> <span class=\"token operator\">=</span> <span class=\"token number\">600</span>         </pre></td></tr><tr><td data-num=\"32\"></td><td><pre>ignore errors       </pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token builtin class-name\">read</span> only <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>    </pre></td></tr><tr><td data-num=\"34\"></td><td><pre>list <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span>          </pre></td></tr><tr><td data-num=\"35\"></td><td><pre>auth <span class=\"token function\">users</span> <span class=\"token operator\">=</span> rsync_backup        </pre></td></tr><tr><td data-num=\"36\"></td><td><pre>secrets <span class=\"token function\">file</span> <span class=\"token operator\">=</span> /etc/rsync.passwd</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>log <span class=\"token function\">file</span> <span class=\"token operator\">=</span> /var/log/rsyncd.log    </pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token punctuation\">[</span>backup_mysql<span class=\"token punctuation\">]</span>       </pre></td></tr><tr><td data-num=\"39\"></td><td><pre>comment <span class=\"token operator\">=</span> welcome to rsync_backup</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>path <span class=\"token operator\">=</span> /backup/mysql  </pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token punctuation\">[</span>backup_file<span class=\"token punctuation\">]</span>         </pre></td></tr><tr><td data-num=\"42\"></td><td><pre>comment <span class=\"token operator\">=</span> welcome to rsync_backup</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>path <span class=\"token operator\">=</span> /backup/file</pre></td></tr></table></figure><h5 id=\"4-创建虚拟用户密码文件并设置权限-3\"><a class=\"anchor\" href=\"#4-创建虚拟用户密码文件并设置权限-3\">#</a> 4. 创建虚拟用户密码文件并设置权限</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/rsync.passwd</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>rsync_backup:your <span class=\"token function\">passwd</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chmod 600 /etc/rsync.passwd</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl restart rsyncd &amp;&amp; systemctl status rsyncd</span></pre></td></tr></table></figure><h5 id=\"5-检查服务端口是否开启-3\"><a class=\"anchor\" href=\"#5-检查服务端口是否开启-3\">#</a> 5. 检查服务端口是否开启</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># netstat -lntp | grep \"rsync\"</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>tcp        <span class=\"token number\">0</span>      <span class=\"token number\">0</span> <span class=\"token number\">0.0</span>.0.0:873             <span class=\"token number\">0.0</span>.0.0:*               LISTEN      <span class=\"token number\">20357</span>/rsync         </pre></td></tr><tr><td data-num=\"3\"></td><td><pre>tcp6       <span class=\"token number\">0</span>      <span class=\"token number\">0</span> :::873                  :::*                    LISTEN      <span class=\"token number\">20357</span>/rsync</pre></td></tr></table></figure><h4 id=\"2-客户端安装sersync\"><a class=\"anchor\" href=\"#2-客户端安装sersync\">#</a> 2. 客户端安装 sersync</h4>\n<p><strong>2.1 安装 sercync 依赖</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum install -y inotify-tools rsync</span></pre></td></tr></table></figure><p><strong>2.2 安装 sercync</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir -p /soft</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cd /soft/</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># wget https://down.whsir.com/downloads/sersync2.5.4_64bit_binary_stable_final.tar.gz</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs soft<span class=\"token punctuation\">]</span><span class=\"token comment\"># tar -xf sersync2.5.4_64bit_binary_stable_final.tar.gz</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs soft<span class=\"token punctuation\">]</span><span class=\"token comment\"># mv GNU-Linux-x86 /usr/local/sersync</span></pre></td></tr></table></figure><h5 id=\"23-修改配置文件\"><a class=\"anchor\" href=\"#23-修改配置文件\">#</a> 2.3 <strong>修改配置文件</strong></h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs soft<span class=\"token punctuation\">]</span><span class=\"token comment\"># cd /usr/local/sersync/</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs sersync<span class=\"token punctuation\">]</span><span class=\"token comment\"># cp confxml.xml confxml.xml.bak</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs sersync<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim confxml.xml</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">5</span>    <span class=\"token operator\">&lt;</span>fileSystem <span class=\"token assign-left variable\">xfs</span><span class=\"token operator\">=</span><span class=\"token string\">\"true\"</span>/<span class=\"token operator\">></span>    <span class=\"token comment\">#第 5 行 false 改为 true</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">13</span>          <span class=\"token operator\">&lt;</span>delete <span class=\"token assign-left variable\">start</span><span class=\"token operator\">=</span><span class=\"token string\">\"true\"</span>/<span class=\"token operator\">></span> <span class=\"token comment\">#第 13-20 行 false 改为 true,# 说明：监控以上变化推送</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">14</span>        <span class=\"token operator\">&lt;</span>createFolder <span class=\"token assign-left variable\">start</span><span class=\"token operator\">=</span><span class=\"token string\">\"true\"</span>/<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">15</span>        <span class=\"token operator\">&lt;</span>createFile <span class=\"token assign-left variable\">start</span><span class=\"token operator\">=</span><span class=\"token string\">\"false\"</span>/<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">16</span>        <span class=\"token operator\">&lt;</span>closeWrite <span class=\"token assign-left variable\">start</span><span class=\"token operator\">=</span><span class=\"token string\">\"true\"</span>/<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">17</span>        <span class=\"token operator\">&lt;</span>moveFrom <span class=\"token assign-left variable\">start</span><span class=\"token operator\">=</span><span class=\"token string\">\"true\"</span>/<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token number\">18</span>        <span class=\"token operator\">&lt;</span>moveTo <span class=\"token assign-left variable\">start</span><span class=\"token operator\">=</span><span class=\"token string\">\"true\"</span>/<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token number\">19</span>        <span class=\"token operator\">&lt;</span>attrib <span class=\"token assign-left variable\">start</span><span class=\"token operator\">=</span><span class=\"token string\">\"true\"</span>/<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token number\">20</span>        <span class=\"token operator\">&lt;</span>modify <span class=\"token assign-left variable\">start</span><span class=\"token operator\">=</span><span class=\"token string\">\"true\"</span>/<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token number\">24</span>        <span class=\"token operator\">&lt;</span>localpath <span class=\"token assign-left variable\">watch</span><span class=\"token operator\">=</span><span class=\"token string\">\"/data\"</span><span class=\"token operator\">></span>      <span class=\"token comment\">#监控的本地目录</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token number\">25</span>             <span class=\"token operator\">&lt;</span>remote <span class=\"token assign-left variable\">ip</span><span class=\"token operator\">=</span><span class=\"token string\">\"192.168.1.145\"</span> <span class=\"token assign-left variable\">name</span><span class=\"token operator\">=</span><span class=\"token string\">\"backup_file\"</span>/<span class=\"token operator\">></span>  <span class=\"token comment\">#rsync 服务端 IP 和模块名 backup_file</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token number\">30</span>      <span class=\"token operator\">&lt;</span>commonParams <span class=\"token assign-left variable\">params</span><span class=\"token operator\">=</span><span class=\"token string\">\"-avz\"</span>/<span class=\"token operator\">></span>  <span class=\"token comment\">#rsync 命令选项</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token number\">31</span>      <span class=\"token operator\">&lt;</span>auth <span class=\"token assign-left variable\">start</span><span class=\"token operator\">=</span><span class=\"token string\">\"true\"</span> <span class=\"token assign-left variable\">users</span><span class=\"token operator\">=</span><span class=\"token string\">\"rsync_backup\"</span> <span class=\"token assign-left variable\">passwordfile</span><span class=\"token operator\">=</span><span class=\"token string\">\"/etc/rsync.passwd\"</span>/<span class=\"token operator\">></span> <span class=\"token comment\">#rsync 认证信息</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr></table></figure><h5 id=\"24-生成密码文件\"><a class=\"anchor\" href=\"#24-生成密码文件\">#</a> 2.4 生成密码文件</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs sersync<span class=\"token punctuation\">]</span><span class=\"token comment\"># echo 'your passwd' > /etc/rsync.passwd</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs sersync<span class=\"token punctuation\">]</span><span class=\"token comment\"># chmod 600 /etc/rsync.passwd</span></pre></td></tr></table></figure><h5 id=\"25-启动sersync\"><a class=\"anchor\" href=\"#25-启动sersync\">#</a> 2.5 启动 sersync</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs sersync<span class=\"token punctuation\">]</span><span class=\"token comment\"># ln -s /usr/local/sersync/sersync2 /usr/bin/</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs sersync<span class=\"token punctuation\">]</span><span class=\"token comment\"># sersync2 -dro /usr/local/sersync/confxml.xml     #针对配置文件 confxml.xml 启动 sersync</span></pre></td></tr></table></figure><p><strong>2.5 设置 sersync 开机自启</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@qzj_nfs sersync<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim /etc/rc.d/rc.local   </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>/usr/local/sersync/sersync2 <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">-r</span> <span class=\"token parameter variable\">-o</span>  /usr/local/sersync/confxml.xml  <span class=\"token comment\">#在最后添加一行</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@qzj_nfs sersync<span class=\"token punctuation\">]</span><span class=\"token comment\"># chmod +x /etc/rc.d/rc.local</span></pre></td></tr></table></figure><p><strong>2.6 测试</strong></p>\n<p><em>在客户端 /data 目录增删改目录文件，rsync 服务端数据存放目录变化</em></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup backup<span class=\"token punctuation\">]</span><span class=\"token comment\"># watch ls</span></pre></td></tr></table></figure><p><strong>2.7 添加脚本监控 sersync 是否正常运行</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs sersync<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /scripts/check_sersync.sh </span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#!/bin/sh</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token assign-left variable\">sersync</span><span class=\"token operator\">=</span><span class=\"token string\">\"/usr/local/sersync/sersync2\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">confxml</span><span class=\"token operator\">=</span><span class=\"token string\">\"/usr/local/sersync/confxml.xml\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token assign-left variable\">status</span><span class=\"token operator\">=</span><span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">ps</span> aux <span class=\"token operator\">|</span><span class=\"token function\">grep</span> <span class=\"token string\">'sersync2'</span><span class=\"token operator\">|</span><span class=\"token function\">grep</span> <span class=\"token parameter variable\">-v</span> <span class=\"token string\">'grep'</span><span class=\"token operator\">|</span><span class=\"token function\">wc</span> <span class=\"token parameter variable\">-l</span><span class=\"token variable\">)</span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">if</span> <span class=\"token punctuation\">[</span> <span class=\"token variable\">$status</span> <span class=\"token parameter variable\">-eq</span> <span class=\"token number\">0</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">then</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token variable\">$sersync</span> <span class=\"token parameter variable\">-d</span> <span class=\"token parameter variable\">-r</span> <span class=\"token parameter variable\">-o</span> <span class=\"token variable\">$confxml</span> <span class=\"token operator\">&amp;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">else</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token builtin class-name\">exit</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">fi</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs sersync<span class=\"token punctuation\">]</span><span class=\"token comment\"># chmod +x /scripts/check_sersync.sh</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs sersync<span class=\"token punctuation\">]</span><span class=\"token comment\"># crontab -l</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>*/5 * * * * /usr/bin/sh /scripts/check_sersync.sh <span class=\"token operator\">&amp;></span> /dev/null</pre></td></tr></table></figure><p><em><strong>补充： 多实例情况</strong></em><br />\n 1、配置多个 confxml.xml 文件（比如：www、bbs、blog.... 等等）<br />\n2、修改端口、同步路径、模块名称<br />\n 3、根据不同的需求同步对应的实例文件<br />\n /usr/local/sersync/sersync2 -dro /usr/local/sersync/www_confxml.xml<br />\n/usr/local/sersync/sersync2 -dro /usr/local/sersync/bbs_confxml.xml</p>\n",
            "tags": [
                "rsync"
            ]
        },
        {
            "id": "http://ixuyong.cn/posts/430579059.html",
            "url": "http://ixuyong.cn/posts/430579059.html",
            "title": "NFS网络文件系统",
            "date_published": "2025-08-17T13:17:29.000Z",
            "content_html": "<h3 id=\"nfs网络文件系统\"><a class=\"anchor\" href=\"#nfs网络文件系统\">#</a> NFS 网络文件系统</h3>\n<h4 id=\"一-nfs基本概述\"><a class=\"anchor\" href=\"#一-nfs基本概述\">#</a> 一、NFS 基本概述</h4>\n<p>NFS 是 Network File System 的缩写及网络文件系统。</p>\n<p>NFS 的主要功能是通过” 局域网 “络让不同主机系统之间可以共享目录。</p>\n<h4 id=\"二-nfs实现原理\"><a class=\"anchor\" href=\"#二-nfs实现原理\">#</a> 二、NFS 实现原理</h4>\n<p><img loading=\"lazy\" data-src=\"https://wp-cdn.4ce.cn/v2/Lgm9nFf.png\" alt=\"1.png\" /></p>\n<p><strong>本地文件操作方式</strong></p>\n<p>1. 当用户执行 mkdir 命令，BashShell 无法完成该命令操作，会将其翻译给内核。</p>\n<p>2.Kernel 内核解析完成后会驱动对应的磁盘设备，完成创建目录的操作。</p>\n<p><strong>NFS 创建文件方式</strong></p>\n<p>1.NFS 客户端执行增、删等操作，客户端会使用不同的函数对该操作进行封装。</p>\n<p>2.NFS 客户端会通过 TCP/IP 的方式传递给 NFS 服务端。</p>\n<p>3.NFS 服务端接收到请求后，会先调用 portmap 进程进行端口映射。</p>\n<p>4.nfsd 进程用于判断 NFS 客户端是否拥有权限连接 NFS 服务端。</p>\n<p>5.Rpc.mount 进程判断客户端是否有对应的权限进行验证。</p>\n<p>6.idmap 进程实现用户映射和压缩。</p>\n<p>7. 最后 NFS 服务端会将客户端的函数转换为本地能执行的命令，由内核驱动硬件完成操作。</p>\n<p>注意：rpc 是一个远程过程调用，那么使用 nfs 必须有 rpc 服务</p>\n<h4 id=\"三-nfs服务实践\"><a class=\"anchor\" href=\"#三-nfs服务实践\">#</a> 三、NFS 服务实践</h4>\n<h5 id=\"31环境准备\"><a class=\"anchor\" href=\"#31环境准备\">#</a> 3.1 环境准备</h5>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">服务器系统</th>\n<th style=\"text-align:center\">角色</th>\n<th style=\"text-align:center\">外网 IP</th>\n<th style=\"text-align:center\">内网 IP</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">CentOS7.6</td>\n<td style=\"text-align:center\">NFS 服务端</td>\n<td style=\"text-align:center\">eth0:10.0.0.32</td>\n<td style=\"text-align:center\">eth1:172.16.1.32</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">CentOS7.6</td>\n<td style=\"text-align:center\">NFS 客服端</td>\n<td style=\"text-align:center\">eth0:10.0.0.31</td>\n<td style=\"text-align:center\">eth1:172.16.1.31</td>\n</tr>\n</tbody>\n</table>\n<h5 id=\"32-nfs服务安装\"><a class=\"anchor\" href=\"#32-nfs服务安装\">#</a> 3.2 NFS 服务安装</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum -y install nfs-utils</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim /etc/exports</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>/data <span class=\"token number\">172.16</span>.1.0/24<span class=\"token punctuation\">(</span>rw,sync,all_squash<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir /data</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chown -R nfsnobody.nfsnobody /data</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl enable nfs-server</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl restart nfs-server</span></pre></td></tr></table></figure><h5 id=\"33-nfs服务挂载\"><a class=\"anchor\" href=\"#33-nfs服务挂载\">#</a> 3.3 NFS 服务挂载</h5>\n<p>安装 nfs-utils 会自动启动 rpcbind 服务，执行 showmount -e 查看远程服务器 rpc 提供的可挂载 nfs 信息。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#1. 查询挂载</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs-client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum -y install nfs\u0002utils</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs-client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># showmount -e 172.16.1.32</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>Export list <span class=\"token keyword\">for</span> <span class=\"token number\">172.16</span>.1.32:</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>/data <span class=\"token number\">172.16</span>.1.0/24</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">#2. 执行挂载</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs-client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir /nfsdir</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs-client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mount -t nfs 172.16.1.32:/data /nfsdir</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs-client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># df –h</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">#3. 永久挂载</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs-client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim /etc/fstab</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token number\">172.16</span>.1.32:/data /nfsdir nfs defaults <span class=\"token number\">0</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\">#4. 执行卸载</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs-client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># umount /nfsdir</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">#注意：卸载的时候如果提示”umount.nfs: /nfsdir:device is busy”</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\">#1. 切换至其他目录，然后在进行卸载。</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">#2.NFS Server 宕机，强制卸载 umount -lf /nfsdir</span></pre></td></tr></table></figure><p>在企业工作场景，通常情况 NFS 服务器共享的只是普通静态数据（图片、附件、视频），不需要执行 suid、exec 等权限，挂载的这个文件系统只能作为数据存取之用，无法执行程序，对于客户端来讲增加了安全性。</p>\n<p>例如：很多木马篡改站点文件都是由上传入口上传的程序到存储目录，然后执行。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#通过 mount -o 指定挂载参数，禁止使用 suid，exec，增加安全性能</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs-client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mount -t nfs -o nosuid,noexec 172.16.1.31:/data /mnt</span></pre></td></tr></table></figure><h5 id=\"34-nfs配置详解\"><a class=\"anchor\" href=\"#34-nfs配置详解\">#</a> 3.4 NFS 配置详解</h5>\n<p>执行 man exports 命令，然后切换到文件结尾，可以快速查看如下样例格式：</p>\n<p>rw：读写权限</p>\n<p>ro：只读权限</p>\n<p>root_squash：当 NFS 客户端以 root 管理员访问时，映射为 NFS 服务器的匿名用户 (不常用)</p>\n<p>no_root_squash：当 NFS 客户端以 root 管理员访问时，映射为 NFS 服务器的 root 管理员 (不常用)</p>\n<p>all_squash：无论 NFS 客户端使用什么账户访问，均映射为 NFS 服务器的匿名用户 (常用)</p>\n<p>sync：同时将数据写入到内存与硬盘中，保证不丢失数据</p>\n<p>async：优先将数据保存到内存，然后再写入硬盘；这样效率更高，但可能会丢失数据</p>\n<p>anonuid：配置 all_squash 使用，指定 NFS 的用户 UID，必须存在系统</p>\n<p>anongid：配置 all_squash 使用，指定 NFS 的用户 GID，必须存在系统</p>\n<h5 id=\"35-验证ro权限\"><a class=\"anchor\" href=\"#35-验证ro权限\">#</a> 3.5 验证 ro 权限</h5>\n<p>1. 服务端修改 rw 为 ro 参数</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/exports</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>/data <span class=\"token number\">172.16</span>.1.0/24<span class=\"token punctuation\">(</span>ro,sync,all_squash<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl restart nfs-server</span></pre></td></tr></table></figure><p>2. 客户端验证</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs-client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mount -t nfs 172.16.1.32:/data /mnt</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs-client ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># df -h</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 发现无法正常写入文件</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup mnt<span class=\"token punctuation\">]</span><span class=\"token comment\"># touch file</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>touch: cannot <span class=\"token function\">touch</span> ‘file’: Read-only <span class=\"token function\">file</span> system</pre></td></tr></table></figure><h5 id=\"36-验证all_squash权限\"><a class=\"anchor\" href=\"#36-验证all_squash权限\">#</a> 3.6 验证 all_squash 权限</h5>\n<p>验证 all_squash、anonuid、anongid 权限</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#1.NFS 服务端配置，然后进行初始化操作</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/exports</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>/data <span class=\"token number\">172.16</span>.1.0/24<span class=\"token punctuation\">(</span>rw,sync,all_squash,anonuid<span class=\"token operator\">=</span><span class=\"token number\">666</span>,anongid<span class=\"token operator\">=</span><span class=\"token number\">666</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># groupadd -g 666 www</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># useradd -u 666 -g 666 www</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@nfs ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chown -R www.www /data/</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#2. 客户端验证，会发现客户端文件的权限为 666，但可以正常写入数据</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># umount /mnt/</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mount -t nfs 172.16.1.31:/data /mnt</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup mnt<span class=\"token punctuation\">]</span><span class=\"token comment\"># touch fff</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup mnt<span class=\"token punctuation\">]</span><span class=\"token comment\"># mkdir 111</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup mnt<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>drwxr-xr-x <span class=\"token number\">2</span> <span class=\"token number\">666</span> <span class=\"token number\">666</span> <span class=\"token number\">6</span> Sep <span class=\"token number\">3</span> 03:05 <span class=\"token number\">111</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>-rw-r--r-- <span class=\"token number\">1</span> <span class=\"token number\">666</span> <span class=\"token number\">666</span> <span class=\"token number\">0</span> Sep <span class=\"token number\">3</span> 03:05 fff</pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">#3. 建议，客户端也创建一个 uid 为 666，gid 为 666，统一身份，避免后续出现权限不足的情况</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup mnt<span class=\"token punctuation\">]</span><span class=\"token comment\"># groupadd -g 666 www</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup mnt<span class=\"token punctuation\">]</span><span class=\"token comment\"># useradd -g 666 -u 666 www</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup mnt<span class=\"token punctuation\">]</span><span class=\"token comment\"># id www</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token assign-left variable\">uid</span><span class=\"token operator\">=</span><span class=\"token number\">666</span><span class=\"token punctuation\">(</span>www<span class=\"token punctuation\">)</span> <span class=\"token assign-left variable\">gid</span><span class=\"token operator\">=</span><span class=\"token number\">666</span><span class=\"token punctuation\">(</span>www<span class=\"token punctuation\">)</span> <span class=\"token assign-left variable\">groups</span><span class=\"token operator\">=</span><span class=\"token number\">666</span><span class=\"token punctuation\">(</span>www<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">[</span>root@backup mnt<span class=\"token punctuation\">]</span><span class=\"token comment\"># ll /mnt/</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>total <span class=\"token number\">4</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>drwxr-xr-x <span class=\"token number\">2</span> www www <span class=\"token number\">6</span> Sep <span class=\"token number\">3</span> 03:05 <span class=\"token number\">111</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>-rw-r--r-- <span class=\"token number\">1</span> www www <span class=\"token number\">0</span> Sep <span class=\"token number\">3</span> 03:05 fff</pre></td></tr></table></figure>",
            "tags": [
                "Linux"
            ]
        },
        {
            "id": "http://ixuyong.cn/posts/2508697220.html",
            "url": "http://ixuyong.cn/posts/2508697220.html",
            "title": "Chrony时间同步服务",
            "date_published": "2025-08-16T11:40:03.000Z",
            "content_html": "<h3 id=\"chrony时间同步服务\"><a class=\"anchor\" href=\"#chrony时间同步服务\">#</a> Chrony 时间同步服务</h3>\n<h4 id=\"一-时间同步基本概念\"><a class=\"anchor\" href=\"#一-时间同步基本概念\">#</a> 一、时间同步基本概念</h4>\n<p>时间同步就是将本地时间与互联网时间进行校对，为系统提供一个统一时间的过程。由于本地时间的计时速率、运行环境不一致性。所有本地时钟纵使在某一刻被校准了 ，一段时间后，这些本地时钟也会出现不一致。为了本地时钟再次达到相同的时间值，所以需要进行时间同步的操作。</p>\n<h4 id=\"二-chrony时间服务\"><a class=\"anchor\" href=\"#二-chrony时间服务\">#</a> 二、Chrony 时间服务</h4>\n<h5 id=\"21-chrony介绍\"><a class=\"anchor\" href=\"#21-chrony介绍\">#</a> 2.1 Chrony 介绍</h5>\n<p>chrony 是基于 ntp 协议的实现时间同步服务，它既可以当做服务端，也可以充当客户端；</p>\n<ul>\n<li>1、chrony 是 NTP 的替代品，能更精确的时间和更快的速度同步时钟；</li>\n<li>2、chrony 占用系统资源少，只有被唤起时才占用少部分 CPU，chrony 兼容 ntpdate；</li>\n<li>3、chrony 允许本地网络其他主机像本地进行时间同步；</li>\n</ul>\n<p><img loading=\"lazy\" data-src=\"https://wp-cdn.4ce.cn/v2/21Dre4A.png\" alt=\"1.png\" /></p>\n<h5 id=\"22-chrony安装\"><a class=\"anchor\" href=\"#22-chrony安装\">#</a> 2.2 Chrony 安装</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@chrony ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum install chrony -y</span></pre></td></tr></table></figure><ul>\n<li>主配置文件：/etc/chrony.conf</li>\n<li>客户端程序：/usr/bin/chronyc</li>\n<li>服务端程序：/usr/sbin/chronyd</li>\n</ul>\n<h5 id=\"23-chrony服务端\"><a class=\"anchor\" href=\"#23-chrony服务端\">#</a> 2.3 Chrony 服务端</h5>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@chrony ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/chrony.conf</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">#使用同步的远程时钟源，理论上可以同步无限个</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>server <span class=\"token number\">0</span>.centos.pool.ntp.org iburst</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>server <span class=\"token number\">1</span>.centos.pool.ntp.org iburst</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>server <span class=\"token number\">2</span>.centos.pool.ntp.org iburst</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>server <span class=\"token number\">3</span>.centos.pool.ntp.org iburst</pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">#根据实际时间计算出服务器增减时间的比率，然后记录到一个文件中，在系统重启后为系统做出最佳时间补偿调整</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>driftfile /var/lib/chrony/drift</pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">#如果系统时钟的偏移量大于 1 秒，则允许系统时钟在前三次更新中步进</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>makestep <span class=\"token number\">1.0</span> <span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">#启用实时时钟（RTC）的内核同步</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>rtcsync</pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">#通过使用 hwtimestamp 指令启用硬件时间戳</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">#hwtimestamp *</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">#增加调整所需的可选择源的最小数量</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">#minsources 2</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\"># 允许指定网络的主机同步时间，不指定就是允许所有，默认不开启。</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>allow <span class=\"token number\">192.168</span>.0.0/16</pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token comment\"># 默认情况下本地服务器无法同步互联网时间时，可能会出现不精确，所以会拒绝提供授时服务；</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token comment\"># 开启此选项，则表示允许接受不精确时间，继续为客户端提供授时服务；</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token builtin class-name\">local</span> stratum <span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token comment\">#指定包含 NTP 身份验证密钥的文件</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token comment\">#keyfile /etc/chrony.keys</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token comment\">#指定日志文件</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>logdir /var/log/chrony</pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token comment\">#选择日志文件要记录的信息</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>log measurements statistics tracking</pre></td></tr></table></figure><p>1.Chrony 服务端配置，修改 /etc/chrony.conf 文件三处，设定外部时间服务器、允许内网同步此服务端、设置断网继续同步</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@Harbor ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat /etc/chrony.conf</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># Use public servers from the pool.ntp.org project.</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># Please consider joining the pool (https://www.pool.ntp.org/join.html).</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>server ntp.aliyun.com iburst</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\"># Allow NTP client access from local network.</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>allow <span class=\"token number\">192.168</span>.1.0/24</pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\"># Serve time even if not synchronized to a time source.</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token builtin class-name\">local</span> stratum <span class=\"token number\">10</span></pre></td></tr></table></figure><p>2. 重启 Chrony 服务</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@chrony ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl restart chronyd</span></pre></td></tr></table></figure><h5 id=\"24-chrony客户端\"><a class=\"anchor\" href=\"#24-chrony客户端\">#</a> 2.4 Chrony 客户端</h5>\n<p>1. 客户端使用 ntpdate 或 chronyc 命令的方式进行手动同步</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># ntpdate</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@chrony ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum install ntpdate -y</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>root@chrony ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ntpdate 192.168.1.68</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># chronyc</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@chrony ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chronyc -a makestep</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">200</span> OK</pre></td></tr></table></figure><p>2. 客户端使用 chrony 守护进程方式进行时间自动化同步</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@chrony ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># yum install chrony -y</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@chrony ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># vim /etc/chrony.conf</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 指向至服务端</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>server <span class=\"token number\">192.168</span>.1.68 iburst</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>root@chrony ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># systemctl restart chronyd</span></pre></td></tr></table></figure><p>3. 查看时间同步是否正常</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@chrony ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># chronyc sources</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">210</span> Number of sources <span class=\"token operator\">=</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>MS Name/IP address         Stratum Poll Reach LastRx Last sample               </pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">=</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>^* <span class=\"token number\">192.168</span>.1.68                  <span class=\"token number\">3</span>   <span class=\"token number\">6</span>    <span class=\"token number\">17</span>     <span class=\"token number\">1</span>  +1652ns<span class=\"token punctuation\">[</span>  +17us<span class=\"token punctuation\">]</span> +/-   32ms</pre></td></tr></table></figure>",
            "tags": [
                "Linux"
            ]
        },
        {
            "id": "http://ixuyong.cn/posts/2260957686.html",
            "url": "http://ixuyong.cn/posts/2260957686.html",
            "title": "Linux—Centos7修改网卡名称",
            "date_published": "2025-08-15T02:40:25.000Z",
            "content_html": "<h3 id=\"linuxcentos7修改网卡名称\"><a class=\"anchor\" href=\"#linuxcentos7修改网卡名称\">#</a> Linux—Centos7 修改网卡名称</h3>\n<p>首先我们先了解不同网卡名称对应的内核参数：</p>\n<ol>\n<li>biosdevname=0  net.ifnames=1：网卡名 “enp<em>s</em>” 此内核参数一般为默认</li>\n<li>biosdevname=1  net.ifnames=0：网卡名 “em*”</li>\n<li>biosdevname=0  net.ifnames=0：网卡名 “eth*”</li>\n</ol>\n<p>本次以将网卡名命名为 eth * 格式作示例</p>\n<h4 id=\"1-查看当前网卡的信息\"><a class=\"anchor\" href=\"#1-查看当前网卡的信息\">#</a> 1. 查看当前网卡的信息</h4>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ifconfig</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>ens33: <span class=\"token assign-left variable\">flags</span><span class=\"token operator\">=</span><span class=\"token number\">416</span><span class=\"token operator\"><span class=\"token file-descriptor important\">3</span>&lt;</span>UP,BROADCAST,RUNNING,MULTICAST<span class=\"token operator\">></span>  mtu <span class=\"token number\">1500</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        inet <span class=\"token number\">192.168</span>.40.88  netmask <span class=\"token number\">255.255</span>.255.0  broadcast <span class=\"token number\">192.168</span>.40.255</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        inet6 fe80::b92f:3dd3:19e7:1311  prefixlen <span class=\"token number\">64</span>  scopeid 0x2<span class=\"token operator\"><span class=\"token file-descriptor important\">0</span>&lt;</span>link<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        ether 00:0c:29:5e:a0:59  txqueuelen <span class=\"token number\">1000</span>  <span class=\"token punctuation\">(</span>Ethernet<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        RX packets <span class=\"token number\">75</span>  bytes <span class=\"token number\">8065</span> <span class=\"token punctuation\">(</span><span class=\"token number\">7.8</span> KiB<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        RX errors <span class=\"token number\">0</span>  dropped <span class=\"token number\">0</span>  overruns <span class=\"token number\">0</span>  frame <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        TX packets <span class=\"token number\">63</span>  bytes <span class=\"token number\">7754</span> <span class=\"token punctuation\">(</span><span class=\"token number\">7.5</span> KiB<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        TX errors <span class=\"token number\">0</span>  dropped <span class=\"token number\">0</span> overruns <span class=\"token number\">0</span>  carrier <span class=\"token number\">0</span>  collisions <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>lo: <span class=\"token assign-left variable\">flags</span><span class=\"token operator\">=</span><span class=\"token number\">7</span><span class=\"token operator\"><span class=\"token file-descriptor important\">3</span>&lt;</span>UP,LOOPBACK,RUNNING<span class=\"token operator\">></span>  mtu <span class=\"token number\">65536</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        inet <span class=\"token number\">127.0</span>.0.1  netmask <span class=\"token number\">255.0</span>.0.0</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        inet6 ::1  prefixlen <span class=\"token number\">128</span>  scopeid 0x1<span class=\"token operator\"><span class=\"token file-descriptor important\">0</span>&lt;</span>host<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        loop  txqueuelen <span class=\"token number\">1000</span>  <span class=\"token punctuation\">(</span>Local Loopback<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        RX packets <span class=\"token number\">0</span>  bytes <span class=\"token number\">0</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0.0</span> B<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        RX errors <span class=\"token number\">0</span>  dropped <span class=\"token number\">0</span>  overruns <span class=\"token number\">0</span>  frame <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        TX packets <span class=\"token number\">0</span>  bytes <span class=\"token number\">0</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0.0</span> B<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        TX errors <span class=\"token number\">0</span>  dropped <span class=\"token number\">0</span> overruns <span class=\"token number\">0</span>  carrier <span class=\"token number\">0</span>  collisions <span class=\"token number\">0</span></pre></td></tr></table></figure><h4 id=\"2-修改配置文件\"><a class=\"anchor\" href=\"#2-修改配置文件\">#</a> 2 . 修改配置文件</h4>\n<p>（1）在下列路径下找到 ifcgf-ens33</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cd /etc/sysconfig/network-scripts/</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager network-scripts<span class=\"token punctuation\">]</span><span class=\"token comment\"># ls</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>ifcfg-ens33  ifdown-ippp  ifdown-routes    <span class=\"token function\">ifup</span>          ifup-ipv6   ifup-ppp       ifup-tunnel</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>ifcfg-lo     ifdown-ipv6  ifdown-sit       ifup-aliases  ifup-isdn   ifup-routes    ifup-wireless</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">ifdown</span>       ifdown-isdn  ifdown-Team      ifup-bnep     ifup-plip   ifup-sit       init.ipv6-global</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>ifdown-bnep  ifdown-post  ifdown-TeamPort  ifup-eth      ifup-plusb  ifup-Team      network-functions</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>ifdown-eth   ifdown-ppp   ifdown-tunnel    ifup-ippp     ifup-post   ifup-TeamPort  network-functions-ipv6</pre></td></tr></table></figure><p>（2）使用 MV 命令，修改当前网卡的名称</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># mv ifcfg-ens33 ifcfg-eth0</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager network-scripts<span class=\"token punctuation\">]</span><span class=\"token comment\"># ls</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>ifcfg-eth0   ifdown-ippp  ifdown-routes    <span class=\"token function\">ifup</span>          ifup-ipv6   ifup-ppp       ifup-tunnel</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>ifcfg-lo     ifdown-ipv6  ifdown-sit       ifup-aliases  ifup-isdn   ifup-routes    ifup-wireless</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token function\">ifdown</span>       ifdown-isdn  ifdown-Team      ifup-bnep     ifup-plip   ifup-sit       init.ipv6-global</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>ifdown-bnep  ifdown-post  ifdown-TeamPort  ifup-eth      ifup-plusb  ifup-Team      network-functions</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>ifdown-eth   ifdown-ppp   ifdown-tunnel    ifup-ippp     ifup-post   ifup-TeamPort  network-functions-ipv6</pre></td></tr></table></figure><p>（3）同步修改网卡配置文件中的 name 和 device，修改为需要配置网卡的名字</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token assign-left variable\">NAME</span><span class=\"token operator\">=</span><span class=\"token string\">\"ens33\"</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token assign-left variable\">DEVICE</span><span class=\"token operator\">=</span><span class=\"token string\">\"ens33\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre> </pre></td></tr><tr><td data-num=\"4\"></td><td><pre>将上列命令修改为</pre></td></tr><tr><td data-num=\"5\"></td><td><pre> </pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token assign-left variable\">NAME</span><span class=\"token operator\">=</span><span class=\"token string\">\"eth0\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token assign-left variable\">DEVICE</span><span class=\"token operator\">=</span><span class=\"token string\">\"eth0\"</span></pre></td></tr></table></figure><p>（4）修改 grub</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># cd /etc/default/</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">#编辑内核信息，在 GRUB_CMDLINE_LINUX 行添加字段 net.ifnames=0 biosdevname=0</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager default<span class=\"token punctuation\">]</span><span class=\"token comment\"># cat grub </span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token assign-left variable\">GRUB_TIMEOUT</span><span class=\"token operator\">=</span><span class=\"token number\">5</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token assign-left variable\">GRUB_DISTRIBUTOR</span><span class=\"token operator\">=</span><span class=\"token string\">\"<span class=\"token variable\"><span class=\"token variable\">$(</span><span class=\"token function\">sed</span> <span class=\"token string\">'s, release .*$,,g'</span> /etc/system-release<span class=\"token variable\">)</span></span>\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token assign-left variable\">GRUB_DEFAULT</span><span class=\"token operator\">=</span>saved</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token assign-left variable\">GRUB_DISABLE_SUBMENU</span><span class=\"token operator\">=</span>true</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token assign-left variable\">GRUB_TERMINAL_OUTPUT</span><span class=\"token operator\">=</span><span class=\"token string\">\"console\"</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token assign-left variable\">GRUB_CMDLINE_LINUX</span><span class=\"token operator\">=</span><span class=\"token string\">\"crashkernel=auto rhgb net.ifnames=0 biosdevname=0 quiet\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token assign-left variable\">GRUB_DISABLE_RECOVERY</span><span class=\"token operator\">=</span><span class=\"token string\">\"true\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">#生成启动菜单</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager default<span class=\"token punctuation\">]</span><span class=\"token comment\"># grub2-mkconfig -o /boot/grub2/grub.cfg</span></pre></td></tr></table></figure><p>（5）完成之后 reboot 重启系统即可</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager default<span class=\"token punctuation\">]</span><span class=\"token comment\"># reboot</span></pre></td></tr></table></figure><p>（6）使用 ifconfig 即可查看</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>root@manager ~<span class=\"token punctuation\">]</span><span class=\"token comment\"># ifconfig</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>eth0: <span class=\"token assign-left variable\">flags</span><span class=\"token operator\">=</span><span class=\"token number\">416</span><span class=\"token operator\"><span class=\"token file-descriptor important\">3</span>&lt;</span>UP,BROADCAST,RUNNING,MULTICAST<span class=\"token operator\">></span>  mtu <span class=\"token number\">1500</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        inet <span class=\"token number\">192.168</span>.40.88  netmask <span class=\"token number\">255.255</span>.255.0  broadcast <span class=\"token number\">192.168</span>.40.255</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        inet6 fe80::63d4:467f:9b76:e34f  prefixlen <span class=\"token number\">64</span>  scopeid 0x2<span class=\"token operator\"><span class=\"token file-descriptor important\">0</span>&lt;</span>link<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        inet6 fe80::1856:7b0:9d1e:7208  prefixlen <span class=\"token number\">64</span>  scopeid 0x2<span class=\"token operator\"><span class=\"token file-descriptor important\">0</span>&lt;</span>link<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        ether 00:0c:29:5e:a0:59  txqueuelen <span class=\"token number\">1000</span>  <span class=\"token punctuation\">(</span>Ethernet<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        RX packets <span class=\"token number\">77</span>  bytes <span class=\"token number\">8117</span> <span class=\"token punctuation\">(</span><span class=\"token number\">7.9</span> KiB<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        RX errors <span class=\"token number\">0</span>  dropped <span class=\"token number\">0</span>  overruns <span class=\"token number\">0</span>  frame <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        TX packets <span class=\"token number\">62</span>  bytes <span class=\"token number\">7842</span> <span class=\"token punctuation\">(</span><span class=\"token number\">7.6</span> KiB<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        TX errors <span class=\"token number\">0</span>  dropped <span class=\"token number\">0</span> overruns <span class=\"token number\">0</span>  carrier <span class=\"token number\">0</span>  collisions <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>lo: <span class=\"token assign-left variable\">flags</span><span class=\"token operator\">=</span><span class=\"token number\">7</span><span class=\"token operator\"><span class=\"token file-descriptor important\">3</span>&lt;</span>UP,LOOPBACK,RUNNING<span class=\"token operator\">></span>  mtu <span class=\"token number\">65536</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        inet <span class=\"token number\">127.0</span>.0.1  netmask <span class=\"token number\">255.0</span>.0.0</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        inet6 ::1  prefixlen <span class=\"token number\">128</span>  scopeid 0x1<span class=\"token operator\"><span class=\"token file-descriptor important\">0</span>&lt;</span>host<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        loop  txqueuelen <span class=\"token number\">1000</span>  <span class=\"token punctuation\">(</span>Local Loopback<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        RX packets <span class=\"token number\">0</span>  bytes <span class=\"token number\">0</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0.0</span> B<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        RX errors <span class=\"token number\">0</span>  dropped <span class=\"token number\">0</span>  overruns <span class=\"token number\">0</span>  frame <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        TX packets <span class=\"token number\">0</span>  bytes <span class=\"token number\">0</span> <span class=\"token punctuation\">(</span><span class=\"token number\">0.0</span> B<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        TX errors <span class=\"token number\">0</span>  dropped <span class=\"token number\">0</span> overruns <span class=\"token number\">0</span>  carrier <span class=\"token number\">0</span>  collisions <span class=\"token number\">0</span></pre></td></tr></table></figure>",
            "tags": [
                "Linux"
            ]
        },
        {
            "id": "http://ixuyong.cn/posts/581151773.html",
            "url": "http://ixuyong.cn/posts/581151773.html",
            "title": "100个运维相关技术官网汇总",
            "date_published": "2025-06-19T13:16:37.000Z",
            "content_html": "<h3 id=\"100个运维相关技术官网大汇总\"><a class=\"anchor\" href=\"#100个运维相关技术官网大汇总\">#</a> 100 个运维相关技术官网大汇总</h3>\n<h4 id=\"1-操作系统官网\"><a class=\"anchor\" href=\"#1-操作系统官网\">#</a> <strong>1. 操作系统官网</strong></h4>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">名称</th>\n<th style=\"text-align:left\">官网链接</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">Ubuntu</td>\n<td style=\"text-align:left\"><a href=\"https://ubuntu.com\">https://ubuntu.com</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Debian</td>\n<td style=\"text-align:left\"><a href=\"https://www.debian.org\">https://www.debian.org</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">RHEL</td>\n<td style=\"text-align:left\"><a href=\"https://www.redhat.com\">https://www.redhat.com</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Rocky Linux</td>\n<td style=\"text-align:left\"><a href=\"https://rockylinux.org\">https://rockylinux.org</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">AlmaLinux</td>\n<td style=\"text-align:left\"><a href=\"https://almalinux.org\">https://almalinux.org</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Arch Wiki</td>\n<td style=\"text-align:left\"><a href=\"https://wiki.archlinux.org\">https://wiki.archlinux.org</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">麒麟系统</td>\n<td style=\"text-align:left\"><a href=\"https://www.kylinos.cn/\">https://www.kylinos.cn/</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">统信系统</td>\n<td style=\"text-align:left\"><a href=\"https://uniontech.com/\">https://uniontech.com/</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">openEuler</td>\n<td style=\"text-align:left\"><a href=\"https://www.openeuler.org/zh/\">https://www.openeuler.org/zh/</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">正版操作系统</td>\n<td style=\"text-align:left\"><a href=\"https://msdn.itellyou.cn/\">https://msdn.itellyou.cn/</a></td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"2-开源镜像站\"><a class=\"anchor\" href=\"#2-开源镜像站\">#</a> <strong>2. 开源镜像站</strong></h4>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">镜像源名称</th>\n<th style=\"text-align:left\">官网链接</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">清华大学镜像站</td>\n<td style=\"text-align:left\"><a href=\"https://mirrors.tuna.tsinghua.edu.cn\">https://mirrors.tuna.tsinghua.edu.cn</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">中科大镜像站</td>\n<td style=\"text-align:left\"><a href=\"https://mirrors.ustc.edu.cn\">https://mirrors.ustc.edu.cn</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">阿里云镜像站</td>\n<td style=\"text-align:left\"><a href=\"https://developer.aliyun.com/mirror\">https://developer.aliyun.com/mirror</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">华为云镜像站</td>\n<td style=\"text-align:left\"><a href=\"https://mirrors.huaweicloud.com\">https://mirrors.huaweicloud.com</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">中国科技网镜像</td>\n<td style=\"text-align:left\"><a href=\"https://mirrors.cstcloud.cn\">https://mirrors.cstcloud.cn</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">网易开源镜像站</td>\n<td style=\"text-align:left\"><a href=\"http://mirrors.163.com\">http://mirrors.163.com</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">腾讯云镜像站</td>\n<td style=\"text-align:left\"><a href=\"https://mirrors.cloud.tencent.com\">https://mirrors.cloud.tencent.com</a></td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"3-容器与-kubernetes\"><a class=\"anchor\" href=\"#3-容器与-kubernetes\">#</a> <strong>3. 容器与 Kubernetes</strong></h4>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">名称</th>\n<th style=\"text-align:left\">官网链接</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">Docker</td>\n<td style=\"text-align:left\"><a href=\"https://www.docker.com\">https://www.docker.com</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Kubernetes</td>\n<td style=\"text-align:left\"><a href=\"https://kubernetes.io\">https://kubernetes.io</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Helm</td>\n<td style=\"text-align:left\"><a href=\"https://helm.sh\">https://helm.sh</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Podman</td>\n<td style=\"text-align:left\"><a href=\"https://podman.io\">https://podman.io</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">containerd</td>\n<td style=\"text-align:left\"><a href=\"https://containerd.io\">https://containerd.io</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">K3s</td>\n<td style=\"text-align:left\"><a href=\"https://k3s.io\">https://k3s.io</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Rancher</td>\n<td style=\"text-align:left\"><a href=\"https://www.rancher.com/\">https://www.rancher.com/</a></td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"4-云平台\"><a class=\"anchor\" href=\"#4-云平台\">#</a> <strong>4. 云平台</strong></h4>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">名称</th>\n<th style=\"text-align:left\">官网链接</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">AWS</td>\n<td style=\"text-align:left\"><a href=\"https://aws.amazon.com\">https://aws.amazon.com</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Azure</td>\n<td style=\"text-align:left\"><a href=\"https://azure.microsoft.com\">https://azure.microsoft.com</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">阿里云</td>\n<td style=\"text-align:left\"><a href=\"https://www.aliyun.com\">https://www.aliyun.com</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">腾讯云</td>\n<td style=\"text-align:left\"><a href=\"https://cloud.tencent.com\">https://cloud.tencent.com</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">华为云</td>\n<td style=\"text-align:left\"><a href=\"https://www.huaweicloud.com\">https://www.huaweicloud.com</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">天翼云</td>\n<td style=\"text-align:left\"><a href=\"https://www.ctyun.cn/\">https://www.ctyun.cn/</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">OpenStack</td>\n<td style=\"text-align:left\"><a href=\"https://www.openstack.org\">https://www.openstack.org</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">CNCF Landscape</td>\n<td style=\"text-align:left\"><a href=\"https://landscape.cncf.io\">https://landscape.cncf.io</a></td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"5-数据库\"><a class=\"anchor\" href=\"#5-数据库\">#</a> <strong>5. 数据库</strong></h4>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">名称</th>\n<th style=\"text-align:left\">官网链接</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">MySQL</td>\n<td style=\"text-align:left\"><a href=\"https://www.mysql.com\">https://www.mysql.com</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Oracle</td>\n<td style=\"text-align:left\"><a href=\"https://www.oracle.com/\">https://www.oracle.com/</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">PostgreSQL</td>\n<td style=\"text-align:left\"><a href=\"https://www.postgresql.org\">https://www.postgresql.org</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">MariaDB</td>\n<td style=\"text-align:left\"><a href=\"https://mariadb.org\">https://mariadb.org</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">MongoDB</td>\n<td style=\"text-align:left\"><a href=\"https://www.mongodb.com\">https://www.mongodb.com</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Redis</td>\n<td style=\"text-align:left\"><a href=\"https://redis.io\">https://redis.io</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Memcached</td>\n<td style=\"text-align:left\"><a href=\"https://memcached.org\">https://memcached.org</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">达梦数据库</td>\n<td style=\"text-align:left\"><a href=\"https://www.dameng.com/\">https://www.dameng.com/</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">OceanBase</td>\n<td style=\"text-align:left\"><a href=\"https://www.oceanbase.com/\">https://www.oceanbase.com/</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Elasticsearch</td>\n<td style=\"text-align:left\"><a href=\"https://www.elastic.co/elasticsearch/\">https://www.elastic.co/elasticsearch/</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">ClickHouse</td>\n<td style=\"text-align:left\"><a href=\"https://clickhouse.com\">https://clickhouse.com</a></td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"6-基础服务\"><a class=\"anchor\" href=\"#6-基础服务\">#</a> <strong>6. 基础服务</strong></h4>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">名称</th>\n<th style=\"text-align:left\">官网链接</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">Nginx</td>\n<td style=\"text-align:left\"><a href=\"https://nginx.org\">https://nginx.org</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Apache HTTPD</td>\n<td style=\"text-align:left\"><a href=\"https://httpd.apache.org\">https://httpd.apache.org</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Tomcat</td>\n<td style=\"text-align:left\"><a href=\"https://tomcat.apache.org/\">https://tomcat.apache.org/</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">HAProxy</td>\n<td style=\"text-align:left\"><a href=\"https://www.haproxy.org\">https://www.haproxy.org</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Dnsmasq</td>\n<td style=\"text-align:left\"><a href=\"https://thekelleys.org.uk/dnsmasq/doc.html\">https://thekelleys.org.uk/dnsmasq/doc.html</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">CoreDNS</td>\n<td style=\"text-align:left\"><a href=\"https://coredns.io\">https://coredns.io</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">RabbitMQ</td>\n<td style=\"text-align:left\"><a href=\"https://www.rabbitmq.com\">https://www.rabbitmq.com</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Kafka</td>\n<td style=\"text-align:left\"><a href=\"https://kafka.apache.org\">https://kafka.apache.org</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Etcd</td>\n<td style=\"text-align:left\"><a href=\"https://etcd.io\">https://etcd.io</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Consul</td>\n<td style=\"text-align:left\"><a href=\"https://www.consul.io\">https://www.consul.io</a></td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"7-cicd-与服务网格\"><a class=\"anchor\" href=\"#7-cicd-与服务网格\">#</a> <strong>7. CI/CD 与服务网格</strong></h4>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">名称</th>\n<th style=\"text-align:left\">官网链接</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">Jenkins</td>\n<td style=\"text-align:left\"><a href=\"https://www.jenkins.io\">https://www.jenkins.io</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">GitLab CI/CD</td>\n<td style=\"text-align:left\"><a href=\"https://about.gitlab.com\">https://about.gitlab.com</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">GitHub Actions</td>\n<td style=\"text-align:left\"><a href=\"https://github.com/features/actions\">https://github.com/features/actions</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">ArgoCD</td>\n<td style=\"text-align:left\"><a href=\"https://argo-cd.readthedocs.io/\">https://argo-cd.readthedocs.io/</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Spinnaker</td>\n<td style=\"text-align:left\"><a href=\"https://spinnaker.io\">https://spinnaker.io</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Istio</td>\n<td style=\"text-align:left\"><a href=\"https://istio.io/\">https://istio.io/</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Envoy Proxy</td>\n<td style=\"text-align:left\"><a href=\"https://www.envoyproxy.io\">https://www.envoyproxy.io</a></td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"8-监控与日志系统\"><a class=\"anchor\" href=\"#8-监控与日志系统\">#</a> <strong>8. 监控与日志系统</strong></h4>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">名称</th>\n<th style=\"text-align:left\">官网链接</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">Prometheus</td>\n<td style=\"text-align:left\"><a href=\"https://prometheus.io\">https://prometheus.io</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Grafana</td>\n<td style=\"text-align:left\"><a href=\"https://grafana.com\">https://grafana.com</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Loki</td>\n<td style=\"text-align:left\"><a href=\"https://grafana.com/oss/loki/\">https://grafana.com/oss/loki/</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">ELK Stack</td>\n<td style=\"text-align:left\"><a href=\"https://www.elastic.co/what-is/elk-stack\">https://www.elastic.co/what-is/elk-stack</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Kibana</td>\n<td style=\"text-align:left\"><a href=\"https://www.elastic.co/kibana/\">https://www.elastic.co/kibana/</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Fluentd</td>\n<td style=\"text-align:left\"><a href=\"https://www.fluentd.org\">https://www.fluentd.org</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Zabbix</td>\n<td style=\"text-align:left\"><a href=\"https://www.zabbix.com\">https://www.zabbix.com</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Netdata</td>\n<td style=\"text-align:left\"><a href=\"https://www.netdata.cloud\">https://www.netdata.cloud</a></td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"9-自动化运维工具\"><a class=\"anchor\" href=\"#9-自动化运维工具\">#</a> <strong>9. 自动化运维工具</strong></h4>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">名称</th>\n<th style=\"text-align:left\">官网链接</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">Ansible</td>\n<td style=\"text-align:left\"><a href=\"https://docs.ansible.com/\">https://docs.ansible.com/</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Terraform</td>\n<td style=\"text-align:left\"><a href=\"https://developer.hashicorp.com/terraform/docs\">https://developer.hashicorp.com/terraform/docs</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">SaltStack</td>\n<td style=\"text-align:left\"><a href=\"https://docs.saltproject.io/\">https://docs.saltproject.io/</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Puppet</td>\n<td style=\"text-align:left\"><a href=\"https://puppet.com/docs/\">https://puppet.com/docs/</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Chef</td>\n<td style=\"text-align:left\"><a href=\"https://docs.chef.io/\">https://docs.chef.io/</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Packer</td>\n<td style=\"text-align:left\"><a href=\"https://developer.hashicorp.com/packer/docs\">https://developer.hashicorp.com/packer/docs</a></td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"10-运维常用工具\"><a class=\"anchor\" href=\"#10-运维常用工具\">#</a> <strong>10. 运维常用工具</strong></h4>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">工具名称</th>\n<th style=\"text-align:left\">官网链接</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">Xshell</td>\n<td style=\"text-align:left\"><a href=\"https://www.netsarang.com/zh/xshell/\">https://www.netsarang.com/zh/xshell/</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Xftp</td>\n<td style=\"text-align:left\"><a href=\"https://www.netsarang.com/en/xftp/\">https://www.netsarang.com/en/xftp/</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">MobaXterm</td>\n<td style=\"text-align:left\"><a href=\"https://mobaxterm.mobatek.net\">https://mobaxterm.mobatek.net</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">PuTTY</td>\n<td style=\"text-align:left\"><a href=\"https://www.putty.org\">https://www.putty.org</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">SecureCRT</td>\n<td style=\"text-align:left\"><a href=\"https://www.vandyke.com/products/securecrt/\">https://www.vandyke.com/products/securecrt/</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">WinSCP</td>\n<td style=\"text-align:left\"><a href=\"https://winscp.net\">https://winscp.net</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">FileZilla</td>\n<td style=\"text-align:left\"><a href=\"https://filezilla-project.org\">https://filezilla-project.org</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">FastCopy</td>\n<td style=\"text-align:left\"><a href=\"https://fastcopy.jp/en/\">https://fastcopy.jp/en/</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Everything</td>\n<td style=\"text-align:left\"><a href=\"https://www.voidtools.com\">https://www.voidtools.com</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Wireshark</td>\n<td style=\"text-align:left\"><a href=\"https://www.wireshark.org\">https://www.wireshark.org</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">VirtualBox</td>\n<td style=\"text-align:left\"><a href=\"https://www.virtualbox.org/\">https://www.virtualbox.org/</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">VMware Workstation</td>\n<td style=\"text-align:left\"><a href=\"https://www.vmware.com/products/workstation-pro.html\">https://www.vmware.com/products/workstation-pro.html</a></td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"11-数据库可视化连接工具\"><a class=\"anchor\" href=\"#11-数据库可视化连接工具\">#</a> <strong>11. 数据库可视化连接工具</strong></h4>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:left\">工具名称</th>\n<th style=\"text-align:left\">官网链接</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:left\">DBeaver</td>\n<td style=\"text-align:left\"><a href=\"https://dbeaver.io\">https://dbeaver.io</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Navicat</td>\n<td style=\"text-align:left\"><a href=\"https://www.navicat.com\">https://www.navicat.com</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">HeidiSQL</td>\n<td style=\"text-align:left\"><a href=\"https://www.heidisql.com\">https://www.heidisql.com</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">SSMS</td>\n<td style=\"text-align:left\"><a href=\"https://learn.microsoft.com/sql/ssms/\">https://learn.microsoft.com/sql/ssms/</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">Toad for Oracle</td>\n<td style=\"text-align:left\"><a href=\"https://www.toadworld.com/products/toad-for-oracle\">https://www.toadworld.com/products/toad-for-oracle</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">SQL Developer</td>\n<td style=\"text-align:left\"><a href=\"https://www.oracle.com/database/sqldeveloper/\">https://www.oracle.com/database/sqldeveloper/</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">DbVisualizer</td>\n<td style=\"text-align:left\"><a href=\"https://www.dbvis.com\">https://www.dbvis.com</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">SQL Workbench</td>\n<td style=\"text-align:left\"><a href=\"https://www.sql-workbench.eu\">https://www.sql-workbench.eu</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">phpMyAdmin</td>\n<td style=\"text-align:left\"><a href=\"https://www.phpmyadmin.net\">https://www.phpmyadmin.net</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">pgAdmin</td>\n<td style=\"text-align:left\"><a href=\"https://www.pgadmin.org\">https://www.pgadmin.org</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">MongoDB Compass</td>\n<td style=\"text-align:left\"><a href=\"https://www.mongodb.com/products/compass\">https://www.mongodb.com/products/compass</a></td>\n</tr>\n<tr>\n<td style=\"text-align:left\">RedisInsight</td>\n<td style=\"text-align:left\"><a href=\"https://redis.com/redis-enterprise/redis-insight/\">https://redis.com/redis-enterprise/redis-insight/</a></td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"12-实用工具\"><a class=\"anchor\" href=\"#12-实用工具\">#</a> 12. 实用工具</h4>\n<table>\n<thead>\n<tr>\n<th>工具名称</th>\n<th>官网链接</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>图床工具</td>\n<td><a href=\"https://wp-cdn.4ce.cn/\">https://wp-cdn.4ce.cn/</a></td>\n</tr>\n<tr>\n<td>科学上网</td>\n<td><a href=\"https://ikuuu.one/auth/register\">https://ikuuu.one/auth/register</a></td>\n</tr>\n<tr>\n<td>截图工具</td>\n<td><a href=\"https://pixpin.cn/\">https://pixpin.cn/</a></td>\n</tr>\n<tr>\n<td>FileZilla</td>\n<td><a href=\"https://www.filezilla.cn/download/client\">https://www.filezilla.cn/download/client</a></td>\n</tr>\n<tr>\n<td>在线工具</td>\n<td><a href=\"https://tool.lu/\">https://tool.lu/</a></td>\n</tr>\n<tr>\n<td>LOGO</td>\n<td><a href=\"https://favicon.io/\">https://favicon.io/</a></td>\n</tr>\n</tbody>\n</table>\n<h4 id=\"13-收藏博客\"><a class=\"anchor\" href=\"#13-收藏博客\">#</a> 13. 收藏博客</h4>\n<table>\n<thead>\n<tr>\n<th>昵称</th>\n<th>博客链接</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>小粉优化大师</td>\n<td><a href=\"https://www.cnblogs.com/ygbh/p/17384988.html\">https://www.cnblogs.com/ygbh/p/17384988.html</a></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n</tr>\n</tbody>\n</table>\n",
            "tags": [
                "Linux"
            ]
        }
    ]
}