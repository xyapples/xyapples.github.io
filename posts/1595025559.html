<!-- build time:Sun Sep 07 2025 22:02:09 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta http-equiv="X-UA-COMPATIBLE" content="IE=edge,chrome=1"><meta name="renderer" content="webkit"><link rel="icon" type="image/ico" sizes="32x32" href="/assets/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon.ico"><link rel="alternate" href="/rss.xml" title="LinuxSre云原生" type="application/rss+xml"><link rel="alternate" href="/atom.xml" title="LinuxSre云原生" type="application/atom+xml"><link rel="alternate" type="application/json" title="LinuxSre云原生" href="http://ixuyong.cn/feed.json"><link rel="preconnect" href="https://s4.zstatic.net"><link rel="preconnect" href="https://at.alicdn.com"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7CFredericka%20the%20Great:400,400italic,700,700italic%7CNoto%20Serif%20JP:400,400italic,700,700italic%7CNoto%20Serif%20SC:400,400italic,700,700italic%7CInconsolata:400,400italic,700,700italic&display=swap&subset=latin,latin-ext" media="none" onload="this.media&#x3D;&#39;all&#39;"><link rel="stylesheet" href="/css/app.css?v=0.4.17"><link rel="modulepreload" href="/js/chunk-GV364XSK.js"><link rel="modulepreload" href="/js/chunk-NYSE5UKM.js"><link rel="modulepreload" href="/js/chunk-RONCYO2S.js"><link rel="modulepreload" href="/js/chunk-THHXCRSX.js"><link rel="modulepreload" href="/js/chunk-WIQECBEN.js"><link rel="modulepreload" href="/js/comments-DL2IYMPZ.js"><link rel="modulepreload" href="/js/copy-tex-NADCTXPG.js"><link rel="modulepreload" href="/js/post-DA635IH6.js"><link rel="modulepreload" href="/js/quicklink-WEDHL4BA.js"><link rel="modulepreload" href="/js/search-VCZRKTM5.js"><link rel="modulepreload" href="/js/siteInit.js"><link rel="modulepreload" href="/js/waline-NNBYRQEE.js"><link rel="stylesheet" href="/css/comments-F4ZGS7LD.css" media="none" onload="this.media&#x3D;&#39;all&#39;"><link rel="stylesheet" href="/css/siteInit.css" media="none" onload="this.media&#x3D;&#39;all&#39;"><link rel="stylesheet" href="/css/waline-IDNZKML2.css" media="none" onload="this.media&#x3D;&#39;all&#39;"><link rel="preload" href="https://s21.ax1x.com/2025/03/29/pEsS0hD.png" as="image" fetchpriority="high"><meta name="keywords" content="Prometheus"><meta name="description" content="专注于 Linux 运维、云计算、云原⽣等技术"><link rel="canonical" href="http://ixuyong.cn/posts/1595025559.html"><title>Prometheus监控实战（一）</title><meta name="generator" content="Hexo 7.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">Prometheus监控实战（一）</h1><div class="meta"><span class="item" title="创建时间：2025-08-10 10:33:41"><span class="icon"><i class="ic i-calendar"></i></span><span class="text">发表于</span><time itemprop="dateCreated datePublished" datetime="2025-08-10T10:33:41+08:00">2025-08-10</time></span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i></span><span class="text">本文字数</span><span>26k</span><span class="text">字</span></span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i></span><span class="text">阅读时长</span><span>24 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span><span class="line"></span><span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">LinuxSre云原生</a></li></ul><ul class="right" id="rightNav"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div class="pjax" id="imgs"><img src="https://s21.ax1x.com/2025/03/29/pEsS0hD.png" loading="eager" decoding="async" fetchpriority="high" alt="LinuxSre云原生"></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"></path></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"></use><use xlink:href="#gentle-wave" x="48" y="3"></use><use xlink:href="#gentle-wave" x="48" y="5"></use><use xlink:href="#gentle-wave" x="48" y="7"></use></g></svg></div><main><div class="inner"><div class="pjax" id="main"><div class="article wrap"><div class="breadcrumb" itemlistelement itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i><span><a href="/">首页</a></span><i class="ic i-angle-right"></i><span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/Prometheus/" itemprop="item" rel="index" title="分类于Prometheus"><span itemprop="name">Prometheus<meta itemprop="position" content="0"></span></a></span></div><article class="post block" itemscope itemtype="http://schema.org/Article" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://ixuyong.cn/posts/1595025559.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/assets/avatar.png"><meta itemprop="name" content="Xu Yong"><meta itemprop="description" content="致力于技术布道、普及前沿技术、打造云原生系列标杆博客, 专注于 Linux 运维、云计算、云原⽣等技术"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="LinuxSre云原生"></span><div class="body md" itemprop="articleBody"><h3 id="prometheus监控实战一"><a class="anchor" href="#prometheus监控实战一">#</a> Prometheus 监控实战（一）</h3><h4 id="一-prometheus介绍"><a class="anchor" href="#一-prometheus介绍">#</a> 一、Prometheus 介绍</h4><h5 id="11-prometheus是什么"><a class="anchor" href="#11-prometheus是什么">#</a> 1.1 Prometheus 是什么</h5><p>Prometheus 是由 SoundCloud 使⽤ Go 语⾔开发的时序数据库（简称 TSDB）但它的功能并⾮局限于 TSDB，因为它还⽀持对⽬标（如服务器、应⽤程序等）进⾏监控；</p><p>因此，我们也可以理解 Prometheus 是⼀款开源的 “监控系统”，但仅仅依托 Prometheus 不⾜以⽀撑整个监控系统，它需要结合⽣态内其他的组件来构建⼀个完整的 IT 监控系统。例如： AleartManager、Grafana、PushGateway 等等。</p><h5 id="12-什么是时序数据"><a class="anchor" href="#12-什么是时序数据">#</a> 1.2 什么是时序数据</h5><p>所谓时序数据，指的是，按照固定时间周期对 “某个或某些指标” 进⾏ “反复测量” 从⽽得到测量的 “数据集合”。这些数据随着时间的推移，会形成⼀个连续的序列，因此被称为时序数据。如果我们将这些数据绘制在图形上，通常会有⼀个 数据轴（Y 轴） 表示数据值，⼀个 时间轴（X 轴） 表示测量的时间点。</p><p><img loading="lazy" data-src="https://wp-cdn.4ce.cn/v2/ciCCOaR.jpeg" alt="3.jpg"></p><h5 id="13-prometheus时序数据"><a class="anchor" href="#13-prometheus时序数据">#</a> 1.3 Prometheus 时序数据</h5><p>在 Prometheus 中，时序数据主要包括三个部分：指标名称、标签集、时序数据（时间戳、数据）。</p><p>1、指标名称</p><p>例如，监控服务器的 CPU 使⽤率，对应的指标名称可以是 cpu_usage、memory_MemTotal 等指标名称是被监控端提供的。</p><p>2、标签集</p><p>标签集⽤于区分不同的数据源或实例。</p><p>假设我们有两台服务器，⼀台是 Web 服务器，另⼀台是 db 数据库服务器。为了区分这两台服务器的 CPU 使⽤率数据，我们可以为它们添加不同的标签，例如： cpu_usage {type=&quot;web&quot;} 和 cpu_usage {type=&quot;db&quot;} 。</p><p>3、时序数据</p><p>指按照按固定时间间隔，采集对应指标名称，从⽽获取到对应指标的数据。例如，每分钟采集⼀次 CPU 使⽤率（ cpu_usage ）。每个数据点包括采集 CPU 使⽤率的时间戳（ 2023.03.30 10:00:01 ），以及该时间点采集到的样本值（ 50% ）。</p><p><img loading="lazy" data-src="https://wp-cdn.4ce.cn/v2/SRYErXu.jpeg" alt="4.jpg"></p><p>PS：每⼀个 “指标名称和标签组合” 都会形成⼀条独⽴的时间序列。这就表示，即使我们只探测了⼀个指标 cpu_usage ，但是它具有不同的标签值，就会产⽣两条分别代表不同实例的时间序列。在这些时间序列中，每⼀个特定的数据点被称为⼀个 ' 样本 '。每个样本都包含指标名称、标签、时间戳以及对应的指标值。</p><h5 id="14-prometheus数据采集三种方式"><a class="anchor" href="#14-prometheus数据采集三种方式">#</a> 1.4 Prometheus 数据采集三种方式</h5><p>在传统的 Zabbix 监控系统中，通常是需要在被监控的节点上安装 Agent 代理程序。由 Agent 代理程序定期收集指标数据，并将其发送到监控服务器，完成数据采集。</p><p><img loading="lazy" data-src="https://wp-cdn.4ce.cn/v2/GrKq3KY.jpeg" alt="1.jpg"></p><p>在 Prometheus 中，被监控端⽆需安装专⻔的 Agent。它只需要 “被监控端通过 HTTP 协议开放出符合 Prometheus 规范的指标数据”，Prometheus 就能够顺利完成数据抓取。</p><p><img loading="lazy" data-src="https://wp-cdn.4ce.cn/v2/8qTrLX7.jpeg" alt="5.jpg"></p><p>但，并不是所有的应⽤或服务都能直接⽀持 HTTP 协议并提供符合 Prometheus 所兼容的指标格式。因此，Prometheus 设计了三种主要的数据抓取机制，即 Instrumentation、Exporter 和 PushGateway。</p><ol><li>Instrumentation ：被监控端通过 HTTP 暴露出 Prometheus 格式的数据，Prometheus 就可以直接采集，这就是所谓的 Instrumentation。像 Kubernetes、Haproxy、Zookeeper、RabbitMQ、Etcd 等应⽤程序原⽣就⽀持暴露指标，可以直接被 Prometheus 所监控。对于 Python、Java、Go 这些开发语⾔编写的业务应⽤，开发⼈员可以直接引⽤ Prometheus 客户端库来编写代码，让应⽤程序原⽣就能⽀持暴露需要监控的指标数据，这些指标数据可以直接被 Prometheus 采集。这就相当于应⽤程序本身具备了与 Prometheus 通信的能⼒，⽆需额外的中间件来转换数据。</li><li>Exporter（导出器） ：有些应⽤程序并不原⽣⽀持通过 HTTP 协议暴露指标数据。对于这类应⽤，我们可以使⽤ Exporter 来代为采集指标。Exporter 是⼀个独⽴的运⾏程序，负责从⽬标应⽤中采集原始格式的数据，并将其转换为 Prometheus 可以理解的格式，然后通过 HTTP 协议暴露出来，供 Prometheus 抓取指标。简单来说，Exporter 就像⼀个翻译官，将⽬标应⽤程序的数据翻译成 Prometheus 可以读懂的语⾔。</li><li>PushGateway（推送⽹关） ：对于那些⽣命周期较短或者不⽅便被 Prometheus 主动拉取数据的应⽤程序（如短暂运⾏的脚本任务）可以使⽤ PushGateway。让这些短暂运⾏的脚本程序，将对应的指标数据主动推送到 PushGateway，然后 Prometheus 从 PushGateway 中抓取这些数据。PushGateway 就像⼀个中间站，存储这些短暂任务产⽣的指标数据，等待 Prometheus 来抓取。</li></ol><p><img loading="lazy" data-src="https://wp-cdn.4ce.cn/v2/vCHt9SX.jpeg" alt="6.jpg"></p><h5 id="15-prometheus作业与实例"><a class="anchor" href="#15-prometheus作业与实例">#</a> 1.5 Prometheus 作业与实例</h5><p>在 Prometheus 中，被监控的每⼀个对象都称为实例（Instance） 实例代表着⼀个独⽴的监控⽬标，它由 IP 地址加端⼝号组合⽽成，</p><p>如 localhost:9090 。在 Prometheus 的配置中，这些实例也可以被称为” ⽬标（Target）“或者 “端点（Endpoint）”。</p><p>为了⽅便管理这些⽬标实例，我们通常会将功能相似或者类型相同的（实例 Instance）归纳到⼀个 “作业（Job）” 中。</p><ul><li>实例（Instances）：实例指的是⼀个被监控的端点。它通常是指向⼀个运⾏的服务或应⽤程序的进程，每个实例都以 host:port 进⾏标识。例如，⼀个 MySQL 数据库服务运⾏在 10.0.0.51:3306 上，那么它就是⼀个实例。</li><li>作业（Jobs）：作业是⼀组具有相同类型的实例集合。例如，多个分布在不同服务器上 MySQL 应⽤，你可以将这些实例归类为同⼀个 mysql 的 Job 作业，⽽后按照 Job 分组后的维度进⾏分析。</li></ul><p><img loading="lazy" data-src="https://wp-cdn.4ce.cn/v2/cFCOs3e.jpeg" alt="2.jpg"></p><p>在 Prometheus 的数据模型中，job 和 instance 是两个核⼼的标签，它们会⾃动附加到所有收集的时间序列数据上。如下所示：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 查询</span></pre></td></tr><tr><td data-num="2"></td><td><pre>cpu_usage</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 结果</span></pre></td></tr><tr><td data-num="4"></td><td><pre>cpu_usage<span class="token punctuation">&#123;</span>job<span class="token operator">=</span><span class="token string">"node-exporter"</span>,instance<span class="token operator">=</span><span class="token string">"10.0.0.7"</span><span class="token punctuation">&#125;</span> <span class="token number">14.04</span></pre></td></tr><tr><td data-num="5"></td><td><pre>cpu_usage<span class="token punctuation">&#123;</span>job<span class="token operator">=</span><span class="token string">"node-exporter"</span>,instance<span class="token operator">=</span><span class="token string">"10.0.0.8"</span><span class="token punctuation">&#125;</span> <span class="token number">12.04</span></pre></td></tr><tr><td data-num="6"></td><td><pre>cpu_usage<span class="token punctuation">&#123;</span>job<span class="token operator">=</span><span class="token string">"node-exporter"</span>,instance<span class="token operator">=</span><span class="token string">"10.0.0.9"</span><span class="token punctuation">&#125;</span> <span class="token number">16.04</span></pre></td></tr></table></figure><h5 id="16-prometheus架构"><a class="anchor" href="#16-prometheus架构">#</a> 1.6 Prometheus 架构</h5><p>Prometheus 最为核⼼的功能就是 “数据采集” 和 “数据存储”。但是，仅有这两项功能并不能构成⼀个完整的监控系统。因此，Prometheus 需要与其他的组件进⾏结合，从⽽实现数据的分析、展示和告警，因此⼀个完整意义上的监控系统⼤体需要如下 5 个组成部分：</p><ul><li>1、数据采集：Prometheus 采⽤ Pull 模式主动向被监控端抓取指标数据。被监控端可以是直接暴露出的应⽤程序指标数据，也可以是通过安装 Exporter 来抓取和暴露应⽤程序的数据。只要是以 Prometheus 格式提供的指标数据，都可以被 Prometheus 抓取。</li><li>2、数据存储：Prometheus 会将抓取到的数据，存储在本地的时间序列数据库中，以防⽌数据丢失。</li><li>3、数据查询和分析：Prometheus 内置了强⼤的查询语⾔ PromQL，⽤户可以通过 PromQL 查询存储在 Prometheus 上的时序数据，进⾏实时查询和分析。同时 PromQL ⽀持多种聚合操作和数学运算，可以对数据进⾏深⼊分析。</li><li>4、告警系统：Prometheus 的告警分为了两个部分组成，告警规则和 Alertmanager。告警规则定义在 Prometheus 服务器中，根据⽤户指定的条件触发告警。当告警触发时，Prometheus 服务器会将告警信息发送给 Alertmanager。Alertmanager 会对告警信息进⾏去重、分组，然后将告警消息通过媒介发送给接收者（如邮件、钉钉等）。</li><li>5、数据可视化：Prometheus 内置了⼀个简单的图形界⾯，⽤户可以在 Web 浏览器中使⽤ PromQL 查询时序数据，并将查询结果以图形的形式展示出来。此外，Prometheus 还可以与第三⽅可视化⼯具（如 Grafana）集成，提供更丰富的可视化功能。</li></ul><p>了解 Prometheus ⽣态中的各个组件后，我们可以概括其⼯作流程：⽬标发现、数据抓取、存储、分析、告警和展示。这些步骤共同构成了 Prometheus 强⼤的监控和告警系统。</p><p><img loading="lazy" data-src="https://wp-cdn.4ce.cn/v2/cZ48728.jpeg" alt="4.jpg"></p><ul><li>1、⽬标发现：在开始监控之前，Prometheus 需要确定监控⽬标。它可以通过静态的配置⽂件指定，或者利⽤服务发现机制动态地发现需要监控的服务。例如，在 Kubernetes 环境中，Prometheus 能够⾃动识别并监控集群中的服务，确保随着集群的变化，监控⽬标始终是最新的。</li><li>2、数据抓取：有了明确的监控⽬标后，Prometheus 通过 HTTP 协议定期从这些⽬标的 /metrics 端点抓取指标数据。这些端点暴露了各种监控指标。</li><li>3、数据存储：数据抓取后会存储在本地的时间序列数据库中。</li><li>4、数据分析：数据⼀旦被存储，就可以⽤ PromQL 查询语⾔，对其进⾏分析。⽆论是实时监控还是历史数据分析，PromQL 都能提供丰富的数据聚合功能，以洞察系统的状况。</li><li>5、告警：Prometheus 根据预定义的规则进⾏评估。当监控的指标达到告警阈值时，Prometheus 会将告警信息发送给 Alertmanager，由 Alertmanager 进⾏告警处理并通知。</li><li>6、数据可视化：Prometheus ⾃带了简单的 UI。但对于更⾼级的数据可视化需求，通常会整合 Grafana 这样的⼯具来为⽤户提供直观的数据展现⽅式。</li></ul><h5 id="17-prometheus数据模型"><a class="anchor" href="#17-prometheus数据模型">#</a> 1.7 Prometheus 数据模型</h5><p>Prometheus 中最为重要的是，对指标进⾏抓取和存储，这些存储下来的数据可以帮助我们分析趋势，或预测未来。为了更有⾼效的存储和查询这些数据，Prometheus 使⽤了⼀种叫 &quot;时间序列&quot; 的数据格式进⾏存储，所谓时间序列就是按照时间顺序记录所采集到的指标以及指标数据。⽽每个时间序列都是由 “⼀个指标名称加⼀堆标签” 所组成的⼀条唯⼀序列标识，其格式 &quot;&lt;metric_name&gt;{&lt;label_name&gt;=&lt;label_value&gt;, &lt;label_name&gt;=&lt;label_value&gt;, ...} @<timestamp><value>&quot;</value></timestamp></p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 查询 node01 节点的各 CPU 核⼼使⽤率</span></pre></td></tr><tr><td data-num="2"></td><td><pre>cpu_usage<span class="token punctuation">&#123;</span>instance<span class="token operator">=</span><span class="token string">"node01.oldxu.net"</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 结果</span></pre></td></tr><tr><td data-num="4"></td><td><pre>cpu_usage<span class="token punctuation">&#123;</span>instance<span class="token operator">=</span><span class="token string">"node01.oldxu.net"</span>,core<span class="token operator">=</span><span class="token string">"0"</span><span class="token punctuation">&#125;</span> <span class="token number">7.535</span></pre></td></tr><tr><td data-num="5"></td><td><pre>cpu_usage<span class="token punctuation">&#123;</span>instance<span class="token operator">=</span><span class="token string">"node01.oldxu.net"</span>,core<span class="token operator">=</span><span class="token string">"1"</span><span class="token punctuation">&#125;</span> <span class="token number">7.535</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># 查询 node02 节点，核⼼为 0 的 CPU 使⽤率</span></pre></td></tr><tr><td data-num="8"></td><td><pre>cpu_usage<span class="token punctuation">&#123;</span>instance<span class="token operator">=</span><span class="token string">"node02.oldxu.net"</span>,core<span class="token operator">=</span><span class="token string">"0"</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment"># 结果</span></pre></td></tr><tr><td data-num="10"></td><td><pre>cpu_usage<span class="token punctuation">&#123;</span>instance<span class="token operator">=</span><span class="token string">"node01.oldxu.net"</span>,core<span class="token operator">=</span><span class="token string">"0"</span><span class="token punctuation">&#125;</span> <span class="token number">8.025</span></pre></td></tr></table></figure><h4 id="二-prometheus安装"><a class="anchor" href="#二-prometheus安装">#</a> 二、Prometheus 安装</h4><p>Prometheus 支持多种安装方式，为了便于理解，我们先使用二进制方式进行部署，后期在使用 Kubernetes 方式进行部署。</p><h5 id="21-环境准备"><a class="anchor" href="#21-环境准备">#</a> 2.1 环境准备</h5><table><thead><tr><th style="text-align:center">IP 地址</th><th style="text-align:center">主机名名称</th><th style="text-align:center">系统版本</th><th style="text-align:center">内核版本</th><th style="text-align:center">CPU</th><th style="text-align:center">内存</th></tr></thead><tbody><tr><td style="text-align:center">192.168.40.221</td><td style="text-align:center"><a target="_blank" rel="noopener" href="http://prom-node01.oldxu.net">prom-node01.oldxu.net</a></td><td style="text-align:center">Centos7.9</td><td style="text-align:center">3.10.0-957.el7.x86_64</td><td style="text-align:center">2Core</td><td style="text-align:center">2G</td></tr><tr><td style="text-align:center">192.168.40.222</td><td style="text-align:center"><a target="_blank" rel="noopener" href="http://prom-node02.oldxu.net">prom-node02.oldxu.net</a></td><td style="text-align:center">Centos7.9</td><td style="text-align:center">3.10.0-957.el7.x86_64</td><td style="text-align:center">2Core</td><td style="text-align:center">2G</td></tr><tr><td style="text-align:center">192.168.40.223</td><td style="text-align:center"><a target="_blank" rel="noopener" href="http://prom-node03.oldxu.net">prom-node03.oldxu.net</a></td><td style="text-align:center">Centos7.9</td><td style="text-align:center">3.10.0-957.el7.x86_64</td><td style="text-align:center">2Core</td><td style="text-align:center">2G</td></tr><tr><td style="text-align:center">192.168.40.224</td><td style="text-align:center"><a target="_blank" rel="noopener" href="http://prom-node04.oldxu.net">prom-node04.oldxu.net</a></td><td style="text-align:center">Centos7.9</td><td style="text-align:center">3.10.0-957.el7.x86_64</td><td style="text-align:center">2Core</td><td style="text-align:center">2G</td></tr><tr><td style="text-align:center">192.168.40.225</td><td style="text-align:center"><a target="_blank" rel="noopener" href="http://prom-node05.oldxu.net">prom-node05.oldxu.net</a></td><td style="text-align:center">Centos7.9</td><td style="text-align:center">3.10.0-957.el7.x86_64</td><td style="text-align:center">2Core</td><td style="text-align:center">2G</td></tr></tbody></table><h5 id="22-配置host解析"><a class="anchor" href="#22-配置host解析">#</a> 2.2 配置 Host 解析</h5><p>1、配置 hosts 解析</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token builtin class-name">echo</span> <span class="token string">"192.168.40.221 prom-node01.oldxu.net"</span> <span class="token operator">>></span> /etc/hosts</pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token builtin class-name">echo</span> <span class="token string">"192.168.40.222 prom-node02.oldxu.net"</span> <span class="token operator">>></span> /etc/hosts</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token builtin class-name">echo</span> <span class="token string">"192.168.40.223 prom-node03.oldxu.net"</span> <span class="token operator">>></span> /etc/hosts</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token builtin class-name">echo</span> <span class="token string">"192.168.40.224 prom-node04.oldxu.net"</span> <span class="token operator">>></span> /etc/hosts</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token builtin class-name">echo</span> <span class="token string">"192.168.40.225 prom-node05.oldxu.net"</span> <span class="token operator">>></span> /etc/hosts</pre></td></tr></table></figure><p>2、推送 hosts 解析文件，确保每个节点都能正常通过主机名进行访问</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token punctuation">&#123;</span><span class="token number">222</span><span class="token punctuation">..</span><span class="token number">225</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">do</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token function">scp</span> /etc/hosts root@192.168.40.<span class="token variable">$i</span>:/etc/hosts</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">done</span></pre></td></tr></table></figure><h5 id="23-下载prometheus"><a class="anchor" href="#23-下载prometheus">#</a> 2.3 下载 Prometheus</h5><p>1、访问 Prometheus 官网 ﻿https://prometheus.io/download/﻿下载 Prometheus</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@prom-node01 ~<span class="token punctuation">]</span><span class="token comment"># wget https://github.com/prometheus/prometheus/releases/download/v2.49.1/prometheus-2.49.1.linux-amd64.tar.gz</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># 加速地址</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@prom-node01 ~<span class="token punctuation">]</span><span class="token comment"># wget https://mirror.ghproxy.com/https://github.com/prometheus/prometheus/releases/download/v2.49.1/prometheus-2.49.1.linux-amd64.tar.gz</span></pre></td></tr></table></figure><p>2、解压 Prometheus 至指定目录</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@prom-node01 ~<span class="token punctuation">]</span><span class="token comment"># tar xf prometheus-2.49.1.linux-amd64.tar.gz -C /etc</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@prom-node01 ~<span class="token punctuation">]</span><span class="token comment"># ln -s /etc/prometheus-2.49.1.linux-amd64/ /etc/prometheus</span></pre></td></tr></table></figure><p>3、执行 ﻿prometheus --version﻿ 查看命令是否正常</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@prom-node01 ~<span class="token punctuation">]</span><span class="token comment"># /etc/prometheus/prometheus --version</span></pre></td></tr><tr><td data-num="2"></td><td><pre>prometheus, version <span class="token number">2.49</span>.1 <span class="token punctuation">(</span>branch: HEAD, revision: 43e14844a33b65e2a396e3944272af8b3a494071<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  build user:       root@6d5f4c649d25</pre></td></tr><tr><td data-num="4"></td><td><pre>  build date:       <span class="token number">20240115</span>-16:58:43</pre></td></tr><tr><td data-num="5"></td><td><pre>  go version:       go1.21.6</pre></td></tr><tr><td data-num="6"></td><td><pre>  platform:         linux/amd64</pre></td></tr><tr><td data-num="7"></td><td><pre>  tags:             netgo,builtinassets,stringlabels</pre></td></tr></table></figure><h5 id="24-配置prometheus"><a class="anchor" href="#24-配置prometheus">#</a> 2.4 配置 Prometheus</h5><p>1、在启动 Prometheus 之前，我们需要准备一个 Prometheus 的配置文件，监控目标服务。由于 Prometheus 服务本身对外暴露了 Metrics 指标接口，所以我们可以配置 Prometheus 监控自身，保存一个名为 prometheus.yml 的文件，替换掉默认的配置文件</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@prom-node01 ~<span class="token punctuation">]</span><span class="token comment"># cp /etc/prometheus/prometheus.yml /etc/prometheus/prometheus.yml_bak</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@prom-node01 ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/prometheus/prometheus.yml</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># 全局段定义</span></pre></td></tr><tr><td data-num="4"></td><td><pre>global:</pre></td></tr><tr><td data-num="5"></td><td><pre>  scrape_interval: 15s <span class="token comment"># 设置 Prometheus 抓取指标数据的间隔，默认为 15 秒。</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># 抓取指定的目标</span></pre></td></tr><tr><td data-num="7"></td><td><pre>scrape_configs:</pre></td></tr><tr><td data-num="8"></td><td><pre>  - job_name: <span class="token string">"prometheus"</span> <span class="token comment"># 定义一个抓取任务，名为 'prometheus'。</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    metrics_path: <span class="token string">"/metrics"</span> <span class="token comment"># 指定 Prometheus 从监控目标暴露的 HTTP 端点路径抓取指标，默认为 '/metrics'。</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    static_configs: <span class="token comment"># 配置静态目标地址，Prometheus 将定期从如下这些地址抓取指标。</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    - targets: <span class="token punctuation">[</span><span class="token string">"prom-node01.oldxu.net:9090"</span><span class="token punctuation">]</span></pre></td></tr></table></figure><p>2、启动可以直接通过命令启动，但直接这么启动不是很方便，因此我们可以准备一个专属的启动文件</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@prom-node01 ~<span class="token punctuation">]</span><span class="token comment"># /etc/prometheus/prometheus --config.file=/etc/prometheus/prometheus.yml</span></pre></td></tr></table></figure><h5 id="25-启动prometheus"><a class="anchor" href="#25-启动prometheus">#</a> 2.5 启动 Prometheus</h5><p>1、配置 system 管理 Prometheus 启动和停止</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@prom-node01 ~<span class="token punctuation">]</span><span class="token comment"># cat /usr/lib/systemd/system/prometheus.service</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>Unit<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token assign-left variable">Description</span><span class="token operator">=</span>Prometheus server</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token assign-left variable">Documentation</span><span class="token operator">=</span>https://prometheus.io/</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">[</span>Service<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token assign-left variable">User</span><span class="token operator">=</span>root</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token assign-left variable">Restart</span><span class="token operator">=</span>always</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/etc/prometheus/prometheus <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token parameter variable">--config.file</span><span class="token operator">=</span>/etc/prometheus/prometheus.yml <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token parameter variable">--storage.tsdb.path</span><span class="token operator">=</span>/etc/prometheus/data <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token parameter variable">--storage.tsdb.retention.time</span><span class="token operator">=</span>60d <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="13"></td><td><pre>--web.enable-lifecycle</pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token assign-left variable">ExecReload</span><span class="token operator">=</span>/bin/kill <span class="token parameter variable">-HUP</span> <span class="token variable">$MAINPID</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token assign-left variable">Restart</span><span class="token operator">=</span>on-failure</pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token assign-left variable">RestartSec</span><span class="token operator">=</span><span class="token number">20</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token assign-left variable">TimeoutStopSec</span><span class="token operator">=</span><span class="token number">20</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token assign-left variable">SendSIGKILL</span><span class="token operator">=</span>no</pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token assign-left variable">LimitNOFILE</span><span class="token operator">=</span><span class="token number">8192</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">[</span>Install<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>multi-user.target</pre></td></tr></table></figure><p>2、在启动 Prometheus 服务时通过参数传递了一些配置选项，它们定义了 Prometheus 服务的一些关键行为。</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token parameter variable">--config.file</span><span class="token operator">=</span>/etc/prometheus/prometheus.yml <span class="token comment"># 指定 Prometheus 的配置文件路径。</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token parameter variable">--storage.tsdb.path</span><span class="token operator">=</span>/etc/prometheus/data <span class="token comment"># 设置 Prometheus 存储时间序列数据库（TSDB）的路径。用于存放 Prometheus 抓取到的指标数据。</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token parameter variable">--storage.tsdb.retention.time</span><span class="token operator">=</span>60d <span class="token comment"># 配置 Prometheus 的数据保留期限。超过这个时间范围的旧数据将被删除。这个可以根据存储资源和监控需求进行调整。</span></pre></td></tr><tr><td data-num="4"></td><td><pre>--web.enable-lifecycle <span class="token comment"># 允许通过 HTTP 请求的方式来更新 Prometheus 的配置。</span></pre></td></tr></table></figure><p>3、启动 Prometheus 服务</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@prom-node01 ~<span class="token punctuation">]</span><span class="token comment"># systemctl daemon-reload</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@prom-node01 ~<span class="token punctuation">]</span><span class="token comment"># systemctl start prometheus</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@prom-node01 ~<span class="token punctuation">]</span><span class="token comment"># netstat -lntp |grep 9090</span></pre></td></tr><tr><td data-num="4"></td><td><pre>tcp6       <span class="token number">0</span>      <span class="token number">0</span> :::9090                 :::*                    LISTEN      <span class="token number">2057</span>/prometheus</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">#通过 HTTP 请求的方式来热更新 Prometheus 的配置文件</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">[</span>root@prom-node01 ~<span class="token punctuation">]</span><span class="token comment"># curl -X POST http://localhost:9090/-/reload</span></pre></td></tr></table></figure><h5 id="26-访问prometheus"><a class="anchor" href="#26-访问prometheus">#</a> 2.6 访问 Prometheus</h5><p>1、通过访问对应服务的 IP:9090 端口，访问 Prometheus 的 UI 界面</p><p><img loading="lazy" data-src="https://wp-cdn.4ce.cn/v2/V68yeDl.jpeg" alt="1.jpg"></p><h5 id="27-prometheus的webui"><a class="anchor" href="#27-prometheus的webui">#</a> 2.7 Prometheus 的 WebUI</h5><p>Prometheus 的 Web UI 提供了多个页面，以便用户可以查询指标、查看配置和状态，以及管理告警等。以下是 Prometheus Web UI 中常见的几个页面及其描述：</p><ul><li><p>Graph: 允许用户通过 Prometheus 的查询语言 PromQL 来查询数据，并将结果以图形的形式展示。</p></li><li><p>Alerts：允许用户查看当前配置的告警规则以及每个告警的状态。</p></li><li><p>Status：页面包含了几个子页面，它们提供了关于 Prometheus 服务器本身的各种信息：</p><ul><li><p>Command-Line Flags: 显示了 Prometheus 启动时使用的命令行参数。这有助于了解 Prometheus 的配置和运行状态。</p></li><li><p>Configuration: 展示了 Prometheus 当前加载的配置文件内容，可以用来确认 Prometheus 正在使用的配置，有助于调试问题。</p></li><li><p>Targets: 显示了 Prometheus 监控的采集目标列表，包括每个目标的健康状态。如果某个目标无法抓取，这里也会显示相关的错误信息。</p></li><li><p>Rules: 显示所有配置的告警和记录规则。</p></li><li><p>Service Discovery: 展示了 Prometheus 的服务发现状态，这包括了 Prometheus 如何发现抓取目标，以及它们的当前状态和元数据信息。</p></li></ul></li></ul><h4 id="三-安装grafana图形展示"><a class="anchor" href="#三-安装grafana图形展示">#</a> 三、安装 Grafana 图形展示</h4><h5 id="31-grafana介绍"><a class="anchor" href="#31-grafana介绍">#</a> 3.1 Grafana 介绍</h5><p>Grafana 是一款开源的数据分析和可视化工具，从 2.5.0 版本开始，Grafana 已经内置了对 Prometheus 的支持，可以直接将 Prometheus 作为数据源进行查询和展示。</p><h5 id="32-grafana安装"><a class="anchor" href="#32-grafana安装">#</a> 3.2 Grafana 安装</h5><p>1、访问 Grafana 官网 ﻿https://grafana.com/grafana/download﻿，下载 Grafana</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@prom-node01 ~<span class="token punctuation">]</span><span class="token comment"># wget https://dl.grafana.com/enterprise/release/grafana-enterprise-10.3.1-1.x86_64.rpm</span></pre></td></tr></table></figure><p>2、安装并启动 Grafana</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@prom-node01 ~<span class="token punctuation">]</span><span class="token comment"># yum localinstall grafana-enterprise-10.3.1-1.x86_64.rpm -y</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@prom-node01 ~<span class="token punctuation">]</span><span class="token comment"># systemctl start grafana-server &amp;&amp; systemctl enable grafana-server</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@prom-node01 ~<span class="token punctuation">]</span><span class="token comment"># netstat -lntp |grep 3000</span></pre></td></tr><tr><td data-num="4"></td><td><pre>tcp6       <span class="token number">0</span>      <span class="token number">0</span> :::3000                 :::*                    LISTEN      <span class="token number">1787</span>/grafana</pre></td></tr></table></figure><p>3、访问 Grafana，通过﻿http://IP:3000﻿，默认 Grafana 用户名为﻿admin﻿，密码为﻿admin</p><p><img loading="lazy" data-src="https://wp-cdn.4ce.cn/v2/kBj2SIo.jpeg" alt="2.jpg"></p><p>4、点击左边菜单选择﻿Administration--&gt;Default Preferences﻿（偏好设置）在﻿Language﻿选项中选择﻿简体中文﻿然后﻿Save﻿.</p><p><img loading="lazy" data-src="https://wp-cdn.4ce.cn/v2/Xccw96a.png" alt="1.png"></p><h5 id="33-配置grafana数据源"><a class="anchor" href="#33-配置grafana数据源">#</a> 3.3 配置 Grafana 数据源</h5><p>1、配置 Grafana 数据源为 Prometheus，点击菜单，选择﻿Connections--&gt;Data sources--&gt; 选择 Prometheus</p><p><img loading="lazy" data-src="https://wp-cdn.4ce.cn/v2/0CLhNrE.jpeg" alt="5.jpg"></p><p>2、导入 Grafana 默认监控 Prometheus 的 Dashboards，该 Dashboard 主要用于监控 Prometheus 服务器本身的性能和状态指标。</p><p><img loading="lazy" data-src="https://wp-cdn.4ce.cn/v2/ZsFdwXb.jpeg" alt="4.jpg"></p><p>3、通过图形界面展示 Prometheus 的数据指标；</p><p><img loading="lazy" data-src="https://wp-cdn.4ce.cn/v2/ZsFdwXb.jpeg" alt="4.jpg"></p><h5 id="34-配置prometheus监控grafana"><a class="anchor" href="#34-配置prometheus监控grafana">#</a> 3.4 配置 Prometheus 监控 Grafana</h5><p>Grafana 作为一个广泛使用的可视化工具，其实也需要被监控。幸运的是 Grafana 本身提供了一个内置的指标端点。通过访问 ﻿http://&lt;grafana-ip:3000/metrics﻿，你可以获取到 Grafana 的性能指标。这些指标包括了 HTTP 请求统计、内存使用情况、图形的数量，活跃用户数等指标，它们对于监控 Grafana 的健康状况非常有帮助。</p><p>1、访问 Grafana 对外暴露指标的 Metrics 接口，如果没有问题，会看到一系列的指标数据</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@prom-node01 ~<span class="token punctuation">]</span><span class="token comment"># curl -s http://prom-node01.oldxu.net:3000/metrics| tail -10</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># TYPE prometheus_template_text_expansions_total counter</span></pre></td></tr><tr><td data-num="3"></td><td><pre>prometheus_template_text_expansions_total <span class="token number">0</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment"># HELP promhttp_metric_handler_requests_in_flight Current number of scrapes being served.</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># TYPE promhttp_metric_handler_requests_in_flight gauge</span></pre></td></tr><tr><td data-num="6"></td><td><pre>promhttp_metric_handler_requests_in_flight <span class="token number">0</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token comment"># HELP promhttp_metric_handler_requests_total Total number of scrapes by HTTP status code.</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment"># TYPE promhttp_metric_handler_requests_total counter</span></pre></td></tr><tr><td data-num="9"></td><td><pre>promhttp_metric_handler_requests_total<span class="token punctuation">&#123;</span>code<span class="token operator">=</span><span class="token string">"200"</span><span class="token punctuation">&#125;</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="10"></td><td><pre>promhttp_metric_handler_requests_total<span class="token punctuation">&#123;</span>code<span class="token operator">=</span><span class="token string">"500"</span><span class="token punctuation">&#125;</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="11"></td><td><pre>promhttp_metric_handler_requests_total<span class="token punctuation">&#123;</span>code<span class="token operator">=</span><span class="token string">"503"</span><span class="token punctuation">&#125;</span> <span class="token number">0</span></pre></td></tr></table></figure><p>2、配置 Prometheus，将 Grafana 作为一个监控目标（target）添加到配置中。</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@prom-node01 ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/prometheus/prometheus.yml</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># 全局段定义</span></pre></td></tr><tr><td data-num="3"></td><td><pre>global:</pre></td></tr><tr><td data-num="4"></td><td><pre>  scrape_interval: 15s <span class="token comment"># 设置 Prometheus 抓取指标数据的间隔，默认为 15 秒。</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># 抓取指定的目标</span></pre></td></tr><tr><td data-num="6"></td><td><pre>scrape_configs:</pre></td></tr><tr><td data-num="7"></td><td><pre>  - job_name: <span class="token string">"prometheus"</span> <span class="token comment"># 定义一个抓取任务，名为 'prometheus'。</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    metrics_path: <span class="token string">"/metrics"</span> <span class="token comment"># 指定 Prometheus 从监控目标暴露的 HTTP 端点路径抓取指标，默认为 '/metrics'。</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    static_configs: <span class="token comment"># 配置静态目标地址，Prometheus 将定期从如下这些地址抓取指标。</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    - targets: <span class="token punctuation">[</span><span class="token string">"prom-node01.oldxu.net:9090"</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  - job_name: <span class="token string">"grafana"</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    metrics_path: <span class="token string">"/metrics"</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    static_configs:</pre></td></tr><tr><td data-num="14"></td><td><pre>    - targets: <span class="token punctuation">[</span><span class="token string">"prom-node01.oldxu.net:3000"</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">[</span>root@prom-node01 ~<span class="token punctuation">]</span><span class="token comment"># /etc/prometheus/promtool check config /etc/prometheus/prometheus.yml</span></pre></td></tr><tr><td data-num="17"></td><td><pre>Checking /etc/prometheus/prometheus.yml</pre></td></tr><tr><td data-num="18"></td><td><pre> SUCCESS: /etc/prometheus/prometheus.yml is valid prometheus config <span class="token function">file</span> syntax</pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">[</span>root@prom-node01 ~<span class="token punctuation">]</span><span class="token comment"># curl -X POST http://localhost:9090/-/reload</span></pre></td></tr></table></figure><p>3、访问 Prometheus，在 Status 中的 Targets 页面，能看到新添加的 grafana 目标；如果 State 显示 UP，说明 Prometheus 正在从 Grafana 抓取指标。</p><p><img loading="lazy" data-src="https://wp-cdn.4ce.cn/v2/Wh5m6k9.jpeg" alt="8.jpg"></p><p>4、接下来可以在 Grafana 中创建一个（Dashboard），也可以使用之前配置 Prometheus 导入的 Grafana 模板，这样就可以直观地展示被监控的 Grafana 服务状态；</p><p><img loading="lazy" data-src="https://wp-cdn.4ce.cn/v2/9IFFRtb.jpeg" alt="7.jpg"></p><h4 id="四-配置prometheus监控node节点"><a class="anchor" href="#四-配置prometheus监控node节点">#</a> 四、配置 Prometheus 监控 Node 节点</h4><h5 id="41-如何监控node节点"><a class="anchor" href="#41-如何监控node节点">#</a> 4.1 如何监控 Node 节点</h5><p>监控节点（如服务器或者虚拟机）通常涉及收集硬件和操作系统层面的指标，比如 CPU 使用率、内存占用、磁盘 I/O、网络流量等。但是这些指标并不能直接被 Prometheus 抓取，因此我们需要借助 Node exporter 将对应的指标转为 Prometheus 能够兼容的指标格式，并对外提供 HTTP 接口暴露给 Prometheus 进行指标抓取。</p><p><strong>监控地址规划：</strong></p><table><thead><tr><th style="text-align:center">IP 地址</th><th style="text-align:center">主机名名称</th><th style="text-align:center">系统版本</th><th style="text-align:center">内核版本</th><th style="text-align:center">CPU</th><th style="text-align:center">内存</th></tr></thead><tbody><tr><td style="text-align:center">192.168.40.221</td><td style="text-align:center"><a target="_blank" rel="noopener" href="http://prom-node01.oldxu.net">prom-node01.oldxu.net</a></td><td style="text-align:center">Centos7.9</td><td style="text-align:center">3.10.0-957.el7.x86_64</td><td style="text-align:center">2Core</td><td style="text-align:center">2G</td></tr><tr><td style="text-align:center">192.168.40.222</td><td style="text-align:center"><a target="_blank" rel="noopener" href="http://prom-node02.oldxu.net">prom-node02.oldxu.net</a></td><td style="text-align:center">Centos7.9</td><td style="text-align:center">3.10.0-957.el7.x86_64</td><td style="text-align:center">2Core</td><td style="text-align:center">2G</td></tr><tr><td style="text-align:center">192.168.40.223</td><td style="text-align:center"><a target="_blank" rel="noopener" href="http://prom-node03.oldxu.net">prom-node03.oldxu.net</a></td><td style="text-align:center">Centos7.9</td><td style="text-align:center">3.10.0-957.el7.x86_64</td><td style="text-align:center">2Core</td><td style="text-align:center">2G</td></tr></tbody></table><h5 id="42-安装node_exporter"><a class="anchor" href="#42-安装node_exporter">#</a> 4.2 安装 node_exporter</h5><p>1、访问 Node-exporter 的 github，获取 Node-exporter 的下载地址， ﻿https://github.com/prometheus/node_exporter/releases/</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@prom-node01 ~<span class="token punctuation">]</span><span class="token comment"># wget https://github.com/prometheus/node_exporter/releases/download/v1.7.0/node_exporter-1.7.0.linux-amd64.tar.gz</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># 加速地址</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@prom-node01 ~<span class="token punctuation">]</span><span class="token comment"># wget https://mirror.ghproxy.com/https://github.com/prometheus/node_exporter/releases/download/v1.7.0/node_exporter-1.7.0.linux-amd64.tar.gz</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># 推送给其他节点</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token punctuation">&#123;</span><span class="token number">222</span><span class="token punctuation">..</span><span class="token number">225</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">do</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token function">scp</span> node_exporter-1.7.0.linux-amd64.tar.gz root@192.168.40.<span class="token variable">$i</span>:~</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">done</span></pre></td></tr></table></figure><p>2、解压 node-exporter</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@prom-node01 ~<span class="token punctuation">]</span><span class="token comment"># tar xf node_exporter-1.7.0.linux-amd64.tar.gz -C /etc</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@prom-node01 ~<span class="token punctuation">]</span><span class="token comment"># ln -s /etc/node_exporter-1.7.0.linux-amd64/ /etc/node_exporter</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@prom-node01 ~<span class="token punctuation">]</span><span class="token comment"># ll /etc/node_exporter/</span></pre></td></tr><tr><td data-num="4"></td><td><pre>total <span class="token number">19476</span></pre></td></tr><tr><td data-num="5"></td><td><pre>-rw-r--r-- <span class="token number">1</span> <span class="token number">1001</span> <span class="token number">1002</span>    <span class="token number">11357</span> Nov <span class="token number">13</span> 08:02 LICENSE</pre></td></tr><tr><td data-num="6"></td><td><pre>-rwxr-xr-x <span class="token number">1</span> <span class="token number">1001</span> <span class="token number">1002</span> <span class="token number">19925095</span> Nov <span class="token number">13</span> 07:54 node_exporter</pre></td></tr><tr><td data-num="7"></td><td><pre>-rw-r--r-- <span class="token number">1</span> <span class="token number">1001</span> <span class="token number">1002</span>      <span class="token number">463</span> Nov <span class="token number">13</span> 08:02 NOTICE</pre></td></tr></table></figure><h5 id="43-配置node_exporter"><a class="anchor" href="#43-配置node_exporter">#</a> 4.3 配置 node_exporter</h5><p>启动 Node Exporter 即可开始进行指标采集，它默认启用了一些常见的收集器以监控 CPU、内存、网络等关键指标。然而，由于每个操作系统对收集器的支持程度不同，Node Exporter 也提供了一些 &quot;默认未启用的收集器&quot;。我们可以根据监控需求，通过特定的参数来启用这些收集器。</p><ul><li>要禁用默认激活的收集器，可以使用参数 ﻿--no-collector.<name></name></li><li>要启用默认未激活的收集器，可以使用参数﻿--collector.<name></name></li></ul><p>如果只想启动某些特定的收集器，可以使用 ﻿--collector.disable-defaults﻿标志禁用所有默认的，然后在指定具体要启用收集器 ﻿--collector.&lt;name﻿ 来进行收集。</p><p><em>默认关闭一些收集器的原因在于，有些指标采集需要占用过多资源开销、太重、太慢；所以谨慎开启；</em></p><p>1、例如，禁止默认启动的 arp 的采集</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 直接启动会发现有 arp 采集</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@prom-node01 ~<span class="token punctuation">]</span><span class="token comment"># /etc/node_exporter/node_exporter</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token assign-left variable">ts</span><span class="token operator">=</span><span class="token number">2024</span>-02-22T13:21:35.150Z <span class="token assign-left variable">caller</span><span class="token operator">=</span>node_exporter.go:117 <span class="token assign-left variable">level</span><span class="token operator">=</span>info <span class="token assign-left variable">collector</span><span class="token operator">=</span>arp</pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment"># 禁用 arp 收集器，就看不到了</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">[</span>root@prom-node01 ~<span class="token punctuation">]</span><span class="token comment"># /etc/node_exporter/node_exporter --no-collector.arp</span></pre></td></tr></table></figure><p>2、启用默认未激活的﻿tcpstat﻿收集器</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@prom-node01 ~<span class="token punctuation">]</span><span class="token comment"># /etc/node_exporter/node_exporter</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@prom-node01 ~<span class="token punctuation">]</span><span class="token comment"># /etc/node_exporter/node_exporter --collector.tcpstat</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token assign-left variable">ts</span><span class="token operator">=</span><span class="token number">2024</span>-02-22T13:23:34.296Z <span class="token assign-left variable">caller</span><span class="token operator">=</span>node_exporter.go:117 <span class="token assign-left variable">level</span><span class="token operator">=</span>info <span class="token assign-left variable">collector</span><span class="token operator">=</span>tcpstat</pre></td></tr></table></figure><p>3、也可以禁用所有收集器，仅启用那些只想启用的收集器</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@prom-node01 ~<span class="token punctuation">]</span><span class="token comment"># /etc/node_exporter/node_exporter --collector.disable-defaults --collector.cpu --collector.meminfo --collector.diskstats --collector.netstat</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token assign-left variable">ts</span><span class="token operator">=</span><span class="token number">2024</span>-02-22T13:25:37.969Z <span class="token assign-left variable">caller</span><span class="token operator">=</span>node_exporter.go:192 <span class="token assign-left variable">level</span><span class="token operator">=</span>info <span class="token assign-left variable">msg</span><span class="token operator">=</span><span class="token string">"Starting node_exporter"</span> <span class="token assign-left variable">version</span><span class="token operator">=</span><span class="token string">"(version=1.7.0, branch=HEAD, revision=7333465abf9efba81876303bb57e6fadb946041b)"</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token assign-left variable">ts</span><span class="token operator">=</span><span class="token number">2024</span>-02-22T13:25:37.969Z <span class="token assign-left variable">caller</span><span class="token operator">=</span>node_exporter.go:193 <span class="token assign-left variable">level</span><span class="token operator">=</span>info <span class="token assign-left variable">msg</span><span class="token operator">=</span><span class="token string">"Build context"</span> <span class="token assign-left variable">build_context</span><span class="token operator">=</span><span class="token string">"(go=go1.21.4, platform=linux/amd64, user=root@35918982f6d8, date=20231112-23:53:35, tags=netgo osusergo static_build)"</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token assign-left variable">ts</span><span class="token operator">=</span><span class="token number">2024</span>-02-22T13:25:37.969Z <span class="token assign-left variable">caller</span><span class="token operator">=</span>node_exporter.go:195 <span class="token assign-left variable">level</span><span class="token operator">=</span>warn <span class="token assign-left variable">msg</span><span class="token operator">=</span><span class="token string">"Node Exporter is running as root user. This exporter is designed to run as unprivileged user, root is not required."</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token assign-left variable">ts</span><span class="token operator">=</span><span class="token number">2024</span>-02-22T13:25:37.970Z <span class="token assign-left variable">caller</span><span class="token operator">=</span>diskstats_common.go:111 <span class="token assign-left variable">level</span><span class="token operator">=</span>info <span class="token assign-left variable">collector</span><span class="token operator">=</span>diskstats <span class="token assign-left variable">msg</span><span class="token operator">=</span><span class="token string">"Parsed flag --collector.diskstats.device-exclude"</span> <span class="token assign-left variable">flag</span><span class="token operator">=</span>^<span class="token punctuation">(</span>ram<span class="token operator">|</span>loop<span class="token operator">|</span>fd<span class="token operator">|</span><span class="token punctuation">(</span>h<span class="token operator">|</span>s<span class="token operator">|</span><span class="token function">v</span><span class="token operator">|</span>xv<span class="token punctuation">)</span>d<span class="token punctuation">[</span>a-z<span class="token punctuation">]</span><span class="token operator">|</span>nvme<span class="token punctuation">\</span>d+n<span class="token punctuation">\</span>d+p<span class="token punctuation">)</span><span class="token punctuation">\</span>d+$</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token assign-left variable">ts</span><span class="token operator">=</span><span class="token number">2024</span>-02-22T13:25:37.970Z <span class="token assign-left variable">caller</span><span class="token operator">=</span>node_exporter.go:110 <span class="token assign-left variable">level</span><span class="token operator">=</span>info <span class="token assign-left variable">msg</span><span class="token operator">=</span><span class="token string">"Enabled collectors"</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token assign-left variable">ts</span><span class="token operator">=</span><span class="token number">2024</span>-02-22T13:25:37.970Z <span class="token assign-left variable">caller</span><span class="token operator">=</span>node_exporter.go:117 <span class="token assign-left variable">level</span><span class="token operator">=</span>info <span class="token assign-left variable">collector</span><span class="token operator">=</span>cpu</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token assign-left variable">ts</span><span class="token operator">=</span><span class="token number">2024</span>-02-22T13:25:37.970Z <span class="token assign-left variable">caller</span><span class="token operator">=</span>node_exporter.go:117 <span class="token assign-left variable">level</span><span class="token operator">=</span>info <span class="token assign-left variable">collector</span><span class="token operator">=</span>diskstats</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token assign-left variable">ts</span><span class="token operator">=</span><span class="token number">2024</span>-02-22T13:25:37.970Z <span class="token assign-left variable">caller</span><span class="token operator">=</span>node_exporter.go:117 <span class="token assign-left variable">level</span><span class="token operator">=</span>info <span class="token assign-left variable">collector</span><span class="token operator">=</span>meminfo</pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token assign-left variable">ts</span><span class="token operator">=</span><span class="token number">2024</span>-02-22T13:25:37.970Z <span class="token assign-left variable">caller</span><span class="token operator">=</span>node_exporter.go:117 <span class="token assign-left variable">level</span><span class="token operator">=</span>info <span class="token assign-left variable">collector</span><span class="token operator">=</span>netstat</pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token assign-left variable">ts</span><span class="token operator">=</span><span class="token number">2024</span>-02-22T13:25:37.970Z <span class="token assign-left variable">caller</span><span class="token operator">=</span>tls_config.go:274 <span class="token assign-left variable">level</span><span class="token operator">=</span>info <span class="token assign-left variable">msg</span><span class="token operator">=</span><span class="token string">"Listening on"</span> <span class="token assign-left variable">address</span><span class="token operator">=</span><span class="token punctuation">[</span>::<span class="token punctuation">]</span>:9100</pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token assign-left variable">ts</span><span class="token operator">=</span><span class="token number">2024</span>-02-22T13:25:37.970Z <span class="token assign-left variable">caller</span><span class="token operator">=</span>tls_config.go:277 <span class="token assign-left variable">level</span><span class="token operator">=</span>info <span class="token assign-left variable">msg</span><span class="token operator">=</span><span class="token string">"TLS is disabled."</span> <span class="token assign-left variable">http2</span><span class="token operator">=</span>false <span class="token assign-left variable">address</span><span class="token operator">=</span><span class="token punctuation">[</span>::<span class="token punctuation">]</span>:9100</pre></td></tr></table></figure><h5 id="44-启动node_exporter"><a class="anchor" href="#44-启动node_exporter">#</a> 4.4 启动 node_exporter</h5><p>1、配置 system 管理 Prometheus 启动和停止</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@prom-node01 ~<span class="token punctuation">]</span><span class="token comment"># cat /usr/lib/systemd/system/node_exporter.service</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>Unit<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token assign-left variable">Description</span><span class="token operator">=</span>node_exporter</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token assign-left variable">Documentation</span><span class="token operator">=</span>https://prometheus.io/</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token assign-left variable">After</span><span class="token operator">=</span>network.target</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">[</span>Service<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/etc/node_exporter/node_exporter <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="9"></td><td><pre>  --web.listen-address<span class="token operator">=</span>:9100 <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  --web.max-requests<span class="token operator">=</span><span class="token number">40</span> <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token parameter variable">--collector.mountstats</span> <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token parameter variable">--collector.systemd</span> <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token parameter variable">--collector.ethtool</span> <span class="token punctuation">\</span></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token parameter variable">--collector.tcpstat</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token assign-left variable">ExecReload</span><span class="token operator">=</span>/bin/kill <span class="token parameter variable">-HUP</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token assign-left variable">TimeoutStopSec</span><span class="token operator">=</span>20s</pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token assign-left variable">Restart</span><span class="token operator">=</span>always</pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">[</span>Install<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>multi-user.target</pre></td></tr></table></figure><p>2、启动 node-exporter</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@prom-node01 ~<span class="token punctuation">]</span><span class="token comment"># systemctl daemon-reload</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@prom-node01 ~<span class="token punctuation">]</span><span class="token comment"># systemctl start node_exporter</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@prom-node01 ~<span class="token punctuation">]</span><span class="token comment"># netstat -lntp|grep 9100</span></pre></td></tr><tr><td data-num="4"></td><td><pre>tcp6       <span class="token number">0</span>      <span class="token number">0</span> :::9100                 :::*                    LISTEN      <span class="token number">6340</span>/node_exporter</pre></td></tr></table></figure><p>3、访问对应的 metrics，验证是否能采集到数据</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@prom-node01 ~<span class="token punctuation">]</span><span class="token comment"># curl -s http://localhost:9100/metrics |head -10</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># HELP go_gc_duration_seconds A summary of the pause duration of garbage collection cycles.</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment"># TYPE go_gc_duration_seconds summary</span></pre></td></tr><tr><td data-num="4"></td><td><pre>go_gc_duration_seconds<span class="token punctuation">&#123;</span>quantile<span class="token operator">=</span><span class="token string">"0"</span><span class="token punctuation">&#125;</span> <span class="token number">3</span>.066e-05</pre></td></tr><tr><td data-num="5"></td><td><pre>go_gc_duration_seconds<span class="token punctuation">&#123;</span>quantile<span class="token operator">=</span><span class="token string">"0.25"</span><span class="token punctuation">&#125;</span> <span class="token number">3</span>.523e-05</pre></td></tr><tr><td data-num="6"></td><td><pre>go_gc_duration_seconds<span class="token punctuation">&#123;</span>quantile<span class="token operator">=</span><span class="token string">"0.5"</span><span class="token punctuation">&#125;</span> <span class="token number">3</span>.7351e-05</pre></td></tr><tr><td data-num="7"></td><td><pre>go_gc_duration_seconds<span class="token punctuation">&#123;</span>quantile<span class="token operator">=</span><span class="token string">"0.75"</span><span class="token punctuation">&#125;</span> <span class="token number">3</span>.9952e-05</pre></td></tr><tr><td data-num="8"></td><td><pre>go_gc_duration_seconds<span class="token punctuation">&#123;</span>quantile<span class="token operator">=</span><span class="token string">"1"</span><span class="token punctuation">&#125;</span> <span class="token number">0.000122787</span></pre></td></tr><tr><td data-num="9"></td><td><pre>go_gc_duration_seconds_sum <span class="token number">0.000496506</span></pre></td></tr><tr><td data-num="10"></td><td><pre>go_gc_duration_seconds_count <span class="token number">11</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment"># HELP go_goroutines Number of goroutines that currently exist.</span></pre></td></tr></table></figure><h5 id="45-配置prometheus"><a class="anchor" href="#45-配置prometheus">#</a> 4.5 配置 Prometheus</h5><p>1、修改 Prometheus 配置，添加新的 Job 分组，然后将对应的节点纳入监控中；</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@prom-node01 ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/prometheus/prometheus.yml</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># 全局段定义</span></pre></td></tr><tr><td data-num="3"></td><td><pre>global:</pre></td></tr><tr><td data-num="4"></td><td><pre>  scrape_interval: 15s <span class="token comment"># 设置 Prometheus 抓取指标数据的间隔，默认为 15 秒。</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># 抓取指定的目标</span></pre></td></tr><tr><td data-num="6"></td><td><pre>scrape_configs:</pre></td></tr><tr><td data-num="7"></td><td><pre>  - job_name: <span class="token string">"prometheus"</span> <span class="token comment"># 定义一个抓取任务，名为 'prometheus'。</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    metrics_path: <span class="token string">"/metrics"</span> <span class="token comment"># 指定 Prometheus 从监控目标暴露的 HTTP 端点路径抓取指标，默认为 '/metrics'。</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    static_configs: <span class="token comment"># 配置静态目标地址，Prometheus 将定期从如下这些地址抓取指标。</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    - targets: <span class="token punctuation">[</span><span class="token string">"prom-node01.oldxu.net:9090"</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>  - job_name: <span class="token string">"grafana"</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    metrics_path: <span class="token string">"/metrics"</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    static_configs:</pre></td></tr><tr><td data-num="15"></td><td><pre>    - targets: <span class="token punctuation">[</span><span class="token string">"prom-node01.oldxu.net:3000"</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>  - job_name: <span class="token string">"node_exporter"</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    metrics_path: <span class="token string">"/metrics"</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    static_configs:</pre></td></tr><tr><td data-num="20"></td><td><pre>    - targets: <span class="token punctuation">[</span><span class="token string">"prom-node01.oldxu.net:9100"</span>,<span class="token string">"prom-node02.oldxu.net:9100"</span>,<span class="token string">"prom-node03.oldxu.net:9100"</span><span class="token punctuation">]</span></pre></td></tr></table></figure><p>2、重新加载 Prometheus</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@prom-node01 ~<span class="token punctuation">]</span><span class="token comment"># curl -v -X POST http://localhost:9090/-/reload</span></pre></td></tr><tr><td data-num="2"></td><td><pre>* About to connect<span class="token punctuation">(</span><span class="token punctuation">)</span> to localhost port <span class="token number">9090</span> <span class="token punctuation">(</span><span class="token comment">#0)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>*   Trying ::1<span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="4"></td><td><pre>* Connected to localhost <span class="token punctuation">(</span>::1<span class="token punctuation">)</span> port <span class="token number">9090</span> <span class="token punctuation">(</span><span class="token comment">#0)</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">></span> POST /-/reload HTTP/1.1</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token operator">></span> User-Agent: curl/7.29.0</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token operator">></span> Host: localhost:9090</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token operator">></span> Accept: */*</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token operator">></span> </pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token operator">&lt;</span> HTTP/1.1 <span class="token number">200</span> OK</pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token operator">&lt;</span> Date: Thu, <span class="token number">22</span> Feb <span class="token number">2024</span> <span class="token number">13</span>:35:56 GMT</pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token operator">&lt;</span> Content-Length: <span class="token number">0</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token operator">&lt;</span> </pre></td></tr><tr><td data-num="14"></td><td><pre>* Connection <span class="token comment">#0 to host localhost left intact</span></pre></td></tr></table></figure><p>3、检查 Prometheus 是否已将对应节点纳入监控（点击 Status--&gt;Targets）</p><p><img loading="lazy" data-src="https://wp-cdn.4ce.cn/v2/ClR3Pyh.jpeg" alt="1.jpg"></p><h5 id="46-导入grafana模板"><a class="anchor" href="#46-导入grafana模板">#</a> 4.6 导入 Grafana 模板</h5><p>在 Grafana 的官方插件库中，有很多 Node-exporter 模板。其中相对受欢的模板的 ID 是： ﻿11074、1860﻿。</p><ul><li>11074﻿：模板包括了 CPU、内存、磁盘、网络、温度传感器等指标（常用）。</li><li>1860﻿：模板包括 CPU、内存、磁盘、网络等。这运行状况，及时发现潜在问题并进行调优。</li></ul><p><img loading="lazy" data-src="https://wp-cdn.4ce.cn/v2/oqN9oVU.jpeg" alt="2.jpg"></p><h4 id="五-node_exporter常用指标"><a class="anchor" href="#五-node_exporter常用指标">#</a> 五、node_exporter 常用指标</h4><h5 id="51-cpu与内存相关指标"><a class="anchor" href="#51-cpu与内存相关指标">#</a> 5.1 CPU 与内存相关指标</h5><p>1、CPU 负载相关核心指标</p><table><thead><tr><th style="text-align:center">指标名称</th><th style="text-align:center">指标类型</th><th style="text-align:center">指标含义</th></tr></thead><tbody><tr><td style="text-align:center">node_load1</td><td style="text-align:center">gauge</td><td style="text-align:center">过去 1 分钟的系统平均负载。</td></tr><tr><td style="text-align:center">node_load5</td><td style="text-align:center">gauge</td><td style="text-align:center">过去 5 分钟的系统平均负载。</td></tr><tr><td style="text-align:center">node_load15</td><td style="text-align:center">gauge</td><td style="text-align:center">过去 1 5 分钟的系统平均负载。</td></tr></tbody></table><p>2、CPU 使用相关核心指标</p><table><thead><tr><th style="text-align:center">指标名称</th><th style="text-align:center">指标类型</th><th style="text-align:center">指标含义</th></tr></thead><tbody><tr><td style="text-align:center">node_cpu_seconds_total</td><td style="text-align:center">Counter</td><td style="text-align:center">CPU 在不同模式下使用的时间（以秒为单位）。</td></tr></tbody></table><p>3、内存相关核心指标</p><table><thead><tr><th style="text-align:center">指标名称</th><th style="text-align:center">指标类型</th><th style="text-align:center">指标含义</th></tr></thead><tbody><tr><td style="text-align:center">node_memory_MemTotal_bytes</td><td style="text-align:center">gauge</td><td style="text-align:center">系统总内存量（以字节为单位）。</td></tr><tr><td style="text-align:center">node_memory_MemAvailable_bytes</td><td style="text-align:center">gauge</td><td style="text-align:center">系统当前可用的内存量（以字节为单位）。</td></tr><tr><td style="text-align:center">node_memory_Cached_bytes</td><td style="text-align:center">gauge</td><td style="text-align:center">系统缓存使用的内存（以字节为单位）。</td></tr><tr><td style="text-align:center">node_memory_Buffers_bytes</td><td style="text-align:center">gauge</td><td style="text-align:center">用于缓冲使用的内存（以字节为单位）。</td></tr></tbody></table><p>计算可用内存百分比： node_memory_MemAvailable_bytes /node_memory_MemTotal_bytes * 100</p><p>计算已用内存百分比：(node_memory_MemTotal_bytes - node_memory_MemAvailable_bytes) /node_memory_MemTotal_bytes *<br>100</p><p>4、SWAP 相关核心指标</p><table><thead><tr><th style="text-align:center">指标名称</th><th style="text-align:center">指标类型</th><th style="text-align:center">指标含义</th></tr></thead><tbody><tr><td style="text-align:center">node_memory_SwapTotal_bytes</td><td style="text-align:center">gauge</td><td style="text-align:center">系统交换空间总量（以字节为单位）。</td></tr><tr><td style="text-align:center">node_memory_SwapFree_bytes</td><td style="text-align:center">gauge</td><td style="text-align:center">系统未被使用的交换空间（以字节为单位）。</td></tr></tbody></table><h5 id="52-磁盘与网络相关指标"><a class="anchor" href="#52-磁盘与网络相关指标">#</a> 5.2 磁盘与网络相关指标</h5><p>1、磁盘空间相关核心指标</p><table><thead><tr><th style="text-align:center">指标名称</th><th style="text-align:center">指标类型</th><th style="text-align:center">指标含义</th></tr></thead><tbody><tr><td style="text-align:center">node_filesystem_size_bytes</td><td style="text-align:center">gauge</td><td style="text-align:center">文件系统大小（以字节为单位）。</td></tr><tr><td style="text-align:center">node_filesystem_avail_bytes</td><td style="text-align:center">gauge</td><td style="text-align:center">文件系统可用空间（以字节为单位）。</td></tr></tbody></table><p>计算可用空间百分比： node_filesystem_avail_bytes /node_filesystem_size_bytes * 100</p><p>计算已用空间百分比：(node_filesystem_size_bytes - node_filesystem_avail_bytes) /node_filesystem_size_bytes * 100</p><p>2、磁盘 Inode 相关核心指标</p><table><thead><tr><th style="text-align:center">指标名称</th><th style="text-align:center">指标类型</th><th style="text-align:center">指标含义</th></tr></thead><tbody><tr><td style="text-align:center">node_filesystem_files</td><td style="text-align:center">gauge</td><td style="text-align:center">文件系统中 inode 能使用的总数。</td></tr><tr><td style="text-align:center">node_filesystem_files_free</td><td style="text-align:center">gauge</td><td style="text-align:center">文件系统中空闲 inode 的数量。</td></tr></tbody></table><p>计算已用的 Inode 百分比： (node_filesystem_files - node_filesystem_files_free) /node_filesystem_files * 100</p><p>3、磁盘 IO 吞吐量相关核心指标</p><table><thead><tr><th style="text-align:center">指标名称</th><th style="text-align:center">指标类型</th><th style="text-align:left">指标含义</th></tr></thead><tbody><tr><td style="text-align:center">node_disk_read_bytes_total</td><td style="text-align:center">Counter</td><td style="text-align:left">从给定设备读取的总字节数。（以字节为单位）。（使用 irate 可以得到每秒写入大小）</td></tr><tr><td style="text-align:center">node_disk_written_bytes_total</td><td style="text-align:center">Counter</td><td style="text-align:left">向给定设备写入的总字节数。（以字节为单位）。（使用 irate 可以得到每秒写入大小）</td></tr></tbody></table><p>4、磁盘 IOPS 相关核心指标</p><table><thead><tr><th style="text-align:center">指标名称</th><th style="text-align:center">指标类型</th><th style="text-align:left">指标含义</th></tr></thead><tbody><tr><td style="text-align:center">node_disk_reads_completed_total</td><td style="text-align:center">Counter</td><td style="text-align:left">磁盘设备完成的读操作总数。（使用 irate 可以得到每秒读操作的平均数）</td></tr><tr><td style="text-align:center">node_disk_writes_completed_total</td><td style="text-align:center">Counter</td><td style="text-align:left">磁盘设备完成的写操作总数。（使用 irate 可以得到每秒读操作的平均数）</td></tr></tbody></table><p>5、网络核心指标</p><table><thead><tr><th style="text-align:center">指标名称</th><th style="text-align:center">指标类型</th><th style="text-align:left">指标含义</th></tr></thead><tbody><tr><td style="text-align:center">node_network_receive_bytes_total</td><td style="text-align:center">Counter</td><td style="text-align:left">网络接口接收到的总字节数。（以字节为单位）。</td></tr><tr><td style="text-align:center">node_network_transmit_bytes_total</td><td style="text-align:center">Counter</td><td style="text-align:left">网络接口发送出去的总字节数。（以字节为单位）。</td></tr></tbody></table><p>6、连接追踪核心指标</p><table><thead><tr><th style="text-align:center">指标名称</th><th style="text-align:center">指标类型</th><th style="text-align:left">指标含义</th></tr></thead><tbody><tr><td style="text-align:center">node_nf_conntrack_entries</td><td style="text-align:center">gauge</td><td style="text-align:left">系统正在跟踪的网络连接的数量。这包括所有类型的连接 TCP， UDP、ICMP 等</td></tr><tr><td style="text-align:center">node_nf_conntrack_entries_limit</td><td style="text-align:center">gauge</td><td style="text-align:left">系统 conntrack 能够跟踪的网络连接的最大数量。读取的是 /proc/sys/net/netfilter/nf_conntrack_max，内核参数为：net.netfilter.nf_conntrack_max）</td></tr></tbody></table><p>计算连接追踪使用百分比： node_nf_conntrack_entries /node_nf_conntrack_entries_limit * 100</p><h5 id="53-tcp与其他相关指标"><a class="anchor" href="#53-tcp与其他相关指标">#</a> 5.3 TCP 与其他相关指标</h5><p>1、TCP 相关核心指标</p><table><thead><tr><th style="text-align:center">指标名称</th><th style="text-align:center">指标类型</th><th style="text-align:left">指标含义</th></tr></thead><tbody><tr><td style="text-align:center" state="time_wait">node_tcp_connection_states</td><td style="text-align:center">gauge</td><td style="text-align:left">当前已断开的 TCP 连接数。</td></tr><tr><td style="text-align:center" state="established">node_tcp_connection_states</td><td style="text-align:center">gauge</td><td style="text-align:left">当前建立的 TCP 连接数。</td></tr></tbody></table><p>2、文件描述符</p><table><thead><tr><th style="text-align:center">指标名称</th><th style="text-align:center">指标类型</th><th style="text-align:left">指标含义</th></tr></thead><tbody><tr><td style="text-align:center">node_filefd_maximum</td><td style="text-align:center">gauge</td><td style="text-align:left">当前系统最大可用的文件描述符数量（由 fs.file-max 内核参数设定，具体读取的文件 /proc/sys/fs/file-max）</td></tr><tr><td style="text-align:center">node_filefd_allocated</td><td style="text-align:center">gauge</td><td style="text-align:left">当前系统已经分配的文件描述符的数量。</td></tr></tbody></table><p>当前文件描述符已使用百分比 ：(node_filefd_allocated /node_filefd_maximum) * 100</p><p>3、系统其他指标</p><table><thead><tr><th style="text-align:center">指标名称</th><th style="text-align:center">指标类型</th><th style="text-align:left">指标含义</th></tr></thead><tbody><tr><td style="text-align:center">node_time_seconds</td><td style="text-align:center">gauge</td><td style="text-align:left">当前系统的时间戳</td></tr><tr><td style="text-align:center">node_boot_time_seconds</td><td style="text-align:center">gauge</td><td style="text-align:left">系统最后一次启动的时间戳。</td></tr></tbody></table><p>系统自启动以来，总共运行了多少天 = (node_time_seconds - node_boot_time_seconds)/ 86400</p><div class="tags"><a href="/tags/Prometheus/" rel="tag"><i class="ic i-tag"></i>Prometheus</a></div></div><footer><div class="meta"><span class="icon"><i class="ic i-eye"></i></span><span>此文章已被阅读次数:</span><span class="waline-pageview-count" id="twikoo_visitors" data-path="/posts/1595025559.html">正在加载...</span><span class="item"><span class="icon"><i class="ic i-calendar-check"></i></span><span class="text">更新于</span><time title="修改时间：2025-08-19 21:23:50" itemprop="dateModified" datetime="2025-08-19T21:23:50+08:00">2025-08-19</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i>赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img loading="lazy" data-src="/assets/wechatpay.png" alt="Xu Yong 微信支付"><p>微信支付</p></div><div><img loading="lazy" data-src="/assets/alipay.png" alt="Xu Yong 支付宝"><p>支付宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者：</strong>Xu Yong<i class="ic i-at"><em>@</em></i>LinuxSre云原生</li><li class="link"><strong>本文链接：</strong><a href="http://ixuyong.cn/posts/1595025559.html" title="Prometheus监控实战（一）">http://ixuyong.cn/posts/1595025559.html</a></li><li class="license"><strong>版权声明：</strong>本站所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/posts/2041568856.html" rel="prev" itemprop="url" data-background-image="https:&#x2F;&#x2F;wp-cdn.4ce.cn&#x2F;v2&#x2F;el5JHV9.jpeg" title="Prometheus监控Kubernetes"><span class="type">上一篇</span><span class="category"><i class="ic i-flag"></i>Prometheus</span><h3>Prometheus监控Kubernetes</h3></a></div><div class="item right"><a href="/posts/3386060324.html" rel="next" itemprop="url" data-background-image="https:&#x2F;&#x2F;wp-cdn.4ce.cn&#x2F;v2&#x2F;oApfFnU.jpeg" title="PromQL快速入门（二）"><span class="type">下一篇</span><span class="category"><i class="ic i-flag"></i>Prometheus</span><h3>PromQL快速入门（二）</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#prometheus%E7%9B%91%E6%8E%A7%E5%AE%9E%E6%88%98%E4%B8%80"><span class="toc-number">1.</span> <span class="toc-text">Prometheus 监控实战（一）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80-prometheus%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.1.</span> <span class="toc-text">一、Prometheus 介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#11-prometheus%E6%98%AF%E4%BB%80%E4%B9%88"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.1 Prometheus 是什么</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#12-%E4%BB%80%E4%B9%88%E6%98%AF%E6%97%B6%E5%BA%8F%E6%95%B0%E6%8D%AE"><span class="toc-number">1.1.2.</span> <span class="toc-text">1.2 什么是时序数据</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#13-prometheus%E6%97%B6%E5%BA%8F%E6%95%B0%E6%8D%AE"><span class="toc-number">1.1.3.</span> <span class="toc-text">1.3 Prometheus 时序数据</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#14-prometheus%E6%95%B0%E6%8D%AE%E9%87%87%E9%9B%86%E4%B8%89%E7%A7%8D%E6%96%B9%E5%BC%8F"><span class="toc-number">1.1.4.</span> <span class="toc-text">1.4 Prometheus 数据采集三种方式</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#15-prometheus%E4%BD%9C%E4%B8%9A%E4%B8%8E%E5%AE%9E%E4%BE%8B"><span class="toc-number">1.1.5.</span> <span class="toc-text">1.5 Prometheus 作业与实例</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#16-prometheus%E6%9E%B6%E6%9E%84"><span class="toc-number">1.1.6.</span> <span class="toc-text">1.6 Prometheus 架构</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#17-prometheus%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.1.7.</span> <span class="toc-text">1.7 Prometheus 数据模型</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8C-prometheus%E5%AE%89%E8%A3%85"><span class="toc-number">1.2.</span> <span class="toc-text">二、Prometheus 安装</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#21-%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">1.2.1.</span> <span class="toc-text">2.1 环境准备</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#22-%E9%85%8D%E7%BD%AEhost%E8%A7%A3%E6%9E%90"><span class="toc-number">1.2.2.</span> <span class="toc-text">2.2 配置 Host 解析</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#23-%E4%B8%8B%E8%BD%BDprometheus"><span class="toc-number">1.2.3.</span> <span class="toc-text">2.3 下载 Prometheus</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#24-%E9%85%8D%E7%BD%AEprometheus"><span class="toc-number">1.2.4.</span> <span class="toc-text">2.4 配置 Prometheus</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#25-%E5%90%AF%E5%8A%A8prometheus"><span class="toc-number">1.2.5.</span> <span class="toc-text">2.5 启动 Prometheus</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#26-%E8%AE%BF%E9%97%AEprometheus"><span class="toc-number">1.2.6.</span> <span class="toc-text">2.6 访问 Prometheus</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#27-prometheus%E7%9A%84webui"><span class="toc-number">1.2.7.</span> <span class="toc-text">2.7 Prometheus 的 WebUI</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89-%E5%AE%89%E8%A3%85grafana%E5%9B%BE%E5%BD%A2%E5%B1%95%E7%A4%BA"><span class="toc-number">1.3.</span> <span class="toc-text">三、安装 Grafana 图形展示</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#31-grafana%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.3.1.</span> <span class="toc-text">3.1 Grafana 介绍</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#32-grafana%E5%AE%89%E8%A3%85"><span class="toc-number">1.3.2.</span> <span class="toc-text">3.2 Grafana 安装</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#33-%E9%85%8D%E7%BD%AEgrafana%E6%95%B0%E6%8D%AE%E6%BA%90"><span class="toc-number">1.3.3.</span> <span class="toc-text">3.3 配置 Grafana 数据源</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#34-%E9%85%8D%E7%BD%AEprometheus%E7%9B%91%E6%8E%A7grafana"><span class="toc-number">1.3.4.</span> <span class="toc-text">3.4 配置 Prometheus 监控 Grafana</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9B%9B-%E9%85%8D%E7%BD%AEprometheus%E7%9B%91%E6%8E%A7node%E8%8A%82%E7%82%B9"><span class="toc-number">1.4.</span> <span class="toc-text">四、配置 Prometheus 监控 Node 节点</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#41-%E5%A6%82%E4%BD%95%E7%9B%91%E6%8E%A7node%E8%8A%82%E7%82%B9"><span class="toc-number">1.4.1.</span> <span class="toc-text">4.1 如何监控 Node 节点</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#42-%E5%AE%89%E8%A3%85node_exporter"><span class="toc-number">1.4.2.</span> <span class="toc-text">4.2 安装 node_exporter</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#43-%E9%85%8D%E7%BD%AEnode_exporter"><span class="toc-number">1.4.3.</span> <span class="toc-text">4.3 配置 node_exporter</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#44-%E5%90%AF%E5%8A%A8node_exporter"><span class="toc-number">1.4.4.</span> <span class="toc-text">4.4 启动 node_exporter</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#45-%E9%85%8D%E7%BD%AEprometheus"><span class="toc-number">1.4.5.</span> <span class="toc-text">4.5 配置 Prometheus</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#46-%E5%AF%BC%E5%85%A5grafana%E6%A8%A1%E6%9D%BF"><span class="toc-number">1.4.6.</span> <span class="toc-text">4.6 导入 Grafana 模板</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%94-node_exporter%E5%B8%B8%E7%94%A8%E6%8C%87%E6%A0%87"><span class="toc-number">1.5.</span> <span class="toc-text">五、node_exporter 常用指标</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#51-cpu%E4%B8%8E%E5%86%85%E5%AD%98%E7%9B%B8%E5%85%B3%E6%8C%87%E6%A0%87"><span class="toc-number">1.5.1.</span> <span class="toc-text">5.1 CPU 与内存相关指标</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#52-%E7%A3%81%E7%9B%98%E4%B8%8E%E7%BD%91%E7%BB%9C%E7%9B%B8%E5%85%B3%E6%8C%87%E6%A0%87"><span class="toc-number">1.5.2.</span> <span class="toc-text">5.2 磁盘与网络相关指标</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#53-tcp%E4%B8%8E%E5%85%B6%E4%BB%96%E7%9B%B8%E5%85%B3%E6%8C%87%E6%A0%87"><span class="toc-number">1.5.3.</span> <span class="toc-text">5.3 TCP 与其他相关指标</span></a></li></ol></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/posts/2041568856.html" rel="bookmark" title="Prometheus监控Kubernetes">Prometheus监控Kubernetes</a></li><li class="active"><a href="/posts/1595025559.html" rel="bookmark" title="Prometheus监控实战（一）">Prometheus监控实战（一）</a></li><li><a href="/posts/3386060324.html" rel="bookmark" title="PromQL快速入门（二）">PromQL快速入门（二）</a></li><li><a href="/posts/4081185381.html" rel="bookmark" title="Prometheus监控实战（三）">Prometheus监控实战（三）</a></li><li><a href="/posts/4081185382.html" rel="bookmark" title="Prometheus监控实战（四）">Prometheus监控实战（四）</a></li><li><a href="/posts/737291847.html" rel="bookmark" title="Prometheus监控实战（五）">Prometheus监控实战（五）</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" loading="lazy" decoding="async" itemprop="image" alt="Xu Yong" src="/assets/avatar.png"><p class="name" itemprop="name">Xu Yong</p><div class="description" itemprop="description">专注于 Linux 运维、云计算、云原⽣等技术</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">64</span><span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">16</span><span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">19</span><span class="name">标签</span></a></div></nav><div class="social"><a target="_blank" rel="noopener" href="https://github.com/xyapples" class="item github" title="https:&#x2F;&#x2F;github.com&#x2F;xyapples"><i class="ic i-github"></i></a><a target="_blank" rel="noopener" href="https://gitee.com/chinagei" class="item gitee" title="https:&#x2F;&#x2F;gitee.com&#x2F;chinagei"><i class="ic i-gitee"></i></a><a href="mailto:373370405@qq.com" class="item email" title="mailto:373370405@qq.com"><i class="ic i-envelope"></i></a></div><div class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-about"></i>关于</a></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友链</a></li></div></div></div></div><ul id="quick"><li class="prev pjax"><a href="/posts/3386060324.html" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/posts/2041568856.html" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/Nginx/" title="分类于Nginx">Nginx</a></div><span><a href="/posts/2322410227.html">Nginx负载均衡会话共享（六）</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/DevOps/" title="分类于DevOps">DevOps</a></div><span><a href="/posts/889219339.html">K8S基于Jenkins实现SpringCloud微服务CI与CD实践（三）</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Linux/" title="分类于Linux">Linux</a></div><span><a href="/posts/430579059.html">NFS网络文件系统</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Linux/" title="分类于Linux">Linux</a></div><span><a href="/posts/2889248111.html">Vsftp服务实践</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Nginx/" title="分类于Nginx">Nginx</a></div><span><a href="/posts/865547436.html">Nginx基础架构LNMP（三）</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/DevOps/" title="分类于DevOps">DevOps</a></div><span><a href="/posts/1208493697.html">K8S基于Jenkins实现SpringCloud微服务CI与CD实践（一）</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Nginx/" title="分类于Nginx">Nginx</a></div><span><a href="/posts/1240534980.html">Nginx TCP四层负载均衡(八)</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Nginx/" title="分类于Nginx">Nginx</a></div><span><a href="/posts/1868764668.html">Nginx负载均衡基于uri调度场景（七）</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Prometheus/" title="分类于Prometheus">Prometheus</a></div><span><a href="/posts/2041568856.html">Prometheus监控Kubernetes</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Prometheus/" title="分类于Prometheus">Prometheus</a></div><span><a href="/posts/1595025559.html">Prometheus监控实战（一）</a></span></li></ul></div><div class="rpost pjax"><h2>最新评论</h2><ul class="leancloud-recent-comment" id="new-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2022 -<span itemprop="copyrightYear">2025</span><span class="with-love"><i class="ic i-sakura rotate"></i></span><span class="author" itemprop="copyrightHolder">Xu Yong @ LinuxSre云原生</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i></span><span title="站点总字数">1.7m 字</span><span class="post-meta-divider"> | </span><span class="post-meta-item-icon"><i class="ic i-coffee"></i></span><span title="站点阅读时长">25:01</span></div><div class="powered-by">基于 <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> & Theme.<a target="_blank" rel="noopener" href="https://github.com/theme-shoka-x/hexo-theme-shokaX/">ShokaX</a></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL = {
    ispost: true,
        path: `posts/1595025559.html`,
        favicon: {
        show: `（●´3｀●）やれやれだぜ`,
        hide: `(´Д｀)大変だ！`
    },
    search: {
        placeholder: "文章搜索",
        empty: "关于 「 ${query} 」，什么也没搜到",
        stats: "${time} ms 内找到 ${hits} 条结果"
    },
    copy_tex: false,
    katex: false,
    mermaid: false,
    audio: undefined,
    fancybox: true,
    nocopy: false,
    outime: true,
    template: `<div class="note warning"><p><span class="label warning">文章时效性提示</span><br>这是一篇发布于 {{publish}} 天前，最后一次更新在 {{updated}} 天前的文章，部分信息可能已经发生改变，请注意甄别。</p></div>`,
    quiz: {
        choice: `单选题`,
        multiple: `多选题`,
        true_false: `判断题`,
        essay: `问答题`,
        gap_fill: `填空题`,
        mistake: `错题备注`
    },
    ignores: [
        (uri) => uri.includes('#'),
        (uri) => new RegExp(LOCAL.path + '$').test(uri),
            []
    ]
};</script><script src="https://s4.zstatic.net/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha384-k6YtvFUEIuEFBdrLKJ3YAUbBki333tj1CSUisai5Cswsg9wcLNaPzsTHDswp4Az8" crossorigin="anonymous" fetchpriority="high"></script><script src="https://s4.zstatic.net/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha384-ZvpUoO&#x2F;+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn&#x2F;6Z&#x2F;hRTt8+pR6L4N2" crossorigin="anonymous" fetchpriority="high"></script><script src="/js/siteInit.js?v=0.4.17" type="module" fetchpriority="high" defer></script></body></html><!-- rebuild by hrmmi -->