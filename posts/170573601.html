<!-- build time:Wed May 28 2025 19:20:29 GMT+0800 (ä¸­å›½æ ‡å‡†æ—¶é—´) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta http-equiv="X-UA-COMPATIBLE" content="IE=edge,chrome=1"><meta name="renderer" content="webkit"><link rel="icon" type="image/ico" sizes="32x32" href="/assets/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon.ico"><link rel="alternate" href="/rss.xml" title="LinuxSreäº‘åŸç”Ÿ" type="application/rss+xml"><link rel="alternate" href="/atom.xml" title="LinuxSreäº‘åŸç”Ÿ" type="application/atom+xml"><link rel="alternate" type="application/json" title="LinuxSreäº‘åŸç”Ÿ" href="http://ixuyong.cn/feed.json"><link rel="preconnect" href="https://s4.zstatic.net"><link rel="preconnect" href="https://at.alicdn.com"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7CFredericka%20the%20Great:400,400italic,700,700italic%7CNoto%20Serif%20JP:400,400italic,700,700italic%7CNoto%20Serif%20SC:400,400italic,700,700italic%7CInconsolata:400,400italic,700,700italic&display=swap&subset=latin,latin-ext" media="none" onload="this.media&#x3D;&#39;all&#39;"><link rel="stylesheet" href="/css/app.css?v=0.4.17"><link rel="modulepreload" href="/js/chunk-GV364XSK.js"><link rel="modulepreload" href="/js/chunk-NYSE5UKM.js"><link rel="modulepreload" href="/js/chunk-RONCYO2S.js"><link rel="modulepreload" href="/js/chunk-THHXCRSX.js"><link rel="modulepreload" href="/js/chunk-WIQECBEN.js"><link rel="modulepreload" href="/js/comments-DL2IYMPZ.js"><link rel="modulepreload" href="/js/copy-tex-NADCTXPG.js"><link rel="modulepreload" href="/js/post-DA635IH6.js"><link rel="modulepreload" href="/js/quicklink-WEDHL4BA.js"><link rel="modulepreload" href="/js/search-VCZRKTM5.js"><link rel="modulepreload" href="/js/siteInit.js"><link rel="modulepreload" href="/js/waline-NNBYRQEE.js"><link rel="stylesheet" href="/css/comments-F4ZGS7LD.css" media="none" onload="this.media&#x3D;&#39;all&#39;"><link rel="stylesheet" href="/css/siteInit.css" media="none" onload="this.media&#x3D;&#39;all&#39;"><link rel="stylesheet" href="/css/waline-IDNZKML2.css" media="none" onload="this.media&#x3D;&#39;all&#39;"><link rel="preload" href="https://s21.ax1x.com/2025/03/29/pEsS0hD.png" as="image" fetchpriority="high"><meta name="keywords" content="Kubernetes"><meta name="description" content="ä¸“æ³¨äº Linux è¿ç»´ã€äº‘è®¡ç®—ã€äº‘åŸâ½£ç­‰æŠ€æœ¯"><link rel="canonical" href="http://ixuyong.cn/posts/170573601.html"><title>K8sæœåŠ¡å‘å¸ƒIngress</title><meta name="generator" content="Hexo 7.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">K8sæœåŠ¡å‘å¸ƒIngress</h1><div class="meta"><span class="item" title="åˆ›å»ºæ—¶é—´ï¼š2025-04-26 16:52:06"><span class="icon"><i class="ic i-calendar"></i></span><span class="text">å‘è¡¨äº</span><time itemprop="dateCreated datePublished" datetime="2025-04-26T16:52:06+08:00">2025-04-26</time></span><span class="item" title="æœ¬æ–‡å­—æ•°"><span class="icon"><i class="ic i-pen"></i></span><span class="text">æœ¬æ–‡å­—æ•°</span><span>36k</span><span class="text">å­—</span></span><span class="item" title="é˜…è¯»æ—¶é•¿"><span class="icon"><i class="ic i-clock"></i></span><span class="text">é˜…è¯»æ—¶é•¿</span><span>33 åˆ†é’Ÿ</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="åˆ‡æ¢å¯¼èˆªæ "><span class="line"></span><span class="line"></span><span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">LinuxSreäº‘åŸç”Ÿ</a></li></ul><ul class="right" id="rightNav"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div class="pjax" id="imgs"><img src="https://s21.ax1x.com/2025/03/29/pEsS0hD.png" loading="eager" decoding="async" fetchpriority="high" alt="LinuxSreäº‘åŸç”Ÿ"></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"></path></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"></use><use xlink:href="#gentle-wave" x="48" y="3"></use><use xlink:href="#gentle-wave" x="48" y="5"></use><use xlink:href="#gentle-wave" x="48" y="7"></use></g></svg></div><main><div class="inner"><div class="pjax" id="main"><div class="article wrap"><div class="breadcrumb" itemlistelement itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i><span><a href="/">é¦–é¡µ</a></span><i class="ic i-angle-right"></i><span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/Kubernetes/" itemprop="item" rel="index" title="åˆ†ç±»äºKubernetes"><span itemprop="name">Kubernetes<meta itemprop="position" content="0"></span></a></span></div><article class="post block" itemscope itemtype="http://schema.org/Article" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://ixuyong.cn/posts/170573601.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/assets/avatar.png"><meta itemprop="name" content="Xu Yong"><meta itemprop="description" content="è‡´åŠ›äºæŠ€æœ¯å¸ƒé“ã€æ™®åŠå‰æ²¿æŠ€æœ¯ã€æ‰“é€ äº‘åŸç”Ÿç³»åˆ—æ ‡æ†åšå®¢, ä¸“æ³¨äº Linux è¿ç»´ã€äº‘è®¡ç®—ã€äº‘åŸâ½£ç­‰æŠ€æœ¯"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="LinuxSreäº‘åŸç”Ÿ"></span><div class="body md" itemprop="articleBody"><h4 id="1-ingress-nginx-controller-å®‰è£…"><a class="anchor" href="#1-ingress-nginx-controller-å®‰è£…">#</a> 1. Ingress Nginx Controller å®‰è£…</h4><table><thead><tr><th>Supported</th><th>Ingress-NGINX version</th><th>k8s supported version</th><th>Alpine Version</th><th>Nginx Version</th><th>Helm Chart Version</th></tr></thead><tbody><tr><td>ğŸ”„</td><td><strong>v1.12.1</strong></td><td>1.32, 1.31, 1.30, 1.29, 1.28</td><td>3.21.3</td><td>1.25.5</td><td>4.12.1</td></tr><tr><td>ğŸ”„</td><td><strong>v1.12.0</strong></td><td>1.32, 1.31, 1.30, 1.29, 1.28</td><td>3.21.0</td><td>1.25.5</td><td>4.12.0</td></tr><tr><td>ğŸ”„</td><td><strong>v1.12.0-beta.0</strong></td><td>1.32, 1.31, 1.30, 1.29, 1.28</td><td>3.20.3</td><td>1.25.5</td><td>4.12.0-beta.0</td></tr><tr><td>ğŸ”„</td><td><strong>v1.11.5</strong></td><td>1.30, 1.29, 1.28, 1.27, 1.26</td><td>3.21.3</td><td>1.25.5</td><td>4.11.5</td></tr><tr><td>ğŸ”„</td><td><strong>v1.11.4</strong></td><td>1.30, 1.29, 1.28, 1.27, 1.26</td><td>3.21.0</td><td>1.25.5</td><td>4.11.4</td></tr><tr><td>ğŸ”„</td><td><strong>v1.11.3</strong></td><td>1.30, 1.29, 1.28, 1.27, 1.26</td><td>3.20.3</td><td>1.25.5</td><td>4.11.3</td></tr><tr><td>ğŸ”„</td><td><strong>v1.11.2</strong></td><td>1.30, 1.29, 1.28, 1.27, 1.26</td><td>3.20.0</td><td>1.25.5</td><td>4.11.2</td></tr><tr><td>ğŸ”„</td><td><strong>v1.11.1</strong></td><td>1.30, 1.29, 1.28, 1.27, 1.26</td><td>3.20.0</td><td>1.25.5</td><td>4.11.1</td></tr><tr><td>ğŸ”„</td><td><strong>v1.11.0</strong></td><td>1.30, 1.29, 1.28, 1.27, 1.26</td><td>3.20.0</td><td>1.25.5</td><td>4.11.0</td></tr><tr><td></td><td><strong>v1.10.6</strong></td><td>1.30, 1.29, 1.28, 1.27, 1.26</td><td>3.21.0</td><td>1.25.5</td><td>4.10.6</td></tr><tr><td></td><td><strong>v1.10.5</strong></td><td>1.30, 1.29, 1.28, 1.27, 1.26</td><td>3.20.3</td><td>1.25.5</td><td>4.10.5</td></tr><tr><td></td><td><strong>v1.10.4</strong></td><td>1.30, 1.29, 1.28, 1.27, 1.26</td><td>3.20.0</td><td>1.25.5</td><td>4.10.4</td></tr><tr><td></td><td><strong>v1.10.3</strong></td><td>1.30, 1.29, 1.28, 1.27, 1.26</td><td>3.20.0</td><td>1.25.5</td><td>4.10.3</td></tr><tr><td></td><td><strong>v1.10.2</strong></td><td>1.30, 1.29, 1.28, 1.27, 1.26</td><td>3.20.0</td><td>1.25.5</td><td>4.10.2</td></tr><tr><td></td><td><strong>v1.10.1</strong></td><td>1.30, 1.29, 1.28, 1.27, 1.26</td><td>3.19.1</td><td>1.25.3</td><td>4.10.1</td></tr><tr><td></td><td><strong>v1.10.0</strong></td><td>1.29, 1.28, 1.27, 1.26</td><td>3.19.1</td><td>1.25.3</td><td>4.10.0</td></tr><tr><td></td><td>v1.9.6</td><td>1.29, 1.28, 1.27, 1.26, 1.25</td><td>3.19.0</td><td>1.21.6</td><td>4.9.1</td></tr><tr><td></td><td>v1.9.5</td><td>1.28, 1.27, 1.26, 1.25</td><td>3.18.4</td><td>1.21.6</td><td>4.9.0</td></tr><tr><td></td><td>v1.9.4</td><td>1.28, 1.27, 1.26, 1.25</td><td>3.18.4</td><td>1.21.6</td><td>4.8.3</td></tr><tr><td></td><td>v1.9.3</td><td>1.28, 1.27, 1.26, 1.25</td><td>3.18.4</td><td>1.21.6</td><td>4.8.*</td></tr><tr><td></td><td>v1.9.1</td><td>1.28, 1.27, 1.26, 1.25</td><td>3.18.4</td><td>1.21.6</td><td>4.8.*</td></tr><tr><td></td><td>v1.9.0</td><td>1.28, 1.27, 1.26, 1.25</td><td>3.18.2</td><td>1.21.6</td><td>4.8.*</td></tr><tr><td></td><td>v1.8.4</td><td>1.27, 1.26, 1.25, 1.24</td><td>3.18.2</td><td>1.21.6</td><td>4.7.*</td></tr><tr><td></td><td>v1.7.1</td><td>1.27, 1.26, 1.25, 1.24</td><td>3.17.2</td><td>1.21.6</td><td>4.6.*</td></tr><tr><td></td><td>v1.6.4</td><td>1.26, 1.25, 1.24, 1.23</td><td>3.17.0</td><td>1.21.6</td><td>4.5.*</td></tr><tr><td></td><td>v1.5.1</td><td>1.25, 1.24, 1.23</td><td>3.16.2</td><td>1.21.6</td><td>4.4.*</td></tr><tr><td></td><td>v1.4.0</td><td>1.25, 1.24, 1.23, 1.22</td><td>3.16.2</td><td>1.19.10â€ </td><td>4.3.0</td></tr><tr><td></td><td>v1.3.1</td><td>1.24, 1.23, 1.22, 1.21, 1.20</td><td>3.16.2</td><td>1.19.10â€ </td><td>4.2.5</td></tr></tbody></table><h5 id="11-helmå®‰è£…ingress-nginx-controller"><a class="anchor" href="#11-helmå®‰è£…ingress-nginx-controller">#</a> 1.1 Helm å®‰è£… Ingress Nginx Controller</h5><ol><li>å®‰è£… Helm</li></ol><pre><code># wget https://get.helm.sh/helm-v3.6.3-linux-amd64.tar.gz
# tar xf helm-v3.6.3-linux-amd64.tar.gz
# mv linux-amd64/helm /usr/local/bin/helm
# helm version
</code></pre><ol start="2"><li>ä¸‹è½½ Ingress Nginx Controller å®‰è£…åŒ…</li></ol><pre><code>å®˜æ–¹æ–‡æ¡£ï¼šhttps://github.com/kubernetes/ingress-nginx/tree/helm-chart-4.8.2         #æ ¹æ®è‡ªå·±k8sç‰ˆæœ¬ä¸‹è½½
# helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx
# helm repo update
# helm repo list
# helm pull ingress-nginx/ingress-nginx --version 4.8.2
</code></pre><ol start="3"><li>é…ç½® Ingress Nginx Controller</li></ol><pre><code># tar xf ingress-nginx-4.8.2.tgz
# cd ingress-nginx
# vim values.yaml
...
 16 controller:
 17   name: controller
 18   enableAnnotationValidations: false
 19   image:
 20     ## Keep false as default for now!
 21     chroot: false
 22     registry: registry.cn-hangzhou.aliyuncs.com
 23     image: kubernetes_public/ingress-nginx-controller
 24     ## for backwards compatibility consider setting the full image url via the repository value below
 25     ## use *either* current default registry/image or repository format or installing chart by providing the values.yaml wil    l fail
 26     ## repository:
 27     tag: &quot;v1.9.3&quot;
 28     #digest: sha256:8fd21d59428507671ce0fb47f818b1d859c92d2ad07bb7c947268d433030ba98
...
 42   # -- Will add custom configuration options to Nginx https://kubernetes.github.io/ingress-nginx/user-guide/nginx-configurat    ion/configmap/
 43   config:
 44     allow-snippet-annotations: true          #å¼€å¯server snippetçš„é…ç½®
...
 67   dnsPolicy: ClusterFirstWithHostNet
...
 88   hostNetwork: true
...
107   ingressClassResource:
108     # -- Name of the ingressClass
109     name: nginx
110     # -- Is this ingressClass enabled or not
111     enabled: true
112     # -- Is this the default ingressClass for the cluster
113     default: true
...
184   kind: DaemonSet
...
287   nodeSelector:
288     kubernetes.io/os: linux
289     ingress: &quot;true&quot;
...
638       image:
639         registry: registry.cn-hangzhou.aliyuncs.com
640         image: kubernetes_public/kube-webhook-certgen
641         ## for backwards compatibility consider setting the full image url via the repository value below
642         ## use *either* current default registry/image or repository format or installing chart by providing the values.yaml     will fail
643         ## repository:
644         tag: v20231011-8b53cabe0
645         #digest: sha256:a7943503b45d552785aa3b5e457f169a5661fb94d82b8a3373bcd9ebaf9aac80
...
</code></pre><p>4. ç»™éœ€è¦éƒ¨ç½² ingress çš„èŠ‚ç‚¹ä¸Šæ‰“æ ‡ç­¾</p><pre><code># kubectl label node k8s-node02 ingress=true
# kubectl label node k8s-node01 ingress=true
# kubectl create ns ingress-nginx
# helm install ingress-nginx -n ingress-nginx .     #å®‰è£…
# helm upgrade ingress-nginx -n ingress-nginx .     #æ›´æ–°
# kubectl get pods -n ingress-nginx 
NAME                             READY   STATUS    RESTARTS   AGE
ingress-nginx-controller-7nfqn   1/1     Running   0          27s
ingress-nginx-controller-k4p2n   1/1     Running   0          17m
ingress-nginx-controller-kw5jk   1/1     Running   0          24s
</code></pre><h5 id="12-bare-metalå®‰è£…ingress-nginx-controller"><a class="anchor" href="#12-bare-metalå®‰è£…ingress-nginx-controller">#</a> 1.2 Bare metal å®‰è£… Ingress Nginx Controller</h5><ol><li>ä¸‹è½½ Ingress éƒ¨ç½²æ–‡ä»¶ï¼Œé“¾æ¥åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://kubernetes.github.io/ingress-nginx/deploy/#bare-metal-clusters">https://kubernetes.github.io/ingress-nginx/deploy/#bare-metal-clusters</a></li></ol><pre><code>[root@k8s-master01 ~]# wget https://raw.githubusercontent.com/kubernetes/ingress-nginx/controller-v1.12.1/deploy/static/provider/baremetal/deploy.yaml
</code></pre><ol start="2"><li>é…ç½® Ingress</li></ol><pre><code>[root@k8s-master01 ingress-master]# cat deploy.yaml 
apiVersion: v1
kind: Namespace
metadata:
  labels:
    app.kubernetes.io/instance: ingress-nginx
    app.kubernetes.io/name: ingress-nginx
  name: ingress-nginx
---
apiVersion: v1
automountServiceAccountToken: true
kind: ServiceAccount
metadata:
  labels:
    app.kubernetes.io/component: controller
    app.kubernetes.io/instance: ingress-nginx
    app.kubernetes.io/name: ingress-nginx
    app.kubernetes.io/part-of: ingress-nginx
    app.kubernetes.io/version: 1.12.1
  name: ingress-nginx
  namespace: ingress-nginx
---
apiVersion: v1
automountServiceAccountToken: true
kind: ServiceAccount
metadata:
  labels:
    app.kubernetes.io/component: admission-webhook
    app.kubernetes.io/instance: ingress-nginx
    app.kubernetes.io/name: ingress-nginx
    app.kubernetes.io/part-of: ingress-nginx
    app.kubernetes.io/version: 1.12.1
  name: ingress-nginx-admission
  namespace: ingress-nginx
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  labels:
    app.kubernetes.io/component: controller
    app.kubernetes.io/instance: ingress-nginx
    app.kubernetes.io/name: ingress-nginx
    app.kubernetes.io/part-of: ingress-nginx
    app.kubernetes.io/version: 1.12.1
  name: ingress-nginx
  namespace: ingress-nginx
rules:
- apiGroups:
  - &quot;&quot;
  resources:
  - namespaces
  verbs:
  - get
- apiGroups:
  - &quot;&quot;
  resources:
  - configmaps
  - pods
  - secrets
  - endpoints
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - &quot;&quot;
  resources:
  - services
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - networking.k8s.io
  resources:
  - ingresses
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - networking.k8s.io
  resources:
  - ingresses/status
  verbs:
  - update
- apiGroups:
  - networking.k8s.io
  resources:
  - ingressclasses
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - coordination.k8s.io
  resourceNames:
  - ingress-nginx-leader
  resources:
  - leases
  verbs:
  - get
  - update
- apiGroups:
  - coordination.k8s.io
  resources:
  - leases
  verbs:
  - create
- apiGroups:
  - &quot;&quot;
  resources:
  - events
  verbs:
  - create
  - patch
- apiGroups:
  - discovery.k8s.io
  resources:
  - endpointslices
  verbs:
  - list
  - watch
  - get
---
apiVersion: rbac.authorization.k8s.io/v1
kind: Role
metadata:
  labels:
    app.kubernetes.io/component: admission-webhook
    app.kubernetes.io/instance: ingress-nginx
    app.kubernetes.io/name: ingress-nginx
    app.kubernetes.io/part-of: ingress-nginx
    app.kubernetes.io/version: 1.12.1
  name: ingress-nginx-admission
  namespace: ingress-nginx
rules:
- apiGroups:
  - &quot;&quot;
  resources:
  - secrets
  verbs:
  - get
  - create
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  labels:
    app.kubernetes.io/instance: ingress-nginx
    app.kubernetes.io/name: ingress-nginx
    app.kubernetes.io/part-of: ingress-nginx
    app.kubernetes.io/version: 1.12.1
  name: ingress-nginx
rules:
- apiGroups:
  - &quot;&quot;
  resources:
  - configmaps
  - endpoints
  - nodes
  - pods
  - secrets
  - namespaces
  verbs:
  - list
  - watch
- apiGroups:
  - coordination.k8s.io
  resources:
  - leases
  verbs:
  - list
  - watch
- apiGroups:
  - &quot;&quot;
  resources:
  - nodes
  verbs:
  - get
- apiGroups:
  - &quot;&quot;
  resources:
  - services
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - networking.k8s.io
  resources:
  - ingresses
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - &quot;&quot;
  resources:
  - events
  verbs:
  - create
  - patch
- apiGroups:
  - networking.k8s.io
  resources:
  - ingresses/status
  verbs:
  - update
- apiGroups:
  - networking.k8s.io
  resources:
  - ingressclasses
  verbs:
  - get
  - list
  - watch
- apiGroups:
  - discovery.k8s.io
  resources:
  - endpointslices
  verbs:
  - list
  - watch
  - get
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRole
metadata:
  labels:
    app.kubernetes.io/component: admission-webhook
    app.kubernetes.io/instance: ingress-nginx
    app.kubernetes.io/name: ingress-nginx
    app.kubernetes.io/part-of: ingress-nginx
    app.kubernetes.io/version: 1.12.1
  name: ingress-nginx-admission
rules:
- apiGroups:
  - admissionregistration.k8s.io
  resources:
  - validatingwebhookconfigurations
  verbs:
  - get
  - update
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  labels:
    app.kubernetes.io/component: controller
    app.kubernetes.io/instance: ingress-nginx
    app.kubernetes.io/name: ingress-nginx
    app.kubernetes.io/part-of: ingress-nginx
    app.kubernetes.io/version: 1.12.1
  name: ingress-nginx
  namespace: ingress-nginx
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: ingress-nginx
subjects:
- kind: ServiceAccount
  name: ingress-nginx
  namespace: ingress-nginx
---
apiVersion: rbac.authorization.k8s.io/v1
kind: RoleBinding
metadata:
  labels:
    app.kubernetes.io/component: admission-webhook
    app.kubernetes.io/instance: ingress-nginx
    app.kubernetes.io/name: ingress-nginx
    app.kubernetes.io/part-of: ingress-nginx
    app.kubernetes.io/version: 1.12.1
  name: ingress-nginx-admission
  namespace: ingress-nginx
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: ingress-nginx-admission
subjects:
- kind: ServiceAccount
  name: ingress-nginx-admission
  namespace: ingress-nginx
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  labels:
    app.kubernetes.io/instance: ingress-nginx
    app.kubernetes.io/name: ingress-nginx
    app.kubernetes.io/part-of: ingress-nginx
    app.kubernetes.io/version: 1.12.1
  name: ingress-nginx
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: ingress-nginx
subjects:
- kind: ServiceAccount
  name: ingress-nginx
  namespace: ingress-nginx
---
apiVersion: rbac.authorization.k8s.io/v1
kind: ClusterRoleBinding
metadata:
  labels:
    app.kubernetes.io/component: admission-webhook
    app.kubernetes.io/instance: ingress-nginx
    app.kubernetes.io/name: ingress-nginx
    app.kubernetes.io/part-of: ingress-nginx
    app.kubernetes.io/version: 1.12.1
  name: ingress-nginx-admission
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: ClusterRole
  name: ingress-nginx-admission
subjects:
- kind: ServiceAccount
  name: ingress-nginx-admission
  namespace: ingress-nginx
---
apiVersion: v1
data: null
kind: ConfigMap
metadata:
  labels:
    app.kubernetes.io/component: controller
    app.kubernetes.io/instance: ingress-nginx
    app.kubernetes.io/name: ingress-nginx
    app.kubernetes.io/part-of: ingress-nginx
    app.kubernetes.io/version: 1.12.1
  name: ingress-nginx-controller
  namespace: ingress-nginx
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app.kubernetes.io/component: controller
    app.kubernetes.io/instance: ingress-nginx
    app.kubernetes.io/name: ingress-nginx
    app.kubernetes.io/part-of: ingress-nginx
    app.kubernetes.io/version: 1.12.1
  name: ingress-nginx-controller
  namespace: ingress-nginx
spec:
  ipFamilies:
  - IPv4
  ipFamilyPolicy: SingleStack
  ports:
  - appProtocol: http
    name: http
    port: 80
    protocol: TCP
    targetPort: http
  - appProtocol: https
    name: https
    port: 443
    protocol: TCP
    targetPort: https
  selector:
    app.kubernetes.io/component: controller
    app.kubernetes.io/instance: ingress-nginx
    app.kubernetes.io/name: ingress-nginx
  #type: NodePort
  type: ClusterIP
---
apiVersion: v1
kind: Service
metadata:
  labels:
    app.kubernetes.io/component: controller
    app.kubernetes.io/instance: ingress-nginx
    app.kubernetes.io/name: ingress-nginx
    app.kubernetes.io/part-of: ingress-nginx
    app.kubernetes.io/version: 1.12.1
  name: ingress-nginx-controller-admission
  namespace: ingress-nginx
spec:
  ports:
  - appProtocol: https
    name: https-webhook
    port: 443
    targetPort: webhook
  selector:
    app.kubernetes.io/component: controller
    app.kubernetes.io/instance: ingress-nginx
    app.kubernetes.io/name: ingress-nginx
  type: ClusterIP
---
apiVersion: apps/v1
#kind: Deployment
kind: DaemonSet
metadata:
  labels:
    app.kubernetes.io/component: controller
    app.kubernetes.io/instance: ingress-nginx
    app.kubernetes.io/name: ingress-nginx
    app.kubernetes.io/part-of: ingress-nginx
    app.kubernetes.io/version: 1.12.1
  name: ingress-nginx-controller
  namespace: ingress-nginx
spec:
  minReadySeconds: 0
  revisionHistoryLimit: 10
  selector:
    matchLabels:
      app.kubernetes.io/component: controller
      app.kubernetes.io/instance: ingress-nginx
      app.kubernetes.io/name: ingress-nginx
  template:
    metadata:
      labels:
        app.kubernetes.io/component: controller
        app.kubernetes.io/instance: ingress-nginx
        app.kubernetes.io/name: ingress-nginx
        app.kubernetes.io/part-of: ingress-nginx
        app.kubernetes.io/version: 1.12.1
    spec:
      containers:
      - args:
        - /nginx-ingress-controller
        - --election-id=ingress-nginx-leader
        - --controller-class=k8s.io/ingress-nginx
        - --ingress-class=nginx
        - --configmap=$(POD_NAMESPACE)/ingress-nginx-controller
        - --validating-webhook=:8443
        - --validating-webhook-certificate=/usr/local/certificates/cert
        - --validating-webhook-key=/usr/local/certificates/key
        env:
        - name: POD_NAME
          valueFrom:
            fieldRef:
              fieldPath: metadata.name
        - name: POD_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        - name: LD_PRELOAD
          value: /usr/local/lib/libmimalloc.so
        image: registry.cn-hangzhou.aliyuncs.com/kubernetes_public/ingress-nginx-controller-v1.12.1:v1.12.1 
        imagePullPolicy: IfNotPresent
        lifecycle:
          preStop:
            exec:
              command:
              - /wait-shutdown
        livenessProbe:
          failureThreshold: 5
          httpGet:
            path: /healthz
            port: 10254
            scheme: HTTP
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        name: controller
        ports:
        - containerPort: 80
          name: http
          protocol: TCP
        - containerPort: 443
          name: https
          protocol: TCP
        - containerPort: 8443
          name: webhook
          protocol: TCP
        readinessProbe:
          failureThreshold: 3
          httpGet:
            path: /healthz
            port: 10254
            scheme: HTTP
          initialDelaySeconds: 10
          periodSeconds: 10
          successThreshold: 1
          timeoutSeconds: 1
        resources:
          requests:
            cpu: 100m
            memory: 90Mi
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            add:
            - NET_BIND_SERVICE
            drop:
            - ALL
          readOnlyRootFilesystem: false
          runAsGroup: 82
          runAsNonRoot: true
          runAsUser: 101
          seccompProfile:
            type: RuntimeDefault
        volumeMounts:
        - mountPath: /usr/local/certificates/
          name: webhook-cert
          readOnly: true
      hostNetwork: true                         # ä¸èŠ‚ç‚¹å…±äº«ç½‘ç»œåç§°ç©ºé—´
      #dnsPolicy: ClusterFirst
      dnsPolicy: ClusterFirstWithHostNet        # dns ç­–ç•¥
      nodeSelector:                             # èŠ‚ç‚¹é€‰æ‹©å™¨
        kubernetes.io/os: linux
        ingress: &quot;true&quot;
      serviceAccountName: ingress-nginx
      terminationGracePeriodSeconds: 300
      volumes:
      - name: webhook-cert
        secret:
          secretName: ingress-nginx-admission
---
apiVersion: batch/v1
kind: Job
metadata:
  labels:
    app.kubernetes.io/component: admission-webhook
    app.kubernetes.io/instance: ingress-nginx
    app.kubernetes.io/name: ingress-nginx
    app.kubernetes.io/part-of: ingress-nginx
    app.kubernetes.io/version: 1.12.1
  name: ingress-nginx-admission-create
  namespace: ingress-nginx
spec:
  template:
    metadata:
      labels:
        app.kubernetes.io/component: admission-webhook
        app.kubernetes.io/instance: ingress-nginx
        app.kubernetes.io/name: ingress-nginx
        app.kubernetes.io/part-of: ingress-nginx
        app.kubernetes.io/version: 1.12.1
      name: ingress-nginx-admission-create
    spec:
      containers:
      - args:
        - create
        - --host=ingress-nginx-controller-admission,ingress-nginx-controller-admission.$(POD_NAMESPACE).svc
        - --namespace=$(POD_NAMESPACE)
        - --secret-name=ingress-nginx-admission
        env:
        - name: POD_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        image: registry.cn-hangzhou.aliyuncs.com/kubernetes_public/kube-webhook-certgen-v1.5.2:v1.5.2 
        imagePullPolicy: IfNotPresent
        name: create
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          readOnlyRootFilesystem: true
          runAsGroup: 65532
          runAsNonRoot: true
          runAsUser: 65532
          seccompProfile:
            type: RuntimeDefault
      nodeSelector:
        kubernetes.io/os: linux
      restartPolicy: OnFailure
      serviceAccountName: ingress-nginx-admission
---
apiVersion: batch/v1
kind: Job
metadata:
  labels:
    app.kubernetes.io/component: admission-webhook
    app.kubernetes.io/instance: ingress-nginx
    app.kubernetes.io/name: ingress-nginx
    app.kubernetes.io/part-of: ingress-nginx
    app.kubernetes.io/version: 1.12.1
  name: ingress-nginx-admission-patch
  namespace: ingress-nginx
spec:
  template:
    metadata:
      labels:
        app.kubernetes.io/component: admission-webhook
        app.kubernetes.io/instance: ingress-nginx
        app.kubernetes.io/name: ingress-nginx
        app.kubernetes.io/part-of: ingress-nginx
        app.kubernetes.io/version: 1.12.1
      name: ingress-nginx-admission-patch
    spec:
      containers:
      - args:
        - patch
        - --webhook-name=ingress-nginx-admission
        - --namespace=$(POD_NAMESPACE)
        - --patch-mutating=false
        - --secret-name=ingress-nginx-admission
        - --patch-failure-policy=Fail
        env:
        - name: POD_NAMESPACE
          valueFrom:
            fieldRef:
              fieldPath: metadata.namespace
        image: registry.cn-hangzhou.aliyuncs.com/kubernetes_public/kube-webhook-certgen-v1.5.2:v1.5.2 
        imagePullPolicy: IfNotPresent
        name: patch
        securityContext:
          allowPrivilegeEscalation: false
          capabilities:
            drop:
            - ALL
          readOnlyRootFilesystem: true
          runAsGroup: 65532
          runAsNonRoot: true
          runAsUser: 65532
          seccompProfile:
            type: RuntimeDefault
      nodeSelector:
        kubernetes.io/os: linux
      restartPolicy: OnFailure
      serviceAccountName: ingress-nginx-admission
---
apiVersion: networking.k8s.io/v1
kind: IngressClass
metadata:
  labels:
    app.kubernetes.io/component: controller
    app.kubernetes.io/instance: ingress-nginx
    app.kubernetes.io/name: ingress-nginx
    app.kubernetes.io/part-of: ingress-nginx
    app.kubernetes.io/version: 1.12.1
  name: nginx
spec:
  controller: k8s.io/ingress-nginx
---
apiVersion: admissionregistration.k8s.io/v1
kind: ValidatingWebhookConfiguration
metadata:
  labels:
    app.kubernetes.io/component: admission-webhook
    app.kubernetes.io/instance: ingress-nginx
    app.kubernetes.io/name: ingress-nginx
    app.kubernetes.io/part-of: ingress-nginx
    app.kubernetes.io/version: 1.12.1
  name: ingress-nginx-admission
webhooks:
- admissionReviewVersions:
  - v1
  clientConfig:
    service:
      name: ingress-nginx-controller-admission
      namespace: ingress-nginx
      path: /networking/v1/ingresses
      port: 443
  failurePolicy: Fail
  matchPolicy: Equivalent
  name: validate.nginx.ingress.kubernetes.io
  rules:
  - apiGroups:
    - networking.k8s.io
    apiVersions:
    - v1
    operations:
    - CREATE
    - UPDATE
    resources:
    - ingresses
  sideEffects: None
</code></pre><ul><li>type: ClusterIP #service ç±»å‹æ”¹ä¸º ClusterIP</li><li>hostNetwork: true # ä¸èŠ‚ç‚¹å…±äº«ç½‘ç»œåç§°ç©ºé—´</li><li>dnsPolicy: ClusterFirstWithHostNet # dns ç­–ç•¥</li><li>nodeSelector: # èŠ‚ç‚¹é€‰æ‹©å™¨</li><li>kind: DaemonSet # èµ„æºç±»å‹ DaemonSet</li></ul><ol start="3"><li>åœ¨æŒ‡å®šèŠ‚ç‚¹éƒ¨ç½² Ingress-Controller</li></ol><pre><code>[root@k8s-master01 ingress-master]# kubectl apply -f deploy.yaml -n ingress-nginx

[root@k8s-master01 ingress-master]# kubectl label node k8s-node01 ingress=true
[root@k8s-master01 ingress-master]# kubectl label node k8s-node02 ingress=true
[root@k8s-master01 ingress-master]# kubectl label node k8s-master03 ingress-     #å–æ¶ˆèŠ‚ç‚¹éƒ¨ç½²

[root@k8s-master01 ingress-master]# kubectl get pods -n ingress-nginx 
NAME                                   READY   STATUS      RESTARTS   AGE
ingress-nginx-admission-create-zp6mh   0/1     Completed   0          12m
ingress-nginx-admission-patch-f2bpd    0/1     Completed   0          12m
ingress-nginx-controller-rgtkc         1/1     Running     0          3m59s
ingress-nginx-controller-trmn8         1/1     Running     0          3m59s
</code></pre><h4 id="2-ingress-nginx-å…¥é—¨ä½¿ç”¨"><a class="anchor" href="#2-ingress-nginx-å…¥é—¨ä½¿ç”¨">#</a> 2. Ingress Nginx å…¥é—¨ä½¿ç”¨</h4><pre><code># cat web-ingress.yaml 
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: web-ingress
spec:
  ingressClassName: &quot;nginx&quot;
  rules:
  - host: test.hmallleasing.com
    http:
      paths:
      - backend:
          service:
            name: nginx
            port:
              number: 80
        path: /
        pathType: ImplementationSpecific
</code></pre><h4 id="3-ingress-nginx-åŸŸåé‡å®šå‘-redirect"><a class="anchor" href="#3-ingress-nginx-åŸŸåé‡å®šå‘-redirect">#</a> 3. Ingress Nginx åŸŸåé‡å®šå‘ Redirect</h4><pre><code># cat redirect-ingress.yaml 
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: redirect-ingress
  annotations:
    nginx.ingress.kubernetes.io/permanent-redirect: https://www.baidu.com
spec:
  ingressClassName: &quot;nginx&quot;
  rules:
  - host: redirect.hmallleasing.com
    http:
      paths:
      - backend:
          service:
            name: nginx
            port:
              number: 80
        path: /
        pathType: ImplementationSpecific
</code></pre><h4 id="4-ingress-nginx-å‰åç«¯åˆ†ç¦»-rewrite"><a class="anchor" href="#4-ingress-nginx-å‰åç«¯åˆ†ç¦»-rewrite">#</a> 4. Ingress Nginx å‰åç«¯åˆ†ç¦» Rewrite</h4><pre><code># cat rewrite-ingress.yaml 
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: rewrite-ingress
  annotations:
    nginx.ingress.kubernetes.io/rewrite-target: /$2
spec:
  ingressClassName: &quot;nginx&quot;
  rules:
  - host: rewrite.hmallleasing.com
    http:
      paths:
      - backend:
          service:
            name: nginx
            port:
              number: 80
        path: /api(/|$)(.*)
        pathType: ImplementationSpecif
</code></pre><h4 id="5-ingress-nginx-é”™è¯¯ä»£ç é‡å®šå‘"><a class="anchor" href="#5-ingress-nginx-é”™è¯¯ä»£ç é‡å®šå‘">#</a> 5. Ingress Nginx é”™è¯¯ä»£ç é‡å®šå‘</h4><pre><code>
</code></pre><h4 id="6-ingress-nginx-ssl"><a class="anchor" href="#6-ingress-nginx-ssl">#</a> 6. Ingress Nginx SSL</h4><pre><code>1.ç”Ÿæˆè¯ä¹¦
# openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout tls.key -out tls.cert -subj &quot;/CN=s.hmallleasing.com/O=tls.hmallleasing.com&quot;

2.åˆ›å»ºè¯ä¹¦
# kubectl create secret tls tls.hmallleasig.com --key tls.key --cert tls.cert

3.ingressé…ç½®
# kubectl create secret tls tls.hmallleasig.com --cert=tls.crt --key=tls.key
# cat tls-ingress.yaml 
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: tls-ingress
  annotations:
    nginx.ingress.kubernetes.io/ssl-redirect: &quot;false&quot;    #ç¦ç”¨httpså¼ºåˆ¶è·³è½¬
spec:
  ingressClassName: &quot;nginx&quot;
  rules:
  - host: tls.hmallleasing.com
    http:
      paths:
      - backend:
          service:
            name: nginx
            port:
              number: 80
        path: /
        pathType: ImplementationSpecific
  tls:                  #https
  - hosts:
    - tls.hmallleasing.com
    secretName: &quot;tls.hmallleasig.com&quot;	
</code></pre><h4 id="7-ingress-nginx-åŒ¹é…è¯·æ±‚å¤´"><a class="anchor" href="#7-ingress-nginx-åŒ¹é…è¯·æ±‚å¤´">#</a> 7. Ingress Nginx åŒ¹é…è¯·æ±‚å¤´</h4><pre><code>1.éƒ¨ç½²ç§»åŠ¨ç«¯åº”ç”¨
# kubectl create deploy phone --image=registry.cn-beijing.aliyuncs.com/dotbalo/nginx:phone
# kubectl expose deploy phone --port 80
# vim m-ingress.yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: m-ingress
spec:
  ingressClassName: &quot;nginx&quot;
  rules:
  - host: m.hmallleasing.com
    http:
      paths:
      - backend:
          service:
            name: phone
            port:
              number: 80
        path: /
        pathType: ImplementationSpecific

2.éƒ¨ç½²PCç«¯åº”ç”¨		
# kubectl create deploy laptop --image=registry.cn-beijing.aliyuncs.com/dotbalo/nginx:laptop	
# kubectl expose deploy laptop --port 80
# vim laptop-ingress.yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  annotations:
    kubernetes.io/ingress.class: nginx
    nginx.ingress.kubernetes.io/server-snippet: |
      set $agentflag 0;
          if ($http_user_agent ~* &quot;(Android|iPhone|Windows Phone|UC|Kindle)&quot; )&#123;
              set $agentflag 1;
          &#125;
          if ( $agentflag = 1 ) &#123;
              return 301 http://m.hmallleaing.com;
          &#125;
  name: laptop-ingress
spec:
  ingressClassName: &quot;nginx&quot;
  rules:
  - host: hmallleasing.com
    http:
      paths:
      - backend:
          service:
            name: laptop
            port:
              number: 80
        path: /
        pathType: ImplementationSpecific	
</code></pre><h4 id="8ingress-nginx-åŸºæœ¬è®¤è¯"><a class="anchor" href="#8ingress-nginx-åŸºæœ¬è®¤è¯">#</a> 8.Ingress Nginx åŸºæœ¬è®¤è¯</h4><pre><code># yum install httpd -y
# htpasswd -c auth superman
# cat auth 
superman:$apr1$AC1pc3dK$RJyWnyDJFNKY6twneGVrA1		

# kubectl create secret generic basic-auth --from-file=auth
# cat basic-ingress.yaml 
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: basic-ingress
  annotations:
    nginx.ingress.kubernetes.io/auth-type: basic  # è®¤è¯ç±»å‹
    nginx.ingress.kubernetes.io/auth-secret: basic-auth  # åŒ…å«ç”¨æˆ·å’Œå¯†ç çš„ secret èµ„æºåç§°
    nginx.ingress.kubernetes.io/auth-realm: 'Please User password'  # è¦æ˜¾ç¤ºçš„ä¿¡æ¯
spec:
  ingressClassName: &quot;nginx&quot;
  rules:
  - host: basic.hmallleasing.com
    http:
      paths:
      - backend:
          service:
            name: nginx
            port:
              number: 80
        path: /
        pathType: ImplementationSpecific
</code></pre><h4 id="9-ingress-nginx-é»‘ç™½åå•"><a class="anchor" href="#9-ingress-nginx-é»‘ç™½åå•">#</a> 9. Ingress Nginx é»‘ / ç™½åå•</h4><pre><code>å†™æ³•ä¸€ï¼š
# cat white-ingress.yaml 
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: white-ingress
  annotations:
    nginx.ingress.kubernetes.io/whitelist-source-range: &quot;192.168.40.101&quot;
spec:
  ingressClassName: &quot;nginx&quot;
  rules:
  - host: white.hmallleasing.com
    http:
      paths:
      - backend:
          service:
            name: nginx
            port:
              number: 80
        path: /
        pathType: ImplementationSpecific	

å†™æ³•äºŒï¼š		
[root@k8s-master01 ingress]# cat white-ingress.yaml 
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: white-ingress
  annotations:
    nginx.ingress.kubernetes.io/whitelist-source-range: &quot;192.168.40.0/24&quot;
spec:
  ingressClassName: &quot;nginx&quot;
  rules:
  - host: white.hmallleasing.com
    http:
      paths:
      - backend:
          service:
            name: nginx
            port:
              number: 80
        path: /
        pathType: ImplementationSpecific


å†™æ³•ä¸‰ï¼š
# cat white-ingress.yaml 
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: white-ingress
  annotations:
    nginx.ingress.kubernetes.io/server-snippet: |
      allow 192.168.40.0/24;
      deny all;
spec:
  ingressClassName: &quot;nginx&quot;
  rules:
  - host: white.hmallleasing.com
    http:
      paths:
      - backend:
          service:
            name: nginx
            port:
              number: 80
        path: /
        pathType: ImplementationSpecific
		

#Master01æµ‹è¯•		
# curl -H &quot;Host:white.hmallleasing.com&quot; http://192.168.40.103 -I
HTTP/1.1 200 OK
Date: Sat, 14 Oct 2023 13:12:03 GMT
Content-Type: text/html
Content-Length: 612
Connection: keep-alive
Last-Modified: Tue, 16 Apr 2019 13:08:19 GMT
ETag: &quot;5cb5d3c3-264&quot;
Accept-Ranges: bytes		

#Master02æµ‹è¯•
# curl -H &quot;Host:white.hmallleasing.com&quot; http://192.168.40.103 -I
HTTP/1.1 403 Forbidden
Date: Sat, 14 Oct 2023 13:13:34 GMT
Content-Type: text/html
Content-Length: 146
Connection: keep-alive
</code></pre><h4 id="10-ingress-nginx-é€Ÿç‡é™åˆ¶"><a class="anchor" href="#10-ingress-nginx-é€Ÿç‡é™åˆ¶">#</a> 10. Ingress Nginx é€Ÿç‡é™åˆ¶</h4><pre><code>[root@k8s-master01 ingress]# cat limit-rate-ingress.yaml 
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: rate-limit-ingress
  annotations:
    nginx.ingress.kubernetes.io/limit-rps: &quot;50&quot;
spec:
  ingressClassName: &quot;nginx&quot;
  rules:
  - host: rate-limit.hmallleasing.com
    http:
      paths:
      - backend:
          service:
            name: nginx
            port:
              number: 80
        path: /
        pathType: ImplementationSpecific

# ab -c 20 -n 1000 http://rate-limit.hmallleasing.com/ |grep request
Complete requests:      1000
Failed requests:        724
Time per request:       10.301 [ms] (mean)
Time per request:       0.515 [ms] (mean, across all concurrent requests)
Percentage of the requests served within a certain time (ms)
</code></pre><h4 id="11ä½¿ç”¨-nginx-å®ç°ç°åº¦é‡‘ä¸é›€å‘å¸ƒ"><a class="anchor" href="#11ä½¿ç”¨-nginx-å®ç°ç°åº¦é‡‘ä¸é›€å‘å¸ƒ">#</a> 11. ä½¿ç”¨ Nginx å®ç°ç°åº¦ / é‡‘ä¸é›€å‘å¸ƒ</h4><pre><code>1.åˆ›å»º v1 ç‰ˆæœ¬
# kubectl create deploy canary-v1 --image=registry.cn-beijing.aliyuncs.com/dotbalo/canary:v1	
# kubectl expose deploy canary-v1 --port 8080
# cat canary-v1-ingress.yaml 
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: canary-v1-ingress
spec:
  ingressClassName: &quot;nginx&quot;
  rules:
  - host: canary.hmallleasing.com
    http:
      paths:
      - backend:
          service:
            name: canary-v1
            port:
              number: 8080
        path: /
        pathType: ImplementationSpecific
		
# curl -H &quot;Host:canary.hmallleasing.com&quot; http://192.168.40.103 	

2.åˆ›å»º v2 ç‰ˆæœ¬
# kubectl create deploy canary-v2 --image=registry.cn-beijing.aliyuncs.com/dotbalo/canary:v2
# kubectl expose deploy canary-v2 --port 8080
# cat canary-v2-ingress.yaml 
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: canary-v2-ingress
  annotations:
    nginx.ingress.kubernetes.io/canary: &quot;true&quot;    #å¯åŠ¨ç°åº¦å‘å¸ƒ
    nginx.ingress.kubernetes.io/canary-weight: &quot;20&quot;  #åŸºäºæƒé‡,50%æµé‡è°ƒåº¦åˆ°è¿™ä¸ªç°åº¦çš„ç‰ˆæœ¬ä¸Š
spec:
  ingressClassName: &quot;nginx&quot;
  rules:
  - host: canary.hmallleasing.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: canary-v2
            port:
              number: 8080

#æµ‹è¯•ç°åº¦å‘å¸ƒ
[root@k8s-master01 ingress]# cat canary.sh 
#!/bin/bash

while true
do
	curl -H &quot;Host:canary.hmallleasing.com&quot; http://192.168.40.103
	sleep 0.5
done
</code></pre><h4 id="12-kubernetes-dashboardé…ç½®è¯ä¹¦"><a class="anchor" href="#12-kubernetes-dashboardé…ç½®è¯ä¹¦">#</a> 12. kubernetes-dashboard é…ç½®è¯ä¹¦</h4><pre><code>1.åˆ›å»ºè¯ä¹¦
kubectl create secret tls kubernetes-dashboard-certs --key *.hmallleasing.com_key.key --cert *.hmallleasing.com_chain.crt -n kubernetes-dashboard

2.ä¿®æ”¹kubernetes-dashboardèµ„æºæ¸…å•
kubectl edit deployment -n kubernetes-dashboard kubernetes-dashboard
...
      - args:
        - --auto-generate-certificates=false
        - --tls-key-file=_.hmallleasing.com_key.key
        - --tls-cert-file=_.hmallleasing.com_chain.crt
        - --token-ttl=21600
        - --authentication-mode=basic,token
        - --namespace=kubernetes-dashboard
...

3.åˆ›å»ºingress
#cat dashboard-ingress.yaml 
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: dashboard-ingress
  namespace: kubernetes-dashboard
  annotations:
    nginx.ingress.kubernetes.io/ssl-passthrough: &quot;true&quot;    
    nginx.ingress.kubernetes.io/backend-protocol: &quot;HTTPS&quot;    
spec:
  ingressClassName: &quot;nginx&quot;
  rules:
  - host: dashboard.hmallleasing.com
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: kubernetes-dashboard
            port:
              number: 443

# kubectl apply -f dashboard-ingress.yaml 
</code></pre><h4 id="13-å…¥å£lbé…ç½®"><a class="anchor" href="#13-å…¥å£lbé…ç½®">#</a> 13. å…¥å£ LB é…ç½®</h4><pre><code>[root@lb nginx]# cat /etc/nginx/conf.d/ingress.conf 
upstream ingress &#123;
	server 192.168.40.103:80 max_conns=2000 max_fails=2 fail_timeout=5s;
	server 192.168.40.104:80 max_conns=2000 max_fails=2 fail_timeout=5s;
	server 192.168.40.105:80 max_conns=2000 max_fails=2 fail_timeout=5s;
&#125;

server &#123;
    listen 443 ssl;
    server_name test.hmallleasing.com;
    client_max_body_size 1G; 
    ssl_prefer_server_ciphers on;
    ssl_certificate  /etc/nginx/sslkey/*.hmallleasing.com_chain.crt;
    ssl_certificate_key  /etc/nginx/sslkey/*.hmallleasing.com_key.key;

    location / &#123;
        proxy_pass http://ingress;
        include proxy_params;
	    proxy_next_upstream error timeout http_500 http_502 http_503 http_504;
	    proxy_next_upstream_tries 2;
	    proxy_next_upstream_timeout 3s;
    &#125;
&#125;

server &#123;
    listen 80;
    server_name test.hmallleasing.com;
    return 302 https://$server_name$request_uri;
&#125;

[root@lb ~]# mkdir /etc/nginx/sslkey -p


[root@lb ~]# cat proxy_params 
proxy_http_version 1.1;
proxy_set_header Connectin &quot;&quot;;

proxy_set_header Host $http_host;
proxy_set_header X-Real-IP $remote_addr;
proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

proxy_connect_timeout 60;
proxy_send_timeout 120;
proxy_read_timeout 120;

proxy_buffering on;
proxy_buffer_size 32k;
proxy_buffers 4 128k;
proxy_temp_file_write_size 10240k;
proxy_max_temp_file_size 10240k;
</code></pre><div class="tags"><a href="/tags/Kubernetes/" rel="tag"><i class="ic i-tag"></i>Kubernetes</a></div></div><footer><div class="meta"><span class="icon"><i class="ic i-eye"></i></span><span>æ­¤æ–‡ç« å·²è¢«é˜…è¯»æ¬¡æ•°:</span><span class="waline-pageview-count" id="twikoo_visitors" data-path="/posts/170573601.html">æ­£åœ¨åŠ è½½...</span><span class="item"><span class="icon"><i class="ic i-calendar-check"></i></span><span class="text">æ›´æ–°äº</span><time title="ä¿®æ”¹æ—¶é—´ï¼š2025-05-12 21:17:20" itemprop="dateModified" datetime="2025-05-12T21:17:20+08:00">2025-05-12</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i>èµèµ</button><p>è¯·æˆ‘å–[èŒ¶]~(ï¿£â–½ï¿£)~*</p><div id="qr"><div><img loading="lazy" data-src="/assets/wechatpay.png" alt="Xu Yong å¾®ä¿¡æ”¯ä»˜"><p>å¾®ä¿¡æ”¯ä»˜</p></div><div><img loading="lazy" data-src="/assets/alipay.png" alt="Xu Yong æ”¯ä»˜å®"><p>æ”¯ä»˜å®</p></div></div></div><div id="copyright"><ul><li class="author"><strong>æœ¬æ–‡ä½œè€…ï¼š</strong>Xu Yong<i class="ic i-at"><em>@</em></i>LinuxSreäº‘åŸç”Ÿ</li><li class="link"><strong>æœ¬æ–‡é“¾æ¥ï¼š</strong><a href="http://ixuyong.cn/posts/170573601.html" title="K8sæœåŠ¡å‘å¸ƒIngress">http://ixuyong.cn/posts/170573601.html</a></li><li class="license"><strong>ç‰ˆæƒå£°æ˜ï¼š</strong>æœ¬ç«™æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/posts/3364424907.html" rel="prev" itemprop="url" data-background-image="https:&#x2F;&#x2F;wp-cdn.4ce.cn&#x2F;v2&#x2F;q5MesmM.jpeg" title="é˜¿é‡Œäº‘+Githubæ„å»ºé•œåƒä»“åº“"><span class="type">ä¸Šä¸€ç¯‡</span><span class="category"><i class="ic i-flag"></i>Docker</span><h3>é˜¿é‡Œäº‘+Githubæ„å»ºé•œåƒä»“åº“</h3></a></div><div class="item right"><a href="/posts/1490514396.html" rel="next" itemprop="url" data-background-image="https:&#x2F;&#x2F;wp-cdn.4ce.cn&#x2F;v2&#x2F;2xXk5iP.jpeg" title="Redis Clusteré›†ç¾¤éƒ¨ç½²"><span class="type">ä¸‹ä¸€ç¯‡</span><span class="category"><i class="ic i-flag"></i>Redis</span><h3>Redis Clusteré›†ç¾¤éƒ¨ç½²</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="æ–‡ç« ç›®å½•"><ol class="toc"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-ingress-nginx-controller-%E5%AE%89%E8%A3%85"><span class="toc-number">1.</span> <span class="toc-text">1. Ingress Nginx Controller å®‰è£…</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#11-helm%E5%AE%89%E8%A3%85ingress-nginx-controller"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 Helm å®‰è£… Ingress Nginx Controller</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#12-bare-metal%E5%AE%89%E8%A3%85ingress-nginx-controller"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 Bare metal å®‰è£… Ingress Nginx Controller</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-ingress-nginx-%E5%85%A5%E9%97%A8%E4%BD%BF%E7%94%A8"><span class="toc-number">2.</span> <span class="toc-text">2. Ingress Nginx å…¥é—¨ä½¿ç”¨</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-ingress-nginx-%E5%9F%9F%E5%90%8D%E9%87%8D%E5%AE%9A%E5%90%91-redirect"><span class="toc-number">3.</span> <span class="toc-text">3. Ingress Nginx åŸŸåé‡å®šå‘ Redirect</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-ingress-nginx-%E5%89%8D%E5%90%8E%E7%AB%AF%E5%88%86%E7%A6%BB-rewrite"><span class="toc-number">4.</span> <span class="toc-text">4. Ingress Nginx å‰åç«¯åˆ†ç¦» Rewrite</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-ingress-nginx-%E9%94%99%E8%AF%AF%E4%BB%A3%E7%A0%81%E9%87%8D%E5%AE%9A%E5%90%91"><span class="toc-number">5.</span> <span class="toc-text">5. Ingress Nginx é”™è¯¯ä»£ç é‡å®šå‘</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-ingress-nginx-ssl"><span class="toc-number">6.</span> <span class="toc-text">6. Ingress Nginx SSL</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-ingress-nginx-%E5%8C%B9%E9%85%8D%E8%AF%B7%E6%B1%82%E5%A4%B4"><span class="toc-number">7.</span> <span class="toc-text">7. Ingress Nginx åŒ¹é…è¯·æ±‚å¤´</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8ingress-nginx-%E5%9F%BA%E6%9C%AC%E8%AE%A4%E8%AF%81"><span class="toc-number">8.</span> <span class="toc-text">8.Ingress Nginx åŸºæœ¬è®¤è¯</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-ingress-nginx-%E9%BB%91%E7%99%BD%E5%90%8D%E5%8D%95"><span class="toc-number">9.</span> <span class="toc-text">9. Ingress Nginx é»‘ &#x2F; ç™½åå•</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-ingress-nginx-%E9%80%9F%E7%8E%87%E9%99%90%E5%88%B6"><span class="toc-number">10.</span> <span class="toc-text">10. Ingress Nginx é€Ÿç‡é™åˆ¶</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11%E4%BD%BF%E7%94%A8-nginx-%E5%AE%9E%E7%8E%B0%E7%81%B0%E5%BA%A6%E9%87%91%E4%B8%9D%E9%9B%80%E5%8F%91%E5%B8%83"><span class="toc-number">11.</span> <span class="toc-text">11. ä½¿ç”¨ Nginx å®ç°ç°åº¦ &#x2F; é‡‘ä¸é›€å‘å¸ƒ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-kubernetes-dashboard%E9%85%8D%E7%BD%AE%E8%AF%81%E4%B9%A6"><span class="toc-number">12.</span> <span class="toc-text">12. kubernetes-dashboard é…ç½®è¯ä¹¦</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#13-%E5%85%A5%E5%8F%A3lb%E9%85%8D%E7%BD%AE"><span class="toc-number">13.</span> <span class="toc-text">13. å…¥å£ LB é…ç½®</span></a></li></ol></div><div class="related panel pjax" data-title="ç³»åˆ—æ–‡ç« "><ul><li><a href="/posts/3166738000.html" rel="bookmark" title="Kubeadmé«˜å¯ç”¨å®‰è£…K8sé›†ç¾¤">Kubeadmé«˜å¯ç”¨å®‰è£…K8sé›†ç¾¤</a></li><li><a href="/posts/2771271649.html" rel="bookmark" title="äº‘åŸç”ŸK8så®‰å…¨ä¸“å®¶CKSè®¤è¯è€ƒé¢˜è¯¦è§£">äº‘åŸç”ŸK8så®‰å…¨ä¸“å®¶CKSè®¤è¯è€ƒé¢˜è¯¦è§£</a></li><li><a href="/posts/985149017.html" rel="bookmark" title="äºŒè¿›åˆ¶é«˜å¯ç”¨å®‰è£…K8Sé›†ç¾¤">äºŒè¿›åˆ¶é«˜å¯ç”¨å®‰è£…K8Sé›†ç¾¤</a></li><li><a href="/posts/1771242682.html" rel="bookmark" title="K8sé›¶å®•æœºæœåŠ¡å‘å¸ƒ-æ¢é’ˆ">K8sé›¶å®•æœºæœåŠ¡å‘å¸ƒ-æ¢é’ˆ</a></li><li><a href="/posts/108692210.html" rel="bookmark" title="K8sèµ„æºè°ƒåº¦deploymentã€statefulsetã€daemonset">K8sèµ„æºè°ƒåº¦deploymentã€statefulsetã€daemonset</a></li><li><a href="/posts/858611107.html" rel="bookmark" title="K8sæœåŠ¡å‘å¸ƒService">K8sæœåŠ¡å‘å¸ƒService</a></li><li><a href="/posts/3992668367.html" rel="bookmark" title="K8sé…ç½®ç®¡ç†Configmap">K8sé…ç½®ç®¡ç†Configmap</a></li><li><a href="/posts/169153047.html" rel="bookmark" title="K8sæŒä¹…åŒ–å­˜å‚¨">K8sæŒä¹…åŒ–å­˜å‚¨</a></li><li><a href="/posts/3833778957.html" rel="bookmark" title="K8sè®¡åˆ’ä»»åŠ¡Jobã€Cronjob">K8sè®¡åˆ’ä»»åŠ¡Jobã€Cronjob</a></li><li><a href="/posts/3142072607.html" rel="bookmark" title="K8såˆå§‹åŒ–å®¹å™¨ã€ä¸´æ—¶å®¹å™¨">K8såˆå§‹åŒ–å®¹å™¨ã€ä¸´æ—¶å®¹å™¨</a></li><li><a href="/posts/3254599477.html" rel="bookmark" title="K8så®¹å¿å’Œæ±¡ç‚¹">K8så®¹å¿å’Œæ±¡ç‚¹</a></li><li><a href="/posts/312010518.html" rel="bookmark" title="K8säº²å’ŒåŠ›Affinity">K8säº²å’ŒåŠ›Affinity</a></li><li><a href="/posts/176412055.html" rel="bookmark" title="K8så‡†å…¥æ§åˆ¶ResourceQuotaã€LimitRangeã€QoSæœåŠ¡è´¨é‡">K8så‡†å…¥æ§åˆ¶ResourceQuotaã€LimitRangeã€QoSæœåŠ¡è´¨é‡</a></li><li><a href="/posts/722512536.html" rel="bookmark" title="K8sç»†ç²’åº¦æƒé™æ§åˆ¶RBAC">K8sç»†ç²’åº¦æƒé™æ§åˆ¶RBAC</a></li><li><a href="/posts/3890389502.html" rel="bookmark" title="K8SæŒä¹…åŒ–å­˜å‚¨NFS+StorageClass">K8SæŒä¹…åŒ–å­˜å‚¨NFS+StorageClass</a></li><li><a href="/posts/3030097036.html" rel="bookmark" title="K8Säº‘åŸç”Ÿå­˜å‚¨Rook-Ceph">K8Säº‘åŸç”Ÿå­˜å‚¨Rook-Ceph</a></li><li class="active"><a href="/posts/170573601.html" rel="bookmark" title="K8sæœåŠ¡å‘å¸ƒIngress">K8sæœåŠ¡å‘å¸ƒIngress</a></li><li><a href="/posts/626047790.html" rel="bookmark" title="æ¶ˆè´¹ç§Ÿèµç³»ç»Ÿå¾®æœåŠ¡åº”ç”¨äº¤ä»˜å®è·µ">æ¶ˆè´¹ç§Ÿèµç³»ç»Ÿå¾®æœåŠ¡åº”ç”¨äº¤ä»˜å®è·µ</a></li></ul></div><div class="overview panel" data-title="ç«™ç‚¹æ¦‚è§ˆ"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" loading="lazy" decoding="async" itemprop="image" alt="Xu Yong" src="/assets/avatar.png"><p class="name" itemprop="name">Xu Yong</p><div class="description" itemprop="description">ä¸“æ³¨äº Linux è¿ç»´ã€äº‘è®¡ç®—ã€äº‘åŸâ½£ç­‰æŠ€æœ¯</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">27</span><span class="name">æ–‡ç« </span></a></div><div class="item categories"><a href="/categories/"><span class="count">8</span><span class="name">åˆ†ç±»</span></a></div><div class="item tags"><a href="/tags/"><span class="count">8</span><span class="name">æ ‡ç­¾</span></a></div></nav><div class="social"><a target="_blank" rel="noopener" href="https://github.com/xyapples" class="item github" title="https:&#x2F;&#x2F;github.com&#x2F;xyapples"><i class="ic i-github"></i></a><a target="_blank" rel="noopener" href="https://gitee.com/chinagei" class="item gitee" title="https:&#x2F;&#x2F;gitee.com&#x2F;chinagei"><i class="ic i-gitee"></i></a><a href="mailto:373370405@qq.com" class="item email" title="mailto:373370405@qq.com"><i class="ic i-envelope"></i></a></div><div class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>é¦–é¡µ</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>åˆ†ç±»</a></li><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>å½’æ¡£</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>æ ‡ç­¾</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-about"></i>å…³äº</a></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>å‹é“¾</a></li></div></div></div></div><ul id="quick"><li class="prev pjax"><a href="/posts/1490514396.html" rel="prev" title="ä¸Šä¸€ç¯‡"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/posts/3364424907.html" rel="next" title="ä¸‹ä¸€ç¯‡"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>éšæœºæ–‡ç« </h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/Kubernetes/" title="åˆ†ç±»äºKubernetes">Kubernetes</a></div><span><a href="/posts/2771271649.html">äº‘åŸç”ŸK8så®‰å…¨ä¸“å®¶CKSè®¤è¯è€ƒé¢˜è¯¦è§£</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Kubernetes/" title="åˆ†ç±»äºKubernetes">Kubernetes</a></div><span><a href="/posts/3030097036.html">K8Säº‘åŸç”Ÿå­˜å‚¨Rook-Ceph</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Kubernetes/" title="åˆ†ç±»äºKubernetes">Kubernetes</a></div><span><a href="/posts/3890389502.html">K8SæŒä¹…åŒ–å­˜å‚¨NFS+StorageClass</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Kubernetes/" title="åˆ†ç±»äºKubernetes">Kubernetes</a></div><span><a href="/posts/169153047.html">K8sæŒä¹…åŒ–å­˜å‚¨</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Harbor/" title="åˆ†ç±»äºHarbor">Harbor</a></div><span><a href="/posts/3071070978.html">ä¼ä¸šçº§ç§æœ‰ä»“åº“Harboræ­å»º</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/ELKStack/" title="åˆ†ç±»äºELKStack">ELKStack</a></div><span><a href="/posts/170066797.html">æ¶ˆè´¹ç§Ÿèµé¡¹ç›®KubernetesåŸºäºELKæ—¥å¿—åˆ†æä¸å®è·µ</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Redis/" title="åˆ†ç±»äºRedis">Redis</a></div><span><a href="/posts/1414180692.html">Redisé›†ç¾¤ï¼ˆä¸»ä»+å“¨å…µï¼‰æ¨¡å¼</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Kubernetes/" title="åˆ†ç±»äºKubernetes">Kubernetes</a></div><span><a href="/posts/3833778957.html">K8sè®¡åˆ’ä»»åŠ¡Jobã€Cronjob</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Kubernetes/" title="åˆ†ç±»äºKubernetes">Kubernetes</a></div><span><a href="/posts/108692210.html">K8sèµ„æºè°ƒåº¦deploymentã€statefulsetã€daemonset</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Kubernetes/" title="åˆ†ç±»äºKubernetes">Kubernetes</a></div><span><a href="/posts/722512536.html">K8sç»†ç²’åº¦æƒé™æ§åˆ¶RBAC</a></span></li></ul></div><div class="rpost pjax"><h2>æœ€æ–°è¯„è®º</h2><ul class="leancloud-recent-comment" id="new-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2022 -<span itemprop="copyrightYear">2025</span><span class="with-love"><i class="ic i-sakura rotate"></i></span><span class="author" itemprop="copyrightHolder">Xu Yong @ LinuxSreäº‘åŸç”Ÿ</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i></span><span title="ç«™ç‚¹æ€»å­—æ•°">510k å­—</span><span class="post-meta-divider"> | </span><span class="post-meta-item-icon"><i class="ic i-coffee"></i></span><span title="ç«™ç‚¹é˜…è¯»æ—¶é•¿">7:44</span></div><div class="powered-by">åŸºäº <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> & Theme.<a target="_blank" rel="noopener" href="https://github.com/theme-shoka-x/hexo-theme-shokaX/">ShokaX</a></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL = {
    ispost: true,
        path: `posts/170573601.html`,
        favicon: {
        show: `ï¼ˆâ—Â´3ï½€â—ï¼‰ã‚„ã‚Œã‚„ã‚Œã ãœ`,
        hide: `(Â´Ğ”ï½€)å¤§å¤‰ã ï¼`
    },
    search: {
        placeholder: "æ–‡ç« æœç´¢",
        empty: "å…³äº ã€Œ ${query} ã€ï¼Œä»€ä¹ˆä¹Ÿæ²¡æœåˆ°",
        stats: "${time} ms å†…æ‰¾åˆ° ${hits} æ¡ç»“æœ"
    },
    copy_tex: false,
    katex: false,
    mermaid: false,
    audio: undefined,
    fancybox: true,
    nocopy: false,
    outime: true,
    template: `<div class="note warning"><p><span class="label warning">æ–‡ç« æ—¶æ•ˆæ€§æç¤º</span><br>è¿™æ˜¯ä¸€ç¯‡å‘å¸ƒäº {{publish}} å¤©å‰ï¼Œæœ€åä¸€æ¬¡æ›´æ–°åœ¨ {{updated}} å¤©å‰çš„æ–‡ç« ï¼Œéƒ¨åˆ†ä¿¡æ¯å¯èƒ½å·²ç»å‘ç”Ÿæ”¹å˜ï¼Œè¯·æ³¨æ„ç”„åˆ«ã€‚</p></div>`,
    quiz: {
        choice: `å•é€‰é¢˜`,
        multiple: `å¤šé€‰é¢˜`,
        true_false: `åˆ¤æ–­é¢˜`,
        essay: `é—®ç­”é¢˜`,
        gap_fill: `å¡«ç©ºé¢˜`,
        mistake: `é”™é¢˜å¤‡æ³¨`
    },
    ignores: [
        (uri) => uri.includes('#'),
        (uri) => new RegExp(LOCAL.path + '$').test(uri),
            []
    ]
};</script><script src="https://s4.zstatic.net/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha384-k6YtvFUEIuEFBdrLKJ3YAUbBki333tj1CSUisai5Cswsg9wcLNaPzsTHDswp4Az8" crossorigin="anonymous" fetchpriority="high"></script><script src="https://s4.zstatic.net/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha384-ZvpUoO&#x2F;+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn&#x2F;6Z&#x2F;hRTt8+pR6L4N2" crossorigin="anonymous" fetchpriority="high"></script><script src="/js/siteInit.js?v=0.4.17" type="module" fetchpriority="high" defer></script></body></html><!-- rebuild by hrmmi -->