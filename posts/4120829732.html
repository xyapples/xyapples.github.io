<!-- build time:Sat Sep 27 2025 21:27:01 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta http-equiv="X-UA-COMPATIBLE" content="IE=edge,chrome=1"><meta name="renderer" content="webkit"><link rel="icon" type="image/ico" sizes="32x32" href="/assets/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon.ico"><link rel="alternate" href="/rss.xml" title="LinuxSre云原生" type="application/rss+xml"><link rel="alternate" href="/atom.xml" title="LinuxSre云原生" type="application/atom+xml"><link rel="alternate" type="application/json" title="LinuxSre云原生" href="http://ixuyong.cn/feed.json"><link rel="preconnect" href="https://s4.zstatic.net"><link rel="preconnect" href="https://at.alicdn.com"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7CFredericka%20the%20Great:400,400italic,700,700italic%7CNoto%20Serif%20JP:400,400italic,700,700italic%7CNoto%20Serif%20SC:400,400italic,700,700italic%7CInconsolata:400,400italic,700,700italic&display=swap&subset=latin,latin-ext" media="none" onload="this.media&#x3D;&#39;all&#39;"><link rel="stylesheet" href="/css/app.css?v=0.4.17"><link rel="modulepreload" href="/js/chunk-GV364XSK.js"><link rel="modulepreload" href="/js/chunk-NYSE5UKM.js"><link rel="modulepreload" href="/js/chunk-RONCYO2S.js"><link rel="modulepreload" href="/js/chunk-THHXCRSX.js"><link rel="modulepreload" href="/js/chunk-WIQECBEN.js"><link rel="modulepreload" href="/js/comments-DL2IYMPZ.js"><link rel="modulepreload" href="/js/copy-tex-NADCTXPG.js"><link rel="modulepreload" href="/js/post-DA635IH6.js"><link rel="modulepreload" href="/js/quicklink-WEDHL4BA.js"><link rel="modulepreload" href="/js/search-VCZRKTM5.js"><link rel="modulepreload" href="/js/siteInit.js"><link rel="modulepreload" href="/js/waline-NNBYRQEE.js"><link rel="stylesheet" href="/css/comments-F4ZGS7LD.css" media="none" onload="this.media&#x3D;&#39;all&#39;"><link rel="stylesheet" href="/css/siteInit.css" media="none" onload="this.media&#x3D;&#39;all&#39;"><link rel="stylesheet" href="/css/waline-IDNZKML2.css" media="none" onload="this.media&#x3D;&#39;all&#39;"><link rel="preload" href="https://s21.ax1x.com/2025/03/29/pEsS0hD.png" as="image" fetchpriority="high"><meta name="keywords" content="Linux"><meta name="description" content="专注于 Linux 运维、云计算、云原⽣等技术"><link rel="canonical" href="http://ixuyong.cn/posts/4120829732.html"><title>DNS域名解析服务</title><meta name="generator" content="Hexo 7.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">DNS域名解析服务</h1><div class="meta"><span class="item" title="创建时间：2025-09-19 22:12:25"><span class="icon"><i class="ic i-calendar"></i></span><span class="text">发表于</span><time itemprop="dateCreated datePublished" datetime="2025-09-19T22:12:25+08:00">2025-09-19</time></span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i></span><span class="text">本文字数</span><span>48k</span><span class="text">字</span></span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i></span><span class="text">阅读时长</span><span>43 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span><span class="line"></span><span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">LinuxSre云原生</a></li></ul><ul class="right" id="rightNav"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div class="pjax" id="imgs"><img src="https://s21.ax1x.com/2025/03/29/pEsS0hD.png" loading="eager" decoding="async" fetchpriority="high" alt="LinuxSre云原生"></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"></path></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"></use><use xlink:href="#gentle-wave" x="48" y="3"></use><use xlink:href="#gentle-wave" x="48" y="5"></use><use xlink:href="#gentle-wave" x="48" y="7"></use></g></svg></div><main><div class="inner"><div class="pjax" id="main"><div class="article wrap"><div class="breadcrumb" itemlistelement itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i><span><a href="/">首页</a></span><i class="ic i-angle-right"></i><span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/Linux/" itemprop="item" rel="index" title="分类于Linux"><span itemprop="name">Linux<meta itemprop="position" content="0"></span></a></span></div><article class="post block" itemscope itemtype="http://schema.org/Article" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://ixuyong.cn/posts/4120829732.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/assets/avatar.png"><meta itemprop="name" content="Xu Yong"><meta itemprop="description" content="致力于技术布道、普及前沿技术、打造云原生系列标杆博客, 专注于 Linux 运维、云计算、云原⽣等技术"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="LinuxSre云原生"></span><div class="body md" itemprop="articleBody"><h3 id="dns域名解析服务"><a class="anchor" href="#dns域名解析服务">#</a> DNS 域名解析服务</h3><h4 id="1-dns基本概述"><a class="anchor" href="#1-dns基本概述">#</a> 1. DNS 基本概述</h4><h5 id="11-为什么需要域名"><a class="anchor" href="#11-为什么需要域名">#</a> 1.1 为什么需要域名</h5><p>在互联网中，使用 IP 地址与服务器进行通信根本行不通，原因如下：</p><ul><li>1、不好记忆，例如：学校官网的 IP 地址是 &quot;39.104.16.126&quot; ，难以记忆；</li><li>2、IP 地址会经常变更，所以通过 IP 地址去访问某台机器就会发生访不到的问题；</li></ul><p>此时 DNS 协议就应运而生了，那 DNS 解决了什么问题？DNS 主要用来管理域名（比较好记忆的字符）与 IP 地址（比较难记忆）的对应关系表。</p><h5 id="12-什么是dns"><a class="anchor" href="#12-什么是dns">#</a> 1.2 什么是 DNS</h5><p>DNS（Domain Name System） 是 ” 域名系统 “英文缩写，它所提供的服务是用来将域名转换为 IP 地址的工作。 DNS 就是一位” 翻译官 “，它的基本工作原理可以用下图来表示；</p><p><img loading="lazy" data-src="https://wp-cdn.4ce.cn/v2/S1Ee9BX.jpeg" alt="1.jpg"></p><h5 id="13-dns域名结构"><a class="anchor" href="#13-dns域名结构">#</a> 1.3 DNS 域名结构</h5><p>由于因特网的用户数量较多，所以因特网在命名时采用的是层次树状结构的命名方法。</p><ul><li>1. 互联网中的域名是有结构有规划的；</li><li>2. 由于域名进行了分级，在进行域名和 IP 地址解析时能更容易找到；</li><li>3. 其次域名具备全球唯一性；</li></ul><p><img loading="lazy" data-src="https://wp-cdn.4ce.cn/v2/ec0zOe9.png" alt="918540-20230506205656234-525954592.png"></p><h5 id="14-域名分类"><a class="anchor" href="#14-域名分类">#</a> 1.4 域名分类</h5><ul><li><p>根域：知道所有顶级域名服务器的域名和地址全世界只有 13 组根服务器，其中 10 台设置在美国，另外的三台设置与英国，瑞典，日本；</p></li><li><p>顶级域：知道所有顶级域名服务器下注册的所有二级域名的 IP 地址。</p><ul><li><p>顶级域有两种：通用域 （com） 域和国家域 （cn【包括 hk/tw】、jp）。</p></li><li><p>顶级域名由 ICANN （互联网名称与数字地址分配机构）委任的注册机构负责运行。</p></li></ul></li><li><p>二级域：负责一个区的域名服务器 （<a target="_blank" rel="noopener" href="http://hmallleasing.com">hmallleasing.com</a>）</p><ul><li>无需到 ICANN 进行申请，只需要到运行顶级域的注册机构（阿里、腾讯）去申请即可。</li><li>如果申请的域名没有被注册，也没有被注册为商标，仅需要缴纳一笔年费即可得到心仪的域名。</li></ul></li><li><p>三级域或主机名：根据服务器所提供的业务功能，选择配置对应的主机名称解析记录，比如（www、ops）</p></li></ul><h5 id="15-dns查询原理"><a class="anchor" href="#15-dns查询原理">#</a> 1.5 DNS 查询原理</h5><p>DNS 查询的结果通常会在本地域名服务器中进行缓存，如果本地域名服务器中有缓存的情况下，则会跳过如下 DNS 查询步骤，很快返回解析结果。<br>下面的示例则概述了本地域名服务器没有缓存的情况下， DNS 查询所需的步骤：</p><ul><li>1、用户在浏览器中输入 <a target="_blank" rel="noopener" href="http://example.com">example.com</a> ， 则由本地域名服务器开始进行递归查询。</li><li>2、本地域名服务器采用迭代查询的方法，向根域名服务器进行查询。</li><li>3、根域名服务器告诉本地域名服务器，下一步应该查询的顶级域名服务器 .TLD 的 IP 地址。</li><li>4、本地域名服务器向顶级域名服务器 .com TLD 进行查询。</li><li>5、.com TLD 服务器告诉本地域名服务器，下一步查询 <a target="_blank" rel="noopener" href="http://example.com">example.com</a> 权威域名服务器的 IP 地址。</li><li>6、本地域名服务器向 <a target="_blank" rel="noopener" href="http://example.com">example.com</a> 权威域名服务器发送查询。</li><li>7、<a target="_blank" rel="noopener" href="http://example.com">example.com</a> 权威域名服务器告诉本地域名服务器所查询的主机 IP 地址。</li><li>8、本地域名服务器最后把查询的 IP 地址响应给浏览器。</li></ul><p><img loading="lazy" data-src="https://wp-cdn.4ce.cn/v2/tskD255.jpeg" alt="Snipaste_2025-09-19_22-27-08.jpg"></p><h6 id="151-递归查询"><a class="anchor" href="#151-递归查询">#</a> 1.5.1 递归查询</h6><p>递归查询是指 DNS 服务器在收到用户发起的请求时，必须向用户返回一个准确的查询结果。<br>如果 DNS 服务器本地没有存储与之对应的信息，则该服务器需要询问其他服务器，并将返回的查询结构提交给用户。</p><h6 id="152-迭代查询"><a class="anchor" href="#152-迭代查询">#</a> 1.5.2 迭代查询</h6><p>迭代查询是指 DNS 服务器在收到用户发起的请求时，并不直接回复查询结果，而是告诉另一台 DNS 服务器的地址，用户再向这台 DNS 服务器提交请求，这样依次反复，直到返回查询结果。</p><h5 id="16-dns解析类型"><a class="anchor" href="#16-dns解析类型">#</a> 1.6 DNS 解析类型</h5><h6 id="161-a"><a class="anchor" href="#161-a">#</a> 1.6.1 A</h6><ul><li>A 记录可实现将域名指向 IP 地址，也称为正向解析；</li><li>正向解析：域名 --&gt; DNS 服务返回 IP；</li></ul><p><img loading="lazy" data-src="https://wp-cdn.4ce.cn/v2/3WCbtLs.jpeg" alt="1.jpg"></p><h6 id="162-ptr"><a class="anchor" href="#162-ptr">#</a> 1.6.2 PTR</h6><ul><li>PTR 记录可以实现 IP 查找域名，也称为反向解析；</li><li>反向解析： IP--&gt;DNS 服务返回域名；</li></ul><p><img loading="lazy" data-src="https://wp-cdn.4ce.cn/v2/BWcFQtl.jpeg" alt="2.jpg"></p><h6 id="163-cname"><a class="anchor" href="#163-cname">#</a> 1.6.3 CNAME</h6><ul><li>当需要将域名指向另一个域名，再由另一个域名提供 IP 地址，就需要添加 CNAME 记录；</li><li>最常用 CNAME 的场景有 WAF (Web Application Firewall)、CDN；</li></ul><p><img loading="lazy" data-src="https://wp-cdn.4ce.cn/v2/icO0aXj.jpeg" alt="3.jpg"></p><h6 id="164-ns"><a class="anchor" href="#164-ns">#</a> 1.6.4 NS</h6><ul><li>1、客户端查询 DNS 服务，如当前 DNS 无法提供权威解析，则返回一条 NS 记录；</li><li>2、客户端在通过 NS 记录中提供的 DNS 权威服务器进行解析；</li></ul><p><img loading="lazy" data-src="https://wp-cdn.4ce.cn/v2/e8xVQa8.jpeg" alt="4.jpg"></p><h6 id="165-mx"><a class="anchor" href="#165-mx">#</a> 1.6.5 MX</h6><p>MX 记录用于说明哪台服务器是当前区域的邮件服务器，包含内容：</p><ul><li>name：域名</li><li>IN MX：表示是邮件服务器的记录</li><li>数字：代表优先级</li><li>邮件服务器的完整域名：FQDN</li></ul><h5 id="17-企业自建dns方式"><a class="anchor" href="#17-企业自建dns方式">#</a> 1.7 企业自建 DNS 方式</h5><p>企业常规做法：购买域名、完成 ICP 备案，并使用公网 DNS 服务（万网..）进行免费（付费）解析。</p><p>为什么需要自建 DNS？</p><ul><li>1、内网 web 服务，例如： jenkins、jumpserver、wiki 等，不适合解析至公网；</li><li>2、内网中间件服务 db、mq 等，由于会经常迁移或扩缩容，应该使用域名对外提供，便于维护；</li><li>3、服务器都有 hostname ， hostname 应该设置为 FQDN ，如何维护主机名和主机的内网 IP 的关系；</li></ul><p>综上：我们需要构建至少一套企业内部的 DNS 服务；</p><h4 id="2-bind基础应用"><a class="anchor" href="#2-bind基础应用">#</a> 2. BIND 基础应用</h4><h5 id="21-什么是bind"><a class="anchor" href="#21-什么是bind">#</a> 2.1 什么是 BIND</h5><p>BIND （由美国加州大学开发并且维护的）、BIND 是一个开源、稳定、且应用广泛的 DNS 服务。</p><ul><li>开源：指 BIND 服务源代码是开放的；</li><li>稳定：指 BIND 服务运行非常稳定；</li><li>广泛：政府企业、单位机构、学校、等；</li></ul><h5 id="22-bind的组成"><a class="anchor" href="#22-bind的组成">#</a> 2.2 BIND 的组成</h5><p>BIND 提供（域名解析服务、权威域名服务、DNS 调试工具）</p><ul><li>域名解析服务：将域名解析为 IP 地址；</li><li>权威域名服务：能从该服务器查询到完整域名对应的 IP 地址，则这台服务器就算权威解析；</li><li>DNS 调试工具：主要提供 DNS 客户端调试工具，供客户端使用；</li></ul><h5 id="23-bind服务实战"><a class="anchor" href="#23-bind服务实战">#</a> 2.3 BIND 服务实战</h5><h6 id="231-bind环境准备"><a class="anchor" href="#231-bind环境准备">#</a> 2.3.1 BIND 环境准备</h6><table><thead><tr><th>系统版本</th><th>外网地址</th><th>内网地址</th><th>功能及作用</th></tr></thead><tbody><tr><td>Centos7</td><td>eth0：192.168.40.91</td><td>eth1：172.16.1.91</td><td>DNS-Master</td></tr><tr><td>Centos7</td><td>eth0：192.168.40.92</td><td>eth1：172.16.1.92</td><td>DNS-Slave</td></tr><tr><td>Centos7</td><td>eth0：192.168.40.93</td><td>eth1：172.16.1.93</td><td>DNS-Son【子域】</td></tr></tbody></table><h6 id="232-bind服务安装"><a class="anchor" href="#232-bind服务安装">#</a> 2.3.2 BIND 服务安装</h6><p>Bind 的安装非常简单，只需要通过 yum 即可完成安装；</p><ul><li>1、bind 提供主程序包；</li><li>2、bind-utils 提供工具包；</li></ul><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># yum install bind bind-utils -y</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># systemctl start named &amp;&amp; systemctl enable named</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># rndc-confgen -r /dev/urandom -a</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># chown root:named /etc/rndc.key</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># chmod 640 /etc/rndc.key </span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart named</span></pre></td></tr></table></figure><h6 id="233-bind配置文件"><a class="anchor" href="#233-bind配置文件">#</a> 2.3.3 BIND 配置文件</h6><ol><li>主配置文件格式</li></ol><ul><li>options {} ：全局选项（监听端口、数据文件存储位置、缓存位置、权限等）</li><li>logging {} ：服务日志选项</li><li>zone . {}：自定义区域配置</li><li>include：包含别的文件</li></ul><ol start="2"><li>主配置文件注意事项</li></ol><ul><li>语法非常严格；</li><li>文件权限属主 root ，属组 named ，文件权限 640</li></ul><ol start="3"><li>配置文件解析</li></ol><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/named.conf </span></pre></td></tr><tr><td data-num="2"></td><td><pre>options <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	// ipv4监听地址及端口</pre></td></tr><tr><td data-num="4"></td><td><pre>	listen-on port <span class="token number">53</span> <span class="token punctuation">&#123;</span> any<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre> 	// ipv6监听地址及端口</pre></td></tr><tr><td data-num="6"></td><td><pre>	listen-on-v6 port <span class="token number">53</span> <span class="token punctuation">&#123;</span> ::1<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	// 区域配置存储目录</pre></td></tr><tr><td data-num="8"></td><td><pre>	directory 	<span class="token string">"/var/named"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	// DNS解析过内容的缓存文件</pre></td></tr><tr><td data-num="10"></td><td><pre>	dump-file 	<span class="token string">"/var/named/data/cache_dump.db"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	// 静态解析文件（几乎不用）</pre></td></tr><tr><td data-num="12"></td><td><pre>	statistics-file <span class="token string">"/var/named/data/named_stats.txt"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>	// 内存的统计信息</pre></td></tr><tr><td data-num="14"></td><td><pre>	memstatistics-file <span class="token string">"/var/named/data/named_mem_stats.txt"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>	recursing-file  <span class="token string">"/var/named/data/named.recursing"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>	secroots-file   <span class="token string">"/var/named/data/named.secroots"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>	// 允许谁本台DNS发起查询请求（localhost<span class="token operator">|</span><span class="token function">ip</span><span class="token operator">|</span>any）</pre></td></tr><tr><td data-num="18"></td><td><pre>	allow-query     <span class="token punctuation">&#123;</span> any<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre>	/* </pre></td></tr><tr><td data-num="21"></td><td><pre>	 - If you are building an AUTHORITATIVE DNS server, <span class="token keyword">do</span> NOT <span class="token builtin class-name">enable</span> recursion.</pre></td></tr><tr><td data-num="22"></td><td><pre>	 - If you are building a RECURSIVE <span class="token punctuation">(</span>caching<span class="token punctuation">)</span> DNS server, you need to <span class="token builtin class-name">enable</span> </pre></td></tr><tr><td data-num="23"></td><td><pre>	   recursion. </pre></td></tr><tr><td data-num="24"></td><td><pre>	 - If your recursive DNS server has a public IP address, you MUST <span class="token builtin class-name">enable</span> access </pre></td></tr><tr><td data-num="25"></td><td><pre>	   control to limit queries to your legitimate users. Failing to <span class="token keyword">do</span> so will</pre></td></tr><tr><td data-num="26"></td><td><pre>	   cause your server to become part of large scale DNS amplification </pre></td></tr><tr><td data-num="27"></td><td><pre>	   attacks. Implementing BCP38 within your network would greatly</pre></td></tr><tr><td data-num="28"></td><td><pre>	   reduce such attack surface </pre></td></tr><tr><td data-num="29"></td><td><pre>	*/</pre></td></tr><tr><td data-num="30"></td><td><pre>	//递归查询</pre></td></tr><tr><td data-num="31"></td><td><pre>	recursion <span class="token function">yes</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>	//安全校验相关的</pre></td></tr><tr><td data-num="33"></td><td><pre>	dnssec-enable <span class="token function">yes</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>	//安全校验相关的</pre></td></tr><tr><td data-num="35"></td><td><pre>	dnssec-validation <span class="token function">yes</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre></pre></td></tr><tr><td data-num="37"></td><td><pre>	/* Path to ISC DLV key */</pre></td></tr><tr><td data-num="38"></td><td><pre>	bindkeys-file <span class="token string">"/etc/named.root.key"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre></pre></td></tr><tr><td data-num="40"></td><td><pre>	managed-keys-directory <span class="token string">"/var/named/dynamic"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre></pre></td></tr><tr><td data-num="42"></td><td><pre>	pid-file <span class="token string">"/run/named/named.pid"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>	session-keyfile <span class="token string">"/run/named/session.key"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="45"></td><td><pre></pre></td></tr><tr><td data-num="46"></td><td><pre>// 控制日志输出的级别以及输出的位置</pre></td></tr><tr><td data-num="47"></td><td><pre>logging <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>        channel default_debug <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>                <span class="token function">file</span> <span class="token string">"data/named.run"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>                severity dynamic<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="52"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="53"></td><td><pre></pre></td></tr><tr><td data-num="54"></td><td><pre>//默认可以对任何域名提供解析服务，因为named.ca中存储的是全球根域服务器<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>zone <span class="token string">"."</span> IN <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>	<span class="token builtin class-name">type</span> hint<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="57"></td><td><pre>	<span class="token function">file</span> <span class="token string">"named.ca"</span><span class="token punctuation">;</span>  //区域配置文件名称</pre></td></tr><tr><td data-num="58"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="59"></td><td><pre></pre></td></tr><tr><td data-num="60"></td><td><pre>//包含其他文件</pre></td></tr><tr><td data-num="61"></td><td><pre>include <span class="token string">"/etc/named.rfc1912.zones"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="62"></td><td><pre>include <span class="token string">"/etc/named.root.key"</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h6 id="234-客户端验证dns解析的配置"><a class="anchor" href="#234-客户端验证dns解析的配置">#</a> 2.3.4 客户端验证 DNS 解析的配置</h6><p>1. 配置 DNS 服务器指向，在 /etc/resolv.conf 里配置 dns 的 IP 地址</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/resolv.conf </span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token comment"># Generated by NetworkManager</span></pre></td></tr><tr><td data-num="3"></td><td><pre>nameserver <span class="token number">192.168</span>.40.91</pre></td></tr></table></figure><ol start="2"><li>使用 ping 命令验证解析</li></ol><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment"># ping www.baidu.com</span></pre></td></tr><tr><td data-num="2"></td><td><pre>PING www.a.shifen.com <span class="token punctuation">(</span><span class="token number">183.2</span>.172.177<span class="token punctuation">)</span> <span class="token number">56</span><span class="token punctuation">(</span><span class="token number">84</span><span class="token punctuation">)</span> bytes of data.</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">64</span> bytes from <span class="token number">183.2</span>.172.177 <span class="token punctuation">(</span><span class="token number">183.2</span>.172.177<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">128</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">15.5</span> ms</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token number">64</span> bytes from <span class="token number">183.2</span>.172.177 <span class="token punctuation">(</span><span class="token number">183.2</span>.172.177<span class="token punctuation">)</span>: <span class="token assign-left variable">icmp_seq</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">ttl</span><span class="token operator">=</span><span class="token number">128</span> <span class="token assign-left variable">time</span><span class="token operator">=</span><span class="token number">12.2</span> ms</pre></td></tr></table></figure><h5 id="24-自定义区域"><a class="anchor" href="#24-自定义区域">#</a> 2.4 自定义区域</h5><p>自定义域分为如下两类：</p><p>主机域（内网）</p><ul><li>1、主机域其实是一个假域；</li><li>2、主机域其实是不能解析到互联网上；</li><li>3、主机域它只对局域网（内网）提供服务；</li></ul><p>业务域（外网）</p><ul><li>1、业务域一般都是真实可用的；</li><li>2、业务域则为一个真正需要对外提供服务的域名；</li></ul><h6 id="241-自定义区域配置文件解析"><a class="anchor" href="#241-自定义区域配置文件解析">#</a> 2.4.1 自定义区域配置文件解析</h6><ul><li>区域 zone 文件定义在 /etc/named.conf 配置；</li><li>也可以配置在自定义的其他文件里，并在 named.conf 里 include</li><li>注意文件的权限，属主 root 属组 named 文件权限 640</li></ul><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>zone <span class="token string">"hmallleasing.com"</span> IN <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	<span class="token builtin class-name">type</span> master<span class="token operator">|</span>slave<span class="token punctuation">;</span>      // 自定义区域类型</pre></td></tr><tr><td data-num="3"></td><td><pre>	<span class="token function">file</span> /path/to/zonefile<span class="token punctuation">;</span> // 绝对路径和相对路径</pre></td></tr><tr><td data-num="4"></td><td><pre>	allow-update <span class="token punctuation">&#123;</span>ip<span class="token operator">|</span>none<span class="token punctuation">&#125;</span><span class="token punctuation">;</span> // 允许哪个ip可以使用nsupdate动态更新区域文件</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h6 id="242-自定义区域数据库文件"><a class="anchor" href="#242-自定义区域数据库文件">#</a> 2.4.2 自定义区域数据库文件</h6><p>范例以及编写注意事项：</p><ul><li>1、严格注意语法书写，其格式非常严格；</li><li>2、记录不准许折行书写；</li><li>3、单行记录开头不准许空格或 tab 开头；</li></ul><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># cat /var/named/example.com.zone</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token variable">$TTL</span> <span class="token number">600</span> <span class="token punctuation">;</span> DNS失效时间，单位秒<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>hmallleasing.com. IN SOA ns.hmallleasinge.com. xuyong.hmallleasing.com. <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">;</span> 区域名称 IN SOA dns.hmallleasing.com. 管理员邮箱</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">;</span> 区域名称可以使用过@表示，@表示当前域</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token number">2021041514</span> <span class="token punctuation">;</span> 序列号<span class="token punctuation">(</span>serial number<span class="token punctuation">)</span> 十进制，不能超过10位，通常使用日期时间戳，例如2018121601</pre></td></tr><tr><td data-num="8"></td><td><pre>	<span class="token number">10800</span>      <span class="token punctuation">;</span> 刷新时间<span class="token punctuation">(</span>refresh <span class="token function">time</span><span class="token punctuation">)</span> 即每隔多久到主服务器检查一次</pre></td></tr><tr><td data-num="9"></td><td><pre>	<span class="token number">900</span>        <span class="token punctuation">;</span> 重试时间<span class="token punctuation">(</span>retry <span class="token function">time</span><span class="token punctuation">)</span> 即刷新不成功多久后重试，应该小于refresh <span class="token function">time</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token number">604800</span>     <span class="token punctuation">;</span> 过期时间<span class="token punctuation">(</span>expire <span class="token function">time</span><span class="token punctuation">)</span> 当辅助DNS无法联系主DNS时，辅助DNS在多长时间内认为其缓存是有效的。</pre></td></tr><tr><td data-num="11"></td><td><pre>	<span class="token number">86400</span>      <span class="token punctuation">;</span> 权威应答的ttl<span class="token punctuation">(</span>netgative answer ttl<span class="token punctuation">)</span> <span class="token punctuation">;</span>缓存DNS服务器可以缓存记录多长时间</pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">;</span> 给客户端返回NS记录，hmallleasing.com. 域名由哪几台权威服务器提供解析</pre></td></tr><tr><td data-num="15"></td><td><pre>hmallleasing.com. IN NS ns1.hmallleasing.com.</pre></td></tr><tr><td data-num="16"></td><td><pre>hmallleasing.com. IN NS ns2.hmallleasing.com.</pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">;</span> A记录，配置权威域名的真实IP地址；</pre></td></tr><tr><td data-num="19"></td><td><pre>ns1.hmallleasing.com. IN A <span class="token number">172.16</span>.1.91</pre></td></tr><tr><td data-num="20"></td><td><pre>ns2.hmallleasing.com. IN A <span class="token number">172.16</span>.1.92</pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">;</span> 真正的域名解析</pre></td></tr><tr><td data-num="23"></td><td><pre>www.hmallleasing.com. IN A <span class="token number">1.1</span>.1.1</pre></td></tr><tr><td data-num="24"></td><td><pre>web.hmallleasing.com. IN A <span class="token number">2.2</span>.2.2</pre></td></tr></table></figure><h5 id="25-bind增加a记录正向解析实战"><a class="anchor" href="#25-bind增加a记录正向解析实战">#</a> 2.5 BIND 增加 A 记录正向解析实战</h5><p>用户通过 DNS 服务器 172.16.1.91 解析 <a target="_blank" rel="noopener" href="http://www.hmalleasing.com">www.hmalleasing.com</a></p><ul><li>1、添加 <a target="_blank" rel="noopener" href="http://hmallleasing.com">hmallleasing.com</a> 区域配置文件</li><li>2、添加区域数据库文件，配置 NS 记录，返回 DNS 权威服务器地址</li><li>3、该域的 DNS 权威服务器为 172.16.1.91</li><li>4、添加该域的 A 记录解析</li></ul><h6 id="251-新增区域配置文件"><a class="anchor" href="#251-新增区域配置文件">#</a> 2.5.1 新增区域配置文件</h6><p>1. 在主配置文件 /etc/named.conf，新增一个 hmallleasing.com 区域配置</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/named.conf</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="3"></td><td><pre>options <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	// ipv4监听地址及端口</pre></td></tr><tr><td data-num="5"></td><td><pre>	listen-on port <span class="token number">53</span> <span class="token punctuation">&#123;</span> any<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="7"></td><td><pre>	// 允许谁本台DNS发起查询请求（localhost<span class="token operator">|</span><span class="token function">ip</span><span class="token operator">|</span>any）</pre></td></tr><tr><td data-num="8"></td><td><pre>	allow-query     <span class="token punctuation">&#123;</span> any<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="10"></td><td><pre>//自行配置权威域名解析hmallleaing.com</pre></td></tr><tr><td data-num="11"></td><td><pre>zone <span class="token string">"hmallleasing.com"</span> IN <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre> 	 <span class="token builtin class-name">type</span> master<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre> 	 <span class="token function">file</span> <span class="token string">"hmallleasing.com.zone"</span><span class="token punctuation">;</span>    //具体解析记录配置存储至哪个文件</pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr></table></figure><p>2. 检查配置文件语法是否正常</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># named-checkconf</span></pre></td></tr></table></figure><h6 id="252-新增区域数据库文件"><a class="anchor" href="#252-新增区域数据库文件">#</a> 2.5.2 新增区域数据库文件</h6><p>1. 添加区域数据库文件</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># cat /var/named/hmallleasing.com.zone</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token variable">$TTL</span> <span class="token number">600</span> <span class="token punctuation">;</span> DNS失效时间，单位秒<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>hmallleasing.com. IN SOA ns.hmallleasing.com. xuy.nf-leasing.com. <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">;</span> 区域名称 IN SOA dns.hmallleasing.com. 管理员邮箱</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">;</span> 区域名称可以使用过@表示，@表示当前域</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token number">2025092018</span> <span class="token punctuation">;</span> 序列号<span class="token punctuation">(</span>serial number<span class="token punctuation">)</span> 十进制，不能超过10位，通常使用日期时间戳，例如2018121601</pre></td></tr><tr><td data-num="8"></td><td><pre>	<span class="token number">10800</span>      <span class="token punctuation">;</span> 刷新时间<span class="token punctuation">(</span>refresh <span class="token function">time</span><span class="token punctuation">)</span> 即每隔多久到主服务器检查一次</pre></td></tr><tr><td data-num="9"></td><td><pre>	<span class="token number">900</span>        <span class="token punctuation">;</span> 重试时间<span class="token punctuation">(</span>retry <span class="token function">time</span><span class="token punctuation">)</span> 即刷新不成功多久后重试，应该小于refresh <span class="token function">time</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token number">604800</span>     <span class="token punctuation">;</span> 过期时间<span class="token punctuation">(</span>expire <span class="token function">time</span><span class="token punctuation">)</span> 当辅助DNS无法联系主DNS时，辅助DNS在多长时间内认为其缓存是有效的。</pre></td></tr><tr><td data-num="11"></td><td><pre>	<span class="token number">86400</span>      <span class="token punctuation">;</span> 权威应答的ttl<span class="token punctuation">(</span>netgative answer ttl<span class="token punctuation">)</span> <span class="token punctuation">;</span>缓存DNS服务器可以缓存记录多长时间</pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">;</span> 给客户端返回NS记录，hmallleasing.com. 域名由哪几台权威服务器提供解析</pre></td></tr><tr><td data-num="15"></td><td><pre>hmallleasing.com. IN NS ns1.hmallleasing.com.</pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">;</span> A记录，配置权威域名的真实IP地址；</pre></td></tr><tr><td data-num="18"></td><td><pre>ns1.hmallleasing.com. IN A <span class="token number">172.16</span>.1.91</pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">;</span> 真正的域名解析</pre></td></tr><tr><td data-num="21"></td><td><pre>www.hmallleasing.com. IN A <span class="token number">1.1</span>.1.1</pre></td></tr><tr><td data-num="22"></td><td><pre>web.hmallleasing.com. IN A <span class="token number">2.2</span>.2.2</pre></td></tr></table></figure><p>2. 检查区域数据库文件</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># named-checkzone hmallleasing.com  /var/named/hmallleasing.com.zone</span></pre></td></tr><tr><td data-num="2"></td><td><pre>zone hmallleasing.com/IN: loaded serial <span class="token number">2025092018</span></pre></td></tr><tr><td data-num="3"></td><td><pre>OK</pre></td></tr></table></figure><p>3. 重载 DNS 服务器</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># rndc reload</span></pre></td></tr></table></figure><h6 id="253-客户端测试域名解析"><a class="anchor" href="#253-客户端测试域名解析">#</a> 2.5.3 客户端测试域名解析</h6><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment"># yum install bind-utils -y</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment"># dig web.hmallleasing.com @172.16.1.91 +short</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">2.2</span>.2.2</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment"># dig www.hmallleasing.com @172.16.1.91 +short</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token number">1.1</span>.1.1</pre></td></tr></table></figure><h5 id="26-bind增加cname记录实战"><a class="anchor" href="#26-bind增加cname记录实战">#</a> 2.6 BIND 增加 CNAME 记录实战</h5><p>用户通过 DNS 服务器 172.16.1.91 解析 <a target="_blank" rel="noopener" href="http://www.job.com">www.job.com</a></p><p>1、添加 <a target="_blank" rel="noopener" href="http://job.com">job.com</a> 区域配置文件</p><p>2、添加区域数据库文件，配置 NS 记录，返回 DNS 权威服务器地址</p><p>3、该域的 DNS 权威服务器为 172.16.1.91</p><p>4、添加该域的 CNAME 解析记录，解析至 <a target="_blank" rel="noopener" href="http://www.hmallleasing.com">www.hmallleasing.com</a> 域名上</p><p><img loading="lazy" data-src="https://wp-cdn.4ce.cn/v2/RBrxONj.jpeg" alt="1.jpg"></p><h6 id="261-新增区域配置文件"><a class="anchor" href="#261-新增区域配置文件">#</a> 2.6.1 新增区域配置文件</h6><p>1. 在主配置文件 /etc/named.conf，新增一个 hmallleasing.com 区域配置</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/named.conf</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="3"></td><td><pre>options <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	// ipv4监听地址及端口</pre></td></tr><tr><td data-num="5"></td><td><pre>	listen-on port <span class="token number">53</span> <span class="token punctuation">&#123;</span> any<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="7"></td><td><pre>	// 允许谁本台DNS发起查询请求（localhost<span class="token operator">|</span><span class="token function">ip</span><span class="token operator">|</span>any）</pre></td></tr><tr><td data-num="8"></td><td><pre>	allow-query     <span class="token punctuation">&#123;</span> any<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="10"></td><td><pre>//自行配置权威域名解析job.com</pre></td></tr><tr><td data-num="11"></td><td><pre>zone <span class="token string">"job.com"</span> IN <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre> 	 <span class="token builtin class-name">type</span> master<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre> 	 <span class="token function">file</span> <span class="token string">"job.com.zone"</span><span class="token punctuation">;</span>    //具体解析记录配置存储至哪个文件</pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr></table></figure><p>2. 检查配置文件语法是否正常</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># named-checkconf</span></pre></td></tr></table></figure><h6 id="262-新增区域数据库文件"><a class="anchor" href="#262-新增区域数据库文件">#</a> 2.6.2 新增区域数据库文件</h6><p>1. 添加区域数据库文件</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># cat /var/named/job.com.zone</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token variable">$TTL</span> <span class="token number">600</span> <span class="token punctuation">;</span> DNS失效时间，单位秒<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>job.com. IN SOA ns.job.com. xuy.nf-leasing.com. <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">;</span> 区域名称 IN SOA dns.hmallleasing.com. 管理员邮箱</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">;</span> 区域名称可以使用过@表示，@表示当前域</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token number">2025092018</span> <span class="token punctuation">;</span> 序列号<span class="token punctuation">(</span>serial number<span class="token punctuation">)</span> 十进制，不能超过10位，通常使用日期时间戳，例如2018121601</pre></td></tr><tr><td data-num="8"></td><td><pre>	<span class="token number">10800</span>      <span class="token punctuation">;</span> 刷新时间<span class="token punctuation">(</span>refresh <span class="token function">time</span><span class="token punctuation">)</span> 即每隔多久到主服务器检查一次</pre></td></tr><tr><td data-num="9"></td><td><pre>	<span class="token number">900</span>        <span class="token punctuation">;</span> 重试时间<span class="token punctuation">(</span>retry <span class="token function">time</span><span class="token punctuation">)</span> 即刷新不成功多久后重试，应该小于refresh <span class="token function">time</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token number">604800</span>     <span class="token punctuation">;</span> 过期时间<span class="token punctuation">(</span>expire <span class="token function">time</span><span class="token punctuation">)</span> 当辅助DNS无法联系主DNS时，辅助DNS在多长时间内认为其缓存是有效的。</pre></td></tr><tr><td data-num="11"></td><td><pre>	<span class="token number">86400</span>      <span class="token punctuation">;</span> 权威应答的ttl<span class="token punctuation">(</span>netgative answer ttl<span class="token punctuation">)</span> <span class="token punctuation">;</span>缓存DNS服务器可以缓存记录多长时间</pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">;</span> 给客户端返回NS记录，hmallleasing.com. 域名由哪几台权威服务器提供解析</pre></td></tr><tr><td data-num="15"></td><td><pre>job.com. IN NS ns1.job.com.</pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">;</span> A记录，配置权威域名的真实IP地址；</pre></td></tr><tr><td data-num="18"></td><td><pre>ns1.job.com. IN A <span class="token number">172.16</span>.1.91</pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">;</span> 真正的域名解析</pre></td></tr><tr><td data-num="21"></td><td><pre>www.job.com. IN CNAME www.hmallleasing.com.</pre></td></tr><tr><td data-num="22"></td><td><pre>dev.job.com. IN A <span class="token number">2.2</span>.2.3</pre></td></tr></table></figure><p>2. 检查区域数据库文件</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># named-checkzone job.com  /var/named/job.com.zone</span></pre></td></tr><tr><td data-num="2"></td><td><pre>zone job.com/IN: loaded serial <span class="token number">2025092018</span></pre></td></tr><tr><td data-num="3"></td><td><pre>OK</pre></td></tr></table></figure><p>3. 重载 DNS 服务器</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># rndc reload</span></pre></td></tr></table></figure><h6 id="263-客户端测试域名解析"><a class="anchor" href="#263-客户端测试域名解析">#</a> 2.6.3 客户端测试域名解析</h6><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment"># dig www.job.com @172.16.1.91 +short</span></pre></td></tr><tr><td data-num="2"></td><td><pre>www.hmallleasing.com.</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">1.1</span>.1.1</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment"># dig dev.job.com @172.16.1.91 +short</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token number">2.2</span>.2.3</pre></td></tr></table></figure><h5 id="27-bind增加ptr记录反向解析实战"><a class="anchor" href="#27-bind增加ptr记录反向解析实战">#</a> 2.7 BIND 增加 PTR 记录反向解析实战</h5><p>配置反向解析 PTR：IP--&gt;FQDN</p><ul><li>1、反向区域文件名称为逆向网络地址 加 .in-addr.arpa. 后缀组成</li><li>2、反向区域数据库文件，例如 172.16.1.200 的 name 为 200 ，完全格式为：1.16.172.in-addr.arpa.</li></ul><h6 id="271-新增区域配置文件"><a class="anchor" href="#271-新增区域配置文件">#</a> 2.7.1 新增区域配置文件</h6><p>1. 在主配置文件 /etc/named.conf，新增一个反向区域配置</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/named.conf</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="3"></td><td><pre>options <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	// ipv4监听地址及端口</pre></td></tr><tr><td data-num="5"></td><td><pre>	listen-on port <span class="token number">53</span> <span class="token punctuation">&#123;</span> any<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="7"></td><td><pre>	// 允许谁本台DNS发起查询请求（localhost<span class="token operator">|</span><span class="token function">ip</span><span class="token operator">|</span>any）</pre></td></tr><tr><td data-num="8"></td><td><pre>	allow-query     <span class="token punctuation">&#123;</span> any<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="10"></td><td><pre>//配置反向解析</pre></td></tr><tr><td data-num="11"></td><td><pre>zone <span class="token string">"1.16.172.in-addr.arpa"</span> IN <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token builtin class-name">type</span> master<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token function">file</span> <span class="token string">"1.16.172.zone"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr></table></figure><p>2. 检查配置文件语法是否正常</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># named-checkconf</span></pre></td></tr></table></figure><h6 id="272-新增区域数据库文件"><a class="anchor" href="#272-新增区域数据库文件">#</a> 2.7.2 新增区域数据库文件</h6><p>1. 添加反向解析区域数据库文件</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># cat /var/named/1.16.172.zone</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token variable">$TTL</span> <span class="token number">600</span> <span class="token punctuation">;</span> DNS失效时间，单位秒<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>@ IN SOA <span class="token number">1.16</span>.172.in-addr.arpa. xuy.nf-leasing.com. <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token number">2025092018</span> <span class="token punctuation">;</span> 序列号<span class="token punctuation">(</span>serial number<span class="token punctuation">)</span> 十进制，不能超过10位，通常使用日期时间戳，例如2018121601</pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token number">10800</span>      <span class="token punctuation">;</span> 刷新时间<span class="token punctuation">(</span>refresh <span class="token function">time</span><span class="token punctuation">)</span> 即每隔多久到主服务器检查一次</pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token number">900</span>        <span class="token punctuation">;</span> 重试时间<span class="token punctuation">(</span>retry <span class="token function">time</span><span class="token punctuation">)</span> 即刷新不成功多久后重试，应该小于refresh <span class="token function">time</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token number">604800</span>     <span class="token punctuation">;</span> 过期时间<span class="token punctuation">(</span>expire <span class="token function">time</span><span class="token punctuation">)</span> 当辅助DNS无法联系主DNS时，辅助DNS在多长时间内认为其缓存是有效的。</pre></td></tr><tr><td data-num="8"></td><td><pre>	<span class="token number">86400</span>      <span class="token punctuation">;</span> 权威应答的ttl<span class="token punctuation">(</span>netgative answer ttl<span class="token punctuation">)</span> <span class="token punctuation">;</span>缓存DNS服务器可以缓存记录多长时间</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">;</span>ns反向解析</pre></td></tr><tr><td data-num="12"></td><td><pre>@ IN NS ns1.hmallleasing.com.</pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">;</span>权威DNS反向解析</pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token number">91</span> IN PTR ns1.hmallleasing.com.</pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">;</span>www反向解析</pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token number">200</span> IN PTR route.hmallleasing.com.</pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token number">5</span> IN PTR lb.hmallleasing.com.</pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token number">7</span> IN PTR web01.hmallleasing.com.</pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token number">8</span> IN PTR web02.hmallleasing.com.</pre></td></tr></table></figure><p>2. 检查区域数据库文件</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># named-checkzone job.com /var/named/1.16.172.zone</span></pre></td></tr><tr><td data-num="2"></td><td><pre>zone job.com/IN: loaded serial <span class="token number">2025092018</span></pre></td></tr><tr><td data-num="3"></td><td><pre>OK</pre></td></tr></table></figure><p>3. 重载 DNS 服务器</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># rndc reload</span></pre></td></tr></table></figure><h6 id="273-客户端测试域名解析"><a class="anchor" href="#273-客户端测试域名解析">#</a> 2.7.3 客户端测试域名解析</h6><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment"># dig -x 172.16.1.200 @172.16.1.91 +short</span></pre></td></tr><tr><td data-num="2"></td><td><pre>route.hmallleasing.com.</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment"># dig -x 172.16.1.7 @172.16.1.91 +short</span></pre></td></tr><tr><td data-num="4"></td><td><pre>web01.hmallleasing.com.</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment"># dig -x 172.16.1.8 @172.16.1.91 +short</span></pre></td></tr><tr><td data-num="6"></td><td><pre>web02.hmallleasing.com.</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment"># dig -x 172.16.1.5 @172.16.1.91 +short</span></pre></td></tr><tr><td data-num="8"></td><td><pre>lb.hmallleasing.com.</pre></td></tr></table></figure><h4 id="3-递归查询"><a class="anchor" href="#3-递归查询">#</a> 3. 递归查询</h4><h5 id="31-什么是递归查询"><a class="anchor" href="#31-什么是递归查询">#</a> 3.1 什么是递归查询</h5><p><img loading="lazy" data-src="https://wp-cdn.4ce.cn/v2/zLPqMP3.jpeg" alt="3.jpg"></p><ul><li>如果你要建立一个【授权域名】服务器，仅提供本地已存在域名解析即可；那么不要开启 recursion 功能。</li><li>如果你要建立一个递归 DNS 服务器，那么需要开启 recursion 功能。</li><li>如果你的递归 DNS 服务器有公网 IP 地址，你必须开启访问控制功能，只有合法用户才可以发询问。</li></ul><h5 id="32-递归查询配置参数"><a class="anchor" href="#32-递归查询配置参数">#</a> 3.2 递归查询配置参数</h5><table><thead><tr><th>参数</th><th>选项</th><th>作用</th></tr></thead><tbody><tr><td>recurison</td><td>yes/no</td><td>是否开启递归查询请求</td></tr><tr><td>allow-recursion</td><td>{address_match_list | any | none };</td><td>限制客户端递归请求的范围</td></tr></tbody></table><h5 id="33-递归查询配置场景"><a class="anchor" href="#33-递归查询配置场景">#</a> 3.3 递归查询配置场景</h5><h6 id="331-开启递归查询"><a class="anchor" href="#331-开启递归查询">#</a> 3.3.1 开启递归查询</h6><p>BIND 默认配置中的 recurison 参数是启用的；</p><ul><li>1、配置仅允许 172.16.1.0 网段用户可以查询（可选）；</li><li>2、使用客户端查询系统中存在的域名；</li><li>3、使用客户端查询系统中不存在的域名（让 BIND 进行递归查询）；</li></ul><p>1. 修改 /etc/named.conf 配置文件</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/named.conf </span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="3"></td><td><pre>	//递归查询</pre></td></tr><tr><td data-num="4"></td><td><pre>	recursion <span class="token function">yes</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	allow-recursion <span class="token punctuation">&#123;</span> <span class="token number">192.168</span>.40.0/24<span class="token punctuation">;</span><span class="token number">172.16</span>.1.0/24<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr></table></figure><p>2. 语法检查且重新加载 named</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># named-checkconf </span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># rndc reload</span></pre></td></tr><tr><td data-num="3"></td><td><pre>server reload successful</pre></td></tr></table></figure><p>3. 查询存在 BIND 服务中的域名</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment"># dig web.hmallleasing.com @172.16.1.91 +short</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">2.2</span>.2.2</pre></td></tr></table></figure><p>4. 查询不在 BIND 服务中的域名，可以获取正确返回，原因是 BIND 进行了递归查询</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment"># dig www.qq.com @172.16.1.91 +short</span></pre></td></tr><tr><td data-num="2"></td><td><pre>ins-r23tsuuf.ias.tencent-cloud.net.</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">121.14</span>.77.221</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token number">121.14</span>.77.201</pre></td></tr></table></figure><h6 id="332-关闭递归查询"><a class="anchor" href="#332-关闭递归查询">#</a> 3.3.2 关闭递归查询</h6><p>1. 修改 /etc/named.conf 配置文件</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/named.conf </span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="3"></td><td><pre>	//递归查询</pre></td></tr><tr><td data-num="4"></td><td><pre>	recursion no<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token comment">#allow-recursion &#123; 192.168.40.0/24;172.16.1.0/24; &#125;;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr></table></figure><p>2. 语法检查且重新加载 named</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># named-checkconf </span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># rndc reload</span></pre></td></tr><tr><td data-num="3"></td><td><pre>server reload successful</pre></td></tr></table></figure><p>3. 查询存在 BIND 服务中的域名会返回权威结果，因为本地无需进行递归查询，即可返回权威解析</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment"># dig web.hmallleasing.com @172.16.1.91 +short</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">2.2</span>.2.2</pre></td></tr></table></figure><p>4. 由于本地无法返回权威结果，同时也禁用了递归查询，所以查询本地不存在域名会有 WARNING 提示</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment"># dig www.qq.com @172.16.1.91</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">;</span> <span class="token operator">&lt;&lt;</span><span class="token operator">>></span> DiG <span class="token number">9.11</span>.4-P2-RedHat-9.11.4-26.P2.el7_9.16 <span class="token operator">&lt;&lt;</span><span class="token operator">>></span> www.qq.com @172.16.1.91</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> global options: +cmd</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> Got answer:</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> -<span class="token operator">>></span>HEADER<span class="token operator">&lt;&lt;-</span> opcode: QUERY, status: REFUSED, id: <span class="token number">30635</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> flags: qr rd<span class="token punctuation">;</span> QUERY: <span class="token number">1</span>, ANSWER: <span class="token number">0</span>, AUTHORITY: <span class="token number">0</span>, ADDITIONAL: <span class="token number">1</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> WARNING: recursion requested but not available   <span class="token comment">#递归查询不可用</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> OPT PSEUDOSECTION:</pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">;</span> EDNS: version: <span class="token number">0</span>, flags:<span class="token punctuation">;</span> udp: <span class="token number">4096</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> QUESTION SECTION:</pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">;</span>www.qq.com.			IN	A</pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> Query time: <span class="token number">0</span> msec</pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> SERVER: <span class="token number">172.16</span>.1.91<span class="token comment">#53(172.16.1.91)</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> WHEN: Sat Sep <span class="token number">20</span> <span class="token number">21</span>:33:54 CST <span class="token number">2025</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> MSG SIZE  rcvd: <span class="token number">39</span></pre></td></tr></table></figure><h4 id="4-dns主辅同步"><a class="anchor" href="#4-dns主辅同步">#</a> 4. DNS 主辅同步</h4><h5 id="41-dns主辅同步概念"><a class="anchor" href="#41-dns主辅同步概念">#</a> 4.1 DNS 主辅同步概念</h5><p>辅助 DNS 是 DNS 容灾备份服务：在主 DNS 和辅 DNS 之间建立区域数据传输机制，当主 DNS 遇到故障或者服务中断时，辅 DNS 仍可以继续提供解析服务，因此保障业务稳定运行。</p><p>辅助 DNS 的优势：</p><ul><li>容灾备份，降低业务中断风险：主 DNS 系统故障，辅助 DNS 可继续提供域名解析服务，保障业务可用性。</li><li>负责均衡，流量均摊降低负载：当辅助 DNS 与主 DNS 同时对外提供解析服务时，可以达到流量负载均衡的效果。</li></ul><h5 id="42-dns主从同步原理"><a class="anchor" href="#42-dns主从同步原理">#</a> 4.2 DNS 主从同步原理</h5><p><img loading="lazy" data-src="https://wp-cdn.4ce.cn/v2/4XJrCeP.jpeg" alt="918540-20230508112130365-444561605.jpg"></p><h5 id="43-dns主从同步场景"><a class="anchor" href="#43-dns主从同步场景">#</a> 4.3 DNS 主从同步场景</h5><h6 id="431-主从环境准备"><a class="anchor" href="#431-主从环境准备">#</a> 4.3.1 主从环境准备</h6><ul><li>1、确保防火墙规则开放（建议关闭）</li><li>2、保持主从服务器时钟一致；</li><li>3、搭建完主从后，若修改主服务器域配置， Serail Number 必须递增，否则不同步；</li></ul><h6 id="432-主辅同步配置要点"><a class="anchor" href="#432-主辅同步配置要点">#</a> 4.3.2 主辅同步配置要点</h6><ul><li>1、主 DNS 的 named.conf 里配置 allow-transfer 和 also-notify 选项；</li><li>2、辅助 DNS 主配置文件 option 段添加 masterfile-format text ，否则同步的文件为 data 类型；</li><li>3、辅助 DNS 添加区域配置文件，类型为 slave ，同时指向 masters 参数指向 master 地址；</li><li>4、辅助 DNS 不可主动修改 DNS 数据库文件；</li></ul><h6 id="433-master服务器的配置"><a class="anchor" href="#433-master服务器的配置">#</a> 4.3.3 Master 服务器的配置</h6><p>1. 在主配置文件 /etc/named.conf，新增一个反向区域配置</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/named.conf</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="3"></td><td><pre>options <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	//允许哪个地址同步master配置信息</pre></td></tr><tr><td data-num="5"></td><td><pre>    allow-transfer <span class="token punctuation">&#123;</span> <span class="token number">172.16</span>.1.92<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="6"></td><td><pre>	//主动通知辅助DNS域名变更	</pre></td></tr><tr><td data-num="7"></td><td><pre>    also-notify <span class="token punctuation">&#123;</span> <span class="token number">172.16</span>.1.92<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="10"></td><td><pre>//自行配置权威域名解析hmallleaing.com</pre></td></tr><tr><td data-num="11"></td><td><pre>zone <span class="token string">"hmallleasing.com"</span> IN <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre> 	 <span class="token builtin class-name">type</span> master<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre> 	 <span class="token function">file</span> <span class="token string">"hmallleasing.com.zone"</span><span class="token punctuation">;</span>    //具体解析记录配置存储至哪个文件</pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>zone <span class="token string">"job.com"</span> IN <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre> 	 <span class="token builtin class-name">type</span> master<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre> 	 <span class="token function">file</span> <span class="token string">"job.com.zone"</span><span class="token punctuation">;</span>    //具体解析记录配置存储至哪个文件</pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>//配置反向解析</pre></td></tr><tr><td data-num="22"></td><td><pre>zone <span class="token string">"1.16.172.in-addr.arpa"</span> IN <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token builtin class-name">type</span> master<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>  <span class="token function">file</span> <span class="token string">"1.16.172.zone"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr></table></figure><p>2. 添加区域数据库文件 (需要多添加一条 ns 记录)</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#1.hmallleasing.com.zone 需要多添加一条 ns 记录</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># cat /var/named/hmallleasing.com.zone </span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token variable">$TTL</span> <span class="token number">600</span> <span class="token punctuation">;</span> DNS失效时间，单位秒<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>hmallleasing.com. IN SOA ns.hmallleasing.com. xuy.nf-leasing.com. <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">;</span> 区域名称 IN SOA dns.hmallleasing.com. 管理员邮箱</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">;</span> 区域名称可以使用过@表示，@表示当前域</pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>	<span class="token number">2025092018</span> <span class="token punctuation">;</span> 序列号<span class="token punctuation">(</span>serial number<span class="token punctuation">)</span> 十进制，不能超过10位，通常使用日期时间戳，例如2018121601</pre></td></tr><tr><td data-num="9"></td><td><pre>	<span class="token number">10800</span>      <span class="token punctuation">;</span> 刷新时间<span class="token punctuation">(</span>refresh <span class="token function">time</span><span class="token punctuation">)</span> 即每隔多久到主服务器检查一次</pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token number">900</span>        <span class="token punctuation">;</span> 重试时间<span class="token punctuation">(</span>retry <span class="token function">time</span><span class="token punctuation">)</span> 即刷新不成功多久后重试，应该小于refresh <span class="token function">time</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	<span class="token number">604800</span>     <span class="token punctuation">;</span> 过期时间<span class="token punctuation">(</span>expire <span class="token function">time</span><span class="token punctuation">)</span> 当辅助DNS无法联系主DNS时，辅助DNS在多长时间内认为其缓存是有效的。</pre></td></tr><tr><td data-num="12"></td><td><pre>	<span class="token number">86400</span>      <span class="token punctuation">;</span> 权威应答的ttl<span class="token punctuation">(</span>netgative answer ttl<span class="token punctuation">)</span> <span class="token punctuation">;</span>缓存DNS服务器可以缓存记录多长时间</pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">;</span> 给客户端返回NS记录，hmallleasing.com. 域名由哪几台权威服务器提供解析</pre></td></tr><tr><td data-num="16"></td><td><pre>hmallleasing.com. IN NS ns1.hmallleasing.com.</pre></td></tr><tr><td data-num="17"></td><td><pre>hmallleasing.com. IN NS ns2.hmallleasing.com.</pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">;</span> A记录，配置权威域名的真实IP地址；</pre></td></tr><tr><td data-num="20"></td><td><pre>ns1.hmallleasing.com. IN A <span class="token number">172.16</span>.1.91</pre></td></tr><tr><td data-num="21"></td><td><pre>ns2.hmallleasing.com. IN A <span class="token number">172.16</span>.1.92</pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token punctuation">;</span> 真正的域名解析</pre></td></tr><tr><td data-num="24"></td><td><pre>www.hmallleasing.com. IN A <span class="token number">1.1</span>.1.1</pre></td></tr><tr><td data-num="25"></td><td><pre>web.hmallleasing.com. IN A <span class="token number">2.2</span>.2.2</pre></td></tr><tr><td data-num="26"></td><td><pre></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token comment">#2./1.16.172.zone 需要多添加一条 ns 记录</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># cat /var/named/1.16.172.zone </span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token variable">$TTL</span> <span class="token number">600</span> <span class="token punctuation">;</span> DNS失效时间，单位秒<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>@ IN SOA <span class="token number">1.16</span>.172.in-addr.arpa. xuy.nf-leasing.com. <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="31"></td><td><pre>	<span class="token number">2025092018</span> <span class="token punctuation">;</span> 序列号<span class="token punctuation">(</span>serial number<span class="token punctuation">)</span> 十进制，不能超过10位，通常使用日期时间戳，例如2018121601</pre></td></tr><tr><td data-num="32"></td><td><pre>	<span class="token number">10800</span>      <span class="token punctuation">;</span> 刷新时间<span class="token punctuation">(</span>refresh <span class="token function">time</span><span class="token punctuation">)</span> 即每隔多久到主服务器检查一次</pre></td></tr><tr><td data-num="33"></td><td><pre>	<span class="token number">900</span>        <span class="token punctuation">;</span> 重试时间<span class="token punctuation">(</span>retry <span class="token function">time</span><span class="token punctuation">)</span> 即刷新不成功多久后重试，应该小于refresh <span class="token function">time</span></pre></td></tr><tr><td data-num="34"></td><td><pre>	<span class="token number">604800</span>     <span class="token punctuation">;</span> 过期时间<span class="token punctuation">(</span>expire <span class="token function">time</span><span class="token punctuation">)</span> 当辅助DNS无法联系主DNS时，辅助DNS在多长时间内认为其缓存是有效的。</pre></td></tr><tr><td data-num="35"></td><td><pre>	<span class="token number">86400</span>      <span class="token punctuation">;</span> 权威应答的ttl<span class="token punctuation">(</span>netgative answer ttl<span class="token punctuation">)</span> <span class="token punctuation">;</span>缓存DNS服务器可以缓存记录多长时间</pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="37"></td><td><pre></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token punctuation">;</span>ns反向解析</pre></td></tr><tr><td data-num="39"></td><td><pre>@ IN NS ns1.hmallleasing.com.</pre></td></tr><tr><td data-num="40"></td><td><pre>@ IN NS ns2.hmallleasing.com.</pre></td></tr><tr><td data-num="41"></td><td><pre></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token punctuation">;</span>权威DNS反向解析</pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token number">91</span> IN PTR ns1.hmallleasing.com.</pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token number">92</span> IN PTR ns2.hmallleasing.com.</pre></td></tr><tr><td data-num="45"></td><td><pre></pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token punctuation">;</span>www反向解析</pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token number">200</span> IN PTR route.hmallleasing.com.</pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token number">5</span> IN PTR lb.hmallleasing.com.</pre></td></tr><tr><td data-num="49"></td><td><pre><span class="token number">7</span> IN PTR web01.hmallleasing.com.</pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token number">8</span> IN PTR web02.hmallleasing.com.</pre></td></tr><tr><td data-num="51"></td><td><pre></pre></td></tr><tr><td data-num="52"></td><td><pre><span class="token comment">#2.job.com.zone 需要多添加一条 ns 记录</span></pre></td></tr><tr><td data-num="53"></td><td><pre><span class="token punctuation">[</span>root@dns-master named<span class="token punctuation">]</span><span class="token comment"># cat job.com.zone </span></pre></td></tr><tr><td data-num="54"></td><td><pre><span class="token variable">$TTL</span> <span class="token number">600</span> <span class="token punctuation">;</span> DNS失效时间，单位秒<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>job.com. IN SOA ns.job.com. xuy.nf-leasing.com. <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="56"></td><td><pre><span class="token punctuation">;</span> 区域名称 IN SOA dns.hmallleasing.com. 管理员邮箱</pre></td></tr><tr><td data-num="57"></td><td><pre><span class="token punctuation">;</span> 区域名称可以使用过@表示，@表示当前域</pre></td></tr><tr><td data-num="58"></td><td><pre></pre></td></tr><tr><td data-num="59"></td><td><pre>	<span class="token number">2025092019</span> <span class="token punctuation">;</span> 序列号<span class="token punctuation">(</span>serial number<span class="token punctuation">)</span> 十进制，不能超过10位，通常使用日期时间戳，例如2018121601</pre></td></tr><tr><td data-num="60"></td><td><pre>	<span class="token number">10800</span>      <span class="token punctuation">;</span> 刷新时间<span class="token punctuation">(</span>refresh <span class="token function">time</span><span class="token punctuation">)</span> 即每隔多久到主服务器检查一次</pre></td></tr><tr><td data-num="61"></td><td><pre>	<span class="token number">900</span>        <span class="token punctuation">;</span> 重试时间<span class="token punctuation">(</span>retry <span class="token function">time</span><span class="token punctuation">)</span> 即刷新不成功多久后重试，应该小于refresh <span class="token function">time</span></pre></td></tr><tr><td data-num="62"></td><td><pre>	<span class="token number">604800</span>     <span class="token punctuation">;</span> 过期时间<span class="token punctuation">(</span>expire <span class="token function">time</span><span class="token punctuation">)</span> 当辅助DNS无法联系主DNS时，辅助DNS在多长时间内认为其缓存是有效的。</pre></td></tr><tr><td data-num="63"></td><td><pre>	<span class="token number">86400</span>      <span class="token punctuation">;</span> 权威应答的ttl<span class="token punctuation">(</span>netgative answer ttl<span class="token punctuation">)</span> <span class="token punctuation">;</span>缓存DNS服务器可以缓存记录多长时间</pre></td></tr><tr><td data-num="64"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="65"></td><td><pre></pre></td></tr><tr><td data-num="66"></td><td><pre><span class="token punctuation">;</span> 给客户端返回NS记录，hmallleasing.com. 域名由哪几台权威服务器提供解析</pre></td></tr><tr><td data-num="67"></td><td><pre>job.com. IN NS ns1.job.com.</pre></td></tr><tr><td data-num="68"></td><td><pre>job.com. IN NS ns2.job.com.</pre></td></tr><tr><td data-num="69"></td><td><pre></pre></td></tr><tr><td data-num="70"></td><td><pre><span class="token punctuation">;</span> A记录，配置权威域名的真实IP地址；</pre></td></tr><tr><td data-num="71"></td><td><pre>ns1.job.com. IN A <span class="token number">172.16</span>.1.91</pre></td></tr><tr><td data-num="72"></td><td><pre>ns2.job.com. IN A <span class="token number">172.16</span>.1.92</pre></td></tr><tr><td data-num="73"></td><td><pre></pre></td></tr><tr><td data-num="74"></td><td><pre><span class="token punctuation">;</span> 真正的域名解析</pre></td></tr><tr><td data-num="75"></td><td><pre>www.job.com. IN CNAME www.hmallleasing.com.</pre></td></tr><tr><td data-num="76"></td><td><pre>dev.job.com. IN A <span class="token number">2.2</span>.2.3</pre></td></tr></table></figure><p>3. 检查语法并重载 DNS 服务器</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># named-checkconf</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># named-checkzone hmallleasing.com /var/named/hmallleasing.com.zone </span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># rndc reload</span></pre></td></tr></table></figure><h6 id="434-slave服务器的配置"><a class="anchor" href="#434-slave服务器的配置">#</a> 4.3.4 Slave 服务器的配置</h6><p>1. 安装 bind 服务</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-slave ~<span class="token punctuation">]</span><span class="token comment"># yum install bind bind-utils -y</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@dns-slave ~<span class="token punctuation">]</span><span class="token comment"># systemctl start named &amp;&amp; systemctl enable named</span></pre></td></tr></table></figure><p>2. 配置 rndc【首次需要配置】</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-slave ~<span class="token punctuation">]</span><span class="token comment"># rndc-confgen -r /dev/urandom -a</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@dns-slave ~<span class="token punctuation">]</span><span class="token comment"># chown root:named /etc/rndc.key</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@dns-slave ~<span class="token punctuation">]</span><span class="token comment"># chmod 640 /etc/rndc.key </span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">[</span>root@dns-slave ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart named</span></pre></td></tr></table></figure><p>3. 修改主配置文件</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-slave ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/named.conf </span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="3"></td><td><pre>options <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	listen-on port <span class="token number">53</span> <span class="token punctuation">&#123;</span> any<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	allow-query     <span class="token punctuation">&#123;</span> any<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    masterfile-format text<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr></table></figure><p>4. 添加区域配置文件，类型为 slave，然后指向 master 地址</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-slave ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/named.conf </span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="3"></td><td><pre>//自行配置权威域名解析hmallleaing.com</pre></td></tr><tr><td data-num="4"></td><td><pre>zone <span class="token string">"hmallleasing.com"</span> IN <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>         <span class="token builtin class-name">type</span> slave<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>         <span class="token function">file</span> <span class="token string">"slaves/hmallleasing.com.zone"</span><span class="token punctuation">;</span>    //具体解析记录配置存储至哪个文件</pre></td></tr><tr><td data-num="7"></td><td><pre>         masters <span class="token punctuation">&#123;</span> <span class="token number">172.16</span>.1.91<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>zone <span class="token string">"job.com"</span> IN <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>         <span class="token builtin class-name">type</span> slave<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>         <span class="token function">file</span> <span class="token string">"slaves/job.com.zone"</span><span class="token punctuation">;</span>    //具体解析记录配置存储至哪个文件</pre></td></tr><tr><td data-num="13"></td><td><pre>         masters <span class="token punctuation">&#123;</span> <span class="token number">172.16</span>.1.91<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>//配置反向解析</pre></td></tr><tr><td data-num="17"></td><td><pre>zone <span class="token string">"1.16.172.in-addr.arpa"</span> IN <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre> 	<span class="token builtin class-name">type</span> slave<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre> 	<span class="token function">file</span> <span class="token string">"slaves/1.16.172.zone"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>  	masters <span class="token punctuation">&#123;</span> <span class="token number">172.16</span>.1.91<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre>include <span class="token string">"/etc/named.rfc1912.zones"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>include <span class="token string">"/etc/named.root.key"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr></table></figure><p>4. 检查语法并重载 DNS 服务器</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># named-checkconf</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># rndc reload</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@dns-slave ~<span class="token punctuation">]</span><span class="token comment"># ll /var/named/slaves/</span></pre></td></tr><tr><td data-num="4"></td><td><pre>-rw-r--r-- <span class="token number">1</span> named named <span class="token number">549</span> Sep <span class="token number">20</span> <span class="token number">22</span>:30 <span class="token number">1.16</span>.172.zone</pre></td></tr><tr><td data-num="5"></td><td><pre>-rw-r--r-- <span class="token number">1</span> named named <span class="token number">420</span> Sep <span class="token number">20</span> <span class="token number">22</span>:30 hmallleasing.com.zone</pre></td></tr><tr><td data-num="6"></td><td><pre>-rw-r--r-- <span class="token number">1</span> named named <span class="token number">356</span> Sep <span class="token number">20</span> <span class="token number">22</span>:30 job.com.zone</pre></td></tr></table></figure><h6 id="435-测试主辅解析"><a class="anchor" href="#435-测试主辅解析">#</a> 4.3.5 测试主辅解析</h6><p>使用 dig 进行域名解析，先通过 master 解析，然后在使用 slave 测试解析</p><p>1. 通过 master 解析</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment"># dig www.hmallleasing.com @172.16.1.91 </span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">;</span> <span class="token operator">&lt;&lt;</span><span class="token operator">>></span> DiG <span class="token number">9.11</span>.4-P2-RedHat-9.11.4-26.P2.el7_9.16 <span class="token operator">&lt;&lt;</span><span class="token operator">>></span> www.hmallleasing.com @172.16.1.91</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> global options: +cmd</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> Got answer:</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> -<span class="token operator">>></span>HEADER<span class="token operator">&lt;&lt;-</span> opcode: QUERY, status: NOERROR, id: <span class="token number">34451</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> flags: qr aa rd ra<span class="token punctuation">;</span> QUERY: <span class="token number">1</span>, ANSWER: <span class="token number">1</span>, AUTHORITY: <span class="token number">2</span>, ADDITIONAL: <span class="token number">3</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> OPT PSEUDOSECTION:</pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">;</span> EDNS: version: <span class="token number">0</span>, flags:<span class="token punctuation">;</span> udp: <span class="token number">4096</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> QUESTION SECTION:</pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">;</span>www.hmallleasing.com.		IN	A</pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> ANSWER SECTION:</pre></td></tr><tr><td data-num="15"></td><td><pre>www.hmallleasing.com.	<span class="token number">600</span>	IN	A	<span class="token number">1.1</span>.1.1</pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> AUTHORITY SECTION:</pre></td></tr><tr><td data-num="18"></td><td><pre>hmallleasing.com.	<span class="token number">600</span>	IN	NS	ns2.hmallleasing.com.</pre></td></tr><tr><td data-num="19"></td><td><pre>hmallleasing.com.	<span class="token number">600</span>	IN	NS	ns1.hmallleasing.com.</pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> ADDITIONAL SECTION:</pre></td></tr><tr><td data-num="22"></td><td><pre>ns1.hmallleasing.com.	<span class="token number">600</span>	IN	A	<span class="token number">172.16</span>.1.91</pre></td></tr><tr><td data-num="23"></td><td><pre>ns2.hmallleasing.com.	<span class="token number">600</span>	IN	A	<span class="token number">172.16</span>.1.92</pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> Query time: <span class="token number">0</span> msec</pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> SERVER: <span class="token number">172.16</span>.1.91<span class="token comment">#53(172.16.1.91)</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> WHEN: Sat Sep <span class="token number">20</span> <span class="token number">23</span>:03:40 CST <span class="token number">2025</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> MSG SIZE  rcvd: <span class="token number">133</span></pre></td></tr></table></figure><p>2. 通过 slave 解析</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment"># dig www.hmallleasing.com @172.16.1.92 </span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">;</span> <span class="token operator">&lt;&lt;</span><span class="token operator">>></span> DiG <span class="token number">9.11</span>.4-P2-RedHat-9.11.4-26.P2.el7_9.16 <span class="token operator">&lt;&lt;</span><span class="token operator">>></span> www.hmallleasing.com @172.16.1.92</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> global options: +cmd</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> Got answer:</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> -<span class="token operator">>></span>HEADER<span class="token operator">&lt;&lt;-</span> opcode: QUERY, status: NOERROR, id: <span class="token number">4506</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> flags: qr aa rd ra<span class="token punctuation">;</span> QUERY: <span class="token number">1</span>, ANSWER: <span class="token number">1</span>, AUTHORITY: <span class="token number">2</span>, ADDITIONAL: <span class="token number">3</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> OPT PSEUDOSECTION:</pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">;</span> EDNS: version: <span class="token number">0</span>, flags:<span class="token punctuation">;</span> udp: <span class="token number">4096</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> QUESTION SECTION:</pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">;</span>www.hmallleasing.com.		IN	A</pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> ANSWER SECTION:</pre></td></tr><tr><td data-num="15"></td><td><pre>www.hmallleasing.com.	<span class="token number">600</span>	IN	A	<span class="token number">1.1</span>.1.1</pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> AUTHORITY SECTION:</pre></td></tr><tr><td data-num="18"></td><td><pre>hmallleasing.com.	<span class="token number">600</span>	IN	NS	ns2.hmallleasing.com.</pre></td></tr><tr><td data-num="19"></td><td><pre>hmallleasing.com.	<span class="token number">600</span>	IN	NS	ns1.hmallleasing.com.</pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> ADDITIONAL SECTION:</pre></td></tr><tr><td data-num="22"></td><td><pre>ns1.hmallleasing.com.	<span class="token number">600</span>	IN	A	<span class="token number">172.16</span>.1.91</pre></td></tr><tr><td data-num="23"></td><td><pre>ns2.hmallleasing.com.	<span class="token number">600</span>	IN	A	<span class="token number">172.16</span>.1.92</pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> Query time: <span class="token number">0</span> msec</pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> SERVER: <span class="token number">172.16</span>.1.92<span class="token comment">#53(172.16.1.92)</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> WHEN: Sat Sep <span class="token number">20</span> <span class="token number">23</span>:03:23 CST <span class="token number">2025</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> MSG SIZE  rcvd: <span class="token number">133</span></pre></td></tr></table></figure><p>3. 测试主辅同步</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#1.dns master 新增一条记录，然后滚动 seria2025092019 自增 1</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@dns-master named<span class="token punctuation">]</span><span class="token comment"># cat hmallleasing.com.zone </span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token variable">$TTL</span> <span class="token number">600</span> <span class="token punctuation">;</span> DNS失效时间，单位秒<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>hmallleasing.com. IN SOA ns.hmallleasing.com. xuy.nf-leasing.com. <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">;</span> 区域名称 IN SOA dns.hmallleasing.com. 管理员邮箱</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">;</span> 区域名称可以使用过@表示，@表示当前域</pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token number">2025092019</span> <span class="token punctuation">;</span> 序列号<span class="token punctuation">(</span>serial number<span class="token punctuation">)</span> 十进制，不能超过10位，通常使用日期时间戳，例如2018121601</pre></td></tr><tr><td data-num="8"></td><td><pre>	<span class="token number">10800</span>      <span class="token punctuation">;</span> 刷新时间<span class="token punctuation">(</span>refresh <span class="token function">time</span><span class="token punctuation">)</span> 即每隔多久到主服务器检查一次</pre></td></tr><tr><td data-num="9"></td><td><pre>	<span class="token number">900</span>        <span class="token punctuation">;</span> 重试时间<span class="token punctuation">(</span>retry <span class="token function">time</span><span class="token punctuation">)</span> 即刷新不成功多久后重试，应该小于refresh <span class="token function">time</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token number">604800</span>     <span class="token punctuation">;</span> 过期时间<span class="token punctuation">(</span>expire <span class="token function">time</span><span class="token punctuation">)</span> 当辅助DNS无法联系主DNS时，辅助DNS在多长时间内认为其缓存是有效的。</pre></td></tr><tr><td data-num="11"></td><td><pre>	<span class="token number">86400</span>      <span class="token punctuation">;</span> 权威应答的ttl<span class="token punctuation">(</span>netgative answer ttl<span class="token punctuation">)</span> <span class="token punctuation">;</span>缓存DNS服务器可以缓存记录多长时间</pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">;</span> 给客户端返回NS记录，hmallleasing.com. 域名由哪几台权威服务器提供解析</pre></td></tr><tr><td data-num="15"></td><td><pre>hmallleasing.com. IN NS ns1.hmallleasing.com.</pre></td></tr><tr><td data-num="16"></td><td><pre>hmallleasing.com. IN NS ns2.hmallleasing.com.</pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">;</span> A记录，配置权威域名的真实IP地址；</pre></td></tr><tr><td data-num="19"></td><td><pre>ns1.hmallleasing.com. IN A <span class="token number">172.16</span>.1.91</pre></td></tr><tr><td data-num="20"></td><td><pre>ns2.hmallleasing.com. IN A <span class="token number">172.16</span>.1.92</pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">;</span> 真正的域名解析</pre></td></tr><tr><td data-num="23"></td><td><pre>www.hmallleasing.com. IN A <span class="token number">1.1</span>.1.1</pre></td></tr><tr><td data-num="24"></td><td><pre>web.hmallleasing.com. IN A <span class="token number">2.2</span>.2.2</pre></td></tr><tr><td data-num="25"></td><td><pre>blog.hmallleasing.com. IN A <span class="token number">3.3</span>.3.3</pre></td></tr><tr><td data-num="26"></td><td><pre></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token comment">#2. 重载 DNS 服务器</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token punctuation">[</span>root@dns-master named<span class="token punctuation">]</span><span class="token comment"># rndc reload</span></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token comment">#3. 使用 master 以及 slave 地址测试新添加的记录是否能解析</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment"># dig blog.hmallleasing.com @172.16.1.91 </span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment"># dig blog.hmallleasing.com @172.16.1.92 </span></pre></td></tr><tr><td data-num="33"></td><td><pre></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token punctuation">;</span> <span class="token operator">&lt;&lt;</span><span class="token operator">>></span> DiG <span class="token number">9.11</span>.4-P2-RedHat-9.11.4-26.P2.el7_9.16 <span class="token operator">&lt;&lt;</span><span class="token operator">>></span> blog.hmallleasing.com @172.16.1.91</pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> global options: +cmd</pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> Got answer:</pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> -<span class="token operator">>></span>HEADER<span class="token operator">&lt;&lt;-</span> opcode: QUERY, status: NOERROR, id: <span class="token number">60136</span></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> flags: qr aa rd ra<span class="token punctuation">;</span> QUERY: <span class="token number">1</span>, ANSWER: <span class="token number">1</span>, AUTHORITY: <span class="token number">2</span>, ADDITIONAL: <span class="token number">3</span></pre></td></tr><tr><td data-num="39"></td><td><pre></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> OPT PSEUDOSECTION:</pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token punctuation">;</span> EDNS: version: <span class="token number">0</span>, flags:<span class="token punctuation">;</span> udp: <span class="token number">4096</span></pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> QUESTION SECTION:</pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token punctuation">;</span>blog.hmallleasing.com.		IN	A</pre></td></tr><tr><td data-num="44"></td><td><pre></pre></td></tr><tr><td data-num="45"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> ANSWER SECTION:</pre></td></tr><tr><td data-num="46"></td><td><pre>blog.hmallleasing.com.	<span class="token number">600</span>	IN	A	<span class="token number">3.3</span>.3.3</pre></td></tr><tr><td data-num="47"></td><td><pre></pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> AUTHORITY SECTION:</pre></td></tr><tr><td data-num="49"></td><td><pre>hmallleasing.com.	<span class="token number">600</span>	IN	NS	ns1.hmallleasing.com.</pre></td></tr><tr><td data-num="50"></td><td><pre>hmallleasing.com.	<span class="token number">600</span>	IN	NS	ns2.hmallleasing.com.</pre></td></tr><tr><td data-num="51"></td><td><pre></pre></td></tr><tr><td data-num="52"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> ADDITIONAL SECTION:</pre></td></tr><tr><td data-num="53"></td><td><pre>ns1.hmallleasing.com.	<span class="token number">600</span>	IN	A	<span class="token number">172.16</span>.1.91</pre></td></tr><tr><td data-num="54"></td><td><pre>ns2.hmallleasing.com.	<span class="token number">600</span>	IN	A	<span class="token number">172.16</span>.1.92</pre></td></tr><tr><td data-num="55"></td><td><pre></pre></td></tr><tr><td data-num="56"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> Query time: <span class="token number">0</span> msec</pre></td></tr><tr><td data-num="57"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> SERVER: <span class="token number">172.16</span>.1.91<span class="token comment">#53(172.16.1.91)</span></pre></td></tr><tr><td data-num="58"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> WHEN: Sat Sep <span class="token number">20</span> <span class="token number">23</span>:10:17 CST <span class="token number">2025</span></pre></td></tr><tr><td data-num="59"></td><td><pre><span class="token punctuation">;</span><span class="token punctuation">;</span> MSG SIZE  rcvd: <span class="token number">134</span></pre></td></tr></table></figure><h4 id="5-dns子域授权配置"><a class="anchor" href="#5-dns子域授权配置">#</a> 5. DNS 子域授权配置</h4><h5 id="51-什么是dns子域授权"><a class="anchor" href="#51-什么是dns子域授权">#</a> 5.1 什么是 DNS 子域授权</h5><p>A 服务负责 （<a target="_blank" rel="noopener" href="http://hmallleasing.com">hmallleasing.com</a>）域名解析，授权 B 服务器管理 （<a target="_blank" rel="noopener" href="http://ops.hmallleasing.com">ops.hmallleasing.com</a>） 的域名解析；</p><ul><li>父域： <a target="_blank" rel="noopener" href="http://hmallleasing.com">hmallleasing.com</a></li><li>子域： <a target="_blank" rel="noopener" href="http://ops.hmallleasing.com">ops.hmallleasing.com</a><ul><li>​ <a target="_blank" rel="noopener" href="http://www.ops.hmallleasing.com">www.ops.hmallleasing.com</a></li><li>​ <a target="_blank" rel="noopener" href="http://blog.ops.hmallleasing.com">blog.ops.hmallleasing.com</a></li></ul></li></ul><p><img loading="lazy" data-src="https://wp-cdn.4ce.cn/v2/at9yUkE.jpeg" alt="1.jpg"></p><h5 id="52-dns子域授权环境"><a class="anchor" href="#52-dns子域授权环境">#</a> 5.2 DNS 子域授权环境</h5><table><thead><tr><th>环境</th><th>域名</th><th>节点外网地址</th><th>节点内网地址</th></tr></thead><tbody><tr><td>父域 Master</td><td><a target="_blank" rel="noopener" href="http://hmallleasing.com">hmallleasing.com</a></td><td>192.168.40.91</td><td>172.16.1.91</td></tr><tr><td>父域 Slace</td><td><a target="_blank" rel="noopener" href="http://hmamllleasing.com">hmamllleasing.com</a></td><td>192.168.40.92</td><td>172.16.1.93</td></tr><tr><td>子域</td><td><a target="_blank" rel="noopener" href="http://ops.hmallleasing.com">ops.hmallleasing.com</a></td><td>192.168.40.92</td><td>172.16.1.93</td></tr></tbody></table><h5 id="53-dns子域授权的配置"><a class="anchor" href="#53-dns子域授权的配置">#</a> 5.3 DNS 子域授权的配置</h5><h6 id="531-dns-master父域配置"><a class="anchor" href="#531-dns-master父域配置">#</a> 5.3.1 DNS Master 父域配置</h6><p>1. 区域配置文件此前可以复用之前主辅配置，所以无需修改；</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/named.conf </span></pre></td></tr><tr><td data-num="2"></td><td><pre>options <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="4"></td><td><pre>	//允许哪个地址同步master配置信息</pre></td></tr><tr><td data-num="5"></td><td><pre>    allow-transfer <span class="token punctuation">&#123;</span> <span class="token number">172.16</span>.1.92<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="6"></td><td><pre>	//主动通知辅助DNS域名变更	</pre></td></tr><tr><td data-num="7"></td><td><pre>     also-notify <span class="token punctuation">&#123;</span> <span class="token number">172.16</span>.1.92<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="10"></td><td><pre>//自行配置权威域名解析hmallleaing.com</pre></td></tr><tr><td data-num="11"></td><td><pre>zone <span class="token string">"hmallleasing.com"</span> IN <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre> 	 <span class="token builtin class-name">type</span> master<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre> 	 <span class="token function">file</span> <span class="token string">"hmallleasing.com.zone"</span><span class="token punctuation">;</span>    //具体解析记录配置存储至哪个文件</pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>zone <span class="token string">"job.com"</span> IN <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre> 	 <span class="token builtin class-name">type</span> master<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre> 	 <span class="token function">file</span> <span class="token string">"job.com.zone"</span><span class="token punctuation">;</span>    //具体解析记录配置存储至哪个文件</pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>//配置反向解析</pre></td></tr><tr><td data-num="22"></td><td><pre>zone <span class="token string">"1.16.172.in-addr.arpa"</span> IN <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token builtin class-name">type</span> master<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>  <span class="token function">file</span> <span class="token string">"1.16.172.zone"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>2. 区域数据库文件，将 ops 三级子域授权给子域服务器</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># cat /var/named/hmallleasing.com.zone </span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token variable">$TTL</span> <span class="token number">600</span> <span class="token punctuation">;</span> DNS失效时间，单位秒<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>hmallleasing.com. IN SOA ns.hmallleasing.com. xuy.nf-leasing.com. <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">;</span> 区域名称 IN SOA dns.hmallleasing.com. 管理员邮箱</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">;</span> 区域名称可以使用过@表示，@表示当前域</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token number">2025092019</span> <span class="token punctuation">;</span> 序列号<span class="token punctuation">(</span>serial number<span class="token punctuation">)</span> 十进制，不能超过10位，通常使用日期时间戳，例如2018121601</pre></td></tr><tr><td data-num="8"></td><td><pre>	<span class="token number">10800</span>      <span class="token punctuation">;</span> 刷新时间<span class="token punctuation">(</span>refresh <span class="token function">time</span><span class="token punctuation">)</span> 即每隔多久到主服务器检查一次</pre></td></tr><tr><td data-num="9"></td><td><pre>	<span class="token number">900</span>        <span class="token punctuation">;</span> 重试时间<span class="token punctuation">(</span>retry <span class="token function">time</span><span class="token punctuation">)</span> 即刷新不成功多久后重试，应该小于refresh <span class="token function">time</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token number">604800</span>     <span class="token punctuation">;</span> 过期时间<span class="token punctuation">(</span>expire <span class="token function">time</span><span class="token punctuation">)</span> 当辅助DNS无法联系主DNS时，辅助DNS在多长时间内认为其缓存是有效的。</pre></td></tr><tr><td data-num="11"></td><td><pre>	<span class="token number">86400</span>      <span class="token punctuation">;</span> 权威应答的ttl<span class="token punctuation">(</span>netgative answer ttl<span class="token punctuation">)</span> <span class="token punctuation">;</span>缓存DNS服务器可以缓存记录多长时间</pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">;</span> 给客户端返回NS记录，hmallleasing.com. 域名由哪几台权威服务器提供解析</pre></td></tr><tr><td data-num="15"></td><td><pre>hmallleasing.com. IN NS ns1.hmallleasing.com.</pre></td></tr><tr><td data-num="16"></td><td><pre>hmallleasing.com. IN NS ns2.hmallleasing.com.</pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">;</span> A记录，配置权威域名的真实IP地址；</pre></td></tr><tr><td data-num="19"></td><td><pre>ns1.hmallleasing.com. IN A <span class="token number">172.16</span>.1.91</pre></td></tr><tr><td data-num="20"></td><td><pre>ns2.hmallleasing.com. IN A <span class="token number">172.16</span>.1.92</pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">;</span> 真正的域名解析</pre></td></tr><tr><td data-num="23"></td><td><pre>www.hmallleasing.com. IN A <span class="token number">1.1</span>.1.1</pre></td></tr><tr><td data-num="24"></td><td><pre>web.hmallleasing.com. IN A <span class="token number">2.2</span>.2.2</pre></td></tr><tr><td data-num="25"></td><td><pre>blog.hmallleasing.com. IN A <span class="token number">3.3</span>.3.3</pre></td></tr><tr><td data-num="26"></td><td><pre></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token punctuation">;</span>增加子域的配置</pre></td></tr><tr><td data-num="28"></td><td><pre>ops.hmallleasing.com.		 IN	 NS	 ns1.ops.hmallleasing.com.</pre></td></tr><tr><td data-num="29"></td><td><pre>ns1.ops.hmallleasing.com.	 IN	 A	 <span class="token number">172.16</span>.1.93</pre></td></tr></table></figure><ol start="3"><li>检查配置文件，区域数据库文件，重载服务</li></ol><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># named-checkconf</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># named-checkzone hmallleasing.com /var/named/hmallleasing.com.zone </span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart named</span></pre></td></tr></table></figure><h6 id="532-dns子域配置other"><a class="anchor" href="#532-dns子域配置other">#</a> 5.3.2 DNS 子域配置 (Other)</h6><p>1.bind 软件安装</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-son ~<span class="token punctuation">]</span><span class="token comment"># yum install bind bind-utils -y</span></pre></td></tr></table></figure><p>2. 修改配置文件，然后增加紫玉的 zone 配置文件</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-son ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/named.conf </span></pre></td></tr><tr><td data-num="2"></td><td><pre>options <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	<span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="4"></td><td><pre>	listen-on port <span class="token number">53</span> <span class="token punctuation">&#123;</span> any<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	allow-query     <span class="token punctuation">&#123;</span> any<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>//增加如下配置</pre></td></tr><tr><td data-num="9"></td><td><pre>zone <span class="token string">"ops.hmallleasing.com"</span> IN <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token builtin class-name">type</span> master<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	<span class="token function">file</span> <span class="token string">"ops.hmallleasing.com.zone"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>3. 添加区域数据数据库文件</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-son ~<span class="token punctuation">]</span><span class="token comment"># cat /var/named/ops.hmallleasing.com.zone</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token variable">$TTL</span> <span class="token number">600</span> <span class="token punctuation">;</span> DNS失效时间，单位秒<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>ops.hmallleasing.com. IN SOA ns.ops.hmallleasing.com. xuy.nf-leasing.com. <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">;</span> 区域名称 IN SOA dns.hmallleasing.com. 管理员邮箱</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">;</span> 区域名称可以使用过@表示，@表示当前域</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token number">2025092018</span> <span class="token punctuation">;</span> 序列号<span class="token punctuation">(</span>serial number<span class="token punctuation">)</span> 十进制，不能超过10位，通常使用日期时间戳，例如2018121601</pre></td></tr><tr><td data-num="8"></td><td><pre>	<span class="token number">10800</span>      <span class="token punctuation">;</span> 刷新时间<span class="token punctuation">(</span>refresh <span class="token function">time</span><span class="token punctuation">)</span> 即每隔多久到主服务器检查一次</pre></td></tr><tr><td data-num="9"></td><td><pre>	<span class="token number">900</span>        <span class="token punctuation">;</span> 重试时间<span class="token punctuation">(</span>retry <span class="token function">time</span><span class="token punctuation">)</span> 即刷新不成功多久后重试，应该小于refresh <span class="token function">time</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token number">604800</span>     <span class="token punctuation">;</span> 过期时间<span class="token punctuation">(</span>expire <span class="token function">time</span><span class="token punctuation">)</span> 当辅助DNS无法联系主DNS时，辅助DNS在多长时间内认为其缓存是有效的。</pre></td></tr><tr><td data-num="11"></td><td><pre>	<span class="token number">86400</span>      <span class="token punctuation">;</span> 权威应答的ttl<span class="token punctuation">(</span>netgative answer ttl<span class="token punctuation">)</span> <span class="token punctuation">;</span>缓存DNS服务器可以缓存记录多长时间</pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">;</span> 给客户端返回NS记录，hmallleasing.com. 域名由哪几台权威服务器提供解析</pre></td></tr><tr><td data-num="15"></td><td><pre>ops.hmallleasing.com. IN NS ns1.ops.hmallleasing.com.</pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">;</span> A记录，配置权威域名的真实IP地址；</pre></td></tr><tr><td data-num="18"></td><td><pre>ns1.ops.hmallleasing.com. IN A <span class="token number">172.16</span>.1.93</pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">;</span> 真正的域名解析</pre></td></tr><tr><td data-num="21"></td><td><pre>www.ops.hmallleasing.com.      	IN     	A  <span class="token number">6.6</span>.6.6</pre></td></tr><tr><td data-num="22"></td><td><pre>blog.ops.hmallleasing.com.      IN      A  <span class="token number">7.7</span>.7.7</pre></td></tr></table></figure><p>4. 检查配置文件，区域数据库文件，重载服务</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-son ~<span class="token punctuation">]</span><span class="token comment"># named-checkconf</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@dns-son ~<span class="token punctuation">]</span><span class="token comment"># named-checkzone ops.hmallleasing.com /var/named/ops.hmallleasing.com.zone </span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@dns-son ~<span class="token punctuation">]</span><span class="token comment"># systemctl start named  &amp;&amp; systemctl enable named</span></pre></td></tr></table></figure><h6 id="533-验证结果"><a class="anchor" href="#533-验证结果">#</a> 5.3.3 验证结果</h6><p>1. 客户端获取子域对应的解析</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment"># dig www.ops.hmallleasing.com @172.16.1.93 +short</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">6.6</span>.6.6</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment"># dig blog.ops.hmallleasing.com @172.16.1.93 +short</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token number">7.7</span>.7.7</pre></td></tr></table></figure><p>2. 客户端获取子域对应的解析（使用父域的 IP）</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment"># dig blog.ops.hmallleasing.com @172.16.1.91 +short</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">7.7</span>.7.7</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment"># dig www.ops.hmallleasing.com @172.16.1.92 +short</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token number">6.6</span>.6.6</pre></td></tr></table></figure><p>3. 客户端获取父域对应的解析（使用子域的 IP）</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 无法正常解析</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment"># dig www.hmallleasing.com @172.16.1.93 +short</span></pre></td></tr></table></figure><p>问题：由于父域与子域互相维护不同的区域配置，它们之间并不存在任何的联系，所以子域在解析父域的域名时，它并不会直接通过父域来获取权威的解析记录，那它会怎么做呢？</p><ul><li>第一步：它会先找顶点根域；</li><li>第二步：寻找找 com 域对应的 DNS 服务器；</li><li>第三步：寻找 example 域对应的 DNS 服务器，而后获取 www 对应的解析记录；</li><li>这种查找模式是由 DNS 的机制所决定的；</li></ul><p>解决方法：明确告诉子域，让其能找到父域进项查询解析，而无需查找根域；（需要配置 DNS 的转发），参考小节：6.2、子域名转发的配置。</p><h4 id="6-dns转发模式"><a class="anchor" href="#6-dns转发模式">#</a> 6. DNS 转发模式</h4><h5 id="61-什么是dns转发"><a class="anchor" href="#61-什么是dns转发">#</a> 6.1 什么是 DNS 转发</h5><p>转发指的是将域名查询请求，转至某一台服务器解析（被转发的服务器必须允许为当前服务器做递归）<br>转发分为两类；</p><ul><li>区域转发：仅转发对某特定区域的解析请求；</li><li>全局转发：针对本地没有通过 zone 定义的区域查询请求，统统转发；</li></ul><p>转发参数：</p><ul><li>forwarders：转发给哪台服务器，可以多台；</li><li>forwarder only：仅转发；</li><li>forwarder first：优先转发给对应的服务器查询，如转发未响应，则自行迭代查询；</li></ul><h5 id="62-dns转发示例"><a class="anchor" href="#62-dns转发示例">#</a> 6.2 DNS 转发示例</h5><p>全局转发示例配置（所有本地不存在的域名都进行转发）</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>options <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	<span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="3"></td><td><pre>	forward <span class="token punctuation">&#123;</span> first <span class="token operator">|</span> only <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	forwarders <span class="token punctuation">&#123;</span> SERVER_IP<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>区域转发示例配置（符合该区域则进行条件转发）</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>zone <span class="token string">"ZONE_NAME"</span> IN <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	<span class="token builtin class-name">type</span> forward<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	forward first<span class="token operator">|</span>only <span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	forwarders <span class="token punctuation">&#123;</span> SERVER_IP<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h5 id="63-dns区域转发实践"><a class="anchor" href="#63-dns区域转发实践">#</a> 6.3 DNS 区域转发实践</h5><p>1. 在子域服务器上，添加父域的域名，然后配置转发；</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-son ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/named.conf </span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="3"></td><td><pre>zone <span class="token string">"ops.hmallleasing.com"</span> IN <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token builtin class-name">type</span> master<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token function">file</span> <span class="token string">"ops.hmallleasing.com.zone"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>//增加如下配置</pre></td></tr><tr><td data-num="9"></td><td><pre>zone <span class="token string">"hmallleasing.com"</span> IN <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token builtin class-name">type</span> forward<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	forward first<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>	forwarders <span class="token punctuation">&#123;</span> <span class="token number">172.16</span>.1.91<span class="token punctuation">;</span> <span class="token number">172.16</span>.1.92<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>2. 检查配置文件，区域数据库文件，重载服务</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-son ~<span class="token punctuation">]</span><span class="token comment"># named-checkconf</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@dns-son ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart named</span></pre></td></tr></table></figure><p>3. 测试转发效果</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment"># dig www.hmallleasing.com @172.16.1.93 +short</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">1.1</span>.1.1</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment"># dig web.hmallleasing.com @172.16.1.93 +short</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token number">2.2</span>.2.2</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment"># dig blog.hmallleasing.com @172.16.1.93 +short</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token number">3.3</span>.3.3</pre></td></tr></table></figure><h4 id="7-智能dns概述"><a class="anchor" href="#7-智能dns概述">#</a> 7. 智能 DNS 概述</h4><p>智能 DNS 就是根据用户的来源地域，自动智能化判断来路 IP 返回给用户，而不需要用户进行选择；</p><h5 id="71-什么是智能dns"><a class="anchor" href="#71-什么是智能dns">#</a> 7.1 什么是智能 DNS</h5><p>DNS 解析，不判断访问者来源，会随机选择其中一个 IP 地址返回给访问者。</p><p>智能 DNS 解析，会判断访问者的来源，为不同的访问者智能返回不同的 IP 地址，可使访问者在访问网站时可获取用户指定的 IP 地址，能够减少解析时延，并提升网站访问速度的功效。</p><p>比方一个企业的站点三个运营商的带宽都有：电信、联通、移动；同样来自三个不同 运营商网络的访问用户，假设电信用户访问企业网址的时候，智能 DNS 会自动根据 IP 判断，再从电信返回给电信用户，其它的也同理；</p><ul><li>电信用户：访问 <a target="_blank" rel="noopener" href="http://www.hmallleasing.com">www.hmallleasing.com</a> 返回 1.1.1.1</li><li>联通用户：访问 <a target="_blank" rel="noopener" href="http://www.hmallleasing.com">www.hmallleasing.com</a> 返回 2.2.2.2</li><li>移动用户：访问 <a target="_blank" rel="noopener" href="http://www.hmallleasing.com">www.hmallleasing.com</a> 返回 3.3.3.3</li></ul><p><img loading="lazy" data-src="https://wp-cdn.4ce.cn/v2/rq4jDva.jpeg" alt="2.jpg"></p><h5 id="72-如何实现智能dns"><a class="anchor" href="#72-如何实现智能dns">#</a> 7.2 如何实现智能 DNS</h5><p>实现智能 DNS 需要 VIEW 试图以及 ACL 访问控制列表协同完成；</p><p><img loading="lazy" data-src="https://wp-cdn.4ce.cn/v2/B5zXQz2.jpeg" alt="3.jpg"></p><h6 id="721-acl访问控制列表"><a class="anchor" href="#721-acl访问控制列表">#</a> 7.2.1 ACL 访问控制列表</h6><p>ACL 访问控制列表，是用来限制哪些主机可以通过 DNS 查询，哪些不可以；</p><p>系统默认内置四种 ACL：</p><ul><li>any ：允许所有主机节点查询；</li><li>none ：拒绝所有主机节点查询；</li><li>localhost ：仅允许本地接口网络主机查询；</li><li>localnet ：本地子网所有 IP；</li></ul><p>1. 简单 ACL 规则定义</p><pre><code class="language-ba">acl &quot;ips&quot; &#123;                           //定义一个名为ips的ACL
  	 10.0.0.1; 10.0.0.2; 192.168.1.1; //包含3个单个IP
 	 172.16.1.0/24;
...
&#125;;
</code></pre><p>2. 复杂 ACL 规则定义</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>acl <span class="token string">"all_rule"</span> <span class="token punctuation">&#123;</span>  			//定义一个名为all_rule的ACL</pre></td></tr><tr><td data-num="2"></td><td><pre>  <span class="token string">"ips"</span><span class="token punctuation">;</span>         	 		//可以嵌套包含其他ACL</pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token number">10.0</span>.15.0/24<span class="token punctuation">;</span> 		  	//包含10.0.15.0子网中的所有IP</pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token operator">!</span><span class="token number">10.0</span>.16.1/24<span class="token punctuation">;</span>   			//非10.0.16.1子网的IP</pre></td></tr><tr><td data-num="5"></td><td><pre>  <span class="token punctuation">&#123;</span><span class="token number">10.0</span>.17.1<span class="token punctuation">;</span><span class="token number">10.0</span>.18.2<span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>   //包含了一个IP组</pre></td></tr><tr><td data-num="6"></td><td><pre>  localhost；               //本地网络接口IP（含实际接口IP和127.0.0.1）</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>3. 定义的 ACL 规则如何使用</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>allow-update <span class="token punctuation">&#123;</span> <span class="token string">"ips"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span>        //允许谁能更新</pre></td></tr><tr><td data-num="2"></td><td><pre>allow-transfer <span class="token punctuation">&#123;</span> <span class="token string">"all_rule"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span> //允许谁能同步</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr></table></figure><h6 id="722-view视图功能"><a class="anchor" href="#722-view视图功能">#</a> 7.2.2 VIEW 视图功能</h6><p>view 语句定义了视图功能，视图是 BIND9 提供的强大的新功能，允许 DNS 服务器根据不同的客户端，请求相同的域名，但返回不同的解析结果；</p><p>view 语法示例：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>view view_name <span class="token punctuation">[</span>class<span class="token punctuation">]</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	match-clients <span class="token punctuation">&#123;</span> address_match_list <span class="token punctuation">&#125;</span> <span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	match-destinations <span class="token punctuation">&#123;</span> address_match_list <span class="token punctuation">&#125;</span> <span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	match-recursive-only <span class="token punctuation">&#123;</span> yes_or_no <span class="token punctuation">&#125;</span> <span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token punctuation">[</span> view_option<span class="token punctuation">;</span> <span class="token punctuation">..</span>.<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token punctuation">[</span>zone<span class="token punctuation">;</span> <span class="token punctuation">..</span>.<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h5 id="73-智能dns场景实战"><a class="anchor" href="#73-智能dns场景实战">#</a> 7.3 智能 DNS 场景实战</h5><ul><li>维护一个主机域；根据不同环境的 IP 请求，查询相同域名，返回不同的解析结果；（企业常用）</li><li>维护一个业务域；根据不同的运营商 IP 地址，解析到不同的地址；（需要大量 IP 地址库）</li></ul><h6 id="731-定义acl规则"><a class="anchor" href="#731-定义acl规则">#</a> 7.3.1 定义 ACL 规则</h6><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>//模拟测试业务地址段</pre></td></tr><tr><td data-num="2"></td><td><pre>acl <span class="token string">"env-test"</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	<span class="token number">172.16</span>.1.10<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>//模拟生产业务地址段</pre></td></tr><tr><td data-num="7"></td><td><pre>acl <span class="token string">"env-prod"</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>	<span class="token number">172.16</span>.1.200<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h6 id="732-定义view视图"><a class="anchor" href="#732-定义view视图">#</a> 7.3.2 定义 VIEW 视图</h6><p>1. 修改 /etc/named.conf 配置文件</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># cp /etc/named.conf /etc/named.conf.bak</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/named.conf</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="4"></td><td><pre>//模拟测试业务地址段</pre></td></tr><tr><td data-num="5"></td><td><pre>acl <span class="token string">"test"</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token number">172.16</span>.1.10<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>//模拟生产业务地址段</pre></td></tr><tr><td data-num="10"></td><td><pre>acl <span class="token string">"prod"</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	<span class="token number">172.16</span>.1.200<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>//测试业务view</pre></td></tr><tr><td data-num="15"></td><td><pre>view <span class="token string">"test-project"</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  match-clients <span class="token punctuation">&#123;</span> <span class="token string">"test"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>  recursion <span class="token function">yes</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>  zone <span class="token string">"."</span> IN <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token builtin class-name">type</span> hint<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token function">file</span> <span class="token string">"named.ca"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre>  zone <span class="token string">"example.com"</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token builtin class-name">type</span> master<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token function">file</span> <span class="token string">"test/example.com.zone"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre>//生产业务view</pre></td></tr><tr><td data-num="31"></td><td><pre>view <span class="token string">"prod-project"</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>  match-clients <span class="token punctuation">&#123;</span> <span class="token string">"prod"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>  recursion <span class="token function">yes</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="34"></td><td><pre></pre></td></tr><tr><td data-num="35"></td><td><pre>  zone <span class="token string">"."</span> IN <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token builtin class-name">type</span> hint<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token function">file</span> <span class="token string">"named.ca"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre></pre></td></tr><tr><td data-num="40"></td><td><pre>  zone <span class="token string">"example.com"</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token builtin class-name">type</span> master<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>    <span class="token function">file</span> <span class="token string">"prod/example.com.zone"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre></pre></td></tr><tr><td data-num="45"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="46"></td><td><pre></pre></td></tr><tr><td data-num="47"></td><td><pre>//默认的view</pre></td></tr><tr><td data-num="48"></td><td><pre>view <span class="token string">"default"</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>  match-clients <span class="token punctuation">&#123;</span> any<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>  recursion <span class="token function">yes</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>  </pre></td></tr><tr><td data-num="52"></td><td><pre>  zone <span class="token string">"."</span> IN <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>    <span class="token builtin class-name">type</span> hint<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="54"></td><td><pre>    <span class="token function">file</span> <span class="token string">"named.ca"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="56"></td><td><pre>  </pre></td></tr><tr><td data-num="57"></td><td><pre>  zone <span class="token string">"example.com"</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="58"></td><td><pre>    <span class="token builtin class-name">type</span> master<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="59"></td><td><pre>    <span class="token function">file</span> <span class="token string">"default/example.com.zone"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="60"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="61"></td><td><pre></pre></td></tr><tr><td data-num="62"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="63"></td><td><pre></pre></td></tr><tr><td data-num="64"></td><td><pre>//包含其他文件</pre></td></tr><tr><td data-num="65"></td><td><pre><span class="token comment">#include "/etc/named.rfc1912.zones";</span></pre></td></tr><tr><td data-num="66"></td><td><pre>include <span class="token string">"/etc/named.root.key"</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>2. 检查配置文件语法</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># named-checkconf</span></pre></td></tr></table></figure><h6 id="733-测试环境zone电信"><a class="anchor" href="#733-测试环境zone电信">#</a> 7.3.3 测试环境 zone (电信)</h6><p>1. 创建目录并修改属组</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># mkdir /var/named/test</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># chgrp named /var/named/test/</span></pre></td></tr></table></figure><p>2. 准备测试环境的 zone 区域配置文件</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># cat /var/named/test/example.com.zone</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token variable">$TTL</span> <span class="token number">600</span> <span class="token punctuation">;</span> DNS失效时间，单位秒<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>example.com. IN SOA ns.example.com. xuy.nf-leasing.com. <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">;</span> 区域名称 IN SOA dns.hmallleasing.com. 管理员邮箱</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">;</span> 区域名称可以使用过@表示，@表示当前域</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token number">2025092018</span> <span class="token punctuation">;</span> 序列号<span class="token punctuation">(</span>serial number<span class="token punctuation">)</span> 十进制，不能超过10位，通常使用日期时间戳，例如2018121601</pre></td></tr><tr><td data-num="8"></td><td><pre>	<span class="token number">10800</span>      <span class="token punctuation">;</span> 刷新时间<span class="token punctuation">(</span>refresh <span class="token function">time</span><span class="token punctuation">)</span> 即每隔多久到主服务器检查一次</pre></td></tr><tr><td data-num="9"></td><td><pre>	<span class="token number">900</span>        <span class="token punctuation">;</span> 重试时间<span class="token punctuation">(</span>retry <span class="token function">time</span><span class="token punctuation">)</span> 即刷新不成功多久后重试，应该小于refresh <span class="token function">time</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token number">604800</span>     <span class="token punctuation">;</span> 过期时间<span class="token punctuation">(</span>expire <span class="token function">time</span><span class="token punctuation">)</span> 当辅助DNS无法联系主DNS时，辅助DNS在多长时间内认为其缓存是有效的。</pre></td></tr><tr><td data-num="11"></td><td><pre>	<span class="token number">86400</span>      <span class="token punctuation">;</span> 权威应答的ttl<span class="token punctuation">(</span>netgative answer ttl<span class="token punctuation">)</span> <span class="token punctuation">;</span>缓存DNS服务器可以缓存记录多长时间</pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">;</span> 给客户端返回NS记录，example.com. 域名由哪几台权威服务器提供解析</pre></td></tr><tr><td data-num="15"></td><td><pre>example.com. IN NS ns1.example.com.</pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">;</span> A记录，配置权威域名的真实IP地址；</pre></td></tr><tr><td data-num="18"></td><td><pre>ns1.example.com. IN A <span class="token number">172.16</span>.1.91</pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">;</span> 真正的域名解析</pre></td></tr><tr><td data-num="21"></td><td><pre>www.example.com.      	IN     	A  <span class="token number">1.1</span>.1.1</pre></td></tr></table></figure><p>3. 检查 zone 区域配置文件语法</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># named-checkzone example.com /var/named/test/example.com.zone</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart named</span></pre></td></tr></table></figure><h6 id="734-生产环境zone联通"><a class="anchor" href="#734-生产环境zone联通">#</a> 7.3.4 生产环境 zone (联通)</h6><p>1. 创建目录并修改属组</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># mkdir /var/named/prod</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># chgrp named /var/named/prod/</span></pre></td></tr></table></figure><p>2. 准备测试环境的 zone 区域配置文件</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># cp /var/named/test/example.com.zone /var/named/prod/example.com.zone </span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># cat /var/named/prod/example.com.zone </span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token variable">$TTL</span> <span class="token number">600</span> <span class="token punctuation">;</span> DNS失效时间，单位秒<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>example.com. IN SOA ns.example.com. xuy.nf-leasing.com. <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">;</span> 区域名称 IN SOA dns.hmallleasing.com. 管理员邮箱</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">;</span> 区域名称可以使用过@表示，@表示当前域</pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>	<span class="token number">2025092018</span> <span class="token punctuation">;</span> 序列号<span class="token punctuation">(</span>serial number<span class="token punctuation">)</span> 十进制，不能超过10位，通常使用日期时间戳，例如2018121601</pre></td></tr><tr><td data-num="9"></td><td><pre>	<span class="token number">10800</span>      <span class="token punctuation">;</span> 刷新时间<span class="token punctuation">(</span>refresh <span class="token function">time</span><span class="token punctuation">)</span> 即每隔多久到主服务器检查一次</pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token number">900</span>        <span class="token punctuation">;</span> 重试时间<span class="token punctuation">(</span>retry <span class="token function">time</span><span class="token punctuation">)</span> 即刷新不成功多久后重试，应该小于refresh <span class="token function">time</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	<span class="token number">604800</span>     <span class="token punctuation">;</span> 过期时间<span class="token punctuation">(</span>expire <span class="token function">time</span><span class="token punctuation">)</span> 当辅助DNS无法联系主DNS时，辅助DNS在多长时间内认为其缓存是有效的。</pre></td></tr><tr><td data-num="12"></td><td><pre>	<span class="token number">86400</span>      <span class="token punctuation">;</span> 权威应答的ttl<span class="token punctuation">(</span>netgative answer ttl<span class="token punctuation">)</span> <span class="token punctuation">;</span>缓存DNS服务器可以缓存记录多长时间</pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">;</span> 给客户端返回NS记录，example.com. 域名由哪几台权威服务器提供解析</pre></td></tr><tr><td data-num="16"></td><td><pre>example.com. IN NS ns1.example.com.</pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">;</span> A记录，配置权威域名的真实IP地址；</pre></td></tr><tr><td data-num="19"></td><td><pre>ns1.example.com. IN A <span class="token number">172.16</span>.1.91</pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">;</span> 真正的域名解析</pre></td></tr><tr><td data-num="22"></td><td><pre>www.example.com.      	IN     	A  <span class="token number">2.2</span>.2.2</pre></td></tr></table></figure><p>3. 检查 zone 区域配置文件语法</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># named-checkzone example.com /var/named/prod/example.com.zone</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart named</span></pre></td></tr></table></figure><h6 id="735-添加默认zone"><a class="anchor" href="#735-添加默认zone">#</a> 7.3.5 添加默认 zone</h6><p>1. 创建目录并修改属组</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># mkdir /var/named/default</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># chgrp named /var/named/default</span></pre></td></tr></table></figure><p>2. 准备测试环境的 zone 区域配置文件</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># cat /var/named/default/example.com.zone </span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token variable">$TTL</span> <span class="token number">600</span> <span class="token punctuation">;</span> DNS失效时间，单位秒<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>example.com. IN SOA ns.example.com. xuy.nf-leasing.com. <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">;</span> 区域名称 IN SOA dns.hmallleasing.com. 管理员邮箱</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">;</span> 区域名称可以使用过@表示，@表示当前域</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token number">2025092018</span> <span class="token punctuation">;</span> 序列号<span class="token punctuation">(</span>serial number<span class="token punctuation">)</span> 十进制，不能超过10位，通常使用日期时间戳，例如2018121601</pre></td></tr><tr><td data-num="8"></td><td><pre>	<span class="token number">10800</span>      <span class="token punctuation">;</span> 刷新时间<span class="token punctuation">(</span>refresh <span class="token function">time</span><span class="token punctuation">)</span> 即每隔多久到主服务器检查一次</pre></td></tr><tr><td data-num="9"></td><td><pre>	<span class="token number">900</span>        <span class="token punctuation">;</span> 重试时间<span class="token punctuation">(</span>retry <span class="token function">time</span><span class="token punctuation">)</span> 即刷新不成功多久后重试，应该小于refresh <span class="token function">time</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token number">604800</span>     <span class="token punctuation">;</span> 过期时间<span class="token punctuation">(</span>expire <span class="token function">time</span><span class="token punctuation">)</span> 当辅助DNS无法联系主DNS时，辅助DNS在多长时间内认为其缓存是有效的。</pre></td></tr><tr><td data-num="11"></td><td><pre>	<span class="token number">86400</span>      <span class="token punctuation">;</span> 权威应答的ttl<span class="token punctuation">(</span>netgative answer ttl<span class="token punctuation">)</span> <span class="token punctuation">;</span>缓存DNS服务器可以缓存记录多长时间</pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">;</span> 给客户端返回NS记录，example.com. 域名由哪几台权威服务器提供解析</pre></td></tr><tr><td data-num="15"></td><td><pre>example.com. IN NS ns1.example.com.</pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">;</span> A记录，配置权威域名的真实IP地址；</pre></td></tr><tr><td data-num="18"></td><td><pre>ns1.example.com. IN A <span class="token number">172.16</span>.1.91</pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">;</span> 真正的域名解析</pre></td></tr><tr><td data-num="21"></td><td><pre>www.example.com.      	IN     	A  <span class="token number">3.3</span>.3.3</pre></td></tr></table></figure><p>3. 检查 zone 区域配置文件语法</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># named-checkzone example.com /var/named/default/example.com.zone</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart named</span></pre></td></tr></table></figure><h6 id="736-客户端测试"><a class="anchor" href="#736-客户端测试">#</a> 7.3.6 客户端测试</h6><p>使用不同客户端查询相同的域名进行测试验证</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 172.16.1.10 解析结果</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment"># dig www.example.com @172.16.1.91 +short</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">1.1</span>.1.1</pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token comment"># 172.16.1.200 解析结果</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">[</span>root@route ~<span class="token punctuation">]</span><span class="token comment"># dig www.example.com @172.16.1.91 +short</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token number">2.2</span>.2.2</pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment"># 172.16.1.7 解析结果</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">[</span>root@web01 ~<span class="token punctuation">]</span><span class="token comment"># dig www.example.com @172.16.1.91 +short</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token number">3.3</span>.3.3</pre></td></tr></table></figure><h5 id="74-智能dns主从场景实践"><a class="anchor" href="#74-智能dns主从场景实践">#</a> 7.4 智能 DNS 主从场景实践</h5><ul><li>基于 TSIG KEY 实现多 VIEW 主从同步，TSIG KEY 是基于对称秘钥加密技术实现的 DNS 报文认证机制。</li><li>秘钥生成后存放至通信双方的配置文件中，报文传送前使用对称加密计数。</li></ul><h6 id="741-生成tsig-key"><a class="anchor" href="#741-生成tsig-key">#</a> 7.4.1 生成 TSIG-KEY</h6><p>使用 BIND 自带的工具 ddns-confgen 生成 TSIG-KEY，每个 view 需要一对 TSIG-KEY</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#1. 生成 default 默认 TSIG-KEY</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># ddns-confgen -a hmac-md5</span></pre></td></tr><tr><td data-num="3"></td><td><pre>key <span class="token string">"default-key"</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	algorithm hmac-md5<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	secret <span class="token string">"MGMtJqmFgFdGU1yh7/FzBQ=="</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">#2. 生成测试环境 TSIG-KEY</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># ddns-confgen -a hmac-md5</span></pre></td></tr><tr><td data-num="10"></td><td><pre>key <span class="token string">"test-key"</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	algorithm hmac-md5<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>	secret <span class="token string">"0huRl0JD1goOvb6/BupIKw=="</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment">#3. 生成生产环境 TSIG-KEY</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># ddns-confgen -a hmac-md5</span></pre></td></tr><tr><td data-num="17"></td><td><pre>key <span class="token string">"prod-key"</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>	algorithm hmac-md5<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>	secret <span class="token string">"1q8T/d2fNp4Y4sLETWZPBA=="</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h6 id="742-master-dns配置"><a class="anchor" href="#742-master-dns配置">#</a> 7.4.2 Master DNS 配置</h6><p>Master DNS named.conf 配置（172.16.1.91）</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/named.conf</span></pre></td></tr><tr><td data-num="2"></td><td><pre>//</pre></td></tr><tr><td data-num="3"></td><td><pre>// named.conf</pre></td></tr><tr><td data-num="4"></td><td><pre>//</pre></td></tr><tr><td data-num="5"></td><td><pre>// Provided by Red Hat <span class="token builtin class-name">bind</span> package to configure the ISC BIND named<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> DNS</pre></td></tr><tr><td data-num="6"></td><td><pre>// server as a caching only nameserver <span class="token punctuation">(</span>as a localhost DNS resolver only<span class="token punctuation">)</span>.</pre></td></tr><tr><td data-num="7"></td><td><pre>//</pre></td></tr><tr><td data-num="8"></td><td><pre>// See /usr/share/doc/bind*/sample/ <span class="token keyword">for</span> example named configuration files.</pre></td></tr><tr><td data-num="9"></td><td><pre>//</pre></td></tr><tr><td data-num="10"></td><td><pre>// See the BIND Administrator's Reference Manual <span class="token punctuation">(</span>ARM<span class="token punctuation">)</span> <span class="token keyword">for</span> details about the</pre></td></tr><tr><td data-num="11"></td><td><pre>// configuration located <span class="token keyword">in</span> /usr/share/doc/bind-<span class="token punctuation">&#123;</span>version<span class="token punctuation">&#125;</span>/Bv9ARM.html</pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>options <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>	// ipv4监听地址及端口</pre></td></tr><tr><td data-num="15"></td><td><pre>	listen-on port <span class="token number">53</span> <span class="token punctuation">&#123;</span> any<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre> 	// ipv6监听地址及端口</pre></td></tr><tr><td data-num="17"></td><td><pre>	listen-on-v6 port <span class="token number">53</span> <span class="token punctuation">&#123;</span> ::1<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>	// 区域配置存储目录</pre></td></tr><tr><td data-num="19"></td><td><pre>	directory 	<span class="token string">"/var/named"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>	// DNS解析过内容的缓存文件</pre></td></tr><tr><td data-num="21"></td><td><pre>	dump-file 	<span class="token string">"/var/named/data/cache_dump.db"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>	// 静态解析文件（几乎不用）</pre></td></tr><tr><td data-num="23"></td><td><pre>	statistics-file <span class="token string">"/var/named/data/named_stats.txt"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>	// 内存的统计信息</pre></td></tr><tr><td data-num="25"></td><td><pre>	memstatistics-file <span class="token string">"/var/named/data/named_mem_stats.txt"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>	recursing-file  <span class="token string">"/var/named/data/named.recursing"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>	secroots-file   <span class="token string">"/var/named/data/named.secroots"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>	// 允许谁本台DNS发起查询请求（localhost<span class="token operator">|</span><span class="token function">ip</span><span class="token operator">|</span>any）</pre></td></tr><tr><td data-num="29"></td><td><pre>	allow-query     <span class="token punctuation">&#123;</span> any<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>	//允许哪个地址同步master配置信息</pre></td></tr><tr><td data-num="31"></td><td><pre>        allow-transfer <span class="token punctuation">&#123;</span> <span class="token number">172.16</span>.1.92<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="32"></td><td><pre>	//主动通知辅助DNS域名变更	</pre></td></tr><tr><td data-num="33"></td><td><pre>        also-notify <span class="token punctuation">&#123;</span> <span class="token number">172.16</span>.1.92<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span> </pre></td></tr><tr><td data-num="34"></td><td><pre></pre></td></tr><tr><td data-num="35"></td><td><pre>	/* </pre></td></tr><tr><td data-num="36"></td><td><pre>	 - If you are building an AUTHORITATIVE DNS server, <span class="token keyword">do</span> NOT <span class="token builtin class-name">enable</span> recursion.</pre></td></tr><tr><td data-num="37"></td><td><pre>	 - If you are building a RECURSIVE <span class="token punctuation">(</span>caching<span class="token punctuation">)</span> DNS server, you need to <span class="token builtin class-name">enable</span> </pre></td></tr><tr><td data-num="38"></td><td><pre>	   recursion. </pre></td></tr><tr><td data-num="39"></td><td><pre>	 - If your recursive DNS server has a public IP address, you MUST <span class="token builtin class-name">enable</span> access </pre></td></tr><tr><td data-num="40"></td><td><pre>	   control to limit queries to your legitimate users. Failing to <span class="token keyword">do</span> so will</pre></td></tr><tr><td data-num="41"></td><td><pre>	   cause your server to become part of large scale DNS amplification </pre></td></tr><tr><td data-num="42"></td><td><pre>	   attacks. Implementing BCP38 within your network would greatly</pre></td></tr><tr><td data-num="43"></td><td><pre>	   reduce such attack surface </pre></td></tr><tr><td data-num="44"></td><td><pre>	*/</pre></td></tr><tr><td data-num="45"></td><td><pre>	//递归查询</pre></td></tr><tr><td data-num="46"></td><td><pre>	recursion <span class="token function">yes</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>	allow-recursion <span class="token punctuation">&#123;</span> <span class="token number">192.168</span>.40.0/24<span class="token punctuation">;</span><span class="token number">172.16</span>.1.0/24<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>	//安全校验相关的</pre></td></tr><tr><td data-num="49"></td><td><pre>	dnssec-enable <span class="token function">yes</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>	//安全校验相关的</pre></td></tr><tr><td data-num="51"></td><td><pre>	dnssec-validation <span class="token function">yes</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="52"></td><td><pre></pre></td></tr><tr><td data-num="53"></td><td><pre>	/* Path to ISC DLV key */</pre></td></tr><tr><td data-num="54"></td><td><pre>	bindkeys-file <span class="token string">"/etc/named.root.key"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="55"></td><td><pre></pre></td></tr><tr><td data-num="56"></td><td><pre>	managed-keys-directory <span class="token string">"/var/named/dynamic"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="57"></td><td><pre></pre></td></tr><tr><td data-num="58"></td><td><pre>	pid-file <span class="token string">"/run/named/named.pid"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="59"></td><td><pre>	session-keyfile <span class="token string">"/run/named/session.key"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="60"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="61"></td><td><pre></pre></td></tr><tr><td data-num="62"></td><td><pre>// 控制日志输出的级别以及输出的位置</pre></td></tr><tr><td data-num="63"></td><td><pre>logging <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="64"></td><td><pre>        channel default_debug <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="65"></td><td><pre>                <span class="token function">file</span> <span class="token string">"data/named.run"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="66"></td><td><pre>                severity dynamic<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="67"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="68"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="69"></td><td><pre></pre></td></tr><tr><td data-num="70"></td><td><pre>//模拟测试业务地址段</pre></td></tr><tr><td data-num="71"></td><td><pre>acl <span class="token string">"test"</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="72"></td><td><pre>	<span class="token number">172.16</span>.1.10<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="73"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="74"></td><td><pre></pre></td></tr><tr><td data-num="75"></td><td><pre>//模拟生产业务地址段</pre></td></tr><tr><td data-num="76"></td><td><pre>acl <span class="token string">"prod"</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="77"></td><td><pre>	<span class="token number">172.16</span>.1.200<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="78"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="79"></td><td><pre></pre></td></tr><tr><td data-num="80"></td><td><pre></pre></td></tr><tr><td data-num="81"></td><td><pre>//TSIG-KEY</pre></td></tr><tr><td data-num="82"></td><td><pre>key <span class="token string">"default-key"</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="83"></td><td><pre>	algorithm hmac-md5<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="84"></td><td><pre>	secret <span class="token string">"MGMtJqmFgFdGU1yh7/FzBQ=="</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="85"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="86"></td><td><pre></pre></td></tr><tr><td data-num="87"></td><td><pre>key <span class="token string">"test-key"</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="88"></td><td><pre>	algorithm hmac-md5<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="89"></td><td><pre>	secret <span class="token string">"0huRl0JD1goOvb6/BupIKw=="</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="90"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="91"></td><td><pre></pre></td></tr><tr><td data-num="92"></td><td><pre>key <span class="token string">"prod-key"</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="93"></td><td><pre>	algorithm hmac-md5<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="94"></td><td><pre>	secret <span class="token string">"1q8T/d2fNp4Y4sLETWZPBA=="</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="95"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="96"></td><td><pre></pre></td></tr><tr><td data-num="97"></td><td><pre>//测试业务view</pre></td></tr><tr><td data-num="98"></td><td><pre>view <span class="token string">"test-project"</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="99"></td><td><pre>  //须取消两台DNS主机通过地址匹配，使其通过TSIG-KEY匹配，如果不取消会出现拒绝访问</pre></td></tr><tr><td data-num="100"></td><td><pre>  match-clients <span class="token punctuation">&#123;</span> key test-key<span class="token punctuation">;</span> <span class="token operator">!</span><span class="token number">172.16</span>.1.91<span class="token punctuation">;</span><span class="token operator">!</span><span class="token number">172.16</span>.1.92<span class="token punctuation">;</span> <span class="token string">"test"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="101"></td><td><pre>  //Slave节点与Master节点通讯使用key-test</pre></td></tr><tr><td data-num="102"></td><td><pre>  server <span class="token number">172.16</span>.1.92 <span class="token punctuation">&#123;</span> keys test-key<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="103"></td><td><pre>  //允许test-project view区域使用test-key传输区域文件</pre></td></tr><tr><td data-num="104"></td><td><pre>  allow-transfer <span class="token punctuation">&#123;</span> key test-key<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="105"></td><td><pre>  recursion <span class="token function">yes</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="106"></td><td><pre></pre></td></tr><tr><td data-num="107"></td><td><pre>  zone <span class="token string">"."</span> IN <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="108"></td><td><pre>    <span class="token builtin class-name">type</span> hint<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="109"></td><td><pre>    <span class="token function">file</span> <span class="token string">"named.ca"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="110"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="111"></td><td><pre></pre></td></tr><tr><td data-num="112"></td><td><pre>  zone <span class="token string">"example.com"</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="113"></td><td><pre>    <span class="token builtin class-name">type</span> master<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="114"></td><td><pre>    <span class="token function">file</span> <span class="token string">"test/example.com.zone"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="115"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="116"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="117"></td><td><pre></pre></td></tr><tr><td data-num="118"></td><td><pre>//生产业务view</pre></td></tr><tr><td data-num="119"></td><td><pre>view <span class="token string">"prod-project"</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="120"></td><td><pre>  //须取消两台DNS主机通过地址匹配，使其通过TSIG-KEY匹配，如果不取消会出现拒绝访问</pre></td></tr><tr><td data-num="121"></td><td><pre>  match-clients <span class="token punctuation">&#123;</span> key prod-key<span class="token punctuation">;</span> <span class="token operator">!</span><span class="token number">172.16</span>.1.91<span class="token punctuation">;</span><span class="token operator">!</span><span class="token number">172.16</span>.1.92<span class="token punctuation">;</span> <span class="token string">"prod"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="122"></td><td><pre>  //Slave节点与Master节点通讯使用prod-key</pre></td></tr><tr><td data-num="123"></td><td><pre>  server <span class="token number">172.16</span>.1.92 <span class="token punctuation">&#123;</span> keys prod-key<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="124"></td><td><pre>  //允许test-project view区域使用prod-key传输区域文件</pre></td></tr><tr><td data-num="125"></td><td><pre>  allow-transfer <span class="token punctuation">&#123;</span> key prod-key<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="126"></td><td><pre>  recursion <span class="token function">yes</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="127"></td><td><pre></pre></td></tr><tr><td data-num="128"></td><td><pre>  zone <span class="token string">"."</span> IN <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="129"></td><td><pre>    <span class="token builtin class-name">type</span> hint<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="130"></td><td><pre>    <span class="token function">file</span> <span class="token string">"named.ca"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="131"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="132"></td><td><pre></pre></td></tr><tr><td data-num="133"></td><td><pre>  zone <span class="token string">"example.com"</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="134"></td><td><pre>    <span class="token builtin class-name">type</span> master<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="135"></td><td><pre>    <span class="token function">file</span> <span class="token string">"prod/example.com.zone"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="136"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="137"></td><td><pre></pre></td></tr><tr><td data-num="138"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="139"></td><td><pre></pre></td></tr><tr><td data-num="140"></td><td><pre>//默认的view</pre></td></tr><tr><td data-num="141"></td><td><pre>view <span class="token string">"default"</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="142"></td><td><pre>  //须取消两台DNS主机通过地址匹配，使其通过TSIG-KEY匹配，如果不取消会出现拒绝访问</pre></td></tr><tr><td data-num="143"></td><td><pre>  match-clients <span class="token punctuation">&#123;</span> key default-key<span class="token punctuation">;</span> <span class="token operator">!</span><span class="token number">172.16</span>.1.91<span class="token punctuation">;</span><span class="token operator">!</span><span class="token number">172.16</span>.1.92<span class="token punctuation">;</span> any<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="144"></td><td><pre>  //Slave节点与Master节点通讯使用default-key</pre></td></tr><tr><td data-num="145"></td><td><pre>  server <span class="token number">172.16</span>.1.92 <span class="token punctuation">&#123;</span> keys default-key<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="146"></td><td><pre>  //允许test-project view区域使用default-key传输区域文件</pre></td></tr><tr><td data-num="147"></td><td><pre>  allow-transfer <span class="token punctuation">&#123;</span> key default-key<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="148"></td><td><pre>  recursion <span class="token function">yes</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="149"></td><td><pre>  </pre></td></tr><tr><td data-num="150"></td><td><pre>  zone <span class="token string">"."</span> IN <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="151"></td><td><pre>    <span class="token builtin class-name">type</span> hint<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="152"></td><td><pre>    <span class="token function">file</span> <span class="token string">"named.ca"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="153"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="154"></td><td><pre>  </pre></td></tr><tr><td data-num="155"></td><td><pre>  zone <span class="token string">"example.com"</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="156"></td><td><pre>    <span class="token builtin class-name">type</span> master<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="157"></td><td><pre>    <span class="token function">file</span> <span class="token string">"default/example.com.zone"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="158"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="159"></td><td><pre></pre></td></tr><tr><td data-num="160"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="161"></td><td><pre></pre></td></tr><tr><td data-num="162"></td><td><pre>//包含其他文件</pre></td></tr><tr><td data-num="163"></td><td><pre><span class="token comment">#include "/etc/named.rfc1912.zones";</span></pre></td></tr><tr><td data-num="164"></td><td><pre>include <span class="token string">"/etc/named.root.key"</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h6 id="743-slave-dns配置"><a class="anchor" href="#743-slave-dns配置">#</a> 7.4.3 Slave DNS 配置</h6><p>Slave DNS named.conf 配置（172.16.1.92）</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-slave ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/named.conf </span></pre></td></tr><tr><td data-num="2"></td><td><pre>//</pre></td></tr><tr><td data-num="3"></td><td><pre>// named.conf</pre></td></tr><tr><td data-num="4"></td><td><pre>//</pre></td></tr><tr><td data-num="5"></td><td><pre>// Provided by Red Hat <span class="token builtin class-name">bind</span> package to configure the ISC BIND named<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> DNS</pre></td></tr><tr><td data-num="6"></td><td><pre>// server as a caching only nameserver <span class="token punctuation">(</span>as a localhost DNS resolver only<span class="token punctuation">)</span>.</pre></td></tr><tr><td data-num="7"></td><td><pre>//</pre></td></tr><tr><td data-num="8"></td><td><pre>// See /usr/share/doc/bind*/sample/ <span class="token keyword">for</span> example named configuration files.</pre></td></tr><tr><td data-num="9"></td><td><pre>//</pre></td></tr><tr><td data-num="10"></td><td><pre>// See the BIND Administrator's Reference Manual <span class="token punctuation">(</span>ARM<span class="token punctuation">)</span> <span class="token keyword">for</span> details about the</pre></td></tr><tr><td data-num="11"></td><td><pre>// configuration located <span class="token keyword">in</span> /usr/share/doc/bind-<span class="token punctuation">&#123;</span>version<span class="token punctuation">&#125;</span>/Bv9ARM.html</pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>options <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>	listen-on port <span class="token number">53</span> <span class="token punctuation">&#123;</span> any<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>	listen-on-v6 port <span class="token number">53</span> <span class="token punctuation">&#123;</span> ::1<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>	directory 	<span class="token string">"/var/named"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>	dump-file 	<span class="token string">"/var/named/data/cache_dump.db"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>	statistics-file <span class="token string">"/var/named/data/named_stats.txt"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>	memstatistics-file <span class="token string">"/var/named/data/named_mem_stats.txt"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>	recursing-file  <span class="token string">"/var/named/data/named.recursing"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>	secroots-file   <span class="token string">"/var/named/data/named.secroots"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>	allow-query     <span class="token punctuation">&#123;</span> any<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        masterfile-format text<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre>	/* </pre></td></tr><tr><td data-num="26"></td><td><pre>	 - If you are building an AUTHORITATIVE DNS server, <span class="token keyword">do</span> NOT <span class="token builtin class-name">enable</span> recursion.</pre></td></tr><tr><td data-num="27"></td><td><pre>	 - If you are building a RECURSIVE <span class="token punctuation">(</span>caching<span class="token punctuation">)</span> DNS server, you need to <span class="token builtin class-name">enable</span> </pre></td></tr><tr><td data-num="28"></td><td><pre>	   recursion. </pre></td></tr><tr><td data-num="29"></td><td><pre>	 - If your recursive DNS server has a public IP address, you MUST <span class="token builtin class-name">enable</span> access </pre></td></tr><tr><td data-num="30"></td><td><pre>	   control to limit queries to your legitimate users. Failing to <span class="token keyword">do</span> so will</pre></td></tr><tr><td data-num="31"></td><td><pre>	   cause your server to become part of large scale DNS amplification </pre></td></tr><tr><td data-num="32"></td><td><pre>	   attacks. Implementing BCP38 within your network would greatly</pre></td></tr><tr><td data-num="33"></td><td><pre>	   reduce such attack surface </pre></td></tr><tr><td data-num="34"></td><td><pre>	*/</pre></td></tr><tr><td data-num="35"></td><td><pre>	recursion <span class="token function">yes</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="36"></td><td><pre></pre></td></tr><tr><td data-num="37"></td><td><pre>	dnssec-enable <span class="token function">yes</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>	dnssec-validation <span class="token function">yes</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre></pre></td></tr><tr><td data-num="40"></td><td><pre>	/* Path to ISC DLV key */</pre></td></tr><tr><td data-num="41"></td><td><pre>	bindkeys-file <span class="token string">"/etc/named.root.key"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="42"></td><td><pre></pre></td></tr><tr><td data-num="43"></td><td><pre>	managed-keys-directory <span class="token string">"/var/named/dynamic"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre></pre></td></tr><tr><td data-num="45"></td><td><pre>	pid-file <span class="token string">"/run/named/named.pid"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>	session-keyfile <span class="token string">"/run/named/session.key"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre></pre></td></tr><tr><td data-num="49"></td><td><pre>logging <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>        channel default_debug <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="51"></td><td><pre>                <span class="token function">file</span> <span class="token string">"data/named.run"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>                severity dynamic<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="54"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="55"></td><td><pre></pre></td></tr><tr><td data-num="56"></td><td><pre>//模拟测试业务地址段</pre></td></tr><tr><td data-num="57"></td><td><pre>acl <span class="token string">"test"</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="58"></td><td><pre>	<span class="token number">172.16</span>.1.10<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="59"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="60"></td><td><pre></pre></td></tr><tr><td data-num="61"></td><td><pre>//模拟生产业务地址段</pre></td></tr><tr><td data-num="62"></td><td><pre>acl <span class="token string">"prod"</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="63"></td><td><pre>	<span class="token number">172.16</span>.1.200<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="64"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="65"></td><td><pre></pre></td></tr><tr><td data-num="66"></td><td><pre></pre></td></tr><tr><td data-num="67"></td><td><pre>//TSIG-KEY</pre></td></tr><tr><td data-num="68"></td><td><pre>key <span class="token string">"default-key"</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="69"></td><td><pre>	algorithm hmac-md5<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="70"></td><td><pre>	secret <span class="token string">"MGMtJqmFgFdGU1yh7/FzBQ=="</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="71"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="72"></td><td><pre></pre></td></tr><tr><td data-num="73"></td><td><pre>key <span class="token string">"test-key"</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="74"></td><td><pre>	algorithm hmac-md5<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="75"></td><td><pre>	secret <span class="token string">"0huRl0JD1goOvb6/BupIKw=="</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="76"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="77"></td><td><pre></pre></td></tr><tr><td data-num="78"></td><td><pre>key <span class="token string">"prod-key"</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="79"></td><td><pre>	algorithm hmac-md5<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="80"></td><td><pre>	secret <span class="token string">"1q8T/d2fNp4Y4sLETWZPBA=="</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="81"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="82"></td><td><pre></pre></td></tr><tr><td data-num="83"></td><td><pre>//测试业务view</pre></td></tr><tr><td data-num="84"></td><td><pre>view <span class="token string">"test-project"</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="85"></td><td><pre>  //须取消两台DNS主机通过地址匹配，使其通过TSIG-KEY匹配，如果不取消会出现拒绝访问</pre></td></tr><tr><td data-num="86"></td><td><pre>  match-clients <span class="token punctuation">&#123;</span> key test-key<span class="token punctuation">;</span> <span class="token operator">!</span><span class="token number">172.16</span>.1.91<span class="token punctuation">;</span><span class="token operator">!</span><span class="token number">172.16</span>.1.92<span class="token punctuation">;</span> <span class="token string">"test"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="87"></td><td><pre>  //Slave节点与Master节点通讯使用key-test</pre></td></tr><tr><td data-num="88"></td><td><pre>  server <span class="token number">172.16</span>.1.91 <span class="token punctuation">&#123;</span> keys test-key<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="89"></td><td><pre>  recursion <span class="token function">yes</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="90"></td><td><pre></pre></td></tr><tr><td data-num="91"></td><td><pre>  zone <span class="token string">"."</span> IN <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="92"></td><td><pre>    <span class="token builtin class-name">type</span> hint<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="93"></td><td><pre>    <span class="token function">file</span> <span class="token string">"named.ca"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="94"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="95"></td><td><pre></pre></td></tr><tr><td data-num="96"></td><td><pre>  zone <span class="token string">"example.com"</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="97"></td><td><pre>    <span class="token builtin class-name">type</span> slave<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="98"></td><td><pre>    <span class="token function">file</span> <span class="token string">"test/example.com.zone"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="99"></td><td><pre>    masters <span class="token punctuation">&#123;</span> <span class="token number">172.16</span>.1.91<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="100"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="101"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="102"></td><td><pre></pre></td></tr><tr><td data-num="103"></td><td><pre>//生产业务view</pre></td></tr><tr><td data-num="104"></td><td><pre>view <span class="token string">"prod-project"</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="105"></td><td><pre>  //须取消两台DNS主机通过地址匹配，使其通过TSIG-KEY匹配，如果不取消会出现拒绝访问</pre></td></tr><tr><td data-num="106"></td><td><pre>  match-clients <span class="token punctuation">&#123;</span> key prod-key<span class="token punctuation">;</span> <span class="token operator">!</span><span class="token number">172.16</span>.1.91<span class="token punctuation">;</span><span class="token operator">!</span><span class="token number">172.16</span>.1.92<span class="token punctuation">;</span> <span class="token string">"prod"</span><span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="107"></td><td><pre>  //Slave节点与Master节点通讯使用prod-key</pre></td></tr><tr><td data-num="108"></td><td><pre>  server <span class="token number">172.16</span>.1.91 <span class="token punctuation">&#123;</span> keys prod-key<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="109"></td><td><pre>  recursion <span class="token function">yes</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="110"></td><td><pre></pre></td></tr><tr><td data-num="111"></td><td><pre>  zone <span class="token string">"."</span> IN <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="112"></td><td><pre>    <span class="token builtin class-name">type</span> hint<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="113"></td><td><pre>    <span class="token function">file</span> <span class="token string">"named.ca"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="114"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="115"></td><td><pre></pre></td></tr><tr><td data-num="116"></td><td><pre>  zone <span class="token string">"example.com"</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="117"></td><td><pre>    <span class="token builtin class-name">type</span> slave<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="118"></td><td><pre>    <span class="token function">file</span> <span class="token string">"prod/example.com.zone"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="119"></td><td><pre>    masters <span class="token punctuation">&#123;</span> <span class="token number">172.16</span>.1.91<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="120"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="121"></td><td><pre></pre></td></tr><tr><td data-num="122"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="123"></td><td><pre></pre></td></tr><tr><td data-num="124"></td><td><pre>//默认的view</pre></td></tr><tr><td data-num="125"></td><td><pre>view <span class="token string">"default"</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="126"></td><td><pre>  //须取消两台DNS主机通过地址匹配，使其通过TSIG-KEY匹配，如果不取消会出现拒绝访问</pre></td></tr><tr><td data-num="127"></td><td><pre>  match-clients <span class="token punctuation">&#123;</span> key default-key<span class="token punctuation">;</span> <span class="token operator">!</span><span class="token number">172.16</span>.1.91<span class="token punctuation">;</span><span class="token operator">!</span><span class="token number">172.16</span>.1.92<span class="token punctuation">;</span> any<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="128"></td><td><pre>  //Slave节点与Master节点通讯使用default-key</pre></td></tr><tr><td data-num="129"></td><td><pre>  server <span class="token number">172.16</span>.1.91 <span class="token punctuation">&#123;</span> keys default-key<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="130"></td><td><pre>  recursion <span class="token function">yes</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="131"></td><td><pre>  </pre></td></tr><tr><td data-num="132"></td><td><pre>  zone <span class="token string">"."</span> IN <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="133"></td><td><pre>    <span class="token builtin class-name">type</span> hint<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="134"></td><td><pre>    <span class="token function">file</span> <span class="token string">"named.ca"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="135"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="136"></td><td><pre>  </pre></td></tr><tr><td data-num="137"></td><td><pre>  zone <span class="token string">"example.com"</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="138"></td><td><pre>    <span class="token builtin class-name">type</span> slave<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="139"></td><td><pre>    <span class="token function">file</span> <span class="token string">"default/example.com.zone"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="140"></td><td><pre>    masters <span class="token punctuation">&#123;</span> <span class="token number">172.16</span>.1.91<span class="token punctuation">;</span> <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="141"></td><td><pre>  <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="142"></td><td><pre></pre></td></tr><tr><td data-num="143"></td><td><pre><span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="144"></td><td><pre></pre></td></tr><tr><td data-num="145"></td><td><pre></pre></td></tr><tr><td data-num="146"></td><td><pre><span class="token comment">#include "/etc/named.rfc1912.zones";</span></pre></td></tr><tr><td data-num="147"></td><td><pre>include <span class="token string">"/etc/named.root.key"</span><span class="token punctuation">;</span></pre></td></tr></table></figure><h6 id="744-验证结果"><a class="anchor" href="#744-验证结果">#</a> 7.4.4 验证结果</h6><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#1. 新建目录并修改权限</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@dns-slave ~<span class="token punctuation">]</span><span class="token comment"># mkdir /var/named/test</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@dns-slave ~<span class="token punctuation">]</span><span class="token comment"># mkdir /var/named/prod</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">[</span>root@dns-slave ~<span class="token punctuation">]</span><span class="token comment"># mkdir /var/named/default</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">[</span>root@dns-slave ~<span class="token punctuation">]</span><span class="token comment"># chown named.named /var/named/test</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">[</span>root@dns-slave ~<span class="token punctuation">]</span><span class="token comment"># chown named.named /var/named/prod/</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">[</span>root@dns-slave ~<span class="token punctuation">]</span><span class="token comment"># chown named.named /var/named/default/</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token comment">#2. 修改 master 所有区域配置文件序列号并重启 master 和 slave</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart named</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">[</span>root@dns-slave ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart named</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment">#3. 检查区域配置文件是否同步</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">[</span>root@dns-slave ~<span class="token punctuation">]</span><span class="token comment"># ll /var/named/test/example.com.zone /var/named/default/example.com.zone </span></pre></td></tr><tr><td data-num="15"></td><td><pre>-rw-r--r-- <span class="token number">1</span> named named <span class="token number">337</span> Sep <span class="token number">21</span> <span class="token number">19</span>:27 /var/named/default/example.com.zone</pre></td></tr><tr><td data-num="16"></td><td><pre>-rw-r--r-- <span class="token number">1</span> named named <span class="token number">337</span> Sep <span class="token number">21</span> <span class="token number">19</span>:27 /var/named/prod/example.com.zone</pre></td></tr><tr><td data-num="17"></td><td><pre>-rw-r--r-- <span class="token number">1</span> named named <span class="token number">337</span> Sep <span class="token number">21</span> <span class="token number">19</span>:27 /var/named/test/example.com.zone</pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment">#4.172.16.1.10 解析结果</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment"># dig www.example.com @172.16.1.91 +short</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token number">1.1</span>.1.1</pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">[</span>root@client ~<span class="token punctuation">]</span><span class="token comment"># dig www.example.com @172.16.1.92 +short</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token number">1.1</span>.1.1</pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token comment">#5.172.16.1.200 解析结果</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token punctuation">[</span>root@route ~<span class="token punctuation">]</span><span class="token comment"># dig www.example.com @172.16.1.91 +short</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token number">2.2</span>.2.2</pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token punctuation">[</span>root@route ~<span class="token punctuation">]</span><span class="token comment"># dig www.example.com @172.16.1.92 +short</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token number">2.2</span>.2.2</pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token comment">#6.172.16.1.7 解析结果</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token punctuation">[</span>root@web01 ~<span class="token punctuation">]</span><span class="token comment"># dig www.example.com @172.16.1.91 +short</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token number">2.2</span>.2.2</pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token punctuation">[</span>root@web01 ~<span class="token punctuation">]</span><span class="token comment"># dig www.example.com @172.16.1.92 +short</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token number">2.2</span>.2.2</pre></td></tr></table></figure><p>修改 master 区域配置文件检查 slave 是否同步成功</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@dns-master ~<span class="token punctuation">]</span><span class="token comment"># cat /var/named/default/example.com.zone </span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token variable">$TTL</span> <span class="token number">600</span> <span class="token punctuation">;</span> DNS失效时间，单位秒<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>example.com. IN SOA ns.example.com. xuy.nf-leasing.com. <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">;</span> 区域名称 IN SOA dns.hmallleasing.com. 管理员邮箱</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">;</span> 区域名称可以使用过@表示，@表示当前域</pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token number">2025092059</span> <span class="token punctuation">;</span> 序列号<span class="token punctuation">(</span>serial number<span class="token punctuation">)</span> 十进制，不能超过10位，通常使用日期时间戳，例如2018121601</pre></td></tr><tr><td data-num="8"></td><td><pre>	<span class="token number">10800</span>      <span class="token punctuation">;</span> 刷新时间<span class="token punctuation">(</span>refresh <span class="token function">time</span><span class="token punctuation">)</span> 即每隔多久到主服务器检查一次</pre></td></tr><tr><td data-num="9"></td><td><pre>	<span class="token number">900</span>        <span class="token punctuation">;</span> 重试时间<span class="token punctuation">(</span>retry <span class="token function">time</span><span class="token punctuation">)</span> 即刷新不成功多久后重试，应该小于refresh <span class="token function">time</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token number">604800</span>     <span class="token punctuation">;</span> 过期时间<span class="token punctuation">(</span>expire <span class="token function">time</span><span class="token punctuation">)</span> 当辅助DNS无法联系主DNS时，辅助DNS在多长时间内认为其缓存是有效的。</pre></td></tr><tr><td data-num="11"></td><td><pre>	<span class="token number">86400</span>      <span class="token punctuation">;</span> 权威应答的ttl<span class="token punctuation">(</span>netgative answer ttl<span class="token punctuation">)</span> <span class="token punctuation">;</span>缓存DNS服务器可以缓存记录多长时间</pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">;</span> 给客户端返回NS记录，example.com. 域名由哪几台权威服务器提供解析</pre></td></tr><tr><td data-num="15"></td><td><pre>example.com. IN NS ns1.example.com.</pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">;</span> A记录，配置权威域名的真实IP地址；</pre></td></tr><tr><td data-num="18"></td><td><pre>ns1.example.com. IN A <span class="token number">172.16</span>.1.91</pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">;</span> 真正的域名解析</pre></td></tr><tr><td data-num="21"></td><td><pre>www.example.com.      	IN     	A  <span class="token number">2.2</span>.2.2</pre></td></tr><tr><td data-num="22"></td><td><pre>bbs.example.com.      	IN     	A  <span class="token number">8.8</span>.8.8</pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">[</span>root@dns-slave ~<span class="token punctuation">]</span><span class="token comment"># cat /var/named/default/example.com.zone </span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token variable">$ORIGIN</span> <span class="token builtin class-name">.</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token variable">$TTL</span> <span class="token number">600</span>	<span class="token punctuation">;</span> <span class="token number">10</span> minutes</pre></td></tr><tr><td data-num="27"></td><td><pre>example.com		IN SOA	ns.example.com. xuy.nf-leasing.com. <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="28"></td><td><pre>				<span class="token number">2025092059</span> <span class="token punctuation">;</span> serial</pre></td></tr><tr><td data-num="29"></td><td><pre>				<span class="token number">10800</span>      <span class="token punctuation">;</span> refresh <span class="token punctuation">(</span><span class="token number">3</span> hours<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre>				<span class="token number">900</span>        <span class="token punctuation">;</span> retry <span class="token punctuation">(</span><span class="token number">15</span> minutes<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="31"></td><td><pre>				<span class="token number">604800</span>     <span class="token punctuation">;</span> expire <span class="token punctuation">(</span><span class="token number">1</span> week<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre>				<span class="token number">86400</span>      <span class="token punctuation">;</span> minimum <span class="token punctuation">(</span><span class="token number">1</span> day<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="33"></td><td><pre>				<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="34"></td><td><pre>			NS	ns1.example.com.</pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token variable">$ORIGIN</span> example.com.</pre></td></tr><tr><td data-num="36"></td><td><pre>bbs			A	<span class="token number">8.8</span>.8.8</pre></td></tr><tr><td data-num="37"></td><td><pre>ns1			A	<span class="token number">172.16</span>.1.91</pre></td></tr><tr><td data-num="38"></td><td><pre>www			A	<span class="token number">2.2</span>.2.2</pre></td></tr><tr><td data-num="39"></td><td><pre></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token punctuation">[</span>root@web01 ~<span class="token punctuation">]</span><span class="token comment"># dig bbs.example.com @172.16.1.92 +short</span></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token number">8.8</span>.8.8</pre></td></tr></table></figure><div class="tags"><a href="/tags/Linux/" rel="tag"><i class="ic i-tag"></i>Linux</a></div></div><footer><div class="meta"><span class="icon"><i class="ic i-eye"></i></span><span>此文章已被阅读次数:</span><span class="waline-pageview-count" id="twikoo_visitors" data-path="/posts/4120829732.html">正在加载...</span><span class="item"><span class="icon"><i class="ic i-calendar-check"></i></span><span class="text">更新于</span><time title="修改时间：2025-09-21 19:50:57" itemprop="dateModified" datetime="2025-09-21T19:50:57+08:00">2025-09-21</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i>赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img loading="lazy" data-src="/assets/wechatpay.png" alt="Xu Yong 微信支付"><p>微信支付</p></div><div><img loading="lazy" data-src="/assets/alipay.png" alt="Xu Yong 支付宝"><p>支付宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者：</strong>Xu Yong<i class="ic i-at"><em>@</em></i>LinuxSre云原生</li><li class="link"><strong>本文链接：</strong><a href="http://ixuyong.cn/posts/4120829732.html" title="DNS域名解析服务">http://ixuyong.cn/posts/4120829732.html</a></li><li class="license"><strong>版权声明：</strong>本站所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/posts/3327248306.html" rel="prev" itemprop="url" data-background-image="https:&#x2F;&#x2F;wp-cdn.4ce.cn&#x2F;v2&#x2F;SDKfGrH.jpeg" title="Firewalld防火墙实战"><span class="type">上一篇</span><span class="category"><i class="ic i-flag"></i>Iptables</span><h3>Firewalld防火墙实战</h3></a></div><div class="item right"><a href="/posts/1361162481.html" rel="next" itemprop="url" data-background-image="https:&#x2F;&#x2F;wp-cdn.4ce.cn&#x2F;v2&#x2F;c6AyizL.jpeg" title="Shell脚本基础与变量"><span class="type">下一篇</span><span class="category"><i class="ic i-flag"></i>Shell</span><h3>Shell脚本基础与变量</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#dns%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.</span> <span class="toc-text">DNS 域名解析服务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-dns%E5%9F%BA%E6%9C%AC%E6%A6%82%E8%BF%B0"><span class="toc-number">1.1.</span> <span class="toc-text">1. DNS 基本概述</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#11-%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E5%9F%9F%E5%90%8D"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.1 为什么需要域名</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#12-%E4%BB%80%E4%B9%88%E6%98%AFdns"><span class="toc-number">1.1.2.</span> <span class="toc-text">1.2 什么是 DNS</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#13-dns%E5%9F%9F%E5%90%8D%E7%BB%93%E6%9E%84"><span class="toc-number">1.1.3.</span> <span class="toc-text">1.3 DNS 域名结构</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#14-%E5%9F%9F%E5%90%8D%E5%88%86%E7%B1%BB"><span class="toc-number">1.1.4.</span> <span class="toc-text">1.4 域名分类</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#15-dns%E6%9F%A5%E8%AF%A2%E5%8E%9F%E7%90%86"><span class="toc-number">1.1.5.</span> <span class="toc-text">1.5 DNS 查询原理</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#151-%E9%80%92%E5%BD%92%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.1.5.1.</span> <span class="toc-text">1.5.1 递归查询</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#152-%E8%BF%AD%E4%BB%A3%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.1.5.2.</span> <span class="toc-text">1.5.2 迭代查询</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#16-dns%E8%A7%A3%E6%9E%90%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.1.6.</span> <span class="toc-text">1.6 DNS 解析类型</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#161-a"><span class="toc-number">1.1.6.1.</span> <span class="toc-text">1.6.1 A</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#162-ptr"><span class="toc-number">1.1.6.2.</span> <span class="toc-text">1.6.2 PTR</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#163-cname"><span class="toc-number">1.1.6.3.</span> <span class="toc-text">1.6.3 CNAME</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#164-ns"><span class="toc-number">1.1.6.4.</span> <span class="toc-text">1.6.4 NS</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#165-mx"><span class="toc-number">1.1.6.5.</span> <span class="toc-text">1.6.5 MX</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#17-%E4%BC%81%E4%B8%9A%E8%87%AA%E5%BB%BAdns%E6%96%B9%E5%BC%8F"><span class="toc-number">1.1.7.</span> <span class="toc-text">1.7 企业自建 DNS 方式</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-bind%E5%9F%BA%E7%A1%80%E5%BA%94%E7%94%A8"><span class="toc-number">1.2.</span> <span class="toc-text">2. BIND 基础应用</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#21-%E4%BB%80%E4%B9%88%E6%98%AFbind"><span class="toc-number">1.2.1.</span> <span class="toc-text">2.1 什么是 BIND</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#22-bind%E7%9A%84%E7%BB%84%E6%88%90"><span class="toc-number">1.2.2.</span> <span class="toc-text">2.2 BIND 的组成</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#23-bind%E6%9C%8D%E5%8A%A1%E5%AE%9E%E6%88%98"><span class="toc-number">1.2.3.</span> <span class="toc-text">2.3 BIND 服务实战</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#231-bind%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">2.3.1 BIND 环境准备</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#232-bind%E6%9C%8D%E5%8A%A1%E5%AE%89%E8%A3%85"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">2.3.2 BIND 服务安装</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#233-bind%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.2.3.3.</span> <span class="toc-text">2.3.3 BIND 配置文件</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#234-%E5%AE%A2%E6%88%B7%E7%AB%AF%E9%AA%8C%E8%AF%81dns%E8%A7%A3%E6%9E%90%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc-number">1.2.3.4.</span> <span class="toc-text">2.3.4 客户端验证 DNS 解析的配置</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#24-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8C%BA%E5%9F%9F"><span class="toc-number">1.2.4.</span> <span class="toc-text">2.4 自定义区域</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#241-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8C%BA%E5%9F%9F%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%90"><span class="toc-number">1.2.4.1.</span> <span class="toc-text">2.4.1 自定义区域配置文件解析</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#242-%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8C%BA%E5%9F%9F%E6%95%B0%E6%8D%AE%E5%BA%93%E6%96%87%E4%BB%B6"><span class="toc-number">1.2.4.2.</span> <span class="toc-text">2.4.2 自定义区域数据库文件</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#25-bind%E5%A2%9E%E5%8A%A0a%E8%AE%B0%E5%BD%95%E6%AD%A3%E5%90%91%E8%A7%A3%E6%9E%90%E5%AE%9E%E6%88%98"><span class="toc-number">1.2.5.</span> <span class="toc-text">2.5 BIND 增加 A 记录正向解析实战</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#251-%E6%96%B0%E5%A2%9E%E5%8C%BA%E5%9F%9F%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.2.5.1.</span> <span class="toc-text">2.5.1 新增区域配置文件</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#252-%E6%96%B0%E5%A2%9E%E5%8C%BA%E5%9F%9F%E6%95%B0%E6%8D%AE%E5%BA%93%E6%96%87%E4%BB%B6"><span class="toc-number">1.2.5.2.</span> <span class="toc-text">2.5.2 新增区域数据库文件</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#253-%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%B5%8B%E8%AF%95%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90"><span class="toc-number">1.2.5.3.</span> <span class="toc-text">2.5.3 客户端测试域名解析</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#26-bind%E5%A2%9E%E5%8A%A0cname%E8%AE%B0%E5%BD%95%E5%AE%9E%E6%88%98"><span class="toc-number">1.2.6.</span> <span class="toc-text">2.6 BIND 增加 CNAME 记录实战</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#261-%E6%96%B0%E5%A2%9E%E5%8C%BA%E5%9F%9F%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.2.6.1.</span> <span class="toc-text">2.6.1 新增区域配置文件</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#262-%E6%96%B0%E5%A2%9E%E5%8C%BA%E5%9F%9F%E6%95%B0%E6%8D%AE%E5%BA%93%E6%96%87%E4%BB%B6"><span class="toc-number">1.2.6.2.</span> <span class="toc-text">2.6.2 新增区域数据库文件</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#263-%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%B5%8B%E8%AF%95%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90"><span class="toc-number">1.2.6.3.</span> <span class="toc-text">2.6.3 客户端测试域名解析</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#27-bind%E5%A2%9E%E5%8A%A0ptr%E8%AE%B0%E5%BD%95%E5%8F%8D%E5%90%91%E8%A7%A3%E6%9E%90%E5%AE%9E%E6%88%98"><span class="toc-number">1.2.7.</span> <span class="toc-text">2.7 BIND 增加 PTR 记录反向解析实战</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#271-%E6%96%B0%E5%A2%9E%E5%8C%BA%E5%9F%9F%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">1.2.7.1.</span> <span class="toc-text">2.7.1 新增区域配置文件</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#272-%E6%96%B0%E5%A2%9E%E5%8C%BA%E5%9F%9F%E6%95%B0%E6%8D%AE%E5%BA%93%E6%96%87%E4%BB%B6"><span class="toc-number">1.2.7.2.</span> <span class="toc-text">2.7.2 新增区域数据库文件</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#273-%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%B5%8B%E8%AF%95%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90"><span class="toc-number">1.2.7.3.</span> <span class="toc-text">2.7.3 客户端测试域名解析</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E9%80%92%E5%BD%92%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.3.</span> <span class="toc-text">3. 递归查询</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#31-%E4%BB%80%E4%B9%88%E6%98%AF%E9%80%92%E5%BD%92%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.3.1.</span> <span class="toc-text">3.1 什么是递归查询</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#32-%E9%80%92%E5%BD%92%E6%9F%A5%E8%AF%A2%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0"><span class="toc-number">1.3.2.</span> <span class="toc-text">3.2 递归查询配置参数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#33-%E9%80%92%E5%BD%92%E6%9F%A5%E8%AF%A2%E9%85%8D%E7%BD%AE%E5%9C%BA%E6%99%AF"><span class="toc-number">1.3.3.</span> <span class="toc-text">3.3 递归查询配置场景</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#331-%E5%BC%80%E5%90%AF%E9%80%92%E5%BD%92%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">3.3.1 开启递归查询</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#332-%E5%85%B3%E9%97%AD%E9%80%92%E5%BD%92%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.3.3.2.</span> <span class="toc-text">3.3.2 关闭递归查询</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-dns%E4%B8%BB%E8%BE%85%E5%90%8C%E6%AD%A5"><span class="toc-number">1.4.</span> <span class="toc-text">4. DNS 主辅同步</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#41-dns%E4%B8%BB%E8%BE%85%E5%90%8C%E6%AD%A5%E6%A6%82%E5%BF%B5"><span class="toc-number">1.4.1.</span> <span class="toc-text">4.1 DNS 主辅同步概念</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#42-dns%E4%B8%BB%E4%BB%8E%E5%90%8C%E6%AD%A5%E5%8E%9F%E7%90%86"><span class="toc-number">1.4.2.</span> <span class="toc-text">4.2 DNS 主从同步原理</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#43-dns%E4%B8%BB%E4%BB%8E%E5%90%8C%E6%AD%A5%E5%9C%BA%E6%99%AF"><span class="toc-number">1.4.3.</span> <span class="toc-text">4.3 DNS 主从同步场景</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#431-%E4%B8%BB%E4%BB%8E%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">1.4.3.1.</span> <span class="toc-text">4.3.1 主从环境准备</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#432-%E4%B8%BB%E8%BE%85%E5%90%8C%E6%AD%A5%E9%85%8D%E7%BD%AE%E8%A6%81%E7%82%B9"><span class="toc-number">1.4.3.2.</span> <span class="toc-text">4.3.2 主辅同步配置要点</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#433-master%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc-number">1.4.3.3.</span> <span class="toc-text">4.3.3 Master 服务器的配置</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#434-slave%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc-number">1.4.3.4.</span> <span class="toc-text">4.3.4 Slave 服务器的配置</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#435-%E6%B5%8B%E8%AF%95%E4%B8%BB%E8%BE%85%E8%A7%A3%E6%9E%90"><span class="toc-number">1.4.3.5.</span> <span class="toc-text">4.3.5 测试主辅解析</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-dns%E5%AD%90%E5%9F%9F%E6%8E%88%E6%9D%83%E9%85%8D%E7%BD%AE"><span class="toc-number">1.5.</span> <span class="toc-text">5. DNS 子域授权配置</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#51-%E4%BB%80%E4%B9%88%E6%98%AFdns%E5%AD%90%E5%9F%9F%E6%8E%88%E6%9D%83"><span class="toc-number">1.5.1.</span> <span class="toc-text">5.1 什么是 DNS 子域授权</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#52-dns%E5%AD%90%E5%9F%9F%E6%8E%88%E6%9D%83%E7%8E%AF%E5%A2%83"><span class="toc-number">1.5.2.</span> <span class="toc-text">5.2 DNS 子域授权环境</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#53-dns%E5%AD%90%E5%9F%9F%E6%8E%88%E6%9D%83%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc-number">1.5.3.</span> <span class="toc-text">5.3 DNS 子域授权的配置</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#531-dns-master%E7%88%B6%E5%9F%9F%E9%85%8D%E7%BD%AE"><span class="toc-number">1.5.3.1.</span> <span class="toc-text">5.3.1 DNS Master 父域配置</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#532-dns%E5%AD%90%E5%9F%9F%E9%85%8D%E7%BD%AEother"><span class="toc-number">1.5.3.2.</span> <span class="toc-text">5.3.2 DNS 子域配置 (Other)</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#533-%E9%AA%8C%E8%AF%81%E7%BB%93%E6%9E%9C"><span class="toc-number">1.5.3.3.</span> <span class="toc-text">5.3.3 验证结果</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-dns%E8%BD%AC%E5%8F%91%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.6.</span> <span class="toc-text">6. DNS 转发模式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#61-%E4%BB%80%E4%B9%88%E6%98%AFdns%E8%BD%AC%E5%8F%91"><span class="toc-number">1.6.1.</span> <span class="toc-text">6.1 什么是 DNS 转发</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#62-dns%E8%BD%AC%E5%8F%91%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.6.2.</span> <span class="toc-text">6.2 DNS 转发示例</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#63-dns%E5%8C%BA%E5%9F%9F%E8%BD%AC%E5%8F%91%E5%AE%9E%E8%B7%B5"><span class="toc-number">1.6.3.</span> <span class="toc-text">6.3 DNS 区域转发实践</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-%E6%99%BA%E8%83%BDdns%E6%A6%82%E8%BF%B0"><span class="toc-number">1.7.</span> <span class="toc-text">7. 智能 DNS 概述</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#71-%E4%BB%80%E4%B9%88%E6%98%AF%E6%99%BA%E8%83%BDdns"><span class="toc-number">1.7.1.</span> <span class="toc-text">7.1 什么是智能 DNS</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#72-%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0%E6%99%BA%E8%83%BDdns"><span class="toc-number">1.7.2.</span> <span class="toc-text">7.2 如何实现智能 DNS</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#721-acl%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6%E5%88%97%E8%A1%A8"><span class="toc-number">1.7.2.1.</span> <span class="toc-text">7.2.1 ACL 访问控制列表</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#722-view%E8%A7%86%E5%9B%BE%E5%8A%9F%E8%83%BD"><span class="toc-number">1.7.2.2.</span> <span class="toc-text">7.2.2 VIEW 视图功能</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#73-%E6%99%BA%E8%83%BDdns%E5%9C%BA%E6%99%AF%E5%AE%9E%E6%88%98"><span class="toc-number">1.7.3.</span> <span class="toc-text">7.3 智能 DNS 场景实战</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#731-%E5%AE%9A%E4%B9%89acl%E8%A7%84%E5%88%99"><span class="toc-number">1.7.3.1.</span> <span class="toc-text">7.3.1 定义 ACL 规则</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#732-%E5%AE%9A%E4%B9%89view%E8%A7%86%E5%9B%BE"><span class="toc-number">1.7.3.2.</span> <span class="toc-text">7.3.2 定义 VIEW 视图</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#733-%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83zone%E7%94%B5%E4%BF%A1"><span class="toc-number">1.7.3.3.</span> <span class="toc-text">7.3.3 测试环境 zone (电信)</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#734-%E7%94%9F%E4%BA%A7%E7%8E%AF%E5%A2%83zone%E8%81%94%E9%80%9A"><span class="toc-number">1.7.3.4.</span> <span class="toc-text">7.3.4 生产环境 zone (联通)</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#735-%E6%B7%BB%E5%8A%A0%E9%BB%98%E8%AE%A4zone"><span class="toc-number">1.7.3.5.</span> <span class="toc-text">7.3.5 添加默认 zone</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#736-%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%B5%8B%E8%AF%95"><span class="toc-number">1.7.3.6.</span> <span class="toc-text">7.3.6 客户端测试</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#74-%E6%99%BA%E8%83%BDdns%E4%B8%BB%E4%BB%8E%E5%9C%BA%E6%99%AF%E5%AE%9E%E8%B7%B5"><span class="toc-number">1.7.4.</span> <span class="toc-text">7.4 智能 DNS 主从场景实践</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#741-%E7%94%9F%E6%88%90tsig-key"><span class="toc-number">1.7.4.1.</span> <span class="toc-text">7.4.1 生成 TSIG-KEY</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#742-master-dns%E9%85%8D%E7%BD%AE"><span class="toc-number">1.7.4.2.</span> <span class="toc-text">7.4.2 Master DNS 配置</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#743-slave-dns%E9%85%8D%E7%BD%AE"><span class="toc-number">1.7.4.3.</span> <span class="toc-text">7.4.3 Slave DNS 配置</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#744-%E9%AA%8C%E8%AF%81%E7%BB%93%E6%9E%9C"><span class="toc-number">1.7.4.4.</span> <span class="toc-text">7.4.4 验证结果</span></a></li></ol></li></ol></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/posts/581151773.html" rel="bookmark" title="100个运维相关技术官网汇总">100个运维相关技术官网汇总</a></li><li><a href="/posts/2260957686.html" rel="bookmark" title="Linux—Centos7修改网卡名称">Linux—Centos7修改网卡名称</a></li><li><a href="/posts/2508697220.html" rel="bookmark" title="Chrony时间同步服务">Chrony时间同步服务</a></li><li><a href="/posts/430579059.html" rel="bookmark" title="NFS网络文件系统">NFS网络文件系统</a></li><li><a href="/posts/1922841233.html" rel="bookmark" title="Rsync服务实践">Rsync服务实践</a></li><li><a href="/posts/269104229.html" rel="bookmark" title="Samba服务实践">Samba服务实践</a></li><li><a href="/posts/2889248111.html" rel="bookmark" title="Vsftp服务实践">Vsftp服务实践</a></li><li class="active"><a href="/posts/4120829732.html" rel="bookmark" title="DNS域名解析服务">DNS域名解析服务</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" loading="lazy" decoding="async" itemprop="image" alt="Xu Yong" src="/assets/avatar.png"><p class="name" itemprop="name">Xu Yong</p><div class="description" itemprop="description">专注于 Linux 运维、云计算、云原⽣等技术</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">72</span><span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">18</span><span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">21</span><span class="name">标签</span></a></div></nav><div class="social"><a target="_blank" rel="noopener" href="https://github.com/xyapples" class="item github" title="https:&#x2F;&#x2F;github.com&#x2F;xyapples"><i class="ic i-github"></i></a><a target="_blank" rel="noopener" href="https://gitee.com/chinagei" class="item gitee" title="https:&#x2F;&#x2F;gitee.com&#x2F;chinagei"><i class="ic i-gitee"></i></a><a href="mailto:373370405@qq.com" class="item email" title="mailto:373370405@qq.com"><i class="ic i-envelope"></i></a></div><div class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-about"></i>关于</a></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友链</a></li></div></div></div></div><ul id="quick"><li class="prev pjax"><a href="/posts/1361162481.html" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/posts/3327248306.html" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/Kubernetes/" title="分类于Kubernetes">Kubernetes</a></div><span><a href="/posts/170573601.html">K8s服务发布Ingress</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Nginx/" title="分类于Nginx">Nginx</a></div><span><a href="/posts/2279050448.html">Nginx代理-动静分离(九)</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Redis/" title="分类于Redis">Redis</a></div><span><a href="/posts/1414180692.html">Redis集群（主从+哨兵）模式</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Kubernetes/" title="分类于Kubernetes">Kubernetes</a></div><span><a href="/posts/3890389502.html">K8S持久化存储NFS+StorageClass</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/DevOps/" title="分类于DevOps">DevOps</a></div><span><a href="/posts/889219339.html">K8S基于Jenkins实现SpringCloud微服务CI与CD实践（三）</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Iptables/" title="分类于Iptables">Iptables</a></div><span><a href="/posts/3327248306.html">Firewalld防火墙实战</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Nginx/" title="分类于Nginx">Nginx</a></div><span><a href="/posts/2322410227.html">Nginx负载均衡会话共享（六）</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Linux/" title="分类于Linux">Linux</a></div><span><a href="/posts/4120829732.html">DNS域名解析服务</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Windows/" title="分类于Windows">Windows</a></div><span><a href="/posts/3071070979.html">一键永久激活Window、office教程</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Linux/" title="分类于Linux">Linux</a></div><span><a href="/posts/1922841233.html">Rsync服务实践</a></span></li></ul></div><div class="rpost pjax"><h2>最新评论</h2><ul class="leancloud-recent-comment" id="new-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2022 -<span itemprop="copyrightYear">2025</span><span class="with-love"><i class="ic i-sakura rotate"></i></span><span class="author" itemprop="copyrightHolder">Xu Yong @ LinuxSre云原生</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i></span><span title="站点总字数">1.8m 字</span><span class="post-meta-divider"> | </span><span class="post-meta-item-icon"><i class="ic i-coffee"></i></span><span title="站点阅读时长">28:01</span></div><div class="powered-by">基于 <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> & Theme.<a target="_blank" rel="noopener" href="https://github.com/theme-shoka-x/hexo-theme-shokaX/">ShokaX</a></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL = {
    ispost: true,
        path: `posts/4120829732.html`,
        favicon: {
        show: `（●´3｀●）やれやれだぜ`,
        hide: `(´Д｀)大変だ！`
    },
    search: {
        placeholder: "文章搜索",
        empty: "关于 「 ${query} 」，什么也没搜到",
        stats: "${time} ms 内找到 ${hits} 条结果"
    },
    copy_tex: false,
    katex: false,
    mermaid: false,
    audio: undefined,
    fancybox: true,
    nocopy: false,
    outime: true,
    template: `<div class="note warning"><p><span class="label warning">文章时效性提示</span><br>这是一篇发布于 {{publish}} 天前，最后一次更新在 {{updated}} 天前的文章，部分信息可能已经发生改变，请注意甄别。</p></div>`,
    quiz: {
        choice: `单选题`,
        multiple: `多选题`,
        true_false: `判断题`,
        essay: `问答题`,
        gap_fill: `填空题`,
        mistake: `错题备注`
    },
    ignores: [
        (uri) => uri.includes('#'),
        (uri) => new RegExp(LOCAL.path + '$').test(uri),
            []
    ]
};</script><script src="https://s4.zstatic.net/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha384-k6YtvFUEIuEFBdrLKJ3YAUbBki333tj1CSUisai5Cswsg9wcLNaPzsTHDswp4Az8" crossorigin="anonymous" fetchpriority="high"></script><script src="https://s4.zstatic.net/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha384-ZvpUoO&#x2F;+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn&#x2F;6Z&#x2F;hRTt8+pR6L4N2" crossorigin="anonymous" fetchpriority="high"></script><script src="/js/siteInit.js?v=0.4.17" type="module" fetchpriority="high" defer></script></body></html><!-- rebuild by hrmmi -->