<!-- build time:Sun Jul 27 2025 22:07:44 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta http-equiv="X-UA-COMPATIBLE" content="IE=edge,chrome=1"><meta name="renderer" content="webkit"><link rel="icon" type="image/ico" sizes="32x32" href="/assets/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/assets/favicon.ico"><link rel="alternate" href="/rss.xml" title="LinuxSre云原生" type="application/rss+xml"><link rel="alternate" href="/atom.xml" title="LinuxSre云原生" type="application/atom+xml"><link rel="alternate" type="application/json" title="LinuxSre云原生" href="http://ixuyong.cn/feed.json"><link rel="preconnect" href="https://s4.zstatic.net"><link rel="preconnect" href="https://at.alicdn.com"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7CFredericka%20the%20Great:400,400italic,700,700italic%7CNoto%20Serif%20JP:400,400italic,700,700italic%7CNoto%20Serif%20SC:400,400italic,700,700italic%7CInconsolata:400,400italic,700,700italic&display=swap&subset=latin,latin-ext" media="none" onload="this.media&#x3D;&#39;all&#39;"><link rel="stylesheet" href="/css/app.css?v=0.4.17"><link rel="modulepreload" href="/js/chunk-GV364XSK.js"><link rel="modulepreload" href="/js/chunk-NYSE5UKM.js"><link rel="modulepreload" href="/js/chunk-RONCYO2S.js"><link rel="modulepreload" href="/js/chunk-THHXCRSX.js"><link rel="modulepreload" href="/js/chunk-WIQECBEN.js"><link rel="modulepreload" href="/js/comments-DL2IYMPZ.js"><link rel="modulepreload" href="/js/copy-tex-NADCTXPG.js"><link rel="modulepreload" href="/js/post-DA635IH6.js"><link rel="modulepreload" href="/js/quicklink-WEDHL4BA.js"><link rel="modulepreload" href="/js/search-VCZRKTM5.js"><link rel="modulepreload" href="/js/siteInit.js"><link rel="modulepreload" href="/js/waline-NNBYRQEE.js"><link rel="stylesheet" href="/css/comments-F4ZGS7LD.css" media="none" onload="this.media&#x3D;&#39;all&#39;"><link rel="stylesheet" href="/css/siteInit.css" media="none" onload="this.media&#x3D;&#39;all&#39;"><link rel="stylesheet" href="/css/waline-IDNZKML2.css" media="none" onload="this.media&#x3D;&#39;all&#39;"><link rel="preload" href="https://s21.ax1x.com/2025/03/29/pEsS0hD.png" as="image" fetchpriority="high"><meta name="keywords" content="Tomcat"><meta name="description" content="专注于 Linux 运维、云计算、云原⽣等技术"><link rel="canonical" href="http://ixuyong.cn/posts/4201058646.html"><title>Tomcat配置管理实践</title><meta name="generator" content="Hexo 7.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">Tomcat配置管理实践</h1><div class="meta"><span class="item" title="创建时间：2025-06-08 10:51:48"><span class="icon"><i class="ic i-calendar"></i></span><span class="text">发表于</span><time itemprop="dateCreated datePublished" datetime="2025-06-08T10:51:48+08:00">2025-06-08</time></span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i></span><span class="text">本文字数</span><span>20k</span><span class="text">字</span></span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i></span><span class="text">阅读时长</span><span>18 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span><span class="line"></span><span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">LinuxSre云原生</a></li></ul><ul class="right" id="rightNav"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div class="pjax" id="imgs"><img src="https://s21.ax1x.com/2025/03/29/pEsS0hD.png" loading="eager" decoding="async" fetchpriority="high" alt="LinuxSre云原生"></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"></path></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"></use><use xlink:href="#gentle-wave" x="48" y="3"></use><use xlink:href="#gentle-wave" x="48" y="5"></use><use xlink:href="#gentle-wave" x="48" y="7"></use></g></svg></div><main><div class="inner"><div class="pjax" id="main"><div class="article wrap"><div class="breadcrumb" itemlistelement itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i><span><a href="/">首页</a></span><i class="ic i-angle-right"></i><span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/Tomcat/" itemprop="item" rel="index" title="分类于Tomcat"><span itemprop="name">Tomcat<meta itemprop="position" content="0"></span></a></span></div><article class="post block" itemscope itemtype="http://schema.org/Article" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://ixuyong.cn/posts/4201058646.html"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/assets/avatar.png"><meta itemprop="name" content="Xu Yong"><meta itemprop="description" content="致力于技术布道、普及前沿技术、打造云原生系列标杆博客, 专注于 Linux 运维、云计算、云原⽣等技术"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="LinuxSre云原生"></span><div class="body md" itemprop="articleBody"><h3 id="tomcat配置管理实践"><a class="anchor" href="#tomcat配置管理实践">#</a> Tomcat 配置管理实践</h3><h4 id="一-oraclejdk安装"><a class="anchor" href="#一-oraclejdk安装">#</a> 一、OracleJdk 安装</h4><p>OracleJdk 下载地址：<a target="_blank" rel="noopener" href="https://www.oracle.com/java/technologies/downloads/#java8">https://www.oracle.com/java/technologies/downloads/#java8</a></p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@web01 ~<span class="token punctuation">]</span><span class="token comment"># tar xf jdk-8u451-linux-x64.tar.gz -C /usr/local</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@web01 ~<span class="token punctuation">]</span><span class="token comment"># ln -s /usr/local/jdk1.8.0_451/ /usr/local/jdk</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">#添加环境变量</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">[</span>root@web01 ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/profile.d/jdk.sh</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/usr/local/jdk</pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$JAVA_HOME</span>/bin</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token builtin class-name">export</span> <span class="token assign-left variable">JRE_HOME</span><span class="token operator">=</span><span class="token variable">$JAVA_HOME</span>/jre </pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token builtin class-name">export</span> <span class="token assign-left variable">CLASSPATH</span><span class="token operator">=</span><span class="token variable">$JAVA_HOME</span>/lib/:<span class="token variable">$JRE_HOME</span>/lib/</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">[</span>root@web01 ~<span class="token punctuation">]</span><span class="token comment"># source /etc/profile</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">[</span>root@web01 ~<span class="token punctuation">]</span><span class="token comment"># java -version</span></pre></td></tr></table></figure><h4 id="二-tomcat安装"><a class="anchor" href="#二-tomcat安装">#</a> 二、Tomcat 安装</h4><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@web01 ~<span class="token punctuation">]</span><span class="token comment"># mkdir /soft &amp;&amp; cd /soft</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@web01 soft<span class="token punctuation">]</span><span class="token comment"># wget https://dlcdn.apache.org/tomcat/tomcat-9/v9.0.106/bin/apache-tomcat-9.0.106.tar.gz</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@web01 soft<span class="token punctuation">]</span><span class="token comment"># tar xf apache-tomcat-9.0.106.tar.gz -C /soft</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">[</span>root@web01 soft<span class="token punctuation">]</span><span class="token comment"># ln -s /soft/apache-tomcat-9.0.106 /soft/tomcat</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">[</span>root@web01 soft<span class="token punctuation">]</span><span class="token comment"># /soft/tomcat/bin/startup.sh</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">[</span>root@web01 soft<span class="token punctuation">]</span><span class="token comment"># netstat -lntp|grep java</span></pre></td></tr><tr><td data-num="7"></td><td><pre>tcp6       <span class="token number">0</span>      <span class="token number">0</span> :::8080                 :::*                    LISTEN      <span class="token number">1765</span>/java           </pre></td></tr><tr><td data-num="8"></td><td><pre>tcp6       <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">127.0</span>.0.1:8005          :::*                    LISTEN      <span class="token number">1765</span>/javaa</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token comment">#Tomcat 启停配置文件</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">[</span>root@web01 soft<span class="token punctuation">]</span><span class="token comment"># cat /usr/lib/systemd/system/tomcat.service</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment"># /usr/lib/systemd/system/tomcat.service</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">[</span>Unit<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token assign-left variable">Description</span><span class="token operator">=</span>Apache Tomcat</pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token assign-left variable">After</span><span class="token operator">=</span>network.target</pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">[</span>Service<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token assign-left variable">Type</span><span class="token operator">=</span>forking</pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token assign-left variable">Environment</span><span class="token operator">=</span>JAVA_HOME<span class="token operator">=</span>/usr/local/jdk</pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token assign-left variable">Environment</span><span class="token operator">=</span>CATALINA_HOME<span class="token operator">=</span>/soft/tomcat</pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token assign-left variable">Environment</span><span class="token operator">=</span>CATALINA_BASE<span class="token operator">=</span>/soft/tomcat</pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/soft/tomcat/bin/startup.sh</pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token assign-left variable">ExecStop</span><span class="token operator">=</span>/soft/tomcat/bin/shutdown.sh</pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token punctuation">[</span>Install<span class="token punctuation">]</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>multi-user.target</pre></td></tr><tr><td data-num="28"></td><td><pre></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token punctuation">[</span>root@web01 soft<span class="token punctuation">]</span><span class="token comment"># systemctl daemon-reload</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token punctuation">[</span>root@web01 soft<span class="token punctuation">]</span><span class="token comment"># systemctl stop tomcat      </span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token punctuation">[</span>root@web01 soft<span class="token punctuation">]</span><span class="token comment"># systemctl start tomcat</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token punctuation">[</span>root@web01 ~<span class="token punctuation">]</span><span class="token comment"># netstat -lntp|grep java</span></pre></td></tr><tr><td data-num="33"></td><td><pre>tcp6       <span class="token number">0</span>      <span class="token number">0</span> :::8080                 :::*                    LISTEN      <span class="token number">1842</span>/java           </pre></td></tr><tr><td data-num="34"></td><td><pre>tcp6       <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">127.0</span>.0.1:8005          :::*                    LISTEN      <span class="token number">1842</span>/java</pre></td></tr></table></figure><p><img loading="lazy" data-src="https://wp-cdn.4ce.cn/v2/Vc1v1lK.jpeg" alt="Snipaste_2025-06-14_14-57-42.jpg"></p><h4 id="三-tomcat配置"><a class="anchor" href="#三-tomcat配置">#</a> 三、Tomcat 配置</h4><h5 id="31-tomcat目录结构"><a class="anchor" href="#31-tomcat目录结构">#</a> 3.1 Tomcat 目录结构</h5><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>bin		：  二进制可执行（脚本文件 windwos版bat、linux版sh）</pre></td></tr><tr><td data-num="2"></td><td><pre>conf	：  配置文件，主配置是server.xml</pre></td></tr><tr><td data-num="3"></td><td><pre>lib		：  都是一些java语言编写的jar包，这些都需要被调用，才能执行； module （jar、war）</pre></td></tr><tr><td data-num="4"></td><td><pre>logs	：  tomcat的日志存放位置，可修改；</pre></td></tr><tr><td data-num="5"></td><td><pre>temp	：  tomcat的临时目录；</pre></td></tr><tr><td data-num="6"></td><td><pre>webapps ：  相当于nginx中  root /soft/tomcat/webapps/     /soft/tomcat/webapps/ROOT</pre></td></tr><tr><td data-num="7"></td><td><pre>work	<span class="token builtin class-name">:</span>   tomcat的一个缓存目录；（java代码，编译为class字节码对外提供；）</pre></td></tr></table></figure><h5 id="32-tomcat配置文件说明"><a class="anchor" href="#32-tomcat配置文件说明">#</a> 3.2 Tomcat 配置文件说明</h5><ul><li>server：表示一个 tomcat 实例；</li><li>Listener：监听器；</li><li>connector：连接器，支持 http、https、ajp 等协议请求；</li><li>service：将 connector 与 engine 关联的组件；</li><li>engine：具体 http、https 的请求与响应； （Nginx 中 http {}）</li><li>host：与用户请求的 Host 字段进行比对；哪个 Host 匹配则哪个处理，如没有符合的则交给默认的 defaultHost 处理</li></ul><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@web01 soft<span class="token punctuation">]</span><span class="token comment"># cat /soft/tomcat/conf/server.xml</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">&lt;</span>?xml <span class="token assign-left variable">version</span><span class="token operator">=</span><span class="token string">"1.0"</span> <span class="token assign-left variable">encoding</span><span class="token operator">=</span><span class="token string">"UTF-8"</span>?<span class="token operator">></span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">&lt;</span><span class="token operator">!</span>--关闭tomcat的端口--<span class="token operator">></span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">&lt;</span>Server <span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token string">"8005"</span> <span class="token assign-left variable">shutdown</span><span class="token operator">=</span><span class="token string">"SHUTDOWN"</span><span class="token operator">></span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token operator">&lt;</span><span class="token operator">!</span>--监听器 --<span class="token operator">></span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token operator">&lt;</span>Listener <span class="token assign-left variable">className</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.startup.VersionLoggerListener"</span> /<span class="token operator">></span></pre></td></tr><tr><td data-num="9"></td><td><pre>  <span class="token operator">&lt;</span>Listener <span class="token assign-left variable">className</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.core.AprLifecycleListener"</span> <span class="token assign-left variable">SSLEngine</span><span class="token operator">=</span><span class="token string">"on"</span> /<span class="token operator">></span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token operator">&lt;</span>Listener <span class="token assign-left variable">className</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.core.JreMemoryLeakPreventionListener"</span> /<span class="token operator">></span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token operator">&lt;</span>Listener <span class="token assign-left variable">className</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.mbeans.GlobalResourcesLifecycleListener"</span> /<span class="token operator">></span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token operator">&lt;</span>Listener <span class="token assign-left variable">className</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.core.ThreadLocalLeakPreventionListener"</span> /<span class="token operator">></span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>  <span class="token operator">&lt;</span><span class="token operator">!</span>--全局资源限制--<span class="token operator">></span></pre></td></tr><tr><td data-num="15"></td><td><pre>  <span class="token operator">&lt;</span>GlobalNamingResources<span class="token operator">></span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token operator">&lt;</span>Resource <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"UserDatabase"</span> <span class="token assign-left variable">auth</span><span class="token operator">=</span><span class="token string">"Container"</span></pre></td></tr><tr><td data-num="17"></td><td><pre>              <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.UserDatabase"</span></pre></td></tr><tr><td data-num="18"></td><td><pre>              <span class="token assign-left variable">description</span><span class="token operator">=</span><span class="token string">"User database that can be updated and saved"</span></pre></td></tr><tr><td data-num="19"></td><td><pre>              <span class="token assign-left variable">factory</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.users.MemoryUserDatabaseFactory"</span></pre></td></tr><tr><td data-num="20"></td><td><pre>              <span class="token assign-left variable">pathname</span><span class="token operator">=</span><span class="token string">"conf/tomcat-users.xml"</span> /<span class="token operator">></span></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token operator">&lt;</span>/GlobalNamingResources<span class="token operator">></span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre>  <span class="token operator">&lt;</span><span class="token operator">!</span>--连接器--<span class="token operator">></span></pre></td></tr><tr><td data-num="24"></td><td><pre>  <span class="token operator">&lt;</span>Service <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"Catalina"</span><span class="token operator">></span></pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token operator">&lt;</span>Connector <span class="token assign-left variable">port</span><span class="token operator">=</span><span class="token string">"8080"</span> <span class="token assign-left variable">protocol</span><span class="token operator">=</span><span class="token string">"HTTP/1.1"</span></pre></td></tr><tr><td data-num="26"></td><td><pre>               <span class="token assign-left variable">connectionTimeout</span><span class="token operator">=</span><span class="token string">"20000"</span></pre></td></tr><tr><td data-num="27"></td><td><pre>               <span class="token assign-left variable">redirectPort</span><span class="token operator">=</span><span class="token string">"8443"</span> /<span class="token operator">></span></pre></td></tr><tr><td data-num="28"></td><td><pre></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre>    <span class="token operator">&lt;</span><span class="token operator">!</span>--引擎--<span class="token operator">></span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token operator">&lt;</span>Engine <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"Catalina"</span> <span class="token assign-left variable">defaultHost</span><span class="token operator">=</span><span class="token string">"localhost"</span><span class="token operator">></span></pre></td></tr><tr><td data-num="32"></td><td><pre></pre></td></tr><tr><td data-num="33"></td><td><pre>	<span class="token operator">&lt;</span><span class="token operator">!</span>--调用限制--<span class="token operator">></span></pre></td></tr><tr><td data-num="34"></td><td><pre>      <span class="token operator">&lt;</span>Realm <span class="token assign-left variable">className</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.realm.LockOutRealm"</span><span class="token operator">></span></pre></td></tr><tr><td data-num="35"></td><td><pre>        <span class="token operator">&lt;</span>Realm <span class="token assign-left variable">className</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.realm.UserDatabaseRealm"</span></pre></td></tr><tr><td data-num="36"></td><td><pre>               <span class="token assign-left variable">resourceName</span><span class="token operator">=</span><span class="token string">"UserDatabase"</span>/<span class="token operator">></span></pre></td></tr><tr><td data-num="37"></td><td><pre>      <span class="token operator">&lt;</span>/Realm<span class="token operator">></span></pre></td></tr><tr><td data-num="38"></td><td><pre></pre></td></tr><tr><td data-num="39"></td><td><pre>	<span class="token operator">&lt;</span><span class="token operator">!</span>--虚拟主机--<span class="token operator">></span></pre></td></tr><tr><td data-num="40"></td><td><pre>      <span class="token operator">&lt;</span>Host <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"localhost"</span>  <span class="token assign-left variable">appBase</span><span class="token operator">=</span><span class="token string">"webapps"</span></pre></td></tr><tr><td data-num="41"></td><td><pre>            <span class="token assign-left variable">unpackWARs</span><span class="token operator">=</span><span class="token string">"true"</span> <span class="token assign-left variable">autoDeploy</span><span class="token operator">=</span><span class="token string">"true"</span><span class="token operator">></span></pre></td></tr><tr><td data-num="42"></td><td><pre>        <span class="token operator">&lt;</span>Valve <span class="token assign-left variable">className</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.valves.AccessLogValve"</span> <span class="token assign-left variable">directory</span><span class="token operator">=</span><span class="token string">"logs"</span></pre></td></tr><tr><td data-num="43"></td><td><pre>               <span class="token assign-left variable">prefix</span><span class="token operator">=</span><span class="token string">"localhost_access_log"</span> <span class="token assign-left variable">suffix</span><span class="token operator">=</span><span class="token string">".txt"</span></pre></td></tr><tr><td data-num="44"></td><td><pre>               <span class="token assign-left variable">pattern</span><span class="token operator">=</span><span class="token string">"%h %l %u %t &amp;quot;%r&amp;quot; %s %b"</span> /<span class="token operator">></span></pre></td></tr><tr><td data-num="45"></td><td><pre>      <span class="token operator">&lt;</span>/Host<span class="token operator">></span></pre></td></tr><tr><td data-num="46"></td><td><pre>    <span class="token operator">&lt;</span>/Engine<span class="token operator">></span></pre></td></tr><tr><td data-num="47"></td><td><pre>  <span class="token operator">&lt;</span>/Service<span class="token operator">></span></pre></td></tr><tr><td data-num="48"></td><td><pre><span class="token operator">&lt;</span>/Server<span class="token operator">></span></pre></td></tr></table></figure><h5 id="33tomcat请求流程"><a class="anchor" href="#33tomcat请求流程">#</a> 3.3Tomcat 请求流程</h5><p><img loading="lazy" data-src="https://wp-cdn.4ce.cn/v2/ZU2ezrN.jpeg" alt="2.jpg"></p><p>假设来自用户的请求为：<a target="_blank" rel="noopener" href="http://tomcat.hmallleasing.com:8080/index.jsp">http://tomcat.hmallleasing.com:8080/index.jsp</a></p><ul><li>1. 服务端运行 Tomcat 应用，监听在本机的 8080 端口，等待连接；</li><li>2. 浏览器发送 http 请求，并且请求服务端的 8080 端口，也就是 Tomcat 进程；</li><li>3. 服务端通过 http connector 连接器获取请求，然后通过 service 将请求交给符合条件的 engine;</li><li><a target="_blank" rel="noopener" href="http://4.xn--Enginetomcat-4l2xh11ksszesu1a.hmallleasing.com:8080/index.jsp%EF%BC%8C%E9%81%8D%E5%8E%86%E5%AE%83%E6%89%80%E6%9C%89%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BAHost;">4.Engine 获得请求 tomcat.hmallleasing.com:8080/index.jsp，遍历它所有虚拟主机 Host;</a></li><li>5. 如果 Engine 匹配不到对应的 Host，就把请求交给 Engine 中的 defaultHost 处理；</li><li>6. 如果 Engine 匹配到对应的 Host, 则提取该 Host 中指定的 appBase（代码存储路径）；</li><li>7. 最后 Engine 将解析后的结果返回给 connector，connector 返回给浏览器；</li></ul><h5 id="35-tomcat与nginx对比"><a class="anchor" href="#35-tomcat与nginx对比">#</a> 3.5 Tomcat 与 Nginx 对比</h5><p>Nginx 中：</p><ul><li>http 层：只能有一个；</li><li>server：可以有多个，多个表示多个站点；</li><li>location：一个站点的多个 uri 的路径匹配</li></ul><p>Tomcat 中：</p><ul><li>engine：只能有一个，也是负责请求与响应的；</li><li>Host： 可以有多个，多个表示多个站点；</li><li>context：用来定义用户请求的 uri，将其调度到指定的目录中提取代码；</li></ul><h5 id="36-tomcat虚拟主机host"><a class="anchor" href="#36-tomcat虚拟主机host">#</a> 3.6 Tomcat 虚拟主机 Host</h5><ul><li>name: 主机名称</li><li>appBase：网站代码存放路径</li><li>unpackWARs：自动解压 war 包</li><li>autoDeploy：自动部署</li></ul><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">&lt;</span><span class="token operator">!</span>--tom1.hmallleasing.com--<span class="token operator">></span></pre></td></tr><tr><td data-num="2"></td><td><pre>      <span class="token operator">&lt;</span>Host <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"tom1.hmallleasing.com"</span>  <span class="token assign-left variable">appBase</span><span class="token operator">=</span><span class="token string">"/code/tom1"</span></pre></td></tr><tr><td data-num="3"></td><td><pre>            <span class="token assign-left variable">unpackWARs</span><span class="token operator">=</span><span class="token string">"true"</span> <span class="token assign-left variable">autoDeploy</span><span class="token operator">=</span><span class="token string">"true"</span><span class="token operator">></span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token operator">&lt;</span>Valve <span class="token assign-left variable">className</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.valves.AccessLogValve"</span> <span class="token assign-left variable">directory</span><span class="token operator">=</span><span class="token string">"logs"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>               <span class="token assign-left variable">prefix</span><span class="token operator">=</span><span class="token string">"tomcat_access_log"</span> <span class="token assign-left variable">suffix</span><span class="token operator">=</span><span class="token string">".txt"</span></pre></td></tr><tr><td data-num="6"></td><td><pre>               <span class="token assign-left variable">pattern</span><span class="token operator">=</span><span class="token string">"%h %l %u %t &amp;quot;%r&amp;quot; %s %b"</span> /<span class="token operator">></span></pre></td></tr><tr><td data-num="7"></td><td><pre>      <span class="token operator">&lt;</span>/Host<span class="token operator">></span></pre></td></tr></table></figure><p>创建网站代码存放路径，写入测试代码，并重启 Tomcat；</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@web01 soft<span class="token punctuation">]</span><span class="token comment"># mkdir /code/tom1/ROOT -p</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@web01 soft<span class="token punctuation">]</span><span class="token comment"># echo "Tomcat Test Page" > /code/tom1/ROOT/index.html</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@web01 soft<span class="token punctuation">]</span><span class="token comment"># systemctl stop tomcat &amp;&amp;  systemctl start tomcat</span></pre></td></tr></table></figure><p><img loading="lazy" data-src="https://wp-cdn.4ce.cn/v2/ieCVXl0.jpeg" alt="1.jpg"></p><h5 id="37-tomcat虚拟主机context"><a class="anchor" href="#37-tomcat虚拟主机context">#</a> 3.7 Tomcat 虚拟主机 Context</h5><p>context 使用方式</p><ul><li>docBase: 站点存放的路径</li><li>path: 访问站点的 URI 路径</li><li>reloadable：修改了 jsp 文件，无需重启就可以实现显示的同步</li></ul><p>访问 http:/tom2.hamllleasing.com/zh-&gt; 映射 -&gt;/code/zh</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">&lt;</span><span class="token operator">!</span>--tom1.hmallleasing.com--<span class="token operator">></span></pre></td></tr><tr><td data-num="2"></td><td><pre>      <span class="token operator">&lt;</span>Host <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"tom1.hmallleasing.com"</span>  <span class="token assign-left variable">appBase</span><span class="token operator">=</span><span class="token string">"/code/tom1"</span></pre></td></tr><tr><td data-num="3"></td><td><pre>            <span class="token assign-left variable">unpackWARs</span><span class="token operator">=</span><span class="token string">"true"</span> <span class="token assign-left variable">autoDeploy</span><span class="token operator">=</span><span class="token string">"true"</span><span class="token operator">></span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token operator">&lt;</span>Context <span class="token assign-left variable">docBase</span><span class="token operator">=</span><span class="token string">"/code/zh"</span> <span class="token assign-left variable">path</span><span class="token operator">=</span><span class="token string">"/zh"</span> <span class="token assign-left variable">reloadable</span><span class="token operator">=</span><span class="token string">"true"</span>/<span class="token operator">></span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token operator">&lt;</span>Valve <span class="token assign-left variable">className</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.valves.AccessLogValve"</span> <span class="token assign-left variable">directory</span><span class="token operator">=</span><span class="token string">"logs"</span></pre></td></tr><tr><td data-num="7"></td><td><pre>               <span class="token assign-left variable">prefix</span><span class="token operator">=</span><span class="token string">"tomcat_access_log"</span> <span class="token assign-left variable">suffix</span><span class="token operator">=</span><span class="token string">".txt"</span></pre></td></tr><tr><td data-num="8"></td><td><pre>               <span class="token assign-left variable">pattern</span><span class="token operator">=</span><span class="token string">"%h %l %u %t &amp;quot;%r&amp;quot; %s %b"</span> /<span class="token operator">></span></pre></td></tr><tr><td data-num="9"></td><td><pre>      <span class="token operator">&lt;</span>/Host<span class="token operator">></span></pre></td></tr></table></figure><p>注意：如果设定了 context，没有创建对应目录则无法启动 Tomcat</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@web01 tomcat<span class="token punctuation">]</span><span class="token comment"># tail -f /soft/tomcat/logs/catalina.out</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="3"></td><td><pre>	Caused by: java.lang.IllegalArgumentException: The main resource <span class="token builtin class-name">set</span> specified <span class="token punctuation">[</span>/code/zh<span class="token punctuation">]</span> is not a directory or war file, or is not readable <span class="token punctuation">(</span>it does not exist or permissions to access it are missing<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre>		at org.apache.catalina.webresources.StandardRoot.createMainResourceSet<span class="token punctuation">(</span>StandardRoot.java:758<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>		at org.apache.catalina.webresources.StandardRoot.startInternal<span class="token punctuation">(</span>StandardRoot.java:715<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre>		at org.apache.catalina.util.LifecycleBase.start<span class="token punctuation">(</span>LifecycleBase.java:164<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr></table></figure><p>创建对应目录，写入测试代码，并重启 Tomcat</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@web01 tomcat<span class="token punctuation">]</span><span class="token comment"># mkdir /code/zh</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@web01 tomcat<span class="token punctuation">]</span><span class="token comment"># echo "hello zh" > /code/zh/index.html</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@web01 tomcat<span class="token punctuation">]</span><span class="token comment"># systemctl stop tomcat &amp;&amp;  systemctl start tomcat</span></pre></td></tr></table></figure><p><img loading="lazy" data-src="https://wp-cdn.4ce.cn/v2/GoiPhZp.jpeg" alt="2.jpg"></p><h5 id="38-tomcat管理页面配置"><a class="anchor" href="#38-tomcat管理页面配置">#</a> 3.8 Tomcat 管理页面配置</h5><p>1、配置 Tomcat Bsic 认证，配置文件 /soft/tomcat/conf/tomcat-users.xml 最后添加用户，然后关联至对应资源的角色名称；</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@web03 ~<span class="token punctuation">]</span><span class="token comment"># vim /soft/tomcat/conf/tomcat-users.xml </span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token operator">&lt;</span>role <span class="token assign-left variable">rolename</span><span class="token operator">=</span><span class="token string">"manager-gui,admin-gui"</span>/<span class="token operator">></span></pre></td></tr><tr><td data-num="4"></td><td><pre>  <span class="token operator">&lt;</span>user <span class="token assign-left variable">username</span><span class="token operator">=</span><span class="token string">"tomcat"</span> <span class="token assign-left variable">password</span><span class="token operator">=</span><span class="token string">"123456"</span> <span class="token assign-left variable">roles</span><span class="token operator">=</span><span class="token string">"manager-gui,admin-gui"</span>/<span class="token operator">></span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">&lt;</span>/tomcat-users<span class="token operator">></span></pre></td></tr></table></figure><p>2、由于 Tomcat 仅语序本地 127.0.0.1 进行 basic 认证，如果需要其他网段通过 basic 认证，还需配置允许访问规则。找到 webapps/ 项目 / META-INF/context.xml 配置；</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#1. 修改第一个项目</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@web01 tomcat<span class="token punctuation">]</span><span class="token comment"># vim /soft/tomcat/webapps/host-manager/META-INF/context.xml</span></pre></td></tr><tr><td data-num="3"></td><td><pre>修改为：</pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token assign-left variable">allow</span><span class="token operator">=</span><span class="token string">"127\.\d+\.\d+\.\d+|::1|0:0:0:0:0:0:0:1|192\.168\.40\.\d+"</span> /<span class="token operator">></span></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token comment">#2. 修改第二个项目</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">[</span>root@web01 tomcat<span class="token punctuation">]</span><span class="token comment"># vim  /soft/tomcat/webapps/manager/META-INF/context.xml</span></pre></td></tr><tr><td data-num="8"></td><td><pre>修改后：</pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token assign-left variable">allow</span><span class="token operator">=</span><span class="token string">"127\.\d+\.\d+\.\d+|::1|0:0:0:0:0:0:0:1|192\.168\.40\.\d+"</span> /<span class="token operator">></span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">#3. 重启 tomcat</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">[</span>root@web01 ~<span class="token punctuation">]</span><span class="token comment"># systemctl stop tomcat &amp;&amp; systemctl start tomcat</span></pre></td></tr></table></figure><p><img loading="lazy" data-src="https://wp-cdn.4ce.cn/v2/gV1iMaz.jpeg" alt="3.jpg"></p><h4 id="四-tomcat部署zrlog"><a class="anchor" href="#四-tomcat部署zrlog">#</a> 四、Tomcat 部署 zrlog</h4><h5 id="41-zrlog单节点部署"><a class="anchor" href="#41-zrlog单节点部署">#</a> 4.1 zrlog 单节点部署</h5><h6 id="411-部署mysql"><a class="anchor" href="#411-部署mysql">#</a> 4.1.1 部署 MySQL</h6><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#1、关闭防火墙、selinux、环境配置</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@db01 ~<span class="token punctuation">]</span><span class="token comment"># hostnamectl set-hostname aizj_db01</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@db01 ~<span class="token punctuation">]</span><span class="token comment"># systemctl stop firewalld</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">[</span>root@db01 ~<span class="token punctuation">]</span><span class="token comment"># systemctl disable firewalld</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">[</span>root@db01 ~<span class="token punctuation">]</span><span class="token comment"># sed -i 's/^SELINUX=enforcing/SELINUX=disabled/g' /etc/sysconfig/selinux</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">[</span>root@db01 ~<span class="token punctuation">]</span><span class="token comment"># sed -i 's/^SELINUX=enforcing/SELINUX=disabled/g' /etc/selinux/config</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">[</span>root@db01 ~<span class="token punctuation">]</span><span class="token comment"># yum install net-tools vim tree lrzsz wget unzip dos2unix bash-completion  lsof ntp ntpdate git -y</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">[</span>root@db01 ~<span class="token punctuation">]</span><span class="token comment"># yum update -y --exclude=kernel* &amp;&amp; reboot</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">[</span>root@db01 ~<span class="token punctuation">]</span><span class="token comment"># echo 'Asia/Shanghai' >/etc/timezone</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">[</span>root@db01 ~<span class="token punctuation">]</span><span class="token comment"># ntpdate time2.aliyun.com</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">[</span>root@db01 ~<span class="token punctuation">]</span><span class="token comment"># crontab -e</span></pre></td></tr><tr><td data-num="12"></td><td><pre>*/5 * * * * /usr/sbin/ntpdate time2.aliyun.com <span class="token operator">&amp;></span> /dev/nul</pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">[</span>root@db01 ~<span class="token punctuation">]</span><span class="token comment"># mkdir /soft /data /scripts /backup</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token comment">#2、安装 Mysql5.7</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">[</span>root@db01 ~<span class="token punctuation">]</span><span class="token comment"># yum install -y mysql-community-server</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">[</span>root@db01 ~<span class="token punctuation">]</span><span class="token comment"># systemctl start mysqld &amp;&amp; systemctl enable mysqld</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">[</span>root@aizj_db01 ~<span class="token punctuation">]</span><span class="token comment"># mysql -uroot -p$(awk '/temporary password/&#123;print $NF&#125;' /var/log/mysqld.log)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>mysql<span class="token operator">></span> ALTER <span class="token environment constant">USER</span> <span class="token string">'root'</span>@<span class="token string">'localhost'</span> IDENTIFIED BY <span class="token string">'Superman*2023'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>mysql<span class="token operator">></span> grant all on *.* to <span class="token string">'zrlog'</span>@<span class="token string">'192.168.40.%'</span> identified by <span class="token string">'Superman*2023'</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token comment">#3、允许 root 用户在任何地方进行远程登录，并具有所有库任何操作权限，具体操作如下：</span></pre></td></tr><tr><td data-num="24"></td><td><pre>mysql <span class="token parameter variable">-u</span> root -p<span class="token string">"youpass"</span></pre></td></tr><tr><td data-num="25"></td><td><pre>mysql<span class="token operator">></span>GRANT ALL PRIVILEGES ON *.* TO <span class="token string">'root'</span>@<span class="token string">'%'</span> IDENTIFIED BY <span class="token string">'Superman*2023'</span> WITH GRANT OPTION<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>FLUSH PRIVILEGES<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token comment">#4. 创建数据库</span></pre></td></tr><tr><td data-num="29"></td><td><pre>mysql<span class="token operator">></span> create database zrlog<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>Query OK, <span class="token number">1</span> row affected <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span></pre></td></tr></table></figure><h6 id="412-配置tomcat虚拟主机"><a class="anchor" href="#412-配置tomcat虚拟主机">#</a> 4.1.2 配置 Tomcat 虚拟主机</h6><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@web01 ~<span class="token punctuation">]</span><span class="token comment"># vim /soft/tomcat/conf/server.xml </span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token operator">&lt;</span><span class="token operator">!</span>--zrlog.hmallleasing.com--<span class="token operator">></span></pre></td></tr><tr><td data-num="4"></td><td><pre>      <span class="token operator">&lt;</span>Host <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"zrlog.hmallleasing.com"</span>  <span class="token assign-left variable">appBase</span><span class="token operator">=</span><span class="token string">"/code/zrlog"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>            <span class="token assign-left variable">unpackWARs</span><span class="token operator">=</span><span class="token string">"true"</span> <span class="token assign-left variable">autoDeploy</span><span class="token operator">=</span><span class="token string">"true"</span><span class="token operator">></span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token operator">&lt;</span>Valve <span class="token assign-left variable">className</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.valves.AccessLogValve"</span> <span class="token assign-left variable">directory</span><span class="token operator">=</span><span class="token string">"logs"</span></pre></td></tr><tr><td data-num="7"></td><td><pre>               <span class="token assign-left variable">prefix</span><span class="token operator">=</span><span class="token string">"zrlog_access_log"</span> <span class="token assign-left variable">suffix</span><span class="token operator">=</span><span class="token string">".txt"</span></pre></td></tr><tr><td data-num="8"></td><td><pre>               <span class="token assign-left variable">pattern</span><span class="token operator">=</span><span class="token string">"%h %l %u %t &amp;quot;%r&amp;quot; %s %b"</span> /<span class="token operator">></span></pre></td></tr><tr><td data-num="9"></td><td><pre>      <span class="token operator">&lt;</span>/Host<span class="token operator">></span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr></table></figure><h6 id="413-准备项目代码"><a class="anchor" href="#413-准备项目代码">#</a> 4.1.3 准备项目代码</h6><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@web01 ~<span class="token punctuation">]</span><span class="token comment"># mkdir -p /code/zrlog</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@web01 ~<span class="token punctuation">]</span><span class="token comment"># mv zrlog-2.2.0-5e8a51f-release.war /code/zrlog/ROOT.war</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@web01 ~<span class="token punctuation">]</span><span class="token comment"># ls /code/zrlog/</span></pre></td></tr><tr><td data-num="4"></td><td><pre>ROOT.war</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">[</span>root@web01 ~<span class="token punctuation">]</span><span class="token comment"># systemctl stop tomcat &amp;&amp; systemctl start tomcat</span></pre></td></tr></table></figure><p><img loading="lazy" data-src="https://wp-cdn.4ce.cn/v2/hR5jFTN.jpeg" alt="1.jpg"></p><h5 id="42-zrlog集群部署"><a class="anchor" href="#42-zrlog集群部署">#</a> 4.2 zrlog 集群部署</h5><table><thead><tr><th style="text-align:center">服务器名称</th><th style="text-align:center">服务器 IP</th><th style="text-align:center">服务器角色</th></tr></thead><tbody><tr><td style="text-align:center">lb01</td><td style="text-align:center">192.168.40.150</td><td style="text-align:center">Nginx</td></tr><tr><td style="text-align:center">web01</td><td style="text-align:center">192.168.40.7</td><td style="text-align:center">Tomcat</td></tr><tr><td style="text-align:center">web02</td><td style="text-align:center">192.168.40.8</td><td style="text-align:center">Tomcat</td></tr><tr><td style="text-align:center">NFS</td><td style="text-align:center">192.168.40.32</td><td style="text-align:center">NFS</td></tr><tr><td style="text-align:center">db01</td><td style="text-align:center">192.168.40.51</td><td style="text-align:center">MySQL</td></tr><tr><td style="text-align:center">Redis</td><td style="text-align:center">192.168.40.41</td><td style="text-align:center">Redis</td></tr></tbody></table><h6 id="421-安装jdk"><a class="anchor" href="#421-安装jdk">#</a> 4.2.1 安装 jdk</h6><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@web01 ~<span class="token punctuation">]</span><span class="token comment"># scp jdk-8u451-linux-x64.tar.gz root@192.168.40.8:/root</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@web02 ~<span class="token punctuation">]</span><span class="token comment"># tar xf jdk-8u451-linux-x64.tar.gz  -C /usr/local/</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@web02 ~<span class="token punctuation">]</span><span class="token comment"># ln -s /usr/local/jdk1.8.0_451/ /usr/local/jdk</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">#添加环境变量</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">[</span>root@web02 ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/profile.d/jdk.sh</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/usr/local/jdk</pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$JAVA_HOME</span>/bin</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token builtin class-name">export</span> <span class="token assign-left variable">JRE_HOME</span><span class="token operator">=</span><span class="token variable">$JAVA_HOME</span>/jre </pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token builtin class-name">export</span> <span class="token assign-left variable">CLASSPATH</span><span class="token operator">=</span><span class="token variable">$JAVA_HOME</span>/lib/:<span class="token variable">$JRE_HOME</span>/lib/</pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">[</span>root@web02 ~<span class="token punctuation">]</span><span class="token comment"># source /etc/profile</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">[</span>root@web02 ~<span class="token punctuation">]</span><span class="token comment"># java -version</span></pre></td></tr></table></figure><h6 id="422-安装tomcat"><a class="anchor" href="#422-安装tomcat">#</a> 4.2.2 安装 Tomcat</h6><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@web01 ~<span class="token punctuation">]</span><span class="token comment"># scp -rp  /soft root@192.168.40.8:/</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@web02 ~<span class="token punctuation">]</span><span class="token comment"># rm -rf /soft/tomcat/</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@web02 soft<span class="token punctuation">]</span><span class="token comment"># ln -s /soft/apache-tomcat-9.0.106 /soft/tomcat</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">[</span>root@web01 ~<span class="token punctuation">]</span><span class="token comment"># scp /usr/lib/systemd/system/tomcat.service root@192.168.40.8:/usr/lib/systemd/system/tomcat.service</span></pre></td></tr></table></figure><h6 id="423-部署zrlog"><a class="anchor" href="#423-部署zrlog">#</a> 4.2.3 部署 zrlog</h6><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@web01 ~<span class="token punctuation">]</span><span class="token comment"># scp -rp /code/* root@192.168.40.8:/code/</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@web02 ~<span class="token punctuation">]</span><span class="token comment"># systemctl daemon-reload</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@web02 ~<span class="token punctuation">]</span><span class="token comment"># systemctl stop tomcat &amp;&amp; systemctl start tomcat</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token punctuation">[</span>root@web02 ~<span class="token punctuation">]</span><span class="token comment"># netstat -lntp|grep java</span></pre></td></tr><tr><td data-num="5"></td><td><pre>tcp6       <span class="token number">0</span>      <span class="token number">0</span> :::8080                 :::*                    LISTEN      <span class="token number">1806</span>/java           </pre></td></tr><tr><td data-num="6"></td><td><pre>tcp6       <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">127.0</span>.0.1:8005          :::*                    LISTEN      <span class="token number">1806</span>/java</pre></td></tr></table></figure><h6 id="424-接入nginx负载均衡"><a class="anchor" href="#424-接入nginx负载均衡">#</a> 4.2.4 接入 Nginx 负载均衡</h6><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># yum install nginx -y</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/nginx/conf.d/zrlog.hmallleasing.com.conf </span></pre></td></tr><tr><td data-num="3"></td><td><pre>upstream zrlog <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	server <span class="token number">192.168</span>.40.7:8080<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	server <span class="token number">192.168</span>.40.8:8080<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>server <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	listen <span class="token number">80</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	server_name zrlog.hmallleasing.com<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>	location / <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>		proxy_pass http://zrlog<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>		include proxy_params<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/nginx/proxy_params</span></pre></td></tr><tr><td data-num="19"></td><td><pre>proxy_set_header Host <span class="token variable">$http_host</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>proxy_set_header X-Real-IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>proxy_set_header X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre>proxy_connect_timeout <span class="token number">30</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>proxy_send_timeout <span class="token number">60</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>proxy_read_timeout <span class="token number">60</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre></pre></td></tr><tr><td data-num="27"></td><td><pre>proxy_buffering on<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>proxy_buffer_size 32k<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>proxy_buffers <span class="token number">4</span> 128k<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token punctuation">[</span>root@lb01 conf.d<span class="token punctuation">]</span><span class="token comment"># systemctl start nginx &amp;&amp; systemctl enable nginx</span></pre></td></tr></table></figure><h6 id="425-接入共享存储nfs"><a class="anchor" href="#425-接入共享存储nfs">#</a> 4.2.5 接入共享存储 Nfs</h6><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@nfs ~<span class="token punctuation">]</span><span class="token comment"># yum install nfs-utils -y</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@nfs ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/exports</span></pre></td></tr><tr><td data-num="3"></td><td><pre>/data/zrlog <span class="token number">192.168</span>.40.0/24<span class="token punctuation">(</span>rw,all_squash,anonuid<span class="token operator">=</span><span class="token number">666</span>,anongid<span class="token operator">=</span><span class="token number">666</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">[</span>root@nfs ~<span class="token punctuation">]</span><span class="token comment"># groupadd -g 666 www</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">[</span>root@nfs ~<span class="token punctuation">]</span><span class="token comment"># useradd -u 666 -g 666 www</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">[</span>root@nfs ~<span class="token punctuation">]</span><span class="token comment"># mkdir /data/zrlog -p</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">[</span>root@nfs ~<span class="token punctuation">]</span><span class="token comment"># chown -R www.www /data/zrlog/</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">[</span>root@nfs ~<span class="token punctuation">]</span><span class="token comment"># systemctl start nfs-server &amp;&amp; systemctl enable nfs-server</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment">#web01 挂载 nfs</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">[</span>root@web01 ~<span class="token punctuation">]</span><span class="token comment"># yum install nfs-utils -y</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">[</span>root@web01 ~<span class="token punctuation">]</span><span class="token comment"># mkdir /code/zrlog/ROOT/attached</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">[</span>root@web01 ~<span class="token punctuation">]</span><span class="token comment"># mount -t nfs 192.168.40.32:/data/zrlog /code/zrlog/ROOT/attached/</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">[</span>root@web01 ~<span class="token punctuation">]</span><span class="token comment"># groupadd -g 666 www</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">[</span>root@web01 ~<span class="token punctuation">]</span><span class="token comment"># useradd -u 666 -g 666 www</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token comment">#web02 挂载 nfs, 由于 web02 节点没有该静态资源目录，所以自行创建</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">[</span>root@web02 ~<span class="token punctuation">]</span><span class="token comment"># yum install nfs-utils -y</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">[</span>root@web02 ~<span class="token punctuation">]</span><span class="token comment"># mkdir /code/zrlog/ROOT/attached</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">[</span>root@web02 ~<span class="token punctuation">]</span><span class="token comment"># mount -t nfs 192.168.40.32:/data/zrlog /code/zrlog/ROOT/attached/</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token punctuation">[</span>root@web02 ~<span class="token punctuation">]</span><span class="token comment"># groupadd -g 666 www</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">[</span>root@web02 ~<span class="token punctuation">]</span><span class="token comment"># useradd -u 666 -g 666 www</span></pre></td></tr></table></figure><h6 id="426-集群配置https"><a class="anchor" href="#426-集群配置https">#</a> 4.2.6 集群配置 Https</h6><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@lb01 ssl_key<span class="token punctuation">]</span><span class="token comment"># [root@lb01 ~]# cat /etc/nginx/conf.d/zrlog.hmallleasing.com.conf </span></pre></td></tr><tr><td data-num="2"></td><td><pre>upstream zrlog <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	server <span class="token number">192.168</span>.40.7:8080<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	server <span class="token number">192.168</span>.40.8:8080<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>server <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        listen <span class="token number">443</span> ssl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	server_name zrlog.hmallleasing.com<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>        client_max_body_size 1G<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        ssl_prefer_server_ciphers on<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        ssl_certificate  /etc/nginx/ssl_key/hmallleasing.com.pem<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        ssl_certificate_key  /etc/nginx/ssl_key/hmallleasing.com.key<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        ssl_session_timeout 100m<span class="token punctuation">;</span>               <span class="token comment">#多长时间内如果再进行连接，则不需要进行握手过程</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        ssl_session_cache shared:cache:10m<span class="token punctuation">;</span>     <span class="token comment">#建立会话的缓存</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>	location / <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>		proxy_pass http://zrlog<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>		include proxy_params<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre>server <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>      listen <span class="token number">80</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>      server_name zrlog.hmallleasing.com<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>      <span class="token builtin class-name">return</span> <span class="token number">302</span> https://<span class="token variable">$server_name</span><span class="token variable">$request_uri</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token comment">#创建证书目录</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># mkdir /etc/nginx/ssl_key</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token punctuation">[</span>root@lb01 ssl_key<span class="token punctuation">]</span><span class="token comment"># nginx -t</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># systemctl reload nginx</span></pre></td></tr></table></figure><h6 id="427-tomcat会话保持session"><a class="anchor" href="#427-tomcat会话保持session">#</a> 4.2.7 Tomcat 会话保持 session</h6><p>1、为 web01、web02 节点添加虚拟主机</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@web01 ~<span class="token punctuation">]</span><span class="token comment"># vim /soft/tomcat/conf/server.xml</span></pre></td></tr><tr><td data-num="2"></td><td><pre>      <span class="token operator">&lt;</span><span class="token operator">!</span>--session.hmallleasing.com--<span class="token operator">></span></pre></td></tr><tr><td data-num="3"></td><td><pre>      <span class="token operator">&lt;</span>Host <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"session.hmallleasing.com"</span>  <span class="token assign-left variable">appBase</span><span class="token operator">=</span><span class="token string">"/code/session"</span></pre></td></tr><tr><td data-num="4"></td><td><pre>            <span class="token assign-left variable">unpackWARs</span><span class="token operator">=</span><span class="token string">"true"</span> <span class="token assign-left variable">autoDeploy</span><span class="token operator">=</span><span class="token string">"true"</span><span class="token operator">></span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token operator">&lt;</span>Valve <span class="token assign-left variable">className</span><span class="token operator">=</span><span class="token string">"org.apache.catalina.valves.AccessLogValve"</span> <span class="token assign-left variable">directory</span><span class="token operator">=</span><span class="token string">"logs"</span></pre></td></tr><tr><td data-num="6"></td><td><pre>               <span class="token assign-left variable">prefix</span><span class="token operator">=</span><span class="token string">"zrlog_access_log"</span> <span class="token assign-left variable">suffix</span><span class="token operator">=</span><span class="token string">".txt"</span></pre></td></tr><tr><td data-num="7"></td><td><pre>               <span class="token assign-left variable">pattern</span><span class="token operator">=</span><span class="token string">"%h %l %u %t &amp;quot;%r&amp;quot; %s %b"</span> /<span class="token operator">></span></pre></td></tr><tr><td data-num="8"></td><td><pre>      <span class="token operator">&lt;</span>/Host<span class="token operator">></span></pre></td></tr></table></figure><p>2、为 web01、web02 配置 session 相关的网页</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#1. 配置 web01</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@web01 ~<span class="token punctuation">]</span><span class="token comment"># mkdir /code/session/ROOT -p</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@web01 ~<span class="token punctuation">]</span><span class="token comment"># cat /code/session/ROOT/index.jsp</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token operator">&lt;</span>body<span class="token operator">></span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token operator">&lt;</span>%</pre></td></tr><tr><td data-num="6"></td><td><pre>//HttpSession session <span class="token operator">=</span> request.getSession<span class="token punctuation">(</span>true<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>System.out.println<span class="token punctuation">(</span>session.getCreationTime<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>out.println<span class="token punctuation">(</span><span class="token string">"&lt;br> web01 SESSION ID:"</span> + session.getId<span class="token punctuation">(</span><span class="token punctuation">)</span> + <span class="token string">"&lt;br>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>out.println<span class="token punctuation">(</span><span class="token string">"Session created time is :"</span> + session.getCreationTime<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>+ <span class="token string">"&lt;br>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>%<span class="token operator">></span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token operator">&lt;</span>/body<span class="token operator">></span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">[</span>root@web01 ~<span class="token punctuation">]</span><span class="token comment"># systemctl stop tomcat &amp;&amp; systemctl start tomcat</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">[</span>root@web01 ~<span class="token punctuation">]</span><span class="token comment"># curl -HHost:session.hmallleasing.com http://192.168.40.7:8080</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment">#2. 配置 web02</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">[</span>root@web02 ~<span class="token punctuation">]</span><span class="token comment"># mkdir /code/session/ROOT -p</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">[</span>root@web02 ~<span class="token punctuation">]</span><span class="token comment"># cat /code/session/ROOT/index.jsp</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token operator">&lt;</span>body<span class="token operator">></span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token operator">&lt;</span>%</pre></td></tr><tr><td data-num="22"></td><td><pre>//HttpSession session <span class="token operator">=</span> request.getSession<span class="token punctuation">(</span>true<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>System.out.println<span class="token punctuation">(</span>session.getCreationTime<span class="token punctuation">(</span><span class="token punctuation">))</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>out.println<span class="token punctuation">(</span><span class="token string">"&lt;br> web02 SESSION ID:"</span> + session.getId<span class="token punctuation">(</span><span class="token punctuation">)</span> + <span class="token string">"&lt;br>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>out.println<span class="token punctuation">(</span><span class="token string">"Session created time is :"</span> + session.getCreationTime<span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre>+ <span class="token string">"&lt;br>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>%<span class="token operator">></span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token operator">&lt;</span>/body<span class="token operator">></span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token punctuation">[</span>root@web02 ~<span class="token punctuation">]</span><span class="token comment"># systemctl stop tomcat &amp;&amp; systemctl start tomcat</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token punctuation">[</span>root@web02 ~<span class="token punctuation">]</span><span class="token comment"># curl -HHost:session.hmallleasing.com http://192.168.40.7:8080</span></pre></td></tr></table></figure><p>3、接入负载均衡，测试检查，看看是否通过轮询调度，获取的 session 是不一致</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/nginx/conf.d/session.hmallleasing.com.conf</span></pre></td></tr><tr><td data-num="2"></td><td><pre>upstream session <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	server <span class="token number">192.168</span>.40.7:8080<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	server <span class="token number">192.168</span>.40.8:8080<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>server <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        listen <span class="token number">443</span> ssl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	server_name session.hmallleasing.com<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>        client_max_body_size 1G<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        ssl_prefer_server_ciphers on<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        ssl_certificate  /etc/nginx/ssl_key/hmallleasing.com.pem<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        ssl_certificate_key  /etc/nginx/ssl_key/hmallleasing.com.key<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        ssl_session_timeout 100m<span class="token punctuation">;</span>               <span class="token comment">#多长时间内如果再进行连接，则不需要进行握手过程</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        ssl_session_cache shared:cache:10m<span class="token punctuation">;</span>     <span class="token comment">#建立会话的缓存</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>	location / <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>		proxy_pass http://session<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>		include proxy_params<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre>server <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>      listen <span class="token number">80</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>      server_name session.hmallleasing.com<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>      <span class="token builtin class-name">return</span> <span class="token number">302</span> https://<span class="token variable">$server_name</span><span class="token variable">$request_uri</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token punctuation">[</span>root@lb01 conf.d<span class="token punctuation">]</span><span class="token comment"># nginx -t</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token punctuation">[</span>root@lb01 conf.d<span class="token punctuation">]</span><span class="token comment"># systemctl reload nginx</span></pre></td></tr></table></figure><p><img loading="lazy" data-src="https://wp-cdn.4ce.cn/v2/3syDtTJ.jpeg" alt="1.jpg"></p><p>当用户通过负载均衡向服务器 A 发起 http 请求，A 服务器会下发一个 sessionID，通过 head 中 set-cookie 回传用户，用户下次请求时会携带 cookie 字段加上服务器用户名和密码进行请求 A 服务器，该值就是 A 服务器下发的 sessionID，如果验证通过则登录成功。由于负载均衡采用轮询调度机制，请求 A 节点下发一个 sessionID，用户带着 A 节点下发一个 sessionID 请求负载均衡，会调度到 B 节点，B 节点不认 A 节点 sessionID，最终形成死循环。</p><p>4、使用负载均衡 ip_hash 来解决 session；</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/nginx/conf.d/session.hmallleasing.com.conf</span></pre></td></tr><tr><td data-num="2"></td><td><pre>upstream session <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>         ip_hash<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	server <span class="token number">192.168</span>.40.7:8080<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	server <span class="token number">192.168</span>.40.8:8080<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>server <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        listen <span class="token number">443</span> ssl<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	server_name session.hmallleasing.com<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>        client_max_body_size 1G<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        ssl_prefer_server_ciphers on<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        ssl_certificate  ssl_key/hmallleasing.com.pem<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        ssl_certificate_key  ssl_key/hmallleasing.com.key<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        ssl_session_timeout 100m<span class="token punctuation">;</span>               <span class="token comment">#多长时间内如果再进行连接，则不需要进行握手过程</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        ssl_session_cache shared:cache:10m<span class="token punctuation">;</span>     <span class="token comment">#建立会话的缓存</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>	location / <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>		proxy_pass http://session<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>		include proxy_params<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre>server <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>      listen <span class="token number">80</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>      server_name session.hmallleasing.com<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>      <span class="token builtin class-name">return</span> <span class="token number">302</span> https://<span class="token variable">$server_name</span><span class="token variable">$request_uri</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># nginx -t </span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token punctuation">[</span>root@lb01 ~<span class="token punctuation">]</span><span class="token comment"># systemctl reload nginx</span></pre></td></tr></table></figure><p>5、通过 redis 来解决 session 会话保持</p><p><img loading="lazy" data-src="https://wp-cdn.4ce.cn/v2/WcgGtb7.jpeg" alt="1.jpg"></p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">#1. 安装 redis, 配置 redis</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">[</span>root@redis ~<span class="token punctuation">]</span><span class="token comment"># yum install redis -y</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">[</span>root@redis ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/redis.conf</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token builtin class-name">bind</span> <span class="token number">127.0</span>.0.1 <span class="token number">192.168</span>.40.104</pre></td></tr><tr><td data-num="5"></td><td><pre>requirepass <span class="token number">123456</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">[</span>root@redis ~<span class="token punctuation">]</span><span class="token comment"># systemctl start redis &amp;&amp; systemctl enable redis</span></pre></td></tr><tr><td data-num="7"></td><td><pre>		</pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token comment">#2. 检查 redis 是否正常能对外提供服务</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">[</span>root@db01 ~<span class="token punctuation">]</span><span class="token comment"># redis-cli -h 192.168.40.41 -a 123456</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token number">192.168</span>.40.104:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> keys *</pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>	</pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token comment">#3.tomcat 要支持 redis，需要模块（需要的是 jar 包）所有的应用节点都需要配置</span></pre></td></tr><tr><td data-num="14"></td><td><pre>https://github.com/ran-jit/tomcat-cluster-redis-session-manager</pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">[</span>root@web01 ~<span class="token punctuation">]</span><span class="token comment"># wget https://github.com/ran-jit/tomcat-cluster-redis-session-manager/releases/download/4.0/tomcat-cluster-redis-session-manager.zip	</span></pre></td></tr><tr><td data-num="16"></td><td><pre>	</pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment">#4.web01、web02 复制 jar 包到 tomcat/lib 目录中</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">[</span>root@web01 ~<span class="token punctuation">]</span><span class="token comment"># unzip tomcat-cluster-redis-session-manager.zip</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">[</span>root@web01 ~<span class="token punctuation">]</span><span class="token comment"># cp tomcat-cluster-redis-session-manager/lib/* /soft/tomcat/lib/</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token comment">#5.web01、web02 复制 redis 配置文件到 tomcat/conf 目录中。并更新他；</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">[</span>root@web01 ~<span class="token punctuation">]</span><span class="token comment"># cp tomcat-cluster-redis-session-manager/conf/redis-data-cache.properties /soft/tomcat/conf/</span></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token comment">#6.web01、web02 修改 redis 配置信息</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token punctuation">[</span>root@web01 ~<span class="token punctuation">]</span><span class="token comment"># vim /soft/tomcat/conf/redis-data-cache.properties</span></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token comment">#- redis hosts. ex: 127.0.0.1:6379, 127.0.0.2:6379, 127.0.0.2:6380, ....</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token assign-left variable">redis.hosts</span><span class="token operator">=</span><span class="token number">192.16</span>.40.41:6379</pre></td></tr><tr><td data-num="28"></td><td><pre></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token comment">#- redis password.</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token assign-left variable">redis.password</span><span class="token operator">=</span><span class="token number">123456</span></pre></td></tr><tr><td data-num="31"></td><td><pre></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token comment">#7..web01、web02 添加两行配置文件在 tomcat/conf/context.xml</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token punctuation">[</span>root@web02 ~<span class="token punctuation">]</span><span class="token comment"># vim /soft/tomcat/conf/context.xml</span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="35"></td><td><pre>        <span class="token operator">&lt;</span>Valve <span class="token assign-left variable">className</span><span class="token operator">=</span><span class="token string">"tomcat.request.session.redis.SessionHandlerValve"</span> /<span class="token operator">></span></pre></td></tr><tr><td data-num="36"></td><td><pre>        <span class="token operator">&lt;</span>Manager <span class="token assign-left variable">className</span><span class="token operator">=</span><span class="token string">"tomcat.request.session.redis.SessionManager"</span> /<span class="token operator">></span></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token operator">&lt;</span>/Context<span class="token operator">></span></pre></td></tr><tr><td data-num="38"></td><td><pre></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token comment">#8.web01、web02 可选：修改 session 过期时间，默认 30m</span></pre></td></tr><tr><td data-num="40"></td><td><pre><span class="token punctuation">[</span>root@web01 ~<span class="token punctuation">]</span><span class="token comment"># vim /soft/tomcat/conf/web.xml</span></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token punctuation">..</span>.</pre></td></tr><tr><td data-num="42"></td><td><pre><span class="token operator">&lt;</span>session-config<span class="token operator">></span></pre></td></tr><tr><td data-num="43"></td><td><pre>  <span class="token operator">&lt;</span>session-timeout<span class="token operator">></span><span class="token number">6</span><span class="token operator"><span class="token file-descriptor important">0</span>&lt;</span>/session-timeout<span class="token operator">></span></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token operator">&lt;</span>/session-config<span class="token operator">></span></pre></td></tr><tr><td data-num="45"></td><td><pre></pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token comment">#8.web01、web02 重启 tomcat</span></pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token punctuation">[</span>root@web01 ~<span class="token punctuation">]</span><span class="token comment"># systemctl stop tomcat &amp;&amp; systemctl start tomcat</span></pre></td></tr><tr><td data-num="48"></td><td><pre></pre></td></tr><tr><td data-num="49"></td><td><pre><span class="token comment">#9.redis 查看 session</span></pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token punctuation">[</span>root@redis ~<span class="token punctuation">]</span><span class="token comment"># redis-cli -h 192.168.40.41 -a 123456</span></pre></td></tr><tr><td data-num="51"></td><td><pre><span class="token number">192.168</span>.40.41:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> flushdb</pre></td></tr><tr><td data-num="52"></td><td><pre><span class="token number">192.168</span>.40.41:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> keys *</pre></td></tr><tr><td data-num="53"></td><td><pre><span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"A8704CF8988CF60C30080420BA66AD0F"</span></pre></td></tr></table></figure><p><img loading="lazy" data-src="https://wp-cdn.4ce.cn/v2/NbEnM7U.jpeg" alt="2.jpg"></p><div class="tags"><a href="/tags/Tomcat/" rel="tag"><i class="ic i-tag"></i>Tomcat</a></div></div><footer><div class="meta"><span class="icon"><i class="ic i-eye"></i></span><span>此文章已被阅读次数:</span><span class="waline-pageview-count" id="twikoo_visitors" data-path="/posts/4201058646.html">正在加载...</span><span class="item"><span class="icon"><i class="ic i-calendar-check"></i></span><span class="text">更新于</span><time title="修改时间：2025-06-15 16:03:35" itemprop="dateModified" datetime="2025-06-15T16:03:35+08:00">2025-06-15</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i>赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img loading="lazy" data-src="/assets/wechatpay.png" alt="Xu Yong 微信支付"><p>微信支付</p></div><div><img loading="lazy" data-src="/assets/alipay.png" alt="Xu Yong 支付宝"><p>支付宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者：</strong>Xu Yong<i class="ic i-at"><em>@</em></i>LinuxSre云原生</li><li class="link"><strong>本文链接：</strong><a href="http://ixuyong.cn/posts/4201058646.html" title="Tomcat配置管理实践">http://ixuyong.cn/posts/4201058646.html</a></li><li class="license"><strong>版权声明：</strong>本站所有文章除特别声明外，均采用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/posts/2260957686.html" rel="prev" itemprop="url" data-background-image="https:&#x2F;&#x2F;wp-cdn.4ce.cn&#x2F;v2&#x2F;o3aSHQA.jpeg" title="Linux—Centos7修改网卡名称"><span class="type">上一篇</span><span class="category"><i class="ic i-flag"></i>Linux</span><h3>Linux—Centos7修改网卡名称</h3></a></div><div class="item right"><a href="/posts/754945111.html" rel="next" itemprop="url" data-background-image="https:&#x2F;&#x2F;wp-cdn.4ce.cn&#x2F;v2&#x2F;QNeI5Oz.jpeg" title="Tomcat JVM调优实践"><span class="type">下一篇</span><span class="category"><i class="ic i-flag"></i>Tomcat</span><h3>Tomcat JVM调优实践</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#tomcat%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86%E5%AE%9E%E8%B7%B5"><span class="toc-number">1.</span> <span class="toc-text">Tomcat 配置管理实践</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%80-oraclejdk%E5%AE%89%E8%A3%85"><span class="toc-number">1.1.</span> <span class="toc-text">一、OracleJdk 安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%8C-tomcat%E5%AE%89%E8%A3%85"><span class="toc-number">1.2.</span> <span class="toc-text">二、Tomcat 安装</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89-tomcat%E9%85%8D%E7%BD%AE"><span class="toc-number">1.3.</span> <span class="toc-text">三、Tomcat 配置</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#31-tomcat%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="toc-number">1.3.1.</span> <span class="toc-text">3.1 Tomcat 目录结构</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#32-tomcat%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E8%AF%B4%E6%98%8E"><span class="toc-number">1.3.2.</span> <span class="toc-text">3.2 Tomcat 配置文件说明</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#33tomcat%E8%AF%B7%E6%B1%82%E6%B5%81%E7%A8%8B"><span class="toc-number">1.3.3.</span> <span class="toc-text">3.3Tomcat 请求流程</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#35-tomcat%E4%B8%8Enginx%E5%AF%B9%E6%AF%94"><span class="toc-number">1.3.4.</span> <span class="toc-text">3.5 Tomcat 与 Nginx 对比</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#36-tomcat%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BAhost"><span class="toc-number">1.3.5.</span> <span class="toc-text">3.6 Tomcat 虚拟主机 Host</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#37-tomcat%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BAcontext"><span class="toc-number">1.3.6.</span> <span class="toc-text">3.7 Tomcat 虚拟主机 Context</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#38-tomcat%E7%AE%A1%E7%90%86%E9%A1%B5%E9%9D%A2%E9%85%8D%E7%BD%AE"><span class="toc-number">1.3.7.</span> <span class="toc-text">3.8 Tomcat 管理页面配置</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9B%9B-tomcat%E9%83%A8%E7%BD%B2zrlog"><span class="toc-number">1.4.</span> <span class="toc-text">四、Tomcat 部署 zrlog</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#41-zrlog%E5%8D%95%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2"><span class="toc-number">1.4.1.</span> <span class="toc-text">4.1 zrlog 单节点部署</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#411-%E9%83%A8%E7%BD%B2mysql"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">4.1.1 部署 MySQL</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#412-%E9%85%8D%E7%BD%AEtomcat%E8%99%9A%E6%8B%9F%E4%B8%BB%E6%9C%BA"><span class="toc-number">1.4.1.2.</span> <span class="toc-text">4.1.2 配置 Tomcat 虚拟主机</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#413-%E5%87%86%E5%A4%87%E9%A1%B9%E7%9B%AE%E4%BB%A3%E7%A0%81"><span class="toc-number">1.4.1.3.</span> <span class="toc-text">4.1.3 准备项目代码</span></a></li></ol></li><li class="toc-item toc-level-5"><a class="toc-link" href="#42-zrlog%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2"><span class="toc-number">1.4.2.</span> <span class="toc-text">4.2 zrlog 集群部署</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#421-%E5%AE%89%E8%A3%85jdk"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">4.2.1 安装 jdk</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#422-%E5%AE%89%E8%A3%85tomcat"><span class="toc-number">1.4.2.2.</span> <span class="toc-text">4.2.2 安装 Tomcat</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#423-%E9%83%A8%E7%BD%B2zrlog"><span class="toc-number">1.4.2.3.</span> <span class="toc-text">4.2.3 部署 zrlog</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#424-%E6%8E%A5%E5%85%A5nginx%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="toc-number">1.4.2.4.</span> <span class="toc-text">4.2.4 接入 Nginx 负载均衡</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#425-%E6%8E%A5%E5%85%A5%E5%85%B1%E4%BA%AB%E5%AD%98%E5%82%A8nfs"><span class="toc-number">1.4.2.5.</span> <span class="toc-text">4.2.5 接入共享存储 Nfs</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#426-%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AEhttps"><span class="toc-number">1.4.2.6.</span> <span class="toc-text">4.2.6 集群配置 Https</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#427-tomcat%E4%BC%9A%E8%AF%9D%E4%BF%9D%E6%8C%81session"><span class="toc-number">1.4.2.7.</span> <span class="toc-text">4.2.7 Tomcat 会话保持 session</span></a></li></ol></li></ol></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li class="active"><a href="/posts/4201058646.html" rel="bookmark" title="Tomcat配置管理实践">Tomcat配置管理实践</a></li><li><a href="/posts/754945111.html" rel="bookmark" title="Tomcat JVM调优实践">Tomcat JVM调优实践</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" loading="lazy" decoding="async" itemprop="image" alt="Xu Yong" src="/assets/avatar.png"><p class="name" itemprop="name">Xu Yong</p><div class="description" itemprop="description">专注于 Linux 运维、云计算、云原⽣等技术</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">50</span><span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">15</span><span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">18</span><span class="name">标签</span></a></div></nav><div class="social"><a target="_blank" rel="noopener" href="https://github.com/xyapples" class="item github" title="https:&#x2F;&#x2F;github.com&#x2F;xyapples"><i class="ic i-github"></i></a><a target="_blank" rel="noopener" href="https://gitee.com/chinagei" class="item gitee" title="https:&#x2F;&#x2F;gitee.com&#x2F;chinagei"><i class="ic i-gitee"></i></a><a href="mailto:373370405@qq.com" class="item email" title="mailto:373370405@qq.com"><i class="ic i-envelope"></i></a></div><div class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-about"></i>关于</a></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友链</a></li></div></div></div></div><ul id="quick"><li class="prev pjax"><a href="/posts/754945111.html" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/posts/2260957686.html" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/Kubernetes/" title="分类于Kubernetes">Kubernetes</a></div><span><a href="/posts/2771271649.html">云原生K8s安全专家CKS认证考题详解</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Kubernetes/" title="分类于Kubernetes">Kubernetes</a></div><span><a href="/posts/722512536.html">K8s细粒度权限控制RBAC</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Redis/" title="分类于Redis">Redis</a></div><span><a href="/posts/1414180692.html">Redis集群（主从+哨兵）模式</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Kubernetes/" title="分类于Kubernetes">Kubernetes</a></div><span><a href="/posts/3030097036.html">K8S云原生存储Rook-Ceph</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Linux/" title="分类于Linux">Linux</a></div><span><a href="/posts/2889248111.html">Vsftp服务实践</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/DevOps/" title="分类于DevOps">DevOps</a></div><span><a href="/posts/1366748664.html">K8S基于Jenkins实现Java项目CI与CD实践（二）</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Linux/" title="分类于Linux">Linux</a></div><span><a href="/posts/581151773.html">100个运维相关技术官网汇总</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Kubernetes/" title="分类于Kubernetes">Kubernetes</a></div><span><a href="/posts/176412055.html">K8s准入控制ResourceQuota、LimitRange、QoS服务质量</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Rabbitmq/" title="分类于Rabbitmq">Rabbitmq</a></div><span><a href="/posts/1384812626.html">Kubenetes部署Rabbitmq集群</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Rabbitmq/" title="分类于Rabbitmq">Rabbitmq</a></div><span><a href="/posts/2692178654.html">Rabbitmq集群部署</a></span></li></ul></div><div class="rpost pjax"><h2>最新评论</h2><ul class="leancloud-recent-comment" id="new-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2022 -<span itemprop="copyrightYear">2025</span><span class="with-love"><i class="ic i-sakura rotate"></i></span><span class="author" itemprop="copyrightHolder">Xu Yong @ LinuxSre云原生</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i></span><span title="站点总字数">1.5m 字</span><span class="post-meta-divider"> | </span><span class="post-meta-item-icon"><i class="ic i-coffee"></i></span><span title="站点阅读时长">22:57</span></div><div class="powered-by">基于 <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a> & Theme.<a target="_blank" rel="noopener" href="https://github.com/theme-shoka-x/hexo-theme-shokaX/">ShokaX</a></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL = {
    ispost: true,
        path: `posts/4201058646.html`,
        favicon: {
        show: `（●´3｀●）やれやれだぜ`,
        hide: `(´Д｀)大変だ！`
    },
    search: {
        placeholder: "文章搜索",
        empty: "关于 「 ${query} 」，什么也没搜到",
        stats: "${time} ms 内找到 ${hits} 条结果"
    },
    copy_tex: false,
    katex: false,
    mermaid: false,
    audio: undefined,
    fancybox: true,
    nocopy: false,
    outime: true,
    template: `<div class="note warning"><p><span class="label warning">文章时效性提示</span><br>这是一篇发布于 {{publish}} 天前，最后一次更新在 {{updated}} 天前的文章，部分信息可能已经发生改变，请注意甄别。</p></div>`,
    quiz: {
        choice: `单选题`,
        multiple: `多选题`,
        true_false: `判断题`,
        essay: `问答题`,
        gap_fill: `填空题`,
        mistake: `错题备注`
    },
    ignores: [
        (uri) => uri.includes('#'),
        (uri) => new RegExp(LOCAL.path + '$').test(uri),
            []
    ]
};</script><script src="https://s4.zstatic.net/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha384-k6YtvFUEIuEFBdrLKJ3YAUbBki333tj1CSUisai5Cswsg9wcLNaPzsTHDswp4Az8" crossorigin="anonymous" fetchpriority="high"></script><script src="https://s4.zstatic.net/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha384-ZvpUoO&#x2F;+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn&#x2F;6Z&#x2F;hRTt8+pR6L4N2" crossorigin="anonymous" fetchpriority="high"></script><script src="/js/siteInit.js?v=0.4.17" type="module" fetchpriority="high" defer></script></body></html><!-- rebuild by hrmmi -->